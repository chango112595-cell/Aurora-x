#!/usr/bin/env python3
"""load_gen.py - simple load generator for IPC/chat endpoints"""
import argparse, os, requests, time, threading
def worker(url, count, delay):
    for i in range(count):
        try:
            r = requests.get(url, timeout=5)
            print('code', r.status_code)
        except Exception as e:
            print('err', e)
        time.sleep(delay)
if __name__ == '__main__':
    p = argparse.ArgumentParser()
    host = os.getenv("AURORA_HOST", "localhost")
    port = os.getenv("AURORA_BACKEND_PORT", "5000")
    base_url = os.getenv("AURORA_BASE_URL", f"http://{host}:{port}")
    p.add_argument('--url', default=f"{base_url}/healthz")
    p.add_argument('--clients', type=int, default=10)
    p.add_argument('--rps', type=float, default=1.0)
    args = p.parse_args()
    threads=[]
    for i in range(args.clients):
        t = threading.Thread(target=worker, args=(args.url, int(10*args.rps), 1.0/args.rps))
        t.start(); threads.append(t)
    for t in threads: t.join()
