#!/usr/bin/env python3
"""
Aurora-X Start Command (100% Hybrid Mode)
Launches enhanced system with auto-update
"""

import subprocess
import sys
import os
import time
from pathlib import Path

print("\n" + "="*80)
print("üåå AURORA-X: Starting 100% Hybrid Mode with Auto-Update")
print("="*80 + "\n")

# Get script directory
script_dir = Path(__file__).parent
os.chdir(script_dir)

# Check if enhanced x-start exists
enhanced_path = script_dir / "x-start-enhanced"
if not enhanced_path.exists():
    print("‚ùå x-start-enhanced not found!")
    print("   Creating it now...\n")
    
    # Build the enhanced x-start
    build_script = script_dir / "aurora_build_enhanced_xstart.py"
    if build_script.exists():
        try:
            subprocess.run([sys.executable, str(build_script)], check=True)
            print("\n‚úÖ x-start-enhanced created!\n")
        except subprocess.CalledProcessError as e:
            print(f"‚ùå Failed to create x-start-enhanced: {e}")
            sys.exit(1)
    else:
        print("‚ùå aurora_build_enhanced_xstart.py not found!")
        sys.exit(1)

print("üîÑ PHASE 1: Auto-Update Check")
print("‚îÅ" * 80)

# Check if auto-update system exists
auto_update_files = [
    "aurora_deep_system_updater.py",
    "aurora_complete_system_update.py",
    "aurora_automatic_system_update.py"
]

auto_update_script = None
for file in auto_update_files:
    if (script_dir / file).exists():
        auto_update_script = file
        break

if auto_update_script:
    print(f"üîÑ Running auto-update: {auto_update_script}")
    try:
        # Run auto-update in background
        subprocess.Popen(
            [sys.executable, str(script_dir / auto_update_script)],
            stdout=subprocess.DEVNULL,
            stderr=subprocess.DEVNULL
        )
        print("   ‚úÖ Auto-update running in background")
        time.sleep(2)
    except Exception as e:
        print(f"   ‚ö†Ô∏è  Auto-update failed to start: {e}")
else:
    print("   ‚ÑπÔ∏è  No auto-update system found (optional)")

print("\nüöÄ PHASE 2: Launching Enhanced System (26 Services)")
print("‚îÅ" * 80)
print("   This will activate the production runtime services...")
print("   ‚Ä¢ Backend API + Frontend (5000)")
print("   ‚Ä¢ Aurora Bridge (5001)")
print("   ‚Ä¢ Aurora Nexus V3 (5002)")
print("   ‚Ä¢ Luminar Nexus V2 (8000)\n")

# Launch the enhanced x-start
try:
    subprocess.run([sys.executable, str(enhanced_path)], check=True)
except KeyboardInterrupt:
    print("\n\n‚ö†Ô∏è  Startup interrupted by user")
    sys.exit(0)
except subprocess.CalledProcessError as e:
    print(f"\n‚ùå Enhanced system failed to start: {e}")
    sys.exit(1)
