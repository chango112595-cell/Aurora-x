
#!/usr/bin/env python3
"""
Aurora-X Unified Start Command
Starts all Aurora services
"""

import subprocess
import sys
import time
import os

print("ğŸŒŒ Aurora: Starting all services...")
print("   This will take a moment as services initialize...\n")

# Change to workspace directory
os.chdir("/home/runner/workspace")

# Start main backend (Express) - this is the primary service
print("ğŸš€ Starting Aurora Backend (port 5000)...")
subprocess.Popen(
    ["npm", "run", "dev"],
    stdout=subprocess.DEVNULL,
    stderr=subprocess.DEVNULL,
    start_new_session=True
)

# Wait a moment for backend to start
time.sleep(3)

# Start Luminar Nexus V2
print("ğŸš€ Starting Luminar Nexus V2 (port 5005)...")
subprocess.Popen(
    ["python3", "tools/luminar_nexus_v2.py", "serve"],
    stdout=subprocess.DEVNULL,
    stderr=subprocess.DEVNULL,
    start_new_session=True
)

# Wait for services to initialize
print("\nâ³ Waiting for services to initialize...")
time.sleep(5)

# Verify services started
print("\nğŸ“Š Checking service status...")

import socket

def check_port(port):
    """Check if a port is listening"""
    sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    sock.settimeout(1)
    try:
        result = sock.connect_ex(('0.0.0.0', port))
        sock.close()
        return result == 0
    except:
        return False

# Check critical ports
critical_ports = {
    5000: "Aurora Backend",
    5005: "Luminar Nexus V2",
}

running_count = 0
for port, name in critical_ports.items():
    if check_port(port):
        print(f"   âœ… {name} running on port {port}")
        running_count += 1
    else:
        print(f"   âš ï¸  {name} not responding on port {port}")

print(f"\nâœ… {running_count}/{len(critical_ports)} critical services started")

if running_count == len(critical_ports):
    print("ğŸŒŸ Aurora is fully operational!")
else:
    print("âš ï¸  Some services failed to start. Check logs for details.")
    sys.exit(1)
