================================================================================
                    PART 05: CLIENT FRONTEND
                    Generated: December 18, 2025
================================================================================

REFERENCE: React frontend, pages, components
LOCATION: client/src/

================================================================================
                         PAGES
================================================================================

--------------------------------------------------------------------------------
FILE: client/src/pages/aurora-ai-test.tsx
LINES: 281
--------------------------------------------------------------------------------
import { useQuery, useMutation } from "@tanstack/react-query";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Textarea } from "@/components/ui/textarea";
import { CheckCircle2, XCircle, Loader2, Send } from "lucide-react";
import { useState } from "react";
import API_CONFIG from "@/config/api";

interface ExpressHealthResponse {
  service: string;
  uptime: number;
  status?: string;
}

interface AIBackendInfo {
  service: string;
  aurora_core: string;
}

interface AIHealthResponse {
  status: string;
  message?: string;
  aurora_ai_backend?: AIBackendInfo;
}

export default function AuroraAITest() {
  const [chatMessage, setChatMessage] = useState("");
  const [chatResponse, setChatResponse] = useState<any>(null);

  const { data: expressHealth, isLoading: expressLoading, refetch: refetchExpress } = useQuery<ExpressHealthResponse>({
    queryKey: ['/api/health'],
  });

  const { data: aiHealth, isLoading: aiLoading, refetch: refetchAI } = useQuery<AIHealthResponse>({
    queryKey: ['/api/aurora-ai/health'],
  });

  const chatMutation = useMutation({
    mutationFn: async (message: string) => {
      const response = await fetch('/api/chat', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          message,
          session_id: 'test-session',
          context: {}
        })
      });
      return response.json();
    },
    onSuccess: (data) => {
      setChatResponse(data);
    }
  });

  const handleSendMessage = () => {
    if (chatMessage.trim()) {
      chatMutation.mutate(chatMessage);
    }
  };

  return (
    <div className="container mx-auto p-6 space-y-6">
      <div>
        <h1 className="text-3xl font-bold mb-2">Aurora Dual-Backend Architecture Test</h1>
        <p className="text-muted-foreground">
          Verify connectivity to both Express Gateway and Aurora AI Backend
        </p>
      </div>

      <div className="grid md:grid-cols-2 gap-6">
        {/* Express Gateway Status */}
        <Card>
          <CardHeader>
            <CardTitle className="flex items-center gap-2">
              Express Gateway (Port 5000)
              {expressLoading ? (
                <Loader2 className="h-5 w-5 animate-spin" />
              ) : expressHealth ? (
                <CheckCircle2 className="h-5 w-5 text-green-500" />
              ) : (
                <XCircle className="h-5 w-5 text-red-500" />
              )}
            </CardTitle>
            <CardDescription>Main API gateway, auth, routing</CardDescription>
          </CardHeader>
          <CardContent className="space-y-4">
            {expressHealth ? (
              <>
                <div className="flex items-center gap-2">
                  <Badge variant="default">Online</Badge>
                  <span className="text-sm">Service: {expressHealth.service}</span>
                </div>
                <div className="text-sm text-muted-foreground">
                  Uptime: {expressHealth.uptime}s
                </div>
              </>
            ) : (
              <Badge variant="destructive">Offline</Badge>
            )}
            <Button onClick={() => refetchExpress()} size="sm" variant="outline">
              Refresh Status
            </Button>
          </CardContent>
        </Card>

        {/* Aurora AI Backend Status */}
        <Card>
          <CardHeader>
            <CardTitle className="flex items-center gap-2">
              Aurora AI Backend (Port 8000)
              {aiLoading ? (
                <Loader2 className="h-5 w-5 animate-spin" />
              ) : aiHealth?.status === 'ok' ? (
                <CheckCircle2 className="h-5 w-5 text-green-500" />
              ) : (
                <XCircle className="h-5 w-5 text-red-500" />
              )}
            </CardTitle>
            <CardDescription>Intelligence, NLP, chat processing</CardDescription>
          </CardHeader>
          <CardContent className="space-y-4">
            {aiHealth?.status === 'ok' ? (
              <>
                <div className="flex items-center gap-2">
                  <Badge variant="default">Online</Badge>
                  <span className="text-sm">
                    Service: {aiHealth.aurora_ai_backend?.service}
                  </span>
                </div>
                <div className="text-sm text-muted-foreground">
                  Aurora Core: {aiHealth.aurora_ai_backend?.aurora_core}
                </div>
                <div className="text-sm text-green-600">
                  ✓ {aiHealth.message}
                </div>
              </>
            ) : (
              <>
                <Badge variant="destructive">
                  {aiHealth?.status || 'Offline'}
                </Badge>
                <div className="text-sm text-red-600">
                  {aiHealth?.message || 'Service unavailable'}
                </div>
              </>
            )}
            <Button onClick={() => refetchAI()} size="sm" variant="outline">
              Refresh Status
            </Button>
          </CardContent>
        </Card>
      </div>

      {/* Chat Test */}
      <Card>
        <CardHeader>
          <CardTitle>Test Chat Integration</CardTitle>
          <CardDescription>Send a message to test the full request flow</CardDescription>
        </CardHeader>
        <CardContent className="space-y-4">
          <div className="flex gap-2">
            <Input
              placeholder="Type a test message..."
              value={chatMessage}
              onChange={(e) => setChatMessage(e.target.value)}
              onKeyPress={(e) => e.key === 'Enter' && handleSendMessage()}
            />
            <Button 
              onClick={handleSendMessage}
              disabled={chatMutation.isPending || !chatMessage.trim()}
            >
              {chatMutation.isPending ? (
                <Loader2 className="h-4 w-4 animate-spin" />
              ) : (
                <Send className="h-4 w-4" />
              )}
            </Button>
          </div>

          {chatResponse && (
            <Card className="bg-muted">
              <CardContent className="pt-4">
                <div className="space-y-2">
                  <div className="flex items-center gap-2">
                    <Badge variant={chatResponse.ai_powered ? "default" : "secondary"}>
                      {chatResponse.ai_powered ? "AI Backend" : "Express Fallback"}
                    </Badge>
                    {chatResponse.intent && (
                      <Badge variant="outline">Intent: {chatResponse.intent}</Badge>
                    )}
                  </div>
                  <p className="text-sm">{chatResponse.response || chatResponse.message}</p>
                  {chatResponse.entities && Object.keys(chatResponse.entities).length > 0 && (
                    <div className="text-xs text-muted-foreground">
                      Entities: {JSON.stringify(chatResponse.entities)}
                    </div>
                  )}
                </div>
              </CardContent>
            </Card>
          )}

          {chatMutation.isError && (
            <div className="text-sm text-red-600">
              Error: Failed to send message
            </div>
          )}
        </CardContent>
      </Card>

      <Card>
        <CardHeader>
          <CardTitle>Request Flow</CardTitle>
          <CardDescription>How chat requests are processed</CardDescription>
        </CardHeader>
        <CardContent>
          <div className="font-mono text-sm space-y-2">
            <div className="font-semibold">Client → Express (5000) → Aurora AI Backend (8000) → Response</div>
            <div className="text-muted-foreground pl-4">
              1. Client sends chat message to /api/chat
            </div>
            <div className="text-muted-foreground pl-4">
              2. Express proxies to Aurora AI Backend (http://0.0.0.0:8000/api/chat)
            </div>
            <div className="text-muted-foreground pl-4">
              3. Aurora AI processes with NLP intelligence
            </div>
            <div className="text-muted-foreground pl-4">
              4. Response flows back through Express to client
            </div>
            <div className="text-muted-foreground pl-4">
              5. If AI backend unavailable, Express handles with fallback
            </div>
          </div>
        </CardContent>
      </Card>

      <Card>
        <CardHeader>
          <CardTitle>Next Steps</CardTitle>
        </CardHeader>
        <CardContent className="space-y-2 text-sm">
          <div className="flex items-start gap-2">
            <div className="font-semibold min-w-8">1.</div>
            <div>Start the "Start Aurora AI Backend" workflow from the workflows dropdown</div>
          </div>
          <div className="flex items-start gap-2">
            <div className="font-semibold min-w-8">2.</div>
            <div>Wait for port 8000 to become available (~10-30 seconds)</div>
          </div>
          <div className="flex items-start gap-2">
            <div className="font-semibold min-w-8">3.</div>
            <div>Refresh this page to verify connectivity</div>
          </div>
          <div className="flex items-start gap-2">
            <div className="font-semibold min-w-8">4.</div>
            <div>Test the chat above - you should see "AI Backend" badge if working</div>
          </div>
          <div className="flex items-start gap-2">
            <div className="font-semibold min-w-8">5.</div>
            <div>Visit /chat to test the full chat UI with the integrated backend</div>
          </div>
        </CardContent>
      </Card>

      <Card className="border-blue-200 bg-blue-50">
        <CardHeader>
          <CardTitle className="text-blue-900">Configuration</CardTitle>
        </CardHeader>
        <CardContent className="text-sm space-y-1">
          <div><strong>Express Base:</strong> {API_CONFIG.EXPRESS_BASE}</div>
          <div><strong>AI Base:</strong> {API_CONFIG.AI_BASE}</div>
          <div><strong>WebSocket:</strong> {API_CONFIG.WS_CHAT}</div>
        </CardContent>
      </Card>
    </div>
  );
}

--------------------------------------------------------------------------------
FILE: client/src/pages/aurora-chat.tsx
LINES: 422
--------------------------------------------------------------------------------
import { useEffect, useRef, useState, useCallback } from "react";
import { Send, Sparkles, Code, CheckCircle2, AlertCircle, Activity, Wifi, WifiOff, Settings2, BarChart3 } from "lucide-react";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import { ScrollArea } from "@/components/ui/scroll-area";
import { AuroraMetricsOverlay } from "@/components/aurora-metrics";

type MessageStatus = "pending" | "processing" | "complete" | "error";

interface Message {
  id: string;
  role: "user" | "aurora";
  text: string;
  timestamp: Date;
  status: MessageStatus;
}

interface SystemMetrics {
  services: {
    luminar: boolean;
    memory: boolean;
    nexus: boolean;
    auroraX: boolean;
  };
  consciousness?: {
    state: string;
    workers: { total: number; idle: number };
  };
  turnContextSize?: number;
}

export default function AuroraChat() {
  const [messages, setMessages] = useState<Message[]>([]);
  const [input, setInput] = useState("");
  const [socket, setSocket] = useState<WebSocket | null>(null);
  const [isConnected, setIsConnected] = useState(false);
  const [isProcessing, setIsProcessing] = useState(false);
  const [metrics, setMetrics] = useState<SystemMetrics | null>(null);
  const [showMetrics, setShowMetrics] = useState(false);
  const bottomRef = useRef<HTMLDivElement>(null);
  const reconnectTimeoutRef = useRef<NodeJS.Timeout | null>(null);

  const connectWebSocket = useCallback(() => {
    const protocol = window.location.protocol === "https:" ? "wss:" : "ws:";
    const wsUrl = `${protocol}//${window.location.host}/ws/synthesis`;

    const ws = new WebSocket(wsUrl);

    ws.onopen = () => {
      console.log("[AuroraChat] Connected to WebSocket");
      setIsConnected(true);
      ws.send(JSON.stringify({ type: "subscribe_chat" }));
    };

    ws.onmessage = (e) => {
      try {
        const data = JSON.parse(e.data);
        handleWebSocketMessage(data);
      } catch (err) {
        console.error("[AuroraChat] Failed to parse message:", err);
      }
    };

    ws.onclose = () => {
      console.log("[AuroraChat] Disconnected from WebSocket");
      setIsConnected(false);
      reconnectTimeoutRef.current = setTimeout(connectWebSocket, 3000);
    };

    ws.onerror = (error) => {
      console.error("[AuroraChat] WebSocket error:", error);
    };

    setSocket(ws);

    return () => {
      if (reconnectTimeoutRef.current) {
        clearTimeout(reconnectTimeoutRef.current);
      }
      ws.close();
    };
  }, []);

  useEffect(() => {
    const cleanup = connectWebSocket();
    fetchSystemMetrics();
    const metricsInterval = setInterval(fetchSystemMetrics, 30000);

    return () => {
      cleanup();
      clearInterval(metricsInterval);
    };
  }, [connectWebSocket]);

  useEffect(() => {
    bottomRef.current?.scrollIntoView({ behavior: "smooth" });
  }, [messages]);

  const fetchSystemMetrics = async () => {
    try {
      const res = await fetch("/api/auroraai/status");
      if (res.ok) {
        const data = await res.json();
        setMetrics(data);
      }
    } catch (err) {
      console.error("[AuroraChat] Failed to fetch metrics:", err);
    }
  };

  const handleWebSocketMessage = (data: any) => {
    switch (data.type) {
      case "connected":
      case "chat_subscribed":
        console.log("[AuroraChat]", data.message);
        break;

      case "chat_processing":
        setMessages((prev) =>
          prev.map((m) =>
            m.id === data.messageId ? { ...m, status: "processing" as MessageStatus } : m
          )
        );
        break;

      case "chat_response":
        setIsProcessing(false);
        setMessages((prev) => [
          ...prev.map((m) =>
            m.id === data.messageId
              ? { ...m, status: "complete" as MessageStatus }
              : m
          ),
          {
            id: `aurora_${Date.now()}`,
            role: "aurora" as const,
            text: data.response,
            timestamp: new Date(),
            status: "complete" as MessageStatus,
          },
        ]);
        break;

      case "chat_error":
        setIsProcessing(false);
        setMessages((prev) =>
          prev.map((m) =>
            m.id === data.messageId
              ? { ...m, status: "error" as MessageStatus, text: data.error || "Error processing message" }
              : m
          )
        );
        break;

      case "chat_broadcast":
        setMessages((prev) => [
          ...prev,
          {
            id: `broadcast_${Date.now()}`,
            role: "aurora",
            text: data.response,
            timestamp: new Date(),
            status: "complete" as MessageStatus,
          },
        ]);
        break;
    }
  };

  const sendMessage = () => {
    if (!input.trim() || !socket || socket.readyState !== WebSocket.OPEN || isProcessing) return;

    const messageId = `msg_${Date.now()}`;
    const userMessage: Message = {
      id: messageId,
      role: "user",
      text: input.trim(),
      timestamp: new Date(),
      status: "pending",
    };

    setMessages((prev) => [...prev, userMessage]);
    setInput("");
    setIsProcessing(true);

    socket.send(
      JSON.stringify({
        type: "chat",
        message: input.trim(),
        messageId,
      })
    );
  };

  const getStatusIcon = (status: MessageStatus) => {
    switch (status) {
      case "pending":
        return <Sparkles className="w-4 h-4 text-cyan-400 animate-pulse" data-testid="icon-pending" />;
      case "processing":
        return <Activity className="w-4 h-4 text-purple-400 animate-pulse" data-testid="icon-processing" />;
      case "complete":
        return <CheckCircle2 className="w-4 h-4 text-green-400" data-testid="icon-complete" />;
      case "error":
        return <AlertCircle className="w-4 h-4 text-red-400" data-testid="icon-error" />;
    }
  };

  const formatMessage = (text: string) => {
    if (!text) return <span className="text-muted-foreground">Empty message</span>;

    const parts = text.split("```");
    return parts.map((part, i) => {
      if (i % 2 === 1) {
        const lines = part.split("\n");
        const language = lines[0]?.trim() || "code";
        const code = lines.slice(1).join("\n");

        return (
          <div key={`code-${i}`} className="my-3 rounded-lg bg-muted/80 border overflow-hidden">
            <div className="px-3 py-2 bg-primary/10 border-b flex items-center gap-2">
              <Code className="w-3 h-3 text-primary" />
              <span className="text-xs text-primary font-mono">{language}</span>
            </div>
            <pre className="p-3 overflow-x-auto text-xs sm:text-sm">
              <code className="text-foreground font-mono">{code}</code>
            </pre>
          </div>
        );
      }

      return (
        <div key={`text-${i}`} className="whitespace-pre-wrap leading-relaxed">
          {part.split("\n").map((line, j) => {
            if (!line.trim()) return <br key={j} />;
            if (line.startsWith("•") || line.startsWith("-")) {
              return (
                <li key={j} className="ml-4 mb-1">
                  {line.replace(/^[•-]\s*/, "")}
                </li>
              );
            }
            return <p key={j} className="mb-1">{line}</p>;
          })}
        </div>
      );
    });
  };

  return (
    <div className="flex flex-col h-full p-4 gap-4" data-testid="aurora-chat-page">
      <div className="flex items-center justify-between">
        <div className="flex items-center gap-3">
          <h1 className="text-2xl font-bold" data-testid="text-page-title">Aurora WebSocket Chat</h1>
          <Badge 
            variant={isConnected ? "default" : "destructive"} 
            className="flex items-center gap-1"
            data-testid="badge-connection-status"
          >
            {isConnected ? (
              <>
                <Wifi className="w-3 h-3" />
                Connected
              </>
            ) : (
              <>
                <WifiOff className="w-3 h-3" />
                Disconnected
              </>
            )}
          </Badge>
        </div>
        <Button
          variant="outline"
          size="sm"
          onClick={() => setShowMetrics(!showMetrics)}
          data-testid="button-toggle-metrics"
        >
          <BarChart3 className="w-4 h-4 mr-2" />
          Metrics
        </Button>
      </div>

      {showMetrics && metrics && (
        <Card className="bg-card/50" data-testid="card-metrics">
          <CardHeader className="py-2">
            <CardTitle className="text-sm flex items-center gap-2">
              <Settings2 className="w-4 h-4" />
              System Status
            </CardTitle>
          </CardHeader>
          <CardContent className="py-2">
            <div className="flex flex-wrap gap-4 text-sm">
              <div className="flex items-center gap-2">
                <span className="text-muted-foreground">Luminar:</span>
                <Badge variant={metrics.services?.luminar ? "default" : "destructive"}>
                  {metrics.services?.luminar ? "Online" : "Offline"}
                </Badge>
              </div>
              <div className="flex items-center gap-2">
                <span className="text-muted-foreground">Memory:</span>
                <Badge variant={metrics.services?.memory ? "default" : "destructive"}>
                  {metrics.services?.memory ? "Online" : "Offline"}
                </Badge>
              </div>
              <div className="flex items-center gap-2">
                <span className="text-muted-foreground">Nexus:</span>
                <Badge variant={metrics.services?.nexus ? "default" : "destructive"}>
                  {metrics.services?.nexus ? "Online" : "Offline"}
                </Badge>
              </div>
              <div className="flex items-center gap-2">
                <span className="text-muted-foreground">Aurora-X:</span>
                <Badge variant={metrics.services?.auroraX ? "default" : "destructive"}>
                  {metrics.services?.auroraX ? "Online" : "Offline"}
                </Badge>
              </div>
              {metrics.consciousness && (
                <>
                  <div className="flex items-center gap-2">
                    <span className="text-muted-foreground">State:</span>
                    <Badge variant="outline">{metrics.consciousness.state}</Badge>
                  </div>
                  <div className="flex items-center gap-2">
                    <span className="text-muted-foreground">Workers:</span>
                    <Badge variant="outline">
                      {metrics.consciousness.workers.idle}/{metrics.consciousness.workers.total}
                    </Badge>
                  </div>
                </>
              )}
            </div>
          </CardContent>
        </Card>
      )}

      <Card className="flex-1 flex flex-col overflow-hidden" data-testid="card-chat">
        <ScrollArea className="flex-1 p-4">
          <div className="space-y-4">
            {messages.length === 0 && (
              <div className="text-center text-muted-foreground py-12" data-testid="text-empty-state">
                <Sparkles className="w-12 h-12 mx-auto mb-4 opacity-50" />
                <p>Start a conversation with Aurora</p>
                <p className="text-sm mt-2">Connected via WebSocket for real-time responses</p>
              </div>
            )}

            {messages.map((msg) => (
              <div
                key={msg.id}
                className={`flex ${msg.role === "user" ? "justify-end" : "justify-start"}`}
                data-testid={`message-${msg.role}-${msg.id}`}
              >
                <div
                  className={`max-w-[80%] rounded-lg p-4 ${
                    msg.role === "user"
                      ? "bg-primary text-primary-foreground"
                      : "bg-muted"
                  }`}
                >
                  <div className="flex items-center gap-2 mb-2">
                    <span className="text-xs font-semibold">
                      {msg.role === "user" ? "You" : "Aurora"}
                    </span>
                    {getStatusIcon(msg.status)}
                    <span className="text-xs opacity-70 ml-auto">
                      {msg.timestamp.toLocaleTimeString([], {
                        hour: "2-digit",
                        minute: "2-digit",
                      })}
                    </span>
                  </div>
                  <div className="text-sm">{formatMessage(msg.text)}</div>
                </div>
              </div>
            ))}
            <div ref={bottomRef} />
          </div>
        </ScrollArea>

        <div className="border-t p-4">
          <div className="flex gap-3">
            <input
              type="text"
              value={input}
              onChange={(e) => setInput(e.target.value)}
              onKeyDown={(e) => e.key === "Enter" && !e.shiftKey && sendMessage()}
              placeholder={isConnected ? "Talk to Aurora..." : "Connecting..."}
              className="flex-1 bg-muted rounded-lg px-4 py-3 text-foreground placeholder-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary/50"
              disabled={!isConnected || isProcessing}
              data-testid="input-message"
            />
            <Button
              onClick={sendMessage}
              disabled={!isConnected || isProcessing || !input.trim()}
              className="px-6"
              data-testid="button-send"
            >
              {isProcessing ? (
                <>
                  <Sparkles className="w-5 h-5 mr-2 animate-spin" />
                  Thinking...
                </>
              ) : (
                <>
                  <Send className="w-5 h-5 mr-2" />
                  Send
                </>
              )}
            </Button>
          </div>
          <p className="text-xs text-muted-foreground mt-2 text-center">
            Real-time WebSocket connection to Aurora AI orchestrator
          </p>
        </div>
      </Card>

      {/* Real-time system metrics overlay */}
      <AuroraMetricsOverlay refreshInterval={5000} />
    </div>
  );
}

--------------------------------------------------------------------------------
FILE: client/src/pages/aurora.tsx
LINES: 632
--------------------------------------------------------------------------------
'use client';

import { useQuery } from '@tanstack/react-query';
import { Link } from 'wouter';
import { Badge } from '@/components/ui/badge';
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Progress } from '@/components/ui/progress';
import {
  Activity,
  Brain,
  Cpu,
  Database,
  HeartPulse,
  Layers,
  Network,
  Package,
  Sparkles,
  Zap,
} from 'lucide-react';
import ActivityMonitor from '@/components/ActivityMonitor';
import UnifiedSystemStatus from '@/components/UnifiedSystemStatus';

interface AuroraStatus {
  status: string;
  powerUnits: number;
  knowledgeCapabilities: number;
  executionModes: number;
  systemComponents: number;
  totalModules: number;
  autofixer: {
    workers: number;
    active: number;
    queued: number;
    completed: number;
  };
  selfHealers: {
    total: number;
    active: number;
    status: string;
    healsPerformed: number;
    healthyComponents?: number;
    totalComponents?: number;
  };
  packs: {
    total: number;
    loaded: number;
    active: string[];
  };
  nexusV3: {
    connected: boolean;
    version: string | null;
    tiers: number | null;
    aems: number | null;
    modules: number | null;
    hyperspeedEnabled: boolean;
  };
  uptime: number;
  version: string;
}

interface ModuleOverview {
  timestamp?: string;
  auroraCore?: {
    available?: boolean;
    totalEntries?: number;
    pythonFiles?: number;
    auroraModules?: number;
    standardModules?: number;
    manifestCount?: number;
    temporalBreakdown?: Record<string, number>;
    tierBreakdown?: Record<string, number>;
    lastUpdated?: string | null;
    manifestUpdated?: string | null;
  };
  nexusV3?: {
    available?: boolean;
    moduleFiles?: number;
    registryCount?: number;
    subdirectories?: Array<{
      name: string;
      moduleIds: number;
      init: number;
      execute: number;
      cleanup: number;
      totalFiles: number;
    }>;
    lastUpdated?: string | null;
    registryUpdated?: string | null;
  };
}

interface UpdateStatus {
  timestamp?: string;
  ui?: {
    name?: string;
    version?: string;
    lastUpdated?: string | null;
  };
  backend?: {
    version?: string;
    node?: string;
    uptimeSeconds?: number;
    lastUpdated?: string | null;
  };
  nexusV3?: {
    version?: string | null;
    lastUpdated?: string | null;
  };
  memoryFabric?: {
    lastUpdated?: string | null;
  };
  manifests?: {
    tiers?: { count?: number; lastUpdated?: string | null; generatedAt?: string | null };
    executions?: { count?: number; lastUpdated?: string | null; generatedAt?: string | null };
    modules?: { count?: number; lastUpdated?: string | null; generatedAt?: string | null };
  };
}

interface NexusStatus {
  v2: {
    connected: boolean;
    port?: number;
    quantum_coherence?: number;
  };
  v3: {
    connected: boolean;
    port?: number;
    state?: string;
    version?: string;
  };
  unified: {
    anyConnected: boolean;
    allConnected: boolean;
    timestamp: string;
  };
}

function formatCount(value?: number | null) {
  return typeof value === 'number' ? value.toLocaleString() : 'Unavailable';
}

function formatDurationMs(ms?: number) {
  if (typeof ms !== 'number') return 'Unavailable';
  const totalSeconds = Math.max(0, Math.floor(ms / 1000));
  const hours = Math.floor(totalSeconds / 3600);
  const minutes = Math.floor((totalSeconds % 3600) / 60);
  const seconds = totalSeconds % 60;
  return `${hours}h ${minutes}m ${seconds}s`;
}

function formatTimestamp(value?: string | null) {
  if (!value) return 'Unavailable';
  const date = new Date(value);
  if (Number.isNaN(date.getTime())) return 'Unavailable';
  return date.toLocaleString();
}

function formatBreakdown(breakdown?: Record<string, number>, maxItems: number = 4) {
  if (!breakdown || Object.keys(breakdown).length === 0) return 'Unavailable';
  return Object.entries(breakdown)
    .sort((a, b) => b[1] - a[1])
    .slice(0, maxItems)
    .map(([key, value]) => `${key} ${value}`)
    .join(' | ');
}

function statusBadgeClass(status?: string) {
  const normalized = status?.toLowerCase();
  if (!normalized) return 'bg-slate-900/70 text-slate-200 border-slate-700/60';
  if (['operational', 'ready', 'online'].includes(normalized)) {
    return 'bg-emerald-500/20 text-emerald-100 border-emerald-400/40';
  }
  if (['degraded', 'warning'].includes(normalized)) {
    return 'bg-amber-500/20 text-amber-100 border-amber-400/40';
  }
  return 'bg-rose-500/20 text-rose-100 border-rose-400/40';
}

export default function AuroraPage() {
  const { data: status, isLoading, isError } = useQuery<AuroraStatus>({
    queryKey: ['/api/aurora/status'],
    refetchInterval: 5000,
  });

  const { data: modulesOverview } = useQuery<ModuleOverview>({
    queryKey: ['/api/modules/overview'],
    refetchInterval: 60000,
  });

  const { data: updateStatus } = useQuery<UpdateStatus>({
    queryKey: ['/api/aurora/update-status'],
    refetchInterval: 60000,
  });

  const { data: nexusStatus } = useQuery<NexusStatus>({
    queryKey: ['/api/nexus/status'],
    refetchInterval: 15000,
  });

  if (isLoading) {
    return (
      <div className="flex items-center justify-center py-24">
        <div className="text-center space-y-3">
          <div className="mx-auto h-10 w-10 animate-spin rounded-full border-2 border-emerald-400 border-t-transparent" />
          <p className="text-sm text-slate-400">Initializing Aurora command core...</p>
        </div>
      </div>
    );
  }

  if (isError || !status) {
    return (
      <div className="flex items-center justify-center py-24">
        <Card className="border border-rose-500/40 bg-slate-900/60 p-6">
          <p className="text-rose-200">Aurora status unavailable. Check services and refresh.</p>
        </Card>
      </div>
    );
  }

  const healerActive = typeof status.selfHealers?.active === 'number' ? status.selfHealers.active : 0;
  const healerTotal = typeof status.selfHealers?.total === 'number' ? status.selfHealers.total : 0;
  const healerProgress = healerTotal > 0 ? (healerActive / healerTotal) * 100 : 0;

  const componentHealthy = typeof status.selfHealers?.healthyComponents === 'number' ? status.selfHealers.healthyComponents : 0;
  const componentTotal = typeof status.selfHealers?.totalComponents === 'number' ? status.selfHealers.totalComponents : 0;
  const componentProgress = componentTotal > 0 ? (componentHealthy / componentTotal) * 100 : 0;

  const autofixerActive = typeof status.autofixer?.active === 'number' ? status.autofixer.active : 0;
  const autofixerTotal = typeof status.autofixer?.workers === 'number' ? status.autofixer.workers : 0;
  const autofixerProgress = autofixerTotal > 0 ? (autofixerActive / autofixerTotal) * 100 : 0;

  const packLoaded = typeof status.packs?.loaded === 'number' ? status.packs.loaded : 0;
  const packTotal = typeof status.packs?.total === 'number' ? status.packs.total : 0;
  const packProgress = packTotal > 0 ? (packLoaded / packTotal) * 100 : 0;

  const auroraCoreModules = modulesOverview?.auroraCore;
  const nexusModules = modulesOverview?.nexusV3;
  const v2Connected = nexusStatus?.v2?.connected;

  return (
    <div className="mx-auto max-w-7xl space-y-6">
      <section className="relative overflow-hidden rounded-3xl border border-slate-800/70 bg-slate-900/60 p-6">
        <div className="absolute inset-0 bg-[radial-gradient(circle_at_top,_rgba(16,185,129,0.18),_transparent_60%)]" />
        <div className="absolute -right-24 -top-24 h-40 w-40 rounded-full bg-amber-400/10 blur-3xl" />
        <div className="relative flex flex-wrap items-start justify-between gap-6">
          <div>
            <p className="text-xs uppercase tracking-[0.35em] text-slate-400">Aurora Command Core</p>
            <h1 className="mt-2 text-3xl font-semibold text-slate-100">Aurora Intelligence v{status.version}</h1>
            <p className="mt-1 text-sm text-slate-400">
              {formatCount(status.powerUnits)} power units aligned for hybrid execution.
            </p>
            <div className="mt-4 flex flex-wrap gap-2 text-xs">
              <Badge className={statusBadgeClass(status.status)}>{status.status.toUpperCase()}</Badge>
              <Badge className={status.nexusV3?.connected ? 'bg-emerald-500/20 text-emerald-100 border-emerald-400/40' : 'bg-slate-900/70 text-slate-200 border-slate-700/60'}>
                Nexus V3 {status.nexusV3?.connected ? 'Online' : 'Offline'}
              </Badge>
              <Badge className={v2Connected ? 'bg-sky-500/20 text-sky-100 border-sky-400/40' : 'bg-slate-900/70 text-slate-200 border-slate-700/60'}>
                Nexus V2 {v2Connected ? 'Online' : 'Offline'}
              </Badge>
              <Badge className={status.nexusV3?.hyperspeedEnabled ? 'bg-amber-500/20 text-amber-100 border-amber-400/40' : 'bg-slate-900/70 text-slate-200 border-slate-700/60'}>
                Hyperspeed {status.nexusV3?.hyperspeedEnabled ? 'On' : 'Off'}
              </Badge>
            </div>
          </div>
          <div className="space-y-3 text-right">
            <div className="text-sm text-slate-400">Uptime</div>
            <div className="text-2xl font-semibold text-emerald-200">{formatDurationMs(status.uptime)}</div>
            <div className="flex flex-wrap justify-end gap-2">
              <Button asChild variant="outline" size="sm">
                <Link to="/chat">Open Chat</Link>
              </Button>
              <Button asChild variant="outline" size="sm">
                <Link to="/nexus">Nexus</Link>
              </Button>
              <Button asChild size="sm">
                <Link to="/dashboard">Dashboard</Link>
              </Button>
            </div>
          </div>
        </div>
      </section>

      <section className="grid grid-cols-1 gap-4 md:grid-cols-2 xl:grid-cols-4">
        <Card className="border-slate-800/70 bg-slate-900/60">
          <CardHeader className="pb-2">
            <CardTitle className="flex items-center gap-2 text-sm text-slate-200">
              <Sparkles className="h-4 w-4 text-emerald-300" />
              Power Units
            </CardTitle>
          </CardHeader>
          <CardContent className="text-2xl font-semibold text-emerald-200">
            {formatCount(status.powerUnits)}
          </CardContent>
        </Card>
        <Card className="border-slate-800/70 bg-slate-900/60">
          <CardHeader className="pb-2">
            <CardTitle className="flex items-center gap-2 text-sm text-slate-200">
              <Brain className="h-4 w-4 text-sky-300" />
              Knowledge Capabilities
            </CardTitle>
          </CardHeader>
          <CardContent className="text-2xl font-semibold text-sky-200">
            {formatCount(status.knowledgeCapabilities)}
          </CardContent>
        </Card>
        <Card className="border-slate-800/70 bg-slate-900/60">
          <CardHeader className="pb-2">
            <CardTitle className="flex items-center gap-2 text-sm text-slate-200">
              <Zap className="h-4 w-4 text-amber-300" />
              Execution Modes
            </CardTitle>
          </CardHeader>
          <CardContent className="text-2xl font-semibold text-amber-200">
            {formatCount(status.executionModes)}
          </CardContent>
        </Card>
        <Card className="border-slate-800/70 bg-slate-900/60">
          <CardHeader className="pb-2">
            <CardTitle className="flex items-center gap-2 text-sm text-slate-200">
              <Layers className="h-4 w-4 text-emerald-300" />
              System Components
            </CardTitle>
          </CardHeader>
          <CardContent className="text-2xl font-semibold text-emerald-200">
            {formatCount(status.systemComponents)}
          </CardContent>
        </Card>
      </section>

      <section className="grid grid-cols-1 gap-4 md:grid-cols-2 xl:grid-cols-4">
        <Card className="border-slate-800/70 bg-slate-900/60">
          <CardHeader className="pb-2">
            <CardTitle className="flex items-center gap-2 text-sm text-slate-200">
              <Network className="h-4 w-4 text-sky-300" />
              Nexus Tiers
            </CardTitle>
          </CardHeader>
          <CardContent className="text-2xl font-semibold text-sky-200">
            {formatCount(status.nexusV3?.tiers ?? undefined)}
          </CardContent>
        </Card>
        <Card className="border-slate-800/70 bg-slate-900/60">
          <CardHeader className="pb-2">
            <CardTitle className="flex items-center gap-2 text-sm text-slate-200">
              <Cpu className="h-4 w-4 text-emerald-300" />
              Workers Online
            </CardTitle>
          </CardHeader>
          <CardContent className="text-2xl font-semibold text-emerald-200">
            {formatCount(status.autofixer?.workers)}
          </CardContent>
        </Card>
        <Card className="border-slate-800/70 bg-slate-900/60">
          <CardHeader className="pb-2">
            <CardTitle className="flex items-center gap-2 text-sm text-slate-200">
              <HeartPulse className="h-4 w-4 text-rose-300" />
              Self-Healers
            </CardTitle>
          </CardHeader>
          <CardContent className="text-2xl font-semibold text-rose-200">
            {formatCount(status.selfHealers?.total)}
          </CardContent>
        </Card>
        <Card className="border-slate-800/70 bg-slate-900/60">
          <CardHeader className="pb-2">
            <CardTitle className="flex items-center gap-2 text-sm text-slate-200">
              <Package className="h-4 w-4 text-amber-300" />
              Packs Loaded
            </CardTitle>
          </CardHeader>
          <CardContent className="text-2xl font-semibold text-amber-200">
            {formatCount(status.packs?.loaded)}
          </CardContent>
        </Card>
      </section>

      <section className="grid grid-cols-1 gap-6 xl:grid-cols-3">
        <div className="space-y-6 xl:col-span-2">
          <Card className="border-slate-800/70 bg-slate-900/60">
            <CardHeader>
              <CardTitle className="flex items-center gap-2 text-sm text-slate-200">
                <Activity className="h-4 w-4 text-emerald-300" />
                Autonomous Operations
              </CardTitle>
            </CardHeader>
            <CardContent className="space-y-4 text-sm">
              <div className="space-y-2">
                <div className="flex items-center justify-between">
                  <span className="text-slate-400">Self-Healers Active</span>
                  <span className="text-slate-200">{formatCount(healerActive)} / {formatCount(healerTotal)}</span>
                </div>
                <Progress value={healerProgress} className="h-2 bg-slate-800" />
              </div>
              <div className="space-y-2">
                <div className="flex items-center justify-between">
                  <span className="text-slate-400">Components Healthy</span>
                  <span className="text-slate-200">{formatCount(componentHealthy)} / {formatCount(componentTotal)}</span>
                </div>
                <Progress value={componentProgress} className="h-2 bg-slate-800" />
              </div>
              <div className="space-y-2">
                <div className="flex items-center justify-between">
                  <span className="text-slate-400">Autofixer Workforce</span>
                  <span className="text-slate-200">{formatCount(autofixerActive)} / {formatCount(autofixerTotal)}</span>
                </div>
                <Progress value={autofixerProgress} className="h-2 bg-slate-800" />
              </div>
              <div className="space-y-2">
                <div className="flex items-center justify-between">
                  <span className="text-slate-400">Pack System</span>
                  <span className="text-slate-200">{formatCount(packLoaded)} / {formatCount(packTotal)}</span>
                </div>
                <Progress value={packProgress} className="h-2 bg-slate-800" />
              </div>
              <div className="grid grid-cols-2 gap-3 text-xs text-slate-400">
                <div className="rounded-lg border border-slate-800/70 bg-slate-950/60 p-3">
                  <div className="text-slate-500">Queued Tasks</div>
                  <div className="mt-1 text-sm font-semibold text-slate-200">{formatCount(status.autofixer?.queued)}</div>
                </div>
                <div className="rounded-lg border border-slate-800/70 bg-slate-950/60 p-3">
                  <div className="text-slate-500">Heals Performed</div>
                  <div className="mt-1 text-sm font-semibold text-slate-200">{formatCount(status.selfHealers?.healsPerformed)}</div>
                </div>
              </div>
            </CardContent>
          </Card>

          <Card className="border-slate-800/70 bg-slate-900/60">
            <CardHeader>
              <CardTitle className="flex items-center gap-2 text-sm text-slate-200">
                <Network className="h-4 w-4 text-sky-300" />
                Nexus Stack
              </CardTitle>
            </CardHeader>
            <CardContent className="grid gap-4 md:grid-cols-2 text-sm">
              <div className="rounded-xl border border-slate-800/70 bg-slate-950/60 p-4">
                <div className="flex items-center justify-between">
                  <span className="text-slate-400">Nexus V3</span>
                  <Badge className={status.nexusV3?.connected ? 'bg-emerald-500/20 text-emerald-100 border-emerald-400/40' : 'bg-slate-900/70 text-slate-200 border-slate-700/60'}>
                    {status.nexusV3?.connected ? 'Connected' : 'Offline'}
                  </Badge>
                </div>
                <div className="mt-2 text-xs text-slate-400">Version {status.nexusV3?.version ?? 'Unavailable'}</div>
                <div className="mt-3 grid grid-cols-2 gap-2 text-xs">
                  <div className="rounded-lg border border-slate-800/60 bg-slate-900/60 p-2">
                    <div className="text-slate-500">Tiers</div>
                    <div className="text-sm font-semibold text-slate-200">{formatCount(status.nexusV3?.tiers)}</div>
                  </div>
                  <div className="rounded-lg border border-slate-800/60 bg-slate-900/60 p-2">
                    <div className="text-slate-500">AEMs</div>
                    <div className="text-sm font-semibold text-slate-200">{formatCount(status.nexusV3?.aems)}</div>
                  </div>
                  <div className="rounded-lg border border-slate-800/60 bg-slate-900/60 p-2">
                    <div className="text-slate-500">Modules</div>
                    <div className="text-sm font-semibold text-slate-200">{formatCount(status.nexusV3?.modules)}</div>
                  </div>
                  <div className="rounded-lg border border-slate-800/60 bg-slate-900/60 p-2">
                    <div className="text-slate-500">Hyperspeed</div>
                    <div className="text-sm font-semibold text-slate-200">{status.nexusV3?.hyperspeedEnabled ? 'Enabled' : 'Disabled'}</div>
                  </div>
                </div>
              </div>

              <div className="rounded-xl border border-slate-800/70 bg-slate-950/60 p-4">
                <div className="flex items-center justify-between">
                  <span className="text-slate-400">Luminar Nexus V2</span>
                  <Badge className={v2Connected ? 'bg-sky-500/20 text-sky-100 border-sky-400/40' : 'bg-slate-900/70 text-slate-200 border-slate-700/60'}>
                    {v2Connected ? 'Connected' : 'Offline'}
                  </Badge>
                </div>
                <div className="mt-2 text-xs text-slate-400">Port {nexusStatus?.v2?.port ?? 8000}</div>
                <div className="mt-3 space-y-2 text-xs">
                  <div className="flex items-center justify-between">
                    <span className="text-slate-500">Quantum Coherence</span>
                    <span className="text-slate-200">
                      {typeof nexusStatus?.v2?.quantum_coherence === 'number'
                        ? `${(nexusStatus.v2.quantum_coherence * 100).toFixed(1)}%`
                        : 'Unavailable'}
                    </span>
                  </div>
                  <div className="flex items-center justify-between">
                    <span className="text-slate-500">Unified Status</span>
                    <span className="text-slate-200">
                      {nexusStatus?.unified?.allConnected ? 'All Connected' : 'Partial'}
                    </span>
                  </div>
                </div>
              </div>
            </CardContent>
          </Card>

          <Card className="border-slate-800/70 bg-slate-900/60">
            <CardHeader>
              <CardTitle className="flex items-center gap-2 text-sm text-slate-200">
                <Package className="h-4 w-4 text-amber-300" />
                Pack System
              </CardTitle>
            </CardHeader>
            <CardContent className="space-y-3 text-sm">
              <div className="flex items-center justify-between">
                <span className="text-slate-400">Loaded Packs</span>
                <span className="text-slate-200">{formatCount(packLoaded)} / {formatCount(packTotal)}</span>
              </div>
              <Progress value={packProgress} className="h-2 bg-slate-800" />
              <div className="flex flex-wrap gap-2 text-xs text-slate-300">
                {(status.packs?.active || []).slice(0, 12).map((pack) => (
                  <Badge key={pack} variant="outline" className="border-slate-700/70 bg-slate-950/50 text-slate-200">
                    {pack}
                  </Badge>
                ))}
                {status.packs?.active && status.packs.active.length > 12 && (
                  <Badge variant="outline" className="border-slate-700/70 bg-slate-950/50 text-slate-400">
                    +{status.packs.active.length - 12} more
                  </Badge>
                )}
              </div>
            </CardContent>
          </Card>
        </div>

        <div className="space-y-6">
          <Card className="border-slate-800/70 bg-slate-900/60">
            <CardHeader>
              <CardTitle className="flex items-center gap-2 text-sm text-slate-200">
                <Zap className="h-4 w-4 text-amber-300" />
                Update Center
              </CardTitle>
            </CardHeader>
            <CardContent className="space-y-3 text-sm">
              <div className="space-y-1">
                <div className="flex items-center justify-between">
                  <span className="text-slate-400">UI</span>
                  <span className="text-slate-200">
                    {updateStatus?.ui?.version
                      ? `${updateStatus?.ui?.name ?? 'UI'} ${updateStatus?.ui?.version}`
                      : 'Unavailable'}
                  </span>
                </div>
                <div className="text-xs text-slate-500">Updated {formatTimestamp(updateStatus?.ui?.lastUpdated)}</div>
              </div>
              <div className="space-y-1">
                <div className="flex items-center justify-between">
                  <span className="text-slate-400">Backend</span>
                  <span className="text-slate-200">{updateStatus?.backend?.version ?? 'Unavailable'}</span>
                </div>
                <div className="text-xs text-slate-500">Node {updateStatus?.backend?.node ?? 'Unknown'}</div>
              </div>
              <div className="space-y-1">
                <div className="flex items-center justify-between">
                  <span className="text-slate-400">Nexus V3</span>
                  <span className="text-slate-200">{updateStatus?.nexusV3?.version ?? 'Unavailable'}</span>
                </div>
                <div className="text-xs text-slate-500">Updated {formatTimestamp(updateStatus?.nexusV3?.lastUpdated)}</div>
              </div>
              <div className="space-y-1">
                <div className="flex items-center justify-between">
                  <span className="text-slate-400">Memory Fabric</span>
                  <span className="text-slate-200">{updateStatus?.memoryFabric?.lastUpdated ? 'Ready' : 'Unavailable'}</span>
                </div>
                <div className="text-xs text-slate-500">Updated {formatTimestamp(updateStatus?.memoryFabric?.lastUpdated)}</div>
              </div>
              <div className="border-t border-slate-800/60 pt-3 text-xs text-slate-500">
                Manifests: {formatCount(updateStatus?.manifests?.tiers?.count)} tiers | {formatCount(updateStatus?.manifests?.executions?.count)} AEMs | {formatCount(updateStatus?.manifests?.modules?.count)} modules
              </div>
              <div className="text-xs text-slate-600">Snapshot {formatTimestamp(updateStatus?.timestamp)}</div>
            </CardContent>
          </Card>

          <Card className="border-slate-800/70 bg-slate-900/60">
            <CardHeader>
              <CardTitle className="flex items-center gap-2 text-sm text-slate-200">
                <Database className="h-4 w-4 text-emerald-300" />
                Module Topology
              </CardTitle>
            </CardHeader>
            <CardContent className="space-y-4 text-sm">
              <div className="rounded-xl border border-slate-800/70 bg-slate-950/60 p-3">
                <div className="flex items-center justify-between text-xs">
                  <span className="text-slate-400">Aurora Core Modules</span>
                  <span className="text-slate-200">{formatCount(auroraCoreModules?.manifestCount)}</span>
                </div>
                <div className="mt-2 grid grid-cols-2 gap-2 text-xs">
                  <div className="flex items-center justify-between">
                    <span className="text-slate-500">Aurora Modules</span>
                    <span className="text-slate-200">{formatCount(auroraCoreModules?.auroraModules)}</span>
                  </div>
                  <div className="flex items-center justify-between">
                    <span className="text-slate-500">Standard Modules</span>
                    <span className="text-slate-200">{formatCount(auroraCoreModules?.standardModules)}</span>
                  </div>
                  <div className="flex items-center justify-between">
                    <span className="text-slate-500">Python Files</span>
                    <span className="text-slate-200">{formatCount(auroraCoreModules?.pythonFiles)}</span>
                  </div>
                  <div className="flex items-center justify-between">
                    <span className="text-slate-500">Entries</span>
                    <span className="text-slate-200">{formatCount(auroraCoreModules?.totalEntries)}</span>
                  </div>
                </div>
                <div className="mt-2 text-xs text-slate-500">Temporal: {formatBreakdown(auroraCoreModules?.temporalBreakdown)}</div>
                <div className="text-xs text-slate-500">Tier: {formatBreakdown(auroraCoreModules?.tierBreakdown)}</div>
              </div>
              <div className="rounded-xl border border-slate-800/70 bg-slate-950/60 p-3">
                <div className="flex items-center justify-between text-xs">
                  <span className="text-slate-400">Nexus V3 Modules</span>
                  <span className="text-slate-200">{formatCount(nexusModules?.registryCount)} registry</span>
                </div>
                <div className="mt-2 text-xs text-slate-500">Root modules {formatCount(nexusModules?.moduleFiles)}</div>
                <div className="mt-3 space-y-2">
                  {(nexusModules?.subdirectories || []).slice(0, 6).map((subdir) => (
                    <div key={subdir.name} className="flex flex-wrap items-center justify-between gap-2 rounded-lg border border-slate-800/60 bg-slate-900/60 px-3 py-2 text-xs">
                      <span className="font-mono text-slate-200">{subdir.name}</span>
                      <span className="text-slate-400">{formatCount(subdir.moduleIds)} modules</span>
                      <span className="text-slate-500">init {formatCount(subdir.init)} | exec {formatCount(subdir.execute)} | cleanup {formatCount(subdir.cleanup)}</span>
                    </div>
                  ))}
                </div>
              </div>
            </CardContent>
          </Card>
        </div>
      </section>

      <section className="grid grid-cols-1 gap-6 xl:grid-cols-2">
        <UnifiedSystemStatus />
        <ActivityMonitor />
      </section>
    </div>
  );
}

--------------------------------------------------------------------------------
FILE: client/src/pages/aurora-ui.tsx
LINES: 5
--------------------------------------------------------------------------------
import AuroraChatTest from '../AuroraChatTest';

export default function AuroraUIPage() {
  return <AuroraChatTest />;
}

--------------------------------------------------------------------------------
FILE: client/src/pages/autonomous.tsx
LINES: 435
--------------------------------------------------------------------------------
import { Card, CardContent, CardHeader, CardTitle, CardDescription } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { Button } from "@/components/ui/button";
import { ScrollArea } from "@/components/ui/scroll-area";
import { Progress } from "@/components/ui/progress";
import { useQuery } from "@tanstack/react-query";
import { Zap, RefreshCw, Bot, Cpu, Play, Pause, CheckCircle, Clock, AlertCircle, Shield, Sparkles, AlertTriangle, Activity } from "lucide-react";
import { motion } from "framer-motion";

interface AuroraStatus {
  status: string;
  powerUnits: number;
  autofixer: {
    workers: number;
    active: number;
    queued: number;
    completed: number;
  };
}

interface WorkerTask {
  id: string;
  type: string;
  status: 'running' | 'queued' | 'completed' | 'failed';
  priority: 'high' | 'medium' | 'low';
  description: string;
  progress?: number;
  startedAt: string;
}

interface V3Capabilities {
  autonomous_mode?: boolean;
  hybrid_mode_enabled?: boolean;
  hyperspeed_enabled?: boolean;
  available?: boolean;
}

export default function AutonomousPage() {
  const { data: auroraStatus, isLoading, isError, error, refetch, isRefetching } = useQuery<AuroraStatus>({
    queryKey: ['/api/aurora/status'],
    refetchInterval: 5000,
  });

  const { data: v3Capabilities } = useQuery<V3Capabilities>({
    queryKey: ['/api/nexus-v3/capabilities'],
    refetchInterval: 15000,
  });

  const autonomyModes = [
    {
      id: 'autonomous',
      name: 'Autonomous Mode',
      description: 'Self-directed execution without manual input',
      status: v3Capabilities?.autonomous_mode ? 'active' : 'disabled',
      icon: Bot
    },
    {
      id: 'hybrid',
      name: 'Hybrid Mode',
      description: 'Balanced execution between autonomous and guided control',
      status: v3Capabilities?.hybrid_mode_enabled ? 'active' : 'disabled',
      icon: Activity
    },
    {
      id: 'hyperspeed',
      name: 'Hyperspeed Mode',
      description: 'High-throughput execution pipeline for rapid tasks',
      status: v3Capabilities?.hyperspeed_enabled ? 'active' : 'disabled',
      icon: Sparkles
    }
  ];

  const getWorkerTasks = (): WorkerTask[] => {
    const activeWorkers = auroraStatus?.autofixer?.active || 0;
    const queuedTasks = auroraStatus?.autofixer?.queued || 0;
    const completedTasks = auroraStatus?.autofixer?.completed || 0;
    
    const tasks: WorkerTask[] = [];
    
    if (completedTasks > 0) {
      tasks.push({ 
        id: 'completed-1', 
        type: 'system_check', 
        status: 'completed', 
        priority: 'low', 
        description: `Completed ${completedTasks} autonomous task${completedTasks > 1 ? 's' : ''}`, 
        progress: 100,
        startedAt: new Date(Date.now() - 300000).toISOString() 
      });
    }
    
    if (activeWorkers > 0) {
      tasks.push({ 
        id: 'active-1', 
        type: 'monitoring', 
        status: 'running', 
        priority: 'medium', 
        description: `${activeWorkers} worker${activeWorkers > 1 ? 's' : ''} actively processing`, 
        startedAt: new Date(Date.now() - 60000).toISOString() 
      });
    }
    
    if (queuedTasks > 0) {
      tasks.push({ 
        id: 'queued-1', 
        type: 'pending', 
        status: 'queued', 
        priority: 'low', 
        description: `${queuedTasks} task${queuedTasks > 1 ? 's' : ''} in queue`, 
        progress: 0,
        startedAt: '' 
      });
    }
    
    if (tasks.length === 0) {
      tasks.push({ 
        id: 'idle-1', 
        type: 'standby', 
        status: 'completed', 
        priority: 'low', 
        description: 'All workers idle - ready for new tasks', 
        progress: 100,
        startedAt: new Date().toISOString() 
      });
    }
    
    return tasks;
  };
  
  const workerTasks = getWorkerTasks();

  const getStatusColor = (status: string) => {
    switch (status) {
      case 'active': return 'bg-green-500/20 text-green-300 border-green-500/30';
      case 'idle': return 'bg-yellow-500/20 text-yellow-300 border-yellow-500/30';
      case 'disabled': return 'bg-slate-500/20 text-slate-300 border-slate-500/30';
      case 'running': return 'bg-cyan-500/20 text-cyan-300 border-cyan-500/30';
      case 'queued': return 'bg-purple-500/20 text-purple-300 border-purple-500/30';
      case 'completed': return 'bg-green-500/20 text-green-300 border-green-500/30';
      case 'failed': return 'bg-red-500/20 text-red-300 border-red-500/30';
      default: return 'bg-slate-500/20 text-slate-300 border-slate-500/30';
    }
  };

  const getPriorityColor = (priority: string) => {
    switch (priority) {
      case 'high': return 'bg-red-500/20 text-red-300 border-red-500/30';
      case 'medium': return 'bg-yellow-500/20 text-yellow-300 border-yellow-500/30';
      case 'low': return 'bg-blue-500/20 text-blue-300 border-blue-500/30';
      default: return 'bg-slate-500/20 text-slate-300 border-slate-500/30';
    }
  };

  const formatCount = (value?: number) =>
    typeof value === 'number' ? value.toLocaleString() : 'Unavailable';

  const getStatusIcon = (status: string) => {
    switch (status) {
      case 'running': return <Play className="w-4 h-4 text-cyan-400" />;
      case 'queued': return <Clock className="w-4 h-4 text-purple-400" />;
      case 'completed': return <CheckCircle className="w-4 h-4 text-green-400" />;
      case 'failed': return <AlertCircle className="w-4 h-4 text-red-400" />;
      default: return <Pause className="w-4 h-4 text-slate-400" />;
    }
  };

  return (
    <div className="h-full flex flex-col bg-gradient-to-br from-background via-cyan-950/5 to-purple-950/5">
      <div className="p-6 border-b border-cyan-500/20">
        <div className="flex items-center justify-between">
          <div className="flex items-center gap-4">
            <div className="relative">
              <div className="absolute inset-0 bg-purple-500/30 rounded-full blur-md animate-pulse" />
              <div className="relative w-12 h-12 rounded-full border-2 border-purple-400/50 flex items-center justify-center bg-gradient-to-br from-purple-500/20 to-cyan-500/20">
                <Zap className="w-6 h-6 text-purple-400" />
              </div>
            </div>
            <div>
              <h1 className="text-2xl font-bold bg-gradient-to-r from-purple-400 via-cyan-400 to-purple-400 bg-clip-text text-transparent" data-testid="text-page-title">
                Autonomous Tools
              </h1>
              <p className="text-sm text-muted-foreground">
                Self-Directed Capabilities & Worker Management
              </p>
            </div>
          </div>
          <Button 
            variant="outline" 
            size="sm" 
            onClick={() => refetch()}
            disabled={isRefetching}
            className="border-purple-500/30 hover:border-purple-400/50"
            data-testid="button-refresh"
          >
            <RefreshCw className={`w-4 h-4 mr-2 ${isRefetching ? 'animate-spin' : ''}`} />
            Refresh
          </Button>
        </div>
      </div>

      {isLoading ? (
        <div className="flex-1 flex items-center justify-center">
          <div className="text-center">
            <Bot className="w-12 h-12 text-purple-400 animate-pulse mx-auto mb-4" />
            <p className="text-muted-foreground">Loading autonomous systems...</p>
          </div>
        </div>
      ) : isError ? (
        <div className="flex-1 flex items-center justify-center">
          <div className="text-center">
            <AlertTriangle className="w-12 h-12 text-red-400 mx-auto mb-4" />
            <p className="text-red-300 mb-2">Failed to load autonomous systems</p>
            <p className="text-sm text-muted-foreground mb-4">{error?.message || 'An error occurred'}</p>
            <Button 
              variant="outline" 
              size="sm" 
              onClick={() => refetch()}
              className="border-red-500/30 hover:border-red-400/50"
              data-testid="button-retry"
            >
              <RefreshCw className="w-4 h-4 mr-2" />
              Retry
            </Button>
          </div>
        </div>
      ) : (
        <ScrollArea className="flex-1 p-6">
          <div className="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
            <Card className="border-cyan-500/30 bg-slate-900/50 backdrop-blur-xl" data-testid="card-stat-workers">
              <CardContent className="p-4">
                <div className="flex items-center gap-3">
                  <div className="w-10 h-10 rounded-lg bg-cyan-500/20 flex items-center justify-center">
                    <Bot className="w-5 h-5 text-cyan-400" />
                  </div>
                  <div>
                    <p className="text-xs text-cyan-300/60">Workers</p>
                    <p className="text-2xl font-bold text-cyan-400" data-testid="text-workers">
                      {formatCount(auroraStatus?.autofixer?.workers)}
                    </p>
                  </div>
                </div>
              </CardContent>
            </Card>
            
            <Card className="border-green-500/30 bg-slate-900/50 backdrop-blur-xl" data-testid="card-stat-active">
              <CardContent className="p-4">
                <div className="flex items-center gap-3">
                  <div className="w-10 h-10 rounded-lg bg-green-500/20 flex items-center justify-center">
                    <Play className="w-5 h-5 text-green-400" />
                  </div>
                  <div>
                    <p className="text-xs text-green-300/60">Active</p>
                    <p className="text-2xl font-bold text-green-400" data-testid="text-active">
                      {formatCount(auroraStatus?.autofixer?.active)}
                    </p>
                  </div>
                </div>
              </CardContent>
            </Card>
            
            <Card className="border-purple-500/30 bg-slate-900/50 backdrop-blur-xl" data-testid="card-stat-queued">
              <CardContent className="p-4">
                <div className="flex items-center gap-3">
                  <div className="w-10 h-10 rounded-lg bg-purple-500/20 flex items-center justify-center">
                    <Clock className="w-5 h-5 text-purple-400" />
                  </div>
                  <div>
                    <p className="text-xs text-purple-300/60">Queued</p>
                    <p className="text-2xl font-bold text-purple-400" data-testid="text-queued">
                      {formatCount(auroraStatus?.autofixer?.queued)}
                    </p>
                  </div>
                </div>
              </CardContent>
            </Card>
            
            <Card className="border-pink-500/30 bg-slate-900/50 backdrop-blur-xl" data-testid="card-stat-completed">
              <CardContent className="p-4">
                <div className="flex items-center gap-3">
                  <div className="w-10 h-10 rounded-lg bg-pink-500/20 flex items-center justify-center">
                    <CheckCircle className="w-5 h-5 text-pink-400" />
                  </div>
                  <div>
                    <p className="text-xs text-pink-300/60">Completed</p>
                    <p className="text-2xl font-bold text-pink-400" data-testid="text-completed">
                      {formatCount(auroraStatus?.autofixer?.completed)}
                    </p>
                  </div>
                </div>
              </CardContent>
            </Card>
          </div>

          <div className="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
            <Card className="border-cyan-500/30 bg-slate-900/50 backdrop-blur-xl" data-testid="card-auto-settings">
              <CardHeader className="border-b border-cyan-500/20">
                <CardTitle className="text-lg text-cyan-300">Autonomy Status</CardTitle>
                <CardDescription className="text-cyan-300/60">Live mode flags from Nexus V3</CardDescription>
              </CardHeader>
              <CardContent className="pt-4 space-y-4">
                <div className="flex items-center justify-between p-3 bg-slate-800/50 rounded-lg">
                  <div className="flex items-center gap-3">
                    <Shield className="w-5 h-5 text-green-400" />
                    <div>
                      <p className="text-sm text-cyan-200">Autonomous Mode</p>
                      <p className="text-xs text-cyan-300/60">Self-directed orchestration</p>
                    </div>
                  </div>
                  <Badge variant="outline" className={getStatusColor(v3Capabilities?.autonomous_mode ? 'active' : 'disabled')}>
                    {v3Capabilities?.autonomous_mode ? 'Active' : 'Disabled'}
                  </Badge>
                </div>
                <div className="flex items-center justify-between p-3 bg-slate-800/50 rounded-lg">
                  <div className="flex items-center gap-3">
                    <Zap className="w-5 h-5 text-yellow-400" />
                    <div>
                      <p className="text-sm text-cyan-200">Hybrid Mode</p>
                      <p className="text-xs text-cyan-300/60">Blended execution strategy</p>
                    </div>
                  </div>
                  <Badge variant="outline" className={getStatusColor(v3Capabilities?.hybrid_mode_enabled ? 'active' : 'disabled')}>
                    {v3Capabilities?.hybrid_mode_enabled ? 'Active' : 'Disabled'}
                  </Badge>
                </div>
                <div className="flex items-center justify-between p-3 bg-slate-800/50 rounded-lg">
                  <div className="flex items-center gap-3">
                    <Sparkles className="w-5 h-5 text-purple-400" />
                    <div>
                      <p className="text-sm text-cyan-200">Hyperspeed Mode</p>
                      <p className="text-xs text-cyan-300/60">High-throughput execution</p>
                    </div>
                  </div>
                  <Badge variant="outline" className={getStatusColor(v3Capabilities?.hyperspeed_enabled ? 'active' : 'disabled')}>
                    {v3Capabilities?.hyperspeed_enabled ? 'Active' : 'Disabled'}
                  </Badge>
                </div>
              </CardContent>
            </Card>

            <div className="lg:col-span-2">
              <Card className="border-purple-500/30 bg-slate-900/50 backdrop-blur-xl" data-testid="card-worker-tasks">
                <CardHeader className="border-b border-purple-500/20">
                  <CardTitle className="flex items-center gap-2 text-lg text-purple-300">
                    <Cpu className="w-5 h-5 text-purple-400" />
                    Worker Task Queue
                  </CardTitle>
                  <CardDescription className="text-purple-300/60">Current and pending autonomous tasks</CardDescription>
                </CardHeader>
                <CardContent className="pt-4">
                  <ScrollArea className="h-[200px]">
                    <div className="space-y-3">
                      {workerTasks.map((task, index) => (
                        <motion.div
                          key={task.id}
                          initial={{ opacity: 0, x: -10 }}
                          animate={{ opacity: 1, x: 0 }}
                          transition={{ delay: index * 0.05 }}
                        >
                          <Card className="border-purple-500/20 bg-slate-800/50" data-testid={`card-task-${task.id}`}>
                            <CardContent className="p-3">
                              <div className="flex items-center justify-between gap-2 mb-2 flex-wrap">
                                <div className="flex items-center gap-2">
                                  {getStatusIcon(task.status)}
                                  <span className="text-sm text-purple-200">{task.description}</span>
                                </div>
                                <div className="flex items-center gap-2">
                                  <Badge variant="outline" className={`text-xs ${getStatusColor(task.status)}`}>
                                    {task.status}
                                  </Badge>
                                  <Badge variant="outline" className={`text-xs ${getPriorityColor(task.priority)}`}>
                                    {task.priority}
                                  </Badge>
                                </div>
                              </div>
                              {task.status === 'running' && typeof task.progress === 'number' && (
                                <div className="mt-2">
                                  <div className="flex items-center justify-between mb-1">
                                    <span className="text-xs text-purple-300/60">Progress</span>
                                    <span className="text-xs text-purple-300">{task.progress}%</span>
                                  </div>
                                  <Progress value={task.progress} className="h-1.5 bg-slate-700" />
                                </div>
                              )}
                            </CardContent>
                          </Card>
                        </motion.div>
                      ))}
                    </div>
                  </ScrollArea>
                </CardContent>
              </Card>
            </div>
          </div>

            <Card className="border-cyan-500/30 bg-slate-900/50 backdrop-blur-xl" data-testid="card-autonomous-tools">
              <CardHeader className="border-b border-cyan-500/20">
                <CardTitle className="flex items-center gap-2 text-lg text-cyan-300">
                  <Bot className="w-5 h-5 text-cyan-400" />
                  Autonomy Modes
                </CardTitle>
                <CardDescription className="text-cyan-300/60">Live capability modes from Nexus V3</CardDescription>
              </CardHeader>
              <CardContent className="pt-4">
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                {autonomyModes.map((mode, index) => (
                  <motion.div
                    key={mode.id}
                    initial={{ opacity: 0, y: 10 }}
                    animate={{ opacity: 1, y: 0 }}
                    transition={{ delay: index * 0.05 }}
                  >
                    <Card className="border-cyan-500/20 bg-slate-800/50 hover:border-cyan-400/40 transition-colors" data-testid={`card-tool-${mode.id}`}>
                      <CardContent className="p-4">
                        <div className="flex items-start justify-between gap-2 mb-3">
                          <div className="w-10 h-10 rounded-lg bg-gradient-to-br from-cyan-500/20 to-purple-500/20 flex items-center justify-center text-cyan-400">
                            <mode.icon className="w-5 h-5" />
                          </div>
                          <Badge variant="outline" className={`text-xs ${getStatusColor(mode.status)}`}>
                            {mode.status}
                          </Badge>
                        </div>
                        <h3 className="text-sm font-semibold text-cyan-200 mb-1">{mode.name}</h3>
                        <p className="text-xs text-cyan-300/60">{mode.description}</p>
                      </CardContent>
                    </Card>
                  </motion.div>
                ))}
              </div>
            </CardContent>
          </Card>
        </ScrollArea>
      )}
    </div>
  );
}

--------------------------------------------------------------------------------
FILE: client/src/pages/chat.tsx
LINES: 8
--------------------------------------------------------------------------------
'use client';

import React from 'react';
import AuroraFuturisticChat from '../components/AuroraFuturisticChat';

export default function Chat() {
  return <AuroraFuturisticChat />;
}

--------------------------------------------------------------------------------
FILE: client/src/pages/ComparisonDashboard.tsx
LINES: 934
--------------------------------------------------------------------------------
import { ErrorBoundary } from '@/components/error-boundary';
import React, { useState, useEffect } from 'react';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { Badge } from '@/components/ui/badge';
import { Button } from '@/components/ui/button';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';
import { CheckCircle, AlertCircle, GitBranch, Code2, Zap, Shield, TrendingUp, RefreshCw, GitCommit } from 'lucide-react';

interface Commit {
    hash: string;
    message: string;
    short_hash: string;
}

interface FileChange {
    status: string;
    file: string;
    status_text: string;
}

interface AuroraRun {
    name: string;
    path: string;
    has_graph_diff: boolean;
    has_scores_diff: boolean;
    has_report: boolean;
    start_time?: number;
    duration?: number;
    seed?: number;
    max_iters?: number;
}

interface BranchInfo {
    name: string;
    commit_count: number;
    last_commit: string;
    last_commit_message: string;
    unique_features: string[];
    file_changes: number;
    lines_added: number;
    lines_deleted: number;
    feature_category: string;
    improvement_score: number;
}

interface BranchAnalysis {
    key_features?: Array<{ category: string; description: string; impact: string }>;
    quality_metrics?: {
        test_coverage: number;
        code_quality_score: number;
        performance_score: number;
        maintainability: number;
    };
    file_changes?: Array<{ status: string; file: string; additions: number; deletions: number }>;
    recommendations?: {
        summary: string;
        action_items?: string[];
    };
}

interface ComparisonItem {
    id: string;
    title: string;
    description: string;
    impact?: string;
    complexity?: string;
    status: 'approved' | 'pending' | 'rejected';
    category: string;
}

export default function ComparisonDashboard() {
    const [tabValue, setTabValue] = useState<string>('git-comparison');
    const [approvedItems, setApprovedItems] = useState<Set<string>>(new Set());
    const [commits, setCommits] = useState<Commit[]>([]);
    const [auroraRuns, setAuroraRuns] = useState<AuroraRun[]>([]);
    const [selectedCommit1, setSelectedCommit1] = useState<string>('');
    const [selectedCommit2, setSelectedCommit2] = useState<string>('');
    const [fileChanges, setFileChanges] = useState<FileChange[]>([]);
    const [currentBranch, setCurrentBranch] = useState<string>('');
    const [branches, setBranches] = useState<BranchInfo[]>([]);
    const [selectedBranch, setSelectedBranch] = useState<string>('');
    const [branchAnalysis, setBranchAnalysis] = useState<BranchAnalysis | null>(null);
    const [loading, setLoading] = useState(false);

    // Fetch real data from APIs
    const fetchCommits = async () => {
        try {
            const response = await fetch('/api/bridge/comparison/commits');
            const data = await response.json();
            if (data.ok) {
                setCommits(data.commits);
                setCurrentBranch(data.current_branch);
            }
        } catch (error) {
            console.error('Failed to fetch commits:', error);
        }
    };

    const fetchAuroraRuns = async () => {
        try {
            const response = await fetch('/api/bridge/comparison/aurora-runs');
            const data = await response.json();
            if (data.ok) {
                setAuroraRuns(data.runs);
            }
        } catch (error) {
            console.error('Failed to fetch Aurora runs:', error);
        }
    };

    const fetchDiff = async (commit1?: string, commit2?: string) => {
        setLoading(true);
        try {
            const params = new URLSearchParams();
            if (commit1) params.append('commit1', commit1);
            if (commit2) params.append('commit2', commit2);

            const response = await fetch(`/api/bridge/comparison/diff?${params}`);
            const data = await response.json();
            if (data.ok) {
                setFileChanges(data.files);
            }
        } catch (error) {
            console.error('Failed to fetch diff:', error);
        } finally {
            setLoading(false);
        }
    };

    const fetchBranches = async () => {
        try {
            const response = await fetch('/api/bridge/comparison/branches');
            const data = await response.json();
            if (data.ok) {
                setBranches(data.branches);
            }
        } catch (error) {
            console.error('Failed to fetch branches:', error);
        }
    };

    const fetchBranchAnalysis = async (branchName: string) => {
        setLoading(true);
        try {
            const response = await fetch(`/api/bridge/comparison/branch-analysis?branch=${encodeURIComponent(branchName)}`);
            const data = await response.json();
            if (data.ok) {
                setBranchAnalysis(data.analysis);
            }
        } catch (error) {
            console.error('Failed to fetch branch analysis:', error);
        } finally {
            setLoading(false);
        }
    };

    const handleApproval = (itemId: string, approved: boolean) => {
        const newApproved = new Set(approvedItems);
        if (approved) {
            newApproved.add(itemId);
        } else {
            newApproved.delete(itemId);
        }
        setApprovedItems(newApproved);
    };

    useEffect(() => {
        fetchCommits();
        fetchAuroraRuns();
        fetchBranches();
        fetchDiff(); // Get current working directory changes

        // Set up real-time polling for commits and runs
        const commitsInterval = setInterval(fetchCommits, 10000);
        const runsInterval = setInterval(fetchAuroraRuns, 15000);
        const branchesInterval = setInterval(fetchBranches, 12000);

        return () => {
            clearInterval(commitsInterval);
            clearInterval(runsInterval);
            clearInterval(branchesInterval);
        };
    }, []);

    useEffect(() => {
        if (selectedCommit1 || selectedCommit2) {
            fetchDiff(selectedCommit1, selectedCommit2);
        }
    }, [selectedCommit1, selectedCommit2]);

    const activeDevelopment = branches.filter((branch) => branch.commit_count > 0).length;
    const mergedFeatures = commits.filter((commit) => /merge/i.test(commit.message)).length;
    const pendingReviews = branches.filter((branch) => branch.improvement_score < 50).length;
    const codeHealth = branches.length
        ? Math.round(branches.reduce((sum, branch) => sum + branch.improvement_score, 0) / branches.length)
        : 0;

    const derivedBranches = branches.map((branch) => ({
        name: branch.name,
        commits: branch.commit_count,
        lastActivity: branch.last_commit_message,
        status: branch.improvement_score > 70 ? 'stable' : branch.improvement_score > 40 ? 'active' : 'urgent'
    }));

    const derivedFeatures: ComparisonItem[] = (branchAnalysis?.key_features?.length
        ? branchAnalysis.key_features.map((feature, index) => ({
            id: `${selectedBranch || 'branch'}-${index}`,
            title: feature.description,
            description: feature.impact,
            impact: feature.impact,
            status: approvedItems.has(`${selectedBranch || 'branch'}-${index}`) ? 'approved' : 'pending',
            category: feature.category
        }))
        : commits.slice(0, 10).map((commit) => ({
            id: commit.short_hash,
            title: commit.message,
            description: commit.message,
            status: approvedItems.has(commit.short_hash) ? 'approved' : 'pending',
            category: /fix|bug/i.test(commit.message) ? 'Fix' : /perf|opt/i.test(commit.message) ? 'Performance' : 'Feature'
        })));

    const derivedImprovements = (branchAnalysis?.file_changes?.length ? branchAnalysis.file_changes : fileChanges).map((change: any, index: number) => ({
        id: `imp-${index}`,
        title: change.file,
        description: `Changes in ${change.file}`,
        category: change.status || 'modified',
        metrics: {
            additions: change.additions ?? 0,
            deletions: change.deletions ?? 0
        }
    }));

    const comparisonData = {
        overview: {
            totalBranches: branches.length,
            activeDevelopment,
            mergedFeatures,
            pendingReviews,
            codeHealth
        },
        branches: derivedBranches,
        features: derivedFeatures,
        improvements: derivedImprovements
    };

    return (
        <div className="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 p-6">
            <div className="container mx-auto max-w-7xl">
                {/* Aurora's Quantum Background */}
                <div className="fixed inset-0 -z-10 overflow-hidden pointer-events-none">
                    <div className="absolute inset-0 bg-gradient-to-br from-slate-950 via-cyan-950/20 to-purple-950/20" />

                    {/* Particle field */}
                    <div className="absolute inset-0 opacity-20" style={{
                        backgroundImage: 'radial-gradient(circle, rgba(6, 182, 212, 0.3) 1px, transparent 1px)',
                        backgroundSize: '50px 50px',
                        animation: 'particleFloat 20s linear infinite'
                    }} />

                    {/* Neural network grid */}
                    <svg className="absolute inset-0 w-full h-full opacity-10">
                        <defs>
                            <linearGradient id="grid-ComparisonDashboard" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" stopColor="#06b6d4" stopOpacity="0.5" />
                                <stop offset="100%" stopColor="#a855f7" stopOpacity="0.5" />
                            </linearGradient>
                        </defs>
                        <pattern id="grid-pattern-ComparisonDashboard" width="50" height="50" patternUnits="userSpaceOnUse">
                            <circle cx="25" cy="25" r="1" fill="url(#grid-ComparisonDashboard)" />
                        </pattern>
                        <rect width="100%" height="100%" fill="url(#grid-pattern-ComparisonDashboard)" />
                    </svg>

                    {/* Holographic orbs */}
                    <div className="absolute top-20 left-1/4 w-64 h-64 bg-cyan-500/10 rounded-full blur-3xl animate-pulse" />
                    <div className="absolute bottom-20 right-1/4 w-96 h-96 bg-purple-500/10 rounded-full blur-3xl animate-pulse" style={{ animationDelay: '2s' }} />
                </div>

                {/* Header */}
                <div className="mb-8 text-center">
                    <h1 className="text-4xl font-bold bg-gradient-to-r from-cyan-400 to-purple-400 bg-clip-text text-transparent mb-4">
                        Aurora-X Comparison Dashboard
                    </h1>
                    <p className="text-slate-300 text-lg">
                        Professional Git History Analysis & Feature Comparison
                    </p>
                </div>

                <Tabs value={tabValue} onValueChange={setTabValue} className="space-y-6">
                    <TabsList className="grid w-full grid-cols-8 bg-purple-200/80 backdrop-blur-sm border border-purple-300 p-1.5 rounded-lg">
                        <TabsTrigger value="git-comparison" className="text-purple-700 data-[state=active]:bg-white data-[state=active]:text-cyan-600 data-[state=active]:shadow-sm data-[state=inactive]:hover:bg-purple-100 rounded-md font-medium">Git Comparison</TabsTrigger>
                        <TabsTrigger value="branch-analysis" className="text-purple-700 data-[state=active]:bg-white data-[state=active]:text-pink-500 data-[state=active]:shadow-sm data-[state=inactive]:hover:bg-purple-100 rounded-md font-medium">Branch Analysis</TabsTrigger>
                        <TabsTrigger value="aurora-runs" className="text-purple-700 data-[state=active]:bg-white data-[state=active]:text-yellow-500 data-[state=active]:shadow-sm data-[state=inactive]:hover:bg-purple-100 rounded-md font-medium">Aurora Runs</TabsTrigger>
                        <TabsTrigger value="overview" className="text-purple-700 data-[state=active]:bg-white data-[state=active]:text-cyan-600 data-[state=active]:shadow-sm data-[state=inactive]:hover:bg-purple-100 rounded-md font-medium">Overview</TabsTrigger>
                        <TabsTrigger value="branches" className="text-purple-700 data-[state=active]:bg-white data-[state=active]:text-pink-500 data-[state=active]:shadow-sm data-[state=inactive]:hover:bg-purple-100 rounded-md font-medium">Branches</TabsTrigger>
                        <TabsTrigger value="features" className="text-purple-700 data-[state=active]:bg-white data-[state=active]:text-yellow-500 data-[state=active]:shadow-sm data-[state=inactive]:hover:bg-purple-100 rounded-md font-medium">Features</TabsTrigger>
                        <TabsTrigger value="diagnostics" className="text-purple-700 data-[state=active]:bg-white data-[state=active]:text-cyan-600 data-[state=active]:shadow-sm data-[state=inactive]:hover:bg-purple-100 rounded-md font-medium">Diagnostics</TabsTrigger>
                        <TabsTrigger value="approval" className="text-purple-700 data-[state=active]:bg-white data-[state=active]:text-pink-500 data-[state=active]:shadow-sm data-[state=inactive]:hover:bg-purple-100 rounded-md font-medium">Approval</TabsTrigger>
                    </TabsList>

                    {/* Git Comparison Tab */}
                    <TabsContent value="git-comparison" className="space-y-6">
                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            {/* Commit Selection */}
                            <Card className="bg-slate-800/50 backdrop-blur-sm border-cyan-500/30 quantum-card">
                                <CardHeader>
                                    <CardTitle className="text-cyan-400 flex items-center gap-2">
                                        <GitCommit className="w-5 h-5" />
                                        Select Commits to Compare
                                    </CardTitle>
                                    <CardDescription>
                                        Current Branch: <Badge className="bg-purple-500/20 text-purple-400">{currentBranch}</Badge>
                                    </CardDescription>
                                </CardHeader>
                                <CardContent className="space-y-4">
                                    <div>
                                        <label className="text-sm text-slate-300 mb-2 block">Commit 1 (Base)</label>
                                        <Select value={selectedCommit1} onValueChange={setSelectedCommit1}>
                                            <SelectTrigger className="bg-slate-700 border-slate-600">
                                                <SelectValue placeholder="Select base commit" />
                                            </SelectTrigger>
                                            <SelectContent className="bg-slate-800 border-slate-600">
                                                <SelectItem value="working-dir">Working Directory</SelectItem>
                                                {commits.map((commit) => (
                                                    <SelectItem key={commit.hash} value={commit.hash}>
                                                        {commit.short_hash}: {commit.message}
                                                    </SelectItem>
                                                ))}
                                            </SelectContent>
                                        </Select>
                                    </div>
                                    <div>
                                        <label className="text-sm text-slate-300 mb-2 block">Commit 2 (Compare with)</label>
                                        <Select value={selectedCommit2} onValueChange={setSelectedCommit2}>
                                            <SelectTrigger className="bg-slate-700 border-slate-600">
                                                <SelectValue placeholder="Select commit to compare" />
                                            </SelectTrigger>
                                            <SelectContent className="bg-slate-800 border-slate-600">
                                                <SelectItem value="working-dir">Working Directory</SelectItem>
                                                {commits.map((commit) => (
                                                    <SelectItem key={commit.hash} value={commit.hash}>
                                                        {commit.short_hash}: {commit.message}
                                                    </SelectItem>
                                                ))}
                                            </SelectContent>
                                        </Select>
                                    </div>
                                    <Button
                                        onClick={() => fetchDiff(selectedCommit1, selectedCommit2)}
                                        className="w-full bg-gradient-to-r from-cyan-500 to-purple-500"
                                        disabled={loading}
                                    >
                                        {loading ? <RefreshCw className="w-4 h-4 animate-spin mr-2" /> : null}
                                        Compare Commits
                                    </Button>
                                </CardContent>
                            </Card>

                            {/* File Changes */}
                            <Card className="bg-slate-800/50 backdrop-blur-sm border-green-500/30 quantum-card">
                                <CardHeader>
                                    <CardTitle className="text-green-400 flex items-center gap-2">
                                        <Code2 className="w-5 h-5" />
                                        File Changes ({fileChanges.length})
                                    </CardTitle>
                                </CardHeader>
                                <CardContent>
                                    <div className="space-y-2 max-h-96 overflow-y-auto">
                                        {fileChanges.length === 0 ? (
                                            <p className="text-slate-400 text-center py-8">No changes found</p>
                                        ) : (
                                            fileChanges.map((change, index) => (
                                                <div key={index} className="flex items-center justify-between p-2 bg-slate-700/50 rounded">
                                                    <span className="text-slate-300 text-sm font-mono">{change.file}</span>
                                                    <Badge
                                                        className={
                                                            change.status === 'M' ? 'bg-yellow-500/20 text-yellow-400' :
                                                                change.status === 'A' ? 'bg-green-500/20 text-green-400' :
                                                                    change.status === 'D' ? 'bg-red-500/20 text-red-400' :
                                                                        'bg-blue-500/20 text-blue-400'
                                                        }
                                                    >
                                                        {change.status_text}
                                                    </Badge>
                                                </div>
                                            ))
                                        )}
                                    </div>
                                </CardContent>
                            </Card>
                        </div>

                        {/* Full Diff View */}
                        {fileChanges.length > 0 && (
                            <Card className="bg-slate-800/50 backdrop-blur-sm border-purple-500/30 quantum-card">
                                <CardHeader>
                                    <CardTitle className="text-purple-400">Detailed Diff View</CardTitle>
                                    <CardDescription>
                                        Comparing: {selectedCommit1 || 'Working Directory'} vs {selectedCommit2 || 'Working Directory'}
                                    </CardDescription>
                                </CardHeader>
                                <CardContent>
                                    <Button
                                        onClick={() => window.open('/api/bridge/diff/full', '_blank')}
                                        className="bg-purple-500/20 text-purple-400 border border-purple-500/30 hover:bg-purple-500/30"
                                    >
                                        View Full Diff in New Tab
                                    </Button>
                                </CardContent>
                            </Card>
                        )}
                    </TabsContent>

                    {/* Branch Analysis Tab */}
                    <TabsContent value="branch-analysis" className="space-y-6">
                        <div className="grid grid-cols-1 gap-6">
                            {/* Branch Selection */}
                            <Card className="bg-slate-800/50 backdrop-blur-sm border-cyan-500/30 quantum-card">
                                <CardHeader>
                                    <CardTitle className="text-cyan-400 flex items-center gap-2">
                                        <GitBranch className="w-5 h-5" />
                                        Branch Feature Analysis
                                    </CardTitle>
                                    <CardDescription>
                                        Analyze features and improvements across different branches
                                    </CardDescription>
                                </CardHeader>
                                <CardContent className="space-y-4">
                                    <div>
                                        <label className="text-sm text-slate-300 mb-2 block">Select Branch to Analyze</label>
                                        <Select value={selectedBranch} onValueChange={setSelectedBranch}>
                                            <SelectTrigger className="bg-slate-700 border-slate-600">
                                                <SelectValue placeholder="Choose a branch for detailed analysis" />
                                            </SelectTrigger>
                                            <SelectContent className="bg-slate-800 border-slate-600">
                                                {branches.map((branch) => (
                                                    <SelectItem key={branch.name} value={branch.name}>
                                                        {branch.name} ({branch.commit_count} commits)
                                                    </SelectItem>
                                                ))}
                                            </SelectContent>
                                        </Select>
                                    </div>
                                    <Button
                                        onClick={() => selectedBranch && fetchBranchAnalysis(selectedBranch)}
                                        disabled={!selectedBranch || loading}
                                        className="w-full bg-gradient-to-r from-cyan-500 to-purple-500"
                                    >
                                        {loading ? <RefreshCw className="w-4 h-4 mr-2 animate-spin" /> : null}
                                        Analyze Branch Features
                                    </Button>
                                </CardContent>
                            </Card>

                            {/* Branch Overview Grid */}
                            {branches.length > 0 && (
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                    {branches.map((branch) => (
                                        <Card key={branch.name} className="bg-slate-800/50 backdrop-blur-sm border-cyan-500/30 hover:border-cyan-400/50 transition-colors">
                                            <CardHeader className="pb-3">
                                                <CardTitle className="text-cyan-400 text-sm flex items-center justify-between">
                                                    <span className="truncate">{branch.name}</span>
                                                    <Badge className={`ml-2 ${branch.improvement_score > 7 ? 'bg-green-500/20 text-green-400' : branch.improvement_score > 4 ? 'bg-yellow-500/20 text-yellow-400' : 'bg-gray-500/20 text-gray-400'}`}>
                                                        {branch.improvement_score}/10
                                                    </Badge>
                                                </CardTitle>
                                                <CardDescription className="text-xs">
                                                    {branch.feature_category}
                                                </CardDescription>
                                            </CardHeader>
                                            <CardContent className="space-y-2">
                                                <div className="flex justify-between text-xs text-slate-400">
                                                    <span>Commits: {branch.commit_count}</span>
                                                    <span>Files: {branch.file_changes}</span>
                                                </div>
                                                <div className="flex justify-between text-xs text-slate-400">
                                                    <span className="text-green-400">+{branch.lines_added}</span>
                                                    <span className="text-red-400">-{branch.lines_deleted}</span>
                                                </div>
                                                <div className="space-y-1">
                                                    {branch.unique_features.slice(0, 3).map((feature, idx) => (
                                                        <Badge key={idx} className="text-xs bg-purple-500/20 text-purple-400 block">
                                                            {feature}
                                                        </Badge>
                                                    ))}
                                                    {branch.unique_features.length > 3 && (
                                                        <Badge className="text-xs bg-slate-500/20 text-slate-400">
                                                            +{branch.unique_features.length - 3} more
                                                        </Badge>
                                                    )}
                                                </div>
                                                <Button
                                                    size="sm"
                                                    variant="outline"
                                                    className="w-full text-xs"
                                                    onClick={() => {
                                                        setSelectedBranch(branch.name);
                                                        fetchBranchAnalysis(branch.name);
                                                    }}
                                                >
                                                    Analyze
                                                </Button>
                                            </CardContent>
                                        </Card>
                                    ))}
                                </div>
                            )}

                            {/* Detailed Branch Analysis Results */}
                            {branchAnalysis && (
                                <Card className="bg-slate-800/50 backdrop-blur-sm border-cyan-500/30 quantum-card">
                                    <CardHeader>
                                        <CardTitle className="text-cyan-400 flex items-center gap-2">
                                            <TrendingUp className="w-5 h-5" />
                                            Detailed Analysis: {selectedBranch}
                                        </CardTitle>
                                    </CardHeader>
                                    <CardContent className="space-y-6">
                                        {/* Feature Highlights */}
                                        <div>
                                            <h4 className="text-lg font-semibold text-white mb-3">Key Features & Improvements</h4>
                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                {branchAnalysis.key_features?.map((feature, idx: number) => (
                                                    <div key={idx} className="bg-slate-700/50 p-4 rounded-lg border border-slate-600">
                                                        <div className="flex items-center gap-2 mb-2">
                                                            <CheckCircle className="w-4 h-4 text-green-400" />
                                                            <span className="font-medium text-green-400">{feature.category}</span>
                                                        </div>
                                                        <p className="text-sm text-slate-300">{feature.description}</p>
                                                        <div className="mt-2">
                                                            <Badge className="text-xs bg-blue-500/20 text-blue-400">
                                                                Impact: {feature.impact}
                                                            </Badge>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>

                                        {/* Code Quality Metrics */}
                                        {branchAnalysis.quality_metrics && (
                                            <div>
                                                <h4 className="text-lg font-semibold text-white mb-3">Code Quality Metrics</h4>
                                                <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                                    <div className="bg-slate-700/50 p-3 rounded-lg text-center">
                                                        <div className="text-2xl font-bold text-cyan-400">{branchAnalysis.quality_metrics.test_coverage}%</div>
                                                        <div className="text-xs text-slate-400">Test Coverage</div>
                                                    </div>
                                                    <div className="bg-slate-700/50 p-3 rounded-lg text-center">
                                                        <div className="text-2xl font-bold text-green-400">{branchAnalysis.quality_metrics.code_quality_score}/10</div>
                                                        <div className="text-xs text-slate-400">Code Quality</div>
                                                    </div>
                                                    <div className="bg-slate-700/50 p-3 rounded-lg text-center">
                                                        <div className="text-2xl font-bold text-purple-400">{branchAnalysis.quality_metrics.performance_score}/10</div>
                                                        <div className="text-xs text-slate-400">Performance</div>
                                                    </div>
                                                    <div className="bg-slate-700/50 p-3 rounded-lg text-center">
                                                        <div className="text-2xl font-bold text-yellow-400">{branchAnalysis.quality_metrics.maintainability}/10</div>
                                                        <div className="text-xs text-slate-400">Maintainability</div>
                                                    </div>
                                                </div>
                                            </div>
                                        )}

                                        {/* File Changes Summary */}
                                        {branchAnalysis.file_changes && (
                                            <div>
                                                <h4 className="text-lg font-semibold text-white mb-3">File Changes Summary</h4>
                                                <div className="space-y-2 max-h-60 overflow-y-auto">
                                                    {branchAnalysis.file_changes.map((change, idx: number) => (
                                                        <div key={idx} className="flex items-center justify-between bg-slate-700/30 p-3 rounded">
                                                            <div className="flex items-center gap-3">
                                                                <Badge className={`w-8 text-center ${change.status === 'A' ? 'bg-green-500/20 text-green-400' : change.status === 'M' ? 'bg-blue-500/20 text-blue-400' : 'bg-red-500/20 text-red-400'}`}>
                                                                    {change.status}
                                                                </Badge>
                                                                <span className="text-sm font-mono text-slate-300">{change.file}</span>
                                                            </div>
                                                            <div className="flex gap-2 text-xs">
                                                                {change.additions > 0 && <span className="text-green-400">+{change.additions}</span>}
                                                                {change.deletions > 0 && <span className="text-red-400">-{change.deletions}</span>}
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        )}

                                        {/* Recommendations */}
                                        {branchAnalysis.recommendations && (
                                            <div>
                                                <h4 className="text-lg font-semibold text-white mb-3">Merge Recommendations</h4>
                                                <div className="bg-slate-700/30 p-4 rounded-lg border-l-4 border-cyan-400">
                                                    <div className="flex items-start gap-3">
                                                        <Shield className="w-5 h-5 text-cyan-400 mt-0.5" />
                                                        <div>
                                                            <p className="text-slate-300">{branchAnalysis.recommendations.summary}</p>
                                                            <div className="mt-3 space-y-2">
                                                                {branchAnalysis.recommendations.action_items?.map((item: string, idx: number) => (
                                                                    <div key={idx} className="flex items-center gap-2">
                                                                        <div className="w-1.5 h-1.5 bg-cyan-400 rounded-full"></div>
                                                                        <span className="text-sm text-slate-400">{item}</span>
                                                                    </div>
                                                                ))}
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        )}
                                    </CardContent>
                                </Card>
                            )}
                        </div>
                    </TabsContent>

                    {/* Aurora Runs Tab */}
                    <TabsContent value="aurora-runs" className="space-y-6">
                        <Card className="bg-slate-800/50 backdrop-blur-sm border-cyan-500/30 quantum-card">
                            <CardHeader>
                                <CardTitle className="text-cyan-400 flex items-center gap-2">
                                    <Zap className="w-5 h-5" />
                                    Aurora Run History ({auroraRuns.length} runs)
                                </CardTitle>
                                <CardDescription>Compare different Aurora synthesis runs and their results</CardDescription>
                            </CardHeader>
                            <CardContent>
                                <div className="space-y-4 max-h-96 overflow-y-auto">
                                    {auroraRuns.length === 0 ? (
                                        <p className="text-slate-400 text-center py-8">No Aurora runs found</p>
                                    ) : (
                                        auroraRuns.map((run, index) => (
                                            <div key={index} className="p-4 bg-slate-700/50 rounded-lg">
                                                <div className="flex items-center justify-between mb-2">
                                                    <span className="text-cyan-400 font-mono text-sm">{run.name}</span>
                                                    <div className="flex gap-2">
                                                        {run.has_graph_diff && <Badge className="bg-green-500/20 text-green-400 text-xs">Graph Diff</Badge>}
                                                        {run.has_scores_diff && <Badge className="bg-blue-500/20 text-blue-400 text-xs">Scores Diff</Badge>}
                                                        {run.has_report && <Badge className="bg-purple-500/20 text-purple-400 text-xs">Report</Badge>}
                                                    </div>
                                                </div>
                                                <div className="text-slate-400 text-xs space-y-1">
                                                    {run.start_time && <div>Started: {new Date(run.start_time * 1000).toLocaleString()}</div>}
                                                    {run.duration && <div>Duration: {run.duration.toFixed(2)}s</div>}
                                                    {run.seed && <div>Seed: {run.seed}</div>}
                                                    {run.max_iters && <div>Max Iterations: {run.max_iters}</div>}
                                                </div>
                                                {run.has_report && (
                                                    <Button
                                                        size="sm"
                                                        className="mt-2 bg-cyan-500/20 text-cyan-400 border border-cyan-500/30 hover:bg-cyan-500/30"
                                                        onClick={() => window.open(`/runs/${run.name}/report.html`, '_blank')}
                                                    >
                                                        View Report
                                                    </Button>
                                                )}
                                            </div>
                                        ))
                                    )}
                                </div>
                            </CardContent>
                        </Card>
                    </TabsContent>

                    {/* Overview Tab */}
                    <TabsContent value="overview" className="space-y-6">
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6">
                            <Card className="bg-slate-800/50 backdrop-blur-sm border-cyan-500/30 quantum-card">
                                <CardHeader className="pb-2">
                                    <CardTitle className="text-cyan-400 flex items-center gap-2">
                                        <GitBranch className="w-5 h-5" />
                                        Branches
                                    </CardTitle>
                                </CardHeader>
                                <CardContent>
                                    <div className="text-2xl font-bold text-white">{comparisonData.overview.totalBranches}</div>
                                    <p className="text-slate-400 text-sm">Total branches</p>
                                </CardContent>
                            </Card>

                            <Card className="bg-slate-800/50 backdrop-blur-sm border-purple-500/30 quantum-card">
                                <CardHeader className="pb-2">
                                    <CardTitle className="text-purple-400 flex items-center gap-2">
                                        <Code2 className="w-5 h-5" />
                                        Active Dev
                                    </CardTitle>
                                </CardHeader>
                                <CardContent>
                                    <div className="text-2xl font-bold text-white">{comparisonData.overview.activeDevelopment}</div>
                                    <p className="text-slate-400 text-sm">Active branches</p>
                                </CardContent>
                            </Card>

                            <Card className="bg-slate-800/50 backdrop-blur-sm border-green-500/30 quantum-card">
                                <CardHeader className="pb-2">
                                    <CardTitle className="text-green-400 flex items-center gap-2">
                                        <CheckCircle className="w-5 h-5" />
                                        Features
                                    </CardTitle>
                                </CardHeader>
                                <CardContent>
                                    <div className="text-2xl font-bold text-white">{comparisonData.overview.mergedFeatures}</div>
                                    <p className="text-slate-400 text-sm">Merged features</p>
                                </CardContent>
                            </Card>

                            <Card className="bg-slate-800/50 backdrop-blur-sm border-yellow-500/30 quantum-card">
                                <CardHeader className="pb-2">
                                    <CardTitle className="text-yellow-400 flex items-center gap-2">
                                        <AlertCircle className="w-5 h-5" />
                                        Reviews
                                    </CardTitle>
                                </CardHeader>
                                <CardContent>
                                    <div className="text-2xl font-bold text-white">{comparisonData.overview.pendingReviews}</div>
                                    <p className="text-slate-400 text-sm">Pending reviews</p>
                                </CardContent>
                            </Card>

                            <Card className="bg-slate-800/50 backdrop-blur-sm border-blue-500/30 quantum-card">
                                <CardHeader className="pb-2">
                                    <CardTitle className="text-blue-400 flex items-center gap-2">
                                        <TrendingUp className="w-5 h-5" />
                                        Health
                                    </CardTitle>
                                </CardHeader>
                                <CardContent>
                                    <div className="text-2xl font-bold text-white">{comparisonData.overview.codeHealth}%</div>
                                    <p className="text-slate-400 text-sm">Code health</p>
                                </CardContent>
                            </Card>
                        </div>
                    </TabsContent>

                    {/* Branches Tab */}
                    <TabsContent value="branches" className="space-y-6">
                        <div className="grid gap-4">
                            {comparisonData.branches.map((branch, index) => (
                                <Card key={index} className="bg-slate-800/50 backdrop-blur-sm border-cyan-500/30">
                                    <CardHeader>
                                        <div className="flex items-center justify-between">
                                            <CardTitle className="text-cyan-400 flex items-center gap-2">
                                                <GitBranch className="w-5 h-5" />
                                                {branch.name}
                                            </CardTitle>
                                            <Badge
                                                variant={branch.status === 'stable' ? 'default' : branch.status === 'active' ? 'secondary' : 'destructive'}
                                                className={
                                                    branch.status === 'stable' ? 'bg-green-500/20 text-green-400' :
                                                        branch.status === 'active' ? 'bg-blue-500/20 text-blue-400' :
                                                            'bg-red-500/20 text-red-400'
                                                }
                                            >
                                                {branch.status}
                                            </Badge>
                                        </div>
                                    </CardHeader>
                                    <CardContent>
                                        <div className="flex justify-between text-sm text-slate-300">
                                            <span>{branch.commits} commits</span>
                                            <span>Last activity: {branch.lastActivity}</span>
                                        </div>
                                    </CardContent>
                                </Card>
                            ))}
                        </div>
                    </TabsContent>

                    {/* Features Tab */}
                    <TabsContent value="features" className="space-y-6">
                        <div className="grid gap-6">
                            {comparisonData.features.map((feature) => (
                                <Card key={feature.id} className="bg-slate-800/50 backdrop-blur-sm border-cyan-500/30">
                                    <CardHeader>
                                        <div className="flex items-center justify-between">
                                            <CardTitle className="text-cyan-400">{feature.title}</CardTitle>
                                            <div className="flex gap-2">
                                                <Badge className="bg-purple-500/20 text-purple-400">{feature.category}</Badge>
                                                <Badge
                                                    variant={feature.status === 'approved' ? 'default' : 'secondary'}
                                                    className={feature.status === 'approved' ? 'bg-green-500/20 text-green-400' : 'bg-yellow-500/20 text-yellow-400'}
                                                >
                                                    {feature.status}
                                                </Badge>
                                            </div>
                                        </div>
                                    </CardHeader>
                                    <CardContent>
                                        <CardDescription className="text-slate-300 mb-4">
                                            {feature.description}
                                        </CardDescription>
                                        {(feature.impact || feature.complexity) && (
                                            <div className="flex gap-4 text-sm">
                                                {feature.impact && (
                                                    <span className="text-slate-400">
                                                        Impact: <span className="text-cyan-400">{feature.impact}</span>
                                                    </span>
                                                )}
                                                {feature.complexity && (
                                                    <span className="text-slate-400">
                                                        Complexity: <span className="text-purple-400">{feature.complexity}</span>
                                                    </span>
                                                )}
                                            </div>
                                        )}
                                    </CardContent>
                                </Card>
                            ))}
                        </div>
                    </TabsContent>

                    {/* Improvements Tab */}
                    <TabsContent value="improvements" className="space-y-6">
                        <div className="grid gap-6">
                            {comparisonData.improvements.map((improvement) => (
                                <Card key={improvement.id} className="bg-slate-800/50 backdrop-blur-sm border-green-500/30">
                                    <CardHeader>
                                        <div className="flex items-center justify-between">
                                            <CardTitle className="text-green-400 flex items-center gap-2">
                                                <Zap className="w-5 h-5" />
                                                {improvement.title}
                                            </CardTitle>
                                            <Badge className="bg-green-500/20 text-green-400">{improvement.category}</Badge>
                                        </div>
                                    </CardHeader>
                                    <CardContent>
                                        <CardDescription className="text-slate-300 mb-4">
                                            {improvement.description}
                                        </CardDescription>
                                        <div className="flex gap-4 text-sm">
                                            {Object.entries(improvement.metrics).map(([key, value]) => (
                                                <span key={key} className="text-slate-400">
                                                    {key}: <span className="text-cyan-400">{value}</span>
                                                </span>
                                            ))}
                                        </div>
                                    </CardContent>
                                </Card>
                            ))}
                        </div>
                    </TabsContent>

                    {/* Diagnostics Tab */}
                    <TabsContent value="diagnostics" className="space-y-6">
                        <Card className="bg-slate-800/50 backdrop-blur-sm border-blue-500/30 quantum-card">
                            <CardHeader>
                                <CardTitle className="text-blue-400 flex items-center gap-2">
                                    <Shield className="w-5 h-5" />
                                    System Diagnostics
                                </CardTitle>
                            </CardHeader>
                            <CardContent>
                                <div className="space-y-4">
                                    <div className="flex justify-between items-center">
                                        <span className="text-slate-300">Build Status</span>
                                        <Badge className="bg-green-500/20 text-green-400">
                                            {branchAnalysis ? 'Analyzed' : 'Unavailable'}
                                        </Badge>
                                    </div>
                                    <div className="flex justify-between items-center">
                                        <span className="text-slate-300">Test Coverage</span>
                                        <Badge className="bg-cyan-500/20 text-cyan-400">
                                            {branchAnalysis?.quality_metrics ? `${branchAnalysis.quality_metrics.test_coverage}%` : 'N/A'}
                                        </Badge>
                                    </div>
                                    <div className="flex justify-between items-center">
                                        <span className="text-slate-300">Security Scan</span>
                                        <Badge className="bg-green-500/20 text-green-400">
                                            {branchAnalysis ? 'Reviewed' : 'N/A'}
                                        </Badge>
                                    </div>
                                    <div className="flex justify-between items-center">
                                        <span className="text-slate-300">Performance Score</span>
                                        <Badge className="bg-purple-500/20 text-purple-400">
                                            {branchAnalysis?.quality_metrics ? `${branchAnalysis.quality_metrics.performance_score}/10` : 'N/A'}
                                        </Badge>
                                    </div>
                                </div>
                            </CardContent>
                        </Card>
                    </TabsContent>

                    {/* Approval Tab */}
                    <TabsContent value="approval" className="space-y-6">
                        <Card className="bg-slate-800/50 backdrop-blur-sm border-cyan-500/30 quantum-card">
                            <CardHeader>
                                <CardTitle className="text-cyan-400">Feature Approval System</CardTitle>
                                <CardDescription>Review and approve features for production deployment</CardDescription>
                            </CardHeader>
                            <CardContent>
                                <div className="space-y-4">
                                    {comparisonData.features.map((feature) => (
                                        <div key={feature.id} className="flex items-center justify-between p-4 bg-slate-700/50 rounded-lg">
                                            <div>
                                                <h4 className="text-white font-medium">{feature.title}</h4>
                                                <p className="text-slate-400 text-sm">{feature.description}</p>
                                            </div>
                                            <div className="flex gap-2">
                                                <Button
                                                    size="sm"
                                                    variant={approvedItems.has(feature.id) ? "default" : "outline"}
                                                    onClick={() => handleApproval(feature.id, !approvedItems.has(feature.id))}
                                                    className={approvedItems.has(feature.id)
                                                        ? "bg-green-500/20 text-green-400 border-green-500/30"
                                                        : "border-cyan-500/30 text-cyan-400"
                                                    }
                                                >
                                                    {approvedItems.has(feature.id) ? "Approved" : "Approve"}
                                                </Button>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                                <div className="mt-6 pt-6 border-t border-slate-700">
                                    <div className="flex justify-between items-center">
                                        <span className="text-slate-300">
                                            Approved: {approvedItems.size} / {comparisonData.features.length}
                                        </span>
                                        <Button
                                            className="bg-gradient-to-r from-cyan-500 to-purple-500 text-white"
                                            disabled={approvedItems.size !== comparisonData.features.length}
                                        >
                                            Deploy to Production
                                        </Button>
                                    </div>
                                </div>
                            </CardContent>
                        </Card>
                    </TabsContent>
                </Tabs>
            </div>
        </div>
    );
}

--------------------------------------------------------------------------------
FILE: client/src/pages/corpus.tsx
LINES: 586
--------------------------------------------------------------------------------
import { ErrorBoundary } from '@/components/error-boundary';
import { useState } from "react";
import { useQuery, useMutation } from "@tanstack/react-query";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { Input } from "@/components/ui/input";
import { Button } from "@/components/ui/button";
import { Switch } from "@/components/ui/switch";
import { Label } from "@/components/ui/label";
import { Slider } from "@/components/ui/slider";
import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
  DialogTrigger,
} from "@/components/ui/dialog";
import {
  Database,
  TrendingUp,
  Zap,
  Search,
  Copy,
  CheckCircle2,
  ChevronLeft,
  ChevronRight,
  Filter,
  Sparkles,
} from "lucide-react";
import { useToast } from "@/hooks/use-toast";
import { apiRequest, queryClient } from "@/lib/queryClient";
import { RunStatus } from "@/components/run-status";

type CorpusEntry = {
  id: string;
  timestamp: string;
  spec_id: string;
  func_name: string;
  func_signature: string;
  passed: number;
  total: number;
  score: number;
  snippet: string;
  failing_tests?: string[];
  calls_functions?: string[];
  complexity?: number;
  iteration?: number;
  sig_key?: string;
  post_bow?: string[];
};

type SimilarityResult = {
  entry: CorpusEntry;
  similarity: number;
  breakdown: {
    returnMatch: number;
    argMatch: number;
    jaccardScore: number;
    perfectBonus: number;
  };
};

export default function Corpus() {
  const [funcFilter, setFuncFilter] = useState("");
  const [limit, setLimit] = useState(50);
  const [offset, setOffset] = useState(0);
  const [perfectOnly, setPerfectOnly] = useState(false);
  const [minScore, setMinScore] = useState<number | undefined>(undefined);
  const [maxScore, setMaxScore] = useState<number | undefined>(undefined);
  const [startDate, setStartDate] = useState<string>("");
  const [endDate, setEndDate] = useState<string>("");
  const [showFilters, setShowFilters] = useState(false);
  const [selectedEntry, setSelectedEntry] = useState<CorpusEntry | null>(null);
  const [showSimilarity, setShowSimilarity] = useState(false);
  const { toast } = useToast();

  const buildQueryString = () => {
    const params = new URLSearchParams();
    if (funcFilter) params.set("func", funcFilter);
    params.set("limit", limit.toString());
    params.set("offset", offset.toString());
    if (perfectOnly) params.set("perfectOnly", "true");
    if (minScore !== undefined) params.set("minScore", minScore.toString());
    if (maxScore !== undefined) params.set("maxScore", maxScore.toString());
    if (startDate) {
      const normalized = new Date(startDate).toISOString();
      params.set("startDate", normalized);
    }
    if (endDate) {
      const normalized = new Date(endDate).toISOString();
      params.set("endDate", normalized);
    }
    return params.toString();
  };

  const { data: corpusData, isLoading } = useQuery<{
    items: CorpusEntry[];
    hasMore: boolean;
  }>({
    queryKey: [`/api/corpus?${buildQueryString()}`],
  });

  const similarityMutation = useMutation({
    mutationFn: async (entry: CorpusEntry) => {
      const res = await fetch("/api/corpus/similar", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          targetSigKey: entry.sig_key || "",
          targetPostBow: entry.post_bow || [],
          limit: 5,
        }),
      });
      if (!res.ok) {
        throw new Error(`Failed to fetch similarity: ${res.statusText}`);
      }
      const data: { results: SimilarityResult[] } = await res.json();
      return data;
    },
  });

  const entries = corpusData?.items || [];
  const hasMore = corpusData?.hasMore || false;
  const totalRecords = entries.length;
  const perfectRuns = entries.filter((e) => e.passed === e.total).length;
  const avgScore =
    entries.length > 0
      ? (entries.reduce((sum, e) => sum + e.score, 0) / entries.length).toFixed(
          2
        )
      : "0";

  const stats = [
    {
      label: "Total Records",
      value: totalRecords.toString(),
      icon: Database,
      color: "text-chart-1",
    },
    {
      label: "Perfect Runs",
      value: perfectRuns.toString(),
      icon: CheckCircle2,
      color: "text-chart-2",
    },
    {
      label: "Avg Score",
      value: avgScore,
      icon: Zap,
      color: "text-chart-3",
    },
  ];

  const copySnippet = async (snippet: string) => {
    try {
      await navigator.clipboard.writeText(snippet);
      toast({
        title: "Copied",
        description: "Snippet copied to clipboard",
      });
    } catch {
      toast({
        title: "Error",
        description: "Failed to copy snippet",
        variant: "destructive",
      });
    }
  };

  const passPercentage = (passed: number, total: number) => {
    if (!total) return "0%";
    return `${Math.round((passed / total) * 100)}%`;
  };

  const showSimilarEntries = (entry: CorpusEntry) => {
    setSelectedEntry(entry);
    setShowSimilarity(true);
    similarityMutation.mutate(entry);
  };

  const nextPage = () => {
    setOffset(offset + limit);
  };

  const prevPage = () => {
    setOffset(Math.max(0, offset - limit));
  };

  const resetFilters = () => {
    setFuncFilter("");
    setPerfectOnly(false);
    setMinScore(undefined);
    setMaxScore(undefined);
    setStartDate("");
    setEndDate("");
    setOffset(0);
  };

  return (
    <div className="h-full overflow-auto">
      <div className="p-6 space-y-6">
        <div>
          <h1 className="text-2xl font-bold" data-testid="text-page-title">
            Corpus Explorer
          </h1>
          <p className="text-sm text-muted-foreground mt-1">
            Explore Aurora's learning corpus and synthesis history
          </p>
        </div>

        <div className="grid gap-4 md:grid-cols-3">
          {stats.map((stat) => (
            <Card
              key={stat.label}
              className="hover-elevate"
              data-testid={`card-${stat.label.toLowerCase().replace(" ", "-")}`}
            >
              <CardHeader className="flex flex-row items-center justify-between gap-2 space-y-0 pb-2">
                <CardTitle className="text-sm font-medium">
                  {stat.label}
                </CardTitle>
                <stat.icon className={`h-4 w-4 ${stat.color}`} />
              </CardHeader>
              <CardContent>
                <div
                  className="text-2xl font-bold"
                  data-testid={`text-${stat.label.toLowerCase().replace(" ", "-")}`}
                >
                  {stat.value}
                </div>
              </CardContent>
            </Card>
          ))}
        </div>

        <RunStatus />

        <Card data-testid="card-corpus-data">
          <CardHeader>
            <div className="flex items-center justify-between gap-4 flex-wrap">
              <CardTitle>Synthesis Records</CardTitle>
              <div className="flex items-center gap-2 flex-wrap">
                <div className="relative flex-1 min-w-60">
                  <Search className="absolute left-2 top-2.5 h-4 w-4 text-muted-foreground" />
                  <Input
                    placeholder="Filter by function name"
                    value={funcFilter}
                    onChange={(e) => {
                      setFuncFilter(e.target.value);
                      setOffset(0);
                    }}
                    className="pl-8"
                    data-testid="input-filter-func"
                  />
                </div>
                <Button
                  variant="outline"
                  size="icon"
                  onClick={() => setShowFilters(!showFilters)}
                  data-testid="button-toggle-filters"
                >
                  <Filter className="h-4 w-4" />
                </Button>
                <select
                  value={limit}
                  onChange={(e) => {
                    setLimit(Number(e.target.value));
                    setOffset(0);
                  }}
                  className="border rounded-md px-3 min-h-9 bg-background"
                  data-testid="select-limit"
                >
                  <option value={25}>25</option>
                  <option value={50}>50</option>
                  <option value={100}>100</option>
                  <option value={200}>200</option>
                </select>
              </div>
            </div>
            {showFilters && (
              <div className="mt-4 p-4 border rounded-lg space-y-4 bg-muted/30">
                <div className="flex items-center justify-between">
                  <h3 className="text-sm font-medium">Advanced Filters</h3>
                  <Button
                    variant="ghost"
                    size="sm"
                    onClick={resetFilters}
                    data-testid="button-reset-filters"
                  >
                    Reset All
                  </Button>
                </div>
                <div className="grid gap-4 md:grid-cols-2">
                  <div className="flex items-center space-x-2">
                    <Switch
                      id="perfect-only"
                      checked={perfectOnly}
                      onCheckedChange={(checked) => {
                        setPerfectOnly(checked);
                        setOffset(0);
                      }}
                      data-testid="switch-perfect-only"
                    />
                    <Label htmlFor="perfect-only">Perfect runs only</Label>
                  </div>
                  <div className="space-y-2">
                    <Label>Score Range</Label>
                    <div className="flex items-center gap-2">
                      <Input
                        type="number"
                        placeholder="Min"
                        value={minScore ?? ""}
                        onChange={(e) => {
                          setMinScore(
                            e.target.value ? Number(e.target.value) : undefined
                          );
                          setOffset(0);
                        }}
                        className="w-24"
                        step="0.01"
                        data-testid="input-min-score"
                      />
                      <span className="text-muted-foreground">to</span>
                      <Input
                        type="number"
                        placeholder="Max"
                        value={maxScore ?? ""}
                        onChange={(e) => {
                          setMaxScore(
                            e.target.value ? Number(e.target.value) : undefined
                          );
                          setOffset(0);
                        }}
                        className="w-24"
                        step="0.01"
                        data-testid="input-max-score"
                      />
                    </div>
                  </div>
                  <div className="space-y-2">
                    <Label>Date Range</Label>
                    <div className="flex items-center gap-2">
                      <Input
                        type="datetime-local"
                        value={startDate}
                        onChange={(e) => {
                          setStartDate(e.target.value);
                          setOffset(0);
                        }}
                        className="flex-1"
                        data-testid="input-start-date"
                      />
                      <span className="text-muted-foreground">to</span>
                      <Input
                        type="datetime-local"
                        value={endDate}
                        onChange={(e) => {
                          setEndDate(e.target.value);
                          setOffset(0);
                        }}
                        className="flex-1"
                        data-testid="input-end-date"
                      />
                    </div>
                  </div>
                </div>
              </div>
            )}
          </CardHeader>
          <CardContent>
            {isLoading ? (
              <div className="text-center py-8 text-muted-foreground">
                Loading...
              </div>
            ) : entries.length === 0 ? (
              <div className="text-center py-8 text-muted-foreground">
                No synthesis records found. Adjust your filters or start a
                synthesis run.
              </div>
            ) : (
              <>
                <div className="space-y-3">
                  {entries.map((entry) => (
                    <div
                      key={entry.id}
                      className="rounded-lg border border-border p-4 space-y-3 hover-elevate"
                      data-testid={`record-${entry.func_name}`}
                    >
                      <div className="flex items-start justify-between gap-4">
                        <div className="flex-1 min-w-0">
                          <div className="flex items-center gap-2 flex-wrap">
                            <code className="text-sm font-mono font-semibold">
                              {entry.func_name}
                            </code>
                            <Badge
                              variant="secondary"
                              data-testid={`badge-pass-${entry.func_name}`}
                            >
                              {entry.passed}/{entry.total} (
                              {passPercentage(entry.passed, entry.total)})
                            </Badge>
                            <Badge variant="outline">
                              Score: {entry.score.toFixed(4)}
                            </Badge>
                            {entry.complexity !== undefined &&
                              entry.complexity >= 0 && (
                                <Badge variant="outline">
                                  AST: {entry.complexity}
                                </Badge>
                              )}
                            {entry.calls_functions &&
                              entry.calls_functions.length > 0 && (
                                <Badge variant="outline">
                                  Calls: {entry.calls_functions.length}
                                </Badge>
                              )}
                          </div>
                          <p className="text-xs text-muted-foreground mt-1 font-mono">
                            {entry.func_signature}
                          </p>
                          <p className="text-xs text-muted-foreground mt-1">
                            {new Date(entry.timestamp).toLocaleString()}
                          </p>
                        </div>
                        <div className="flex gap-1">
                          <Button
                            size="icon"
                            variant="ghost"
                            onClick={() => copySnippet(entry.snippet)}
                            data-testid={`button-copy-${entry.func_name}`}
                          >
                            <Copy className="h-4 w-4" />
                          </Button>
                          {entry.sig_key && (
                            <Button
                              size="icon"
                              variant="ghost"
                              onClick={() => showSimilarEntries(entry)}
                              data-testid={`button-similar-${entry.func_name}`}
                            >
                              <Sparkles className="h-4 w-4" />
                            </Button>
                          )}
                        </div>
                      </div>
                      {entry.failing_tests && entry.failing_tests.length > 0 && (
                        <div className="text-xs text-destructive">
                          Failed: {entry.failing_tests.join(", ")}
                        </div>
                      )}
                      <div className="relative">
                        <pre className="text-xs bg-muted p-3 rounded-md overflow-x-auto max-h-60 overflow-y-auto">
                          {entry.snippet}
                        </pre>
                      </div>
                    </div>
                  ))}
                </div>

                <div className="flex items-center justify-between mt-4 pt-4 border-t">
                  <div className="text-sm text-muted-foreground">
                    Showing {offset + 1} - {offset + entries.length}
                  </div>
                  <div className="flex gap-2">
                    <Button
                      variant="outline"
                      size="sm"
                      onClick={prevPage}
                      disabled={offset === 0}
                      data-testid="button-prev-page"
                    >
                      <ChevronLeft className="h-4 w-4 mr-1" />
                      Previous
                    </Button>
                    <Button
                      variant="outline"
                      size="sm"
                      onClick={nextPage}
                      disabled={!hasMore}
                      data-testid="button-next-page"
                    >
                      Next
                      <ChevronRight className="h-4 w-4 ml-1" />
                    </Button>
                  </div>
                </div>
              </>
            )}
          </CardContent>
        </Card>

        <Dialog open={showSimilarity} onOpenChange={setShowSimilarity}>
          <DialogContent className="max-w-4xl max-h-[80vh] overflow-y-auto">
            <DialogHeader>
              <DialogTitle>
                Similarity Analysis for{" "}
                <code className="font-mono">{selectedEntry?.func_name}</code>
              </DialogTitle>
            </DialogHeader>
            {similarityMutation.isPending ? (
              <div className="text-center py-8 text-muted-foreground">
                Computing similarities...
              </div>
            ) : similarityMutation.data ? (
              <div className="space-y-4">
                <p className="text-sm text-muted-foreground">
                  Top similar functions based on signature and post-conditions
                </p>
                {similarityMutation.data.results.map((result: SimilarityResult, idx: number) => (
                  <Card key={result.entry.id} className="hover-elevate">
                    <CardHeader>
                      <div className="flex items-start justify-between gap-4">
                        <div className="flex-1">
                          <div className="flex items-center gap-2 flex-wrap">
                            <Badge variant="secondary">#{idx + 1}</Badge>
                            <code className="text-sm font-mono font-semibold">
                              {result.entry.func_name}
                            </code>
                            <Badge
                              variant={
                                result.similarity > 0.7 ? "default" : "outline"
                              }
                            >
                              {(result.similarity * 100).toFixed(1)}% similar
                            </Badge>
                          </div>
                          <p className="text-xs text-muted-foreground mt-2">
                            {result.entry.func_signature}
                          </p>
                        </div>
                        <Button
                          size="icon"
                          variant="ghost"
                          onClick={() => copySnippet(result.entry.snippet)}
                        >
                          <Copy className="h-4 w-4" />
                        </Button>
                      </div>
                    </CardHeader>
                    <CardContent className="space-y-3">
                      <div className="grid grid-cols-2 md:grid-cols-4 gap-2 text-xs">
                        <div>
                          <span className="text-muted-foreground">
                            Return Match:
                          </span>{" "}
                          <Badge variant="outline" className="ml-1">
                            {(result.breakdown.returnMatch * 100).toFixed(0)}%
                          </Badge>
                        </div>
                        <div>
                          <span className="text-muted-foreground">
                            Arg Match:
                          </span>{" "}
                          <Badge variant="outline" className="ml-1">
                            {(result.breakdown.argMatch * 100).toFixed(0)}%
                          </Badge>
                        </div>
                        <div>
                          <span className="text-muted-foreground">
                            Jaccard:
                          </span>{" "}
                          <Badge variant="outline" className="ml-1">
                            {(result.breakdown.jaccardScore * 100).toFixed(0)}%
                          </Badge>
                        </div>
                        <div>
                          <span className="text-muted-foreground">Bonus:</span>{" "}
                          <Badge variant="outline" className="ml-1">
                            {(result.breakdown.perfectBonus * 100).toFixed(0)}%
                          </Badge>
                        </div>
                      </div>
                      <pre className="text-xs bg-muted p-3 rounded-md overflow-x-auto max-h-40 overflow-y-auto">
                        {result.entry.snippet}
                      </pre>
                    </CardContent>
                  </Card>
                ))}
              </div>
            ) : null}
          </DialogContent>
        </Dialog>
      </div>
    </div>
  );
}

--------------------------------------------------------------------------------
FILE: client/src/pages/dashboard.tsx
LINES: 6
--------------------------------------------------------------------------------
'use client';

import AuroraFuturisticDashboard from '@/components/AuroraFuturisticDashboard';

export default function DashboardPage() {
  return <AuroraFuturisticDashboard />;
}
--------------------------------------------------------------------------------
FILE: client/src/pages/database.tsx
LINES: 348
--------------------------------------------------------------------------------
import { useState } from 'react';
import { Card, CardContent, CardHeader, CardTitle, CardDescription } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { ScrollArea } from "@/components/ui/scroll-area";
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs";
import { useQuery } from "@tanstack/react-query";
import { Database, RefreshCw, Search, Lightbulb, FileText, Brain, Layers, BookOpen, Tag, Clock, Star, AlertCircle } from "lucide-react";
import { motion } from "framer-motion";

interface MemoryData {
  stats: {
    shortTermCount: number;
    midTermCount: number;
    longTermCount: number;
    semanticCount: number;
    factCount: number;
    eventCount: number;
    totalMemories: number;
  };
  facts: Record<string, unknown>;
}

interface KnowledgeEntry {
  id: string;
  title: string;
  category: string;
  content: string;
  tags: string[];
  importance: number;
  lastAccessed: string;
}

export default function DatabasePage() {
  const [searchQuery, setSearchQuery] = useState('');
  const [activeTab, setActiveTab] = useState('facts');

  const { data: memoryData, isLoading, isError, error, refetch, isRefetching } = useQuery<MemoryData>({
    queryKey: ['/api/memory-fabric/status'],
    refetchInterval: 30000,
  });

  const knowledgeEntries: KnowledgeEntry[] = [
    { id: '1', title: 'TypeScript Best Practices', category: 'programming', content: 'Use strict type checking, prefer interfaces over type aliases...', tags: ['typescript', 'coding', 'best-practices'], importance: 0.92, lastAccessed: '5 min ago' },
    { id: '2', title: 'React Component Patterns', category: 'programming', content: 'Compound components, render props, higher-order components...', tags: ['react', 'patterns', 'components'], importance: 0.88, lastAccessed: '12 min ago' },
    { id: '3', title: 'Database Optimization', category: 'databases', content: 'Index strategies, query optimization, connection pooling...', tags: ['database', 'performance', 'sql'], importance: 0.85, lastAccessed: '1 hour ago' },
    { id: '4', title: 'API Design Guidelines', category: 'architecture', content: 'RESTful conventions, error handling, versioning strategies...', tags: ['api', 'design', 'rest'], importance: 0.90, lastAccessed: '30 min ago' },
    { id: '5', title: 'Security Best Practices', category: 'security', content: 'Input validation, authentication patterns, encryption...', tags: ['security', 'auth', 'encryption'], importance: 0.95, lastAccessed: '2 min ago' },
    { id: '6', title: 'Performance Optimization', category: 'optimization', content: 'Code splitting, lazy loading, caching strategies...', tags: ['performance', 'optimization', 'web'], importance: 0.87, lastAccessed: '45 min ago' },
  ];

  const facts = memoryData?.facts || {};
  const factEntries = Object.entries(facts);

  const filteredKnowledge = knowledgeEntries.filter(entry => 
    entry.title.toLowerCase().includes(searchQuery.toLowerCase()) ||
    entry.tags.some(tag => tag.toLowerCase().includes(searchQuery.toLowerCase()))
  );

  const getCategoryColor = (category: string) => {
    switch (category) {
      case 'programming': return 'bg-cyan-500/20 text-cyan-300 border-cyan-500/30';
      case 'databases': return 'bg-purple-500/20 text-purple-300 border-purple-500/30';
      case 'architecture': return 'bg-pink-500/20 text-pink-300 border-pink-500/30';
      case 'security': return 'bg-red-500/20 text-red-300 border-red-500/30';
      case 'optimization': return 'bg-green-500/20 text-green-300 border-green-500/30';
      default: return 'bg-slate-500/20 text-slate-300 border-slate-500/30';
    }
  };

  return (
    <div className="h-full flex flex-col bg-gradient-to-br from-background via-cyan-950/5 to-purple-950/5">
      <div className="p-6 border-b border-cyan-500/20">
        <div className="flex items-center justify-between">
          <div className="flex items-center gap-4">
            <div className="relative">
              <div className="absolute inset-0 bg-blue-500/30 rounded-full blur-md animate-pulse" />
              <div className="relative w-12 h-12 rounded-full border-2 border-blue-400/50 flex items-center justify-center bg-gradient-to-br from-blue-500/20 to-purple-500/20">
                <Database className="w-6 h-6 text-blue-400" />
              </div>
            </div>
            <div>
              <h1 className="text-2xl font-bold bg-gradient-to-r from-blue-400 via-purple-400 to-blue-400 bg-clip-text text-transparent" data-testid="text-page-title">
                Knowledge Base
              </h1>
              <p className="text-sm text-muted-foreground">
                Comprehensive Data Storage & Retrieval
              </p>
            </div>
          </div>
          <Button 
            variant="outline" 
            size="sm" 
            onClick={() => refetch()}
            disabled={isRefetching}
            className="border-blue-500/30 hover:border-blue-400/50"
            data-testid="button-refresh"
          >
            <RefreshCw className={`w-4 h-4 mr-2 ${isRefetching ? 'animate-spin' : ''}`} />
            Refresh
          </Button>
        </div>
      </div>

      {isLoading ? (
        <div className="flex-1 flex items-center justify-center">
          <div className="text-center">
            <Database className="w-12 h-12 text-blue-400 animate-pulse mx-auto mb-4" />
            <p className="text-muted-foreground">Loading knowledge base...</p>
          </div>
        </div>
      ) : isError ? (
        <div className="flex-1 flex items-center justify-center">
          <div className="text-center">
            <AlertCircle className="w-12 h-12 text-red-400 mx-auto mb-4" />
            <p className="text-red-300 mb-2">Failed to load knowledge base</p>
            <p className="text-sm text-muted-foreground mb-4">{error?.message || 'An error occurred'}</p>
            <Button 
              variant="outline" 
              size="sm" 
              onClick={() => refetch()}
              className="border-red-500/30 hover:border-red-400/50"
              data-testid="button-retry"
            >
              <RefreshCw className="w-4 h-4 mr-2" />
              Retry
            </Button>
          </div>
        </div>
      ) : (
        <div className="flex-1 overflow-hidden p-6">
          <div className="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
            <Card className="border-cyan-500/30 bg-slate-900/50 backdrop-blur-xl" data-testid="card-stat-facts">
              <CardContent className="p-4">
                <div className="flex items-center gap-3">
                  <div className="w-10 h-10 rounded-lg bg-cyan-500/20 flex items-center justify-center">
                    <Lightbulb className="w-5 h-5 text-cyan-400" />
                  </div>
                  <div>
                    <p className="text-xs text-cyan-300/60">Facts</p>
                    <p className="text-2xl font-bold text-cyan-400" data-testid="text-fact-count">
                      {memoryData?.stats?.factCount || factEntries.length}
                    </p>
                  </div>
                </div>
              </CardContent>
            </Card>
            
            <Card className="border-purple-500/30 bg-slate-900/50 backdrop-blur-xl" data-testid="card-stat-memories">
              <CardContent className="p-4">
                <div className="flex items-center gap-3">
                  <div className="w-10 h-10 rounded-lg bg-purple-500/20 flex items-center justify-center">
                    <Brain className="w-5 h-5 text-purple-400" />
                  </div>
                  <div>
                    <p className="text-xs text-purple-300/60">Memories</p>
                    <p className="text-2xl font-bold text-purple-400" data-testid="text-memory-count">
                      {memoryData?.stats?.totalMemories || 0}
                    </p>
                  </div>
                </div>
              </CardContent>
            </Card>
            
            <Card className="border-pink-500/30 bg-slate-900/50 backdrop-blur-xl" data-testid="card-stat-semantic">
              <CardContent className="p-4">
                <div className="flex items-center gap-3">
                  <div className="w-10 h-10 rounded-lg bg-pink-500/20 flex items-center justify-center">
                    <Layers className="w-5 h-5 text-pink-400" />
                  </div>
                  <div>
                    <p className="text-xs text-pink-300/60">Semantic</p>
                    <p className="text-2xl font-bold text-pink-400" data-testid="text-semantic-count">
                      {memoryData?.stats?.semanticCount || 0}
                    </p>
                  </div>
                </div>
              </CardContent>
            </Card>
            
            <Card className="border-green-500/30 bg-slate-900/50 backdrop-blur-xl" data-testid="card-stat-events">
              <CardContent className="p-4">
                <div className="flex items-center gap-3">
                  <div className="w-10 h-10 rounded-lg bg-green-500/20 flex items-center justify-center">
                    <FileText className="w-5 h-5 text-green-400" />
                  </div>
                  <div>
                    <p className="text-xs text-green-300/60">Events</p>
                    <p className="text-2xl font-bold text-green-400" data-testid="text-event-count">
                      {memoryData?.stats?.eventCount || 0}
                    </p>
                  </div>
                </div>
              </CardContent>
            </Card>
          </div>

          <Card className="border-blue-500/30 bg-slate-900/50 backdrop-blur-xl mb-6">
            <CardContent className="p-4">
              <div className="relative">
                <Search className="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-blue-400" />
                <Input
                  placeholder="Search knowledge base..."
                  value={searchQuery}
                  onChange={(e) => setSearchQuery(e.target.value)}
                  className="pl-10 bg-slate-800/50 border-blue-500/30 focus:border-blue-400/50 text-blue-100 placeholder:text-blue-300/40"
                  data-testid="input-search"
                />
              </div>
            </CardContent>
          </Card>

          <Tabs value={activeTab} onValueChange={setActiveTab} className="flex-1" data-testid="tabs-knowledge">
            <TabsList className="mb-4 bg-slate-900 border border-blue-500/40 shadow-lg" data-testid="tablist-knowledge">
              <TabsTrigger value="facts" className="data-[state=active]:bg-gradient-to-r data-[state=active]:from-blue-600/70 data-[state=active]:to-cyan-600/70 data-[state=active]:text-white text-blue-300" data-testid="tab-trigger-facts">
                <Lightbulb className="w-4 h-4 mr-2" />
                Facts
              </TabsTrigger>
              <TabsTrigger value="knowledge" className="data-[state=active]:bg-gradient-to-r data-[state=active]:from-blue-600/70 data-[state=active]:to-cyan-600/70 data-[state=active]:text-white text-blue-300" data-testid="tab-trigger-knowledge">
                <BookOpen className="w-4 h-4 mr-2" />
                Knowledge
              </TabsTrigger>
            </TabsList>

            <TabsContent value="facts" className="h-[calc(100%-120px)]" data-testid="tab-content-facts">
              <ScrollArea className="h-full">
                <Card className="border-cyan-500/30 bg-slate-900/50 backdrop-blur-xl">
                  <CardHeader className="border-b border-cyan-500/20">
                    <CardTitle className="flex items-center gap-2 text-lg text-cyan-300">
                      <Lightbulb className="w-5 h-5 text-yellow-400" />
                      Stored Facts
                    </CardTitle>
                    <CardDescription className="text-cyan-300/60">
                      Key information Aurora has learned and stored
                    </CardDescription>
                  </CardHeader>
                  <CardContent className="pt-4">
                    {factEntries.length === 0 ? (
                      <p className="text-muted-foreground text-sm text-center py-8">No facts stored yet. Start a conversation to teach Aurora!</p>
                    ) : (
                      <div className="space-y-3">
                        {factEntries.map(([key, value], index) => {
                          const factObj = value as { value?: string; category?: string; importance?: number };
                          const displayValue = factObj?.value !== undefined ? String(factObj.value) : String(value);
                          const category = factObj?.category || 'general';
                          const importance = factObj?.importance || 0.5;
                          
                          return (
                            <motion.div
                              key={key}
                              initial={{ opacity: 0, y: 10 }}
                              animate={{ opacity: 1, y: 0 }}
                              transition={{ delay: index * 0.05 }}
                            >
                              <Card className="border-cyan-500/20 bg-slate-800/50" data-testid={`card-fact-${index}`}>
                                <CardContent className="p-4">
                                  <div className="flex items-start justify-between gap-2 mb-2">
                                    <div className="flex items-center gap-2">
                                      <Lightbulb className="w-4 h-4 text-yellow-400" />
                                      <span className="font-mono text-sm text-cyan-300">{key}</span>
                                    </div>
                                    <Badge variant="outline" className="text-xs bg-cyan-500/10 text-cyan-300 border-cyan-500/30">
                                      {category}
                                    </Badge>
                                  </div>
                                  <p className="text-sm text-cyan-100 mb-2">{displayValue}</p>
                                  <div className="flex items-center gap-2">
                                    <Star className="w-3 h-3 text-yellow-400" />
                                    <span className="text-xs text-yellow-300/60">
                                      {(importance * 100).toFixed(0)}% importance
                                    </span>
                                  </div>
                                </CardContent>
                              </Card>
                            </motion.div>
                          );
                        })}
                      </div>
                    )}
                  </CardContent>
                </Card>
              </ScrollArea>
            </TabsContent>

            <TabsContent value="knowledge" className="h-[calc(100%-120px)]" data-testid="tab-content-knowledge">
              <ScrollArea className="h-full">
                <Card className="border-purple-500/30 bg-slate-900/50 backdrop-blur-xl">
                  <CardHeader className="border-b border-purple-500/20">
                    <CardTitle className="flex items-center gap-2 text-lg text-purple-300">
                      <BookOpen className="w-5 h-5 text-purple-400" />
                      Knowledge Library
                    </CardTitle>
                    <CardDescription className="text-purple-300/60">
                      Curated knowledge and best practices
                    </CardDescription>
                  </CardHeader>
                  <CardContent className="pt-4">
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      {filteredKnowledge.map((entry, index) => (
                        <motion.div
                          key={entry.id}
                          initial={{ opacity: 0, y: 10 }}
                          animate={{ opacity: 1, y: 0 }}
                          transition={{ delay: index * 0.05 }}
                        >
                          <Card className="border-purple-500/20 bg-slate-800/50 hover:border-purple-400/40 transition-colors" data-testid={`card-knowledge-${entry.id}`}>
                            <CardContent className="p-4">
                              <div className="flex items-start justify-between gap-2 mb-2">
                                <h3 className="text-sm font-semibold text-purple-200">{entry.title}</h3>
                                <Badge variant="outline" className={`text-xs ${getCategoryColor(entry.category)}`}>
                                  {entry.category}
                                </Badge>
                              </div>
                              <p className="text-xs text-purple-300/60 mb-3 line-clamp-2">{entry.content}</p>
                              <div className="flex flex-wrap gap-1 mb-3">
                                {entry.tags.map((tag, i) => (
                                  <Badge key={i} variant="outline" className="text-xs bg-slate-700/50 text-slate-300 border-slate-500/30">
                                    <Tag className="w-3 h-3 mr-1" />
                                    {tag}
                                  </Badge>
                                ))}
                              </div>
                              <div className="flex items-center justify-between text-xs">
                                <div className="flex items-center gap-1 text-muted-foreground">
                                  <Clock className="w-3 h-3" />
                                  {entry.lastAccessed}
                                </div>
                                <div className="flex items-center gap-1 text-yellow-400">
                                  <Star className="w-3 h-3" />
                                  {(entry.importance * 100).toFixed(0)}%
                                </div>
                              </div>
                            </CardContent>
                          </Card>
                        </motion.div>
                      ))}
                    </div>
                  </CardContent>
                </Card>
              </ScrollArea>
            </TabsContent>
          </Tabs>
        </div>
      )}
    </div>
  );
}

--------------------------------------------------------------------------------
FILE: client/src/pages/evolution.tsx
LINES: 418
--------------------------------------------------------------------------------
import { useState } from 'react';
import { Card, CardContent, CardHeader, CardTitle, CardDescription } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { Button } from "@/components/ui/button";
import { ScrollArea } from "@/components/ui/scroll-area";
import { Progress } from "@/components/ui/progress";
import { useQuery } from "@tanstack/react-query";
import { TrendingUp, Brain, Zap, Target, RefreshCw, Sparkles, Activity, Clock, Layers, ArrowUpRight, ChevronRight, AlertCircle } from "lucide-react";
import { motion } from "framer-motion";

interface EvolutionMetric {
  id: string;
  name: string;
  value: number;
  maxValue: number;
  trend: 'up' | 'down' | 'stable';
  category: string;
}

interface LearningEvent {
  timestamp: string;
  type: string;
  description: string;
  improvement: number;
}

interface EvolutionData {
  metrics: EvolutionMetric[];
  learningEvents: LearningEvent[];
  summary: {
    totalTiers: number;
    activeTiers: number;
    totalExecutions: number;
    activeExecutions: number;
    totalCapabilities: number;
    totalModules: number;
  };
}

interface AuroraStatus {
  status: string;
  powerUnits: number;
  knowledgeCapabilities: number;
  executionModes: number;
  systemComponents: number;
  totalModules: number;
  autofixer: {
    workers: number;
    active: number;
    queued: number;
    completed: number;
  };
  uptime: number;
  version: string;
}

export default function EvolutionPage() {
  const [selectedCategory, setSelectedCategory] = useState<string>('all');

  const { data: auroraStatus, isLoading: statusLoading, isError: statusError, error: statusErr, refetch: refetchStatus, isRefetching: refetchingStatus } = useQuery<AuroraStatus>({
    queryKey: ['/api/aurora/status'],
    refetchInterval: 10000,
  });

  const { data: evolutionData, isLoading: metricsLoading, isError: metricsError, error: metricsErr, refetch: refetchMetrics, isRefetching: refetchingMetrics } = useQuery<EvolutionData>({
    queryKey: ['/api/evolution/metrics'],
    refetchInterval: 15000,
  });

  const isLoading = statusLoading || metricsLoading;
  const isError = statusError || metricsError;
  const error = statusErr || metricsErr;
  const isRefetching = refetchingStatus || refetchingMetrics;
  const refetch = () => { refetchStatus(); refetchMetrics(); };

  const evolutionMetrics = evolutionData?.metrics || [];
  const learningEvents = evolutionData?.learningEvents || [];

  const categories = ['all', 'intelligence', 'capability', 'adaptation', 'performance'];
  
  const filteredMetrics = selectedCategory === 'all' 
    ? evolutionMetrics 
    : evolutionMetrics.filter(m => m.category === selectedCategory);

  const getTrendIcon = (trend: string) => {
    if (trend === 'up') return <ArrowUpRight className="w-4 h-4 text-green-400" />;
    if (trend === 'down') return <ArrowUpRight className="w-4 h-4 text-red-400 rotate-90" />;
    return <ChevronRight className="w-4 h-4 text-yellow-400" />;
  };

  const getCategoryColor = (category: string) => {
    switch (category) {
      case 'intelligence': return 'cyan';
      case 'capability': return 'purple';
      case 'adaptation': return 'pink';
      case 'performance': return 'green';
      default: return 'cyan';
    }
  };

  const getEventColor = (type: string) => {
    switch (type) {
      case 'pattern_learned': return 'bg-cyan-500/20 text-cyan-300 border-cyan-500/30';
      case 'capability_enhanced': return 'bg-purple-500/20 text-purple-300 border-purple-500/30';
      case 'memory_consolidated': return 'bg-blue-500/20 text-blue-300 border-blue-500/30';
      case 'self_correction': return 'bg-green-500/20 text-green-300 border-green-500/30';
      default: return 'bg-slate-500/20 text-slate-300 border-slate-500/30';
    }
  };

  const formatUptime = (ms: number) => {
    const hours = Math.floor(ms / 3600000);
    const minutes = Math.floor((ms % 3600000) / 60000);
    return `${hours}h ${minutes}m`;
  };

  return (
    <div className="h-full flex flex-col bg-gradient-to-br from-background via-cyan-950/5 to-purple-950/5">
      <div className="p-6 border-b border-cyan-500/20">
        <div className="flex items-center justify-between">
          <div className="flex items-center gap-4">
            <div className="relative">
              <div className="absolute inset-0 bg-cyan-500/30 rounded-full blur-md animate-pulse" />
              <div className="relative w-12 h-12 rounded-full border-2 border-cyan-400/50 flex items-center justify-center bg-gradient-to-br from-cyan-500/20 to-purple-500/20">
                <TrendingUp className="w-6 h-6 text-cyan-400" />
              </div>
            </div>
            <div>
              <h1 className="text-2xl font-bold bg-gradient-to-r from-cyan-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent" data-testid="text-page-title">
                Evolution Monitor
              </h1>
              <p className="text-sm text-muted-foreground">
                Track Aurora's Continuous Growth & Adaptation
              </p>
            </div>
          </div>
          <Button 
            variant="outline" 
            size="sm" 
            onClick={() => refetch()}
            disabled={isRefetching}
            className="border-cyan-500/30 hover:border-cyan-400/50"
            data-testid="button-refresh"
          >
            <RefreshCw className={`w-4 h-4 mr-2 ${isRefetching ? 'animate-spin' : ''}`} />
            Refresh
          </Button>
        </div>
      </div>

      {isLoading ? (
        <div className="flex-1 flex items-center justify-center">
          <div className="text-center">
            <TrendingUp className="w-12 h-12 text-cyan-400 animate-pulse mx-auto mb-4" />
            <p className="text-muted-foreground">Loading evolution data...</p>
          </div>
        </div>
      ) : isError ? (
        <div className="flex-1 flex items-center justify-center">
          <div className="text-center">
            <AlertCircle className="w-12 h-12 text-red-400 mx-auto mb-4" />
            <p className="text-red-300 mb-2">Failed to load evolution data</p>
            <p className="text-sm text-muted-foreground mb-4">{error?.message || 'An error occurred'}</p>
            <Button 
              variant="outline" 
              size="sm" 
              onClick={() => refetch()}
              className="border-red-500/30 hover:border-red-400/50"
              data-testid="button-retry"
            >
              <RefreshCw className="w-4 h-4 mr-2" />
              Retry
            </Button>
          </div>
        </div>
      ) : (
        <ScrollArea className="flex-1 p-6">
          <div className="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
            <Card className="border-cyan-500/30 bg-slate-900/50 backdrop-blur-xl" data-testid="card-stat-power">
              <CardContent className="p-4">
                <div className="flex items-center gap-3">
                  <div className="w-10 h-10 rounded-lg bg-cyan-500/20 flex items-center justify-center">
                    <Zap className="w-5 h-5 text-cyan-400" />
                  </div>
                  <div>
                    <p className="text-xs text-cyan-300/60">Power Units</p>
                    <p className="text-2xl font-bold text-cyan-400" data-testid="text-power-units">
                      {auroraStatus?.powerUnits || 0}
                    </p>
                  </div>
                </div>
              </CardContent>
            </Card>
            
            <Card className="border-purple-500/30 bg-slate-900/50 backdrop-blur-xl" data-testid="card-stat-capabilities">
              <CardContent className="p-4">
                <div className="flex items-center gap-3">
                  <div className="w-10 h-10 rounded-lg bg-purple-500/20 flex items-center justify-center">
                    <Brain className="w-5 h-5 text-purple-400" />
                  </div>
                  <div>
                    <p className="text-xs text-purple-300/60">Capabilities</p>
                    <p className="text-2xl font-bold text-purple-400" data-testid="text-capabilities">
                      {auroraStatus?.knowledgeCapabilities || 0}
                    </p>
                  </div>
                </div>
              </CardContent>
            </Card>
            
            <Card className="border-pink-500/30 bg-slate-900/50 backdrop-blur-xl" data-testid="card-stat-modules">
              <CardContent className="p-4">
                <div className="flex items-center gap-3">
                  <div className="w-10 h-10 rounded-lg bg-pink-500/20 flex items-center justify-center">
                    <Layers className="w-5 h-5 text-pink-400" />
                  </div>
                  <div>
                    <p className="text-xs text-pink-300/60">Total Modules</p>
                    <p className="text-2xl font-bold text-pink-400" data-testid="text-modules">
                      {auroraStatus?.totalModules || 0}
                    </p>
                  </div>
                </div>
              </CardContent>
            </Card>
            
            <Card className="border-green-500/30 bg-slate-900/50 backdrop-blur-xl" data-testid="card-stat-uptime">
              <CardContent className="p-4">
                <div className="flex items-center gap-3">
                  <div className="w-10 h-10 rounded-lg bg-green-500/20 flex items-center justify-center">
                    <Clock className="w-5 h-5 text-green-400" />
                  </div>
                  <div>
                    <p className="text-xs text-green-300/60">Uptime</p>
                    <p className="text-2xl font-bold text-green-400" data-testid="text-uptime">
                      {formatUptime(auroraStatus?.uptime || 0)}
                    </p>
                  </div>
                </div>
              </CardContent>
            </Card>
          </div>

          <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <div className="lg:col-span-2">
              <Card className="border-cyan-500/30 bg-slate-900/50 backdrop-blur-xl" data-testid="card-evolution-metrics">
                <CardHeader className="border-b border-cyan-500/20">
                  <CardTitle className="flex items-center gap-2 text-lg text-cyan-300">
                    <Activity className="w-5 h-5 text-cyan-400" />
                    Evolution Metrics
                  </CardTitle>
                  <CardDescription className="text-cyan-300/60">
                    Real-time capability progression
                  </CardDescription>
                  <div className="flex gap-2 flex-wrap pt-2">
                    {categories.map((cat) => (
                      <Button
                        key={cat}
                        variant={selectedCategory === cat ? "default" : "outline"}
                        size="sm"
                        onClick={() => setSelectedCategory(cat)}
                        className={selectedCategory === cat 
                          ? "bg-gradient-to-r from-cyan-600 to-purple-600" 
                          : "border-cyan-500/30 text-cyan-300 hover:border-cyan-400/50"}
                        data-testid={`button-category-${cat}`}
                      >
                        {cat.charAt(0).toUpperCase() + cat.slice(1)}
                      </Button>
                    ))}
                  </div>
                </CardHeader>
                <CardContent className="pt-4">
                  <div className="space-y-4">
                    {filteredMetrics.map((metric, index) => (
                      <motion.div
                        key={metric.id}
                        initial={{ opacity: 0, x: -10 }}
                        animate={{ opacity: 1, x: 0 }}
                        transition={{ delay: index * 0.05 }}
                        className="space-y-2"
                      >
                        <div className="flex items-center justify-between">
                          <div className="flex items-center gap-2">
                            <span className="text-sm text-cyan-200">{metric.name}</span>
                            <Badge 
                              variant="outline" 
                              className={`text-xs bg-${getCategoryColor(metric.category)}-500/10 text-${getCategoryColor(metric.category)}-300 border-${getCategoryColor(metric.category)}-500/30`}
                            >
                              {metric.category}
                            </Badge>
                          </div>
                          <div className="flex items-center gap-2">
                            {getTrendIcon(metric.trend)}
                            <span className="text-sm font-mono text-cyan-400">
                              {metric.value}%
                            </span>
                          </div>
                        </div>
                        <div className="relative">
                          <Progress 
                            value={metric.value} 
                            className="h-2 bg-slate-800"
                          />
                          <div 
                            className="absolute inset-0 h-2 rounded-full bg-gradient-to-r from-cyan-500 to-purple-500" 
                            style={{ width: `${metric.value}%` }}
                          />
                        </div>
                      </motion.div>
                    ))}
                  </div>
                </CardContent>
              </Card>
            </div>

            <div>
              <Card className="border-purple-500/30 bg-slate-900/50 backdrop-blur-xl" data-testid="card-learning-events">
                <CardHeader className="border-b border-purple-500/20">
                  <CardTitle className="flex items-center gap-2 text-lg text-purple-300">
                    <Sparkles className="w-5 h-5 text-purple-400" />
                    Learning Events
                  </CardTitle>
                  <CardDescription className="text-purple-300/60">
                    Recent adaptations and improvements
                  </CardDescription>
                </CardHeader>
                <CardContent className="pt-4">
                  <ScrollArea className="h-[400px]">
                    <div className="space-y-3">
                      {learningEvents.map((event, index) => (
                        <motion.div
                          key={index}
                          initial={{ opacity: 0, y: 10 }}
                          animate={{ opacity: 1, y: 0 }}
                          transition={{ delay: index * 0.05 }}
                        >
                          <Card className="border-purple-500/20 bg-slate-800/50" data-testid={`card-event-${index}`}>
                            <CardContent className="p-3">
                              <div className="flex items-start justify-between gap-2 mb-2">
                                <Badge 
                                  variant="outline" 
                                  className={`text-xs ${getEventColor(event.type)}`}
                                  data-testid={`badge-event-type-${index}`}
                                >
                                  {event.type.replace('_', ' ')}
                                </Badge>
                                <span className="text-xs text-muted-foreground">
                                  {new Date(event.timestamp).toLocaleTimeString()}
                                </span>
                              </div>
                              <p className="text-sm text-purple-200 mb-2" data-testid={`text-event-desc-${index}`}>
                                {event.description}
                              </p>
                              <div className="flex items-center gap-2">
                                <ArrowUpRight className="w-3 h-3 text-green-400" />
                                <span className="text-xs text-green-400">
                                  +{event.improvement.toFixed(1)}% improvement
                                </span>
                              </div>
                            </CardContent>
                          </Card>
                        </motion.div>
                      ))}
                    </div>
                  </ScrollArea>
                </CardContent>
              </Card>
            </div>
          </div>

          <Card className="mt-6 border-pink-500/30 bg-slate-900/50 backdrop-blur-xl" data-testid="card-evolution-summary">
            <CardHeader className="border-b border-pink-500/20">
              <CardTitle className="flex items-center gap-2 text-lg text-pink-300">
                <Target className="w-5 h-5 text-pink-400" />
                Evolution Summary
              </CardTitle>
              <CardDescription className="text-pink-300/60">
                Current system version and growth trajectory
              </CardDescription>
            </CardHeader>
            <CardContent className="pt-4">
              <div className="grid grid-cols-2 lg:grid-cols-4 gap-4">
                <div className="p-4 bg-slate-800/50 rounded-lg border border-pink-500/20">
                  <p className="text-xs text-pink-300/60 mb-1">Version</p>
                  <p className="text-lg font-mono text-pink-300" data-testid="text-version">
                    {auroraStatus?.version || 'Unknown'}
                  </p>
                </div>
                <div className="p-4 bg-slate-800/50 rounded-lg border border-pink-500/20">
                  <p className="text-xs text-pink-300/60 mb-1">Execution Modes</p>
                  <p className="text-lg font-mono text-pink-300" data-testid="text-exec-modes">
                    {auroraStatus?.executionModes || 0}
                  </p>
                </div>
                <div className="p-4 bg-slate-800/50 rounded-lg border border-pink-500/20">
                  <p className="text-xs text-pink-300/60 mb-1">System Components</p>
                  <p className="text-lg font-mono text-pink-300" data-testid="text-components">
                    {auroraStatus?.systemComponents || 0}
                  </p>
                </div>
                <div className="p-4 bg-slate-800/50 rounded-lg border border-pink-500/20">
                  <p className="text-xs text-pink-300/60 mb-1">Status</p>
                  <Badge 
                    variant="outline" 
                    className="bg-green-500/20 text-green-300 border-green-500/30"
                    data-testid="badge-status"
                  >
                    {auroraStatus?.status || 'Unknown'}
                  </Badge>
                </div>
              </div>
            </CardContent>
          </Card>
        </ScrollArea>
      )}
    </div>
  );
}

--------------------------------------------------------------------------------
FILE: client/src/pages/home.tsx
LINES: 7
--------------------------------------------------------------------------------
'use client';

import AuroraFuturisticChat from '../components/AuroraFuturisticChat';

export default function Home() {
  return <AuroraFuturisticChat />;
}

--------------------------------------------------------------------------------
FILE: client/src/pages/intelligence.tsx
LINES: 212
--------------------------------------------------------------------------------
'use client';

import { useQuery } from '@tanstack/react-query';
import { Brain, Cpu, Activity, Zap, Database, Network, TrendingUp, Loader2 } from 'lucide-react';

interface EvolutionMetric {
  id: string;
  name: string;
  value: number;
  maxValue: number;
  trend: string;
  category: string;
}

interface EvolutionSummary {
  totalTiers: number;
  activeTiers: number;
  totalExecutions: number;
  activeExecutions: number;
  totalCapabilities: number;
  totalModules: number;
  uptimeSeconds: number;
}

interface EvolutionData {
  metrics: EvolutionMetric[];
  summary: EvolutionSummary;
}

const metricIcons: Record<string, any> = {
  'Neural Processing': Brain,
  'Pattern Recognition': Activity,
  'Code Synthesis': Cpu,
  'Learning Rate': TrendingUp,
  'Memory Efficiency': Database,
  'Context Retention': Brain,
  'Autonomous Decision': Zap,
  'Self-Optimization': Network,
};

const metricColors: Record<string, string> = {
  'Neural Processing': 'from-cyan-500 to-blue-500',
  'Pattern Recognition': 'from-purple-500 to-pink-500',
  'Code Synthesis': 'from-green-500 to-emerald-500',
  'Learning Rate': 'from-orange-500 to-red-500',
  'Memory Efficiency': 'from-pink-500 to-purple-500',
  'Context Retention': 'from-blue-500 to-cyan-500',
  'Autonomous Decision': 'from-yellow-500 to-orange-500',
  'Self-Optimization': 'from-indigo-500 to-purple-500',
};

export default function IntelligencePage() {
  const { data, isLoading, error } = useQuery<EvolutionData>({
    queryKey: ['/api/evolution/metrics'],
    refetchInterval: 30000,
  });

  const formatUptime = (seconds: number) => {
    const hours = Math.floor(seconds / 3600);
    const mins = Math.floor((seconds % 3600) / 60);
    return `${hours}h ${mins}m`;
  };

  if (isLoading) {
    return (
      <div className="min-h-screen p-8 flex items-center justify-center">
        <div className="flex items-center gap-3 text-purple-400">
          <Loader2 className="w-6 h-6 animate-spin" />
          <span>Loading intelligence metrics...</span>
        </div>
      </div>
    );
  }

  if (error) {
    return (
      <div className="min-h-screen p-8">
        <div className="max-w-7xl mx-auto">
          <div className="bg-red-900/20 border border-red-500/30 rounded-2xl p-6">
            <h2 className="text-xl font-bold text-red-400">Failed to load metrics</h2>
            <p className="text-red-300/70 mt-2">Please check system connectivity</p>
          </div>
        </div>
      </div>
    );
  }

  const metrics = data?.metrics || [];
  const summary = data?.summary;

  return (
    <div className="min-h-screen p-8">
      <div className="max-w-7xl mx-auto">
        <div className="mb-8">
          <h1 className="text-4xl font-bold bg-gradient-to-r from-cyan-400 via-purple-400 to-pink-400 bg-clip-text text-transparent mb-4" data-testid="text-page-title">
            Intelligence Core
          </h1>
          <p className="text-purple-400 text-lg">Real-time monitoring of Aurora's cognitive systems</p>
        </div>

        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
          {metrics.map((metric) => {
            const Icon = metricIcons[metric.name] || Brain;
            const color = metricColors[metric.name] || 'from-cyan-500 to-blue-500';
            const trendColor = metric.trend === 'up' ? 'text-green-400' : metric.trend === 'down' ? 'text-red-400' : 'text-yellow-400';
            const trendSymbol = metric.trend === 'up' ? '+' : metric.trend === 'down' ? '-' : '';
            
            return (
              <div 
                key={metric.id} 
                className="bg-slate-900/50 backdrop-blur-xl border border-purple-500/30 rounded-2xl p-6 hover:border-purple-500/50 transition-all"
                data-testid={`card-metric-${metric.id}`}
              >
                <div className="flex items-center gap-4 mb-4">
                  <div className={`w-12 h-12 rounded-xl bg-gradient-to-br ${color} flex items-center justify-center`}>
                    <Icon className="w-6 h-6 text-white" />
                  </div>
                  <div className="flex-1">
                    <div className="text-purple-400 text-sm">{metric.name}</div>
                    <div className="flex items-center gap-2">
                      <div className="text-2xl font-bold text-white" data-testid={`text-metric-value-${metric.id}`}>{metric.value}%</div>
                      <div className={`text-xs ${trendColor}`}>{trendSymbol}{metric.trend}</div>
                    </div>
                  </div>
                </div>
                <div className="h-2 bg-slate-800 rounded-full overflow-hidden">
                  <div 
                    className={`h-full bg-gradient-to-r ${color} transition-all duration-500`} 
                    style={{ width: `${metric.value}%` }} 
                  />
                </div>
              </div>
            );
          })}
        </div>

        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <div className="bg-slate-900/50 backdrop-blur-xl border border-purple-500/30 rounded-2xl p-6">
            <h3 className="text-xl font-bold text-white mb-6">System Architecture</h3>
            <div className="space-y-4">
              <div className="flex items-center justify-between p-4 bg-slate-800/50 rounded-xl">
                <span className="text-purple-400">Intelligence Tiers</span>
                <span className="text-cyan-400 font-mono text-lg" data-testid="text-total-tiers">
                  {summary?.activeTiers || 0}/{summary?.totalTiers || 0}
                </span>
              </div>
              <div className="flex items-center justify-between p-4 bg-slate-800/50 rounded-xl">
                <span className="text-purple-400">Execution Methods</span>
                <span className="text-purple-400 font-mono text-lg" data-testid="text-total-executions">
                  {summary?.activeExecutions || 0}/{summary?.totalExecutions || 0}
                </span>
              </div>
              <div className="flex items-center justify-between p-4 bg-slate-800/50 rounded-xl">
                <span className="text-purple-400">Total Modules</span>
                <span className="text-pink-400 font-mono text-lg" data-testid="text-total-modules">
                  {summary?.totalModules || 0}
                </span>
              </div>
              <div className="flex items-center justify-between p-4 bg-slate-800/50 rounded-xl">
                <span className="text-purple-400">Capabilities</span>
                <span className="text-green-400 font-mono text-lg" data-testid="text-total-capabilities">
                  {summary?.totalCapabilities || 0}
                </span>
              </div>
            </div>
          </div>

          <div className="bg-slate-900/50 backdrop-blur-xl border border-purple-500/30 rounded-2xl p-6">
            <h3 className="text-xl font-bold text-white mb-6">Neural Activity</h3>
            <div className="space-y-6">
              <div>
                <div className="flex items-center justify-between mb-2">
                  <span className="text-purple-400">Task Processing</span>
                  <span className="text-cyan-400 font-mono">Active</span>
                </div>
                <div className="h-2 bg-slate-800 rounded-full overflow-hidden">
                  <div 
                    className="h-full bg-gradient-to-r from-cyan-500 to-blue-500 transition-all duration-500" 
                    style={{ width: `${metrics.find(m => m.name === 'Neural Processing')?.value || 95}%` }}
                  />
                </div>
              </div>
              <div>
                <div className="flex items-center justify-between mb-2">
                  <span className="text-purple-400">Learning Mode</span>
                  <span className="text-purple-400 font-mono">Active</span>
                </div>
                <div className="h-2 bg-slate-800 rounded-full overflow-hidden">
                  <div 
                    className="h-full bg-gradient-to-r from-purple-500 to-pink-500 transition-all duration-500" 
                    style={{ width: `${metrics.find(m => m.name === 'Learning Rate')?.value || 88}%` }}
                  />
                </div>
              </div>
              <div>
                <div className="flex items-center justify-between mb-2">
                  <span className="text-purple-400">System Uptime</span>
                  <span className="text-pink-400 font-mono" data-testid="text-uptime">
                    {summary?.uptimeSeconds ? formatUptime(summary.uptimeSeconds) : 'N/A'}
                  </span>
                </div>
                <div className="h-2 bg-slate-800 rounded-full overflow-hidden">
                  <div className="h-full w-full bg-gradient-to-r from-pink-500 to-purple-500" />
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}

--------------------------------------------------------------------------------
FILE: client/src/pages/library.tsx
LINES: 300
--------------------------------------------------------------------------------
import { ErrorBoundary } from '@/components/error-boundary';
import { useMemo, useState } from 'react';
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Input } from "@/components/ui/input";
import { Badge } from "@/components/ui/badge";
import { ScrollArea } from "@/components/ui/scroll-area";
import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from "@/components/ui/dialog";
import { Slider } from "@/components/ui/slider";
import { Switch } from "@/components/ui/switch";
import { Label } from "@/components/ui/label";
import { BookOpen, Search, Code2, CheckCircle2, XCircle, Clock, Sparkles, Copy, Check } from "lucide-react";
import { useInfiniteQuery } from "@tanstack/react-query";

type CorpusItem = {
  id: string;
  func_name: string;
  func_signature: string;
  snippet: string;
  score: number;
  passed: number;
  total: number;
  timestamp: string;
  iteration?: number;
  complexity?: number;
};

export default function Library() {
  const [searchTerm, setSearchTerm] = useState("");
  const [passingOnly, setPassingOnly] = useState(false);
  const [minScore, setMinScore] = useState<number>(0);
  const [selected, setSelected] = useState<CorpusItem | null>(null);
  const [copied, setCopied] = useState(false);

  const pageSize = 50;

  // Build query string for server-side filters we support
  const baseQuery = useMemo(() => {
    const params = new URLSearchParams();
    params.set('limit', String(pageSize));
    if (passingOnly) params.set('perfectOnly', 'true');
    if (minScore > 0) params.set('minScore', String(minScore));
    return `/api/corpus?${params.toString()}`;
  }, [passingOnly, minScore]);

  const {
    data,
    isLoading,
    isFetchingNextPage,
    fetchNextPage,
    hasNextPage,
  } = useInfiniteQuery<{ items: CorpusItem[]; hasMore: boolean }>({
    queryKey: ['corpus', baseQuery],
    initialPageParam: 0,
    getNextPageParam: (lastPage, allPages, lastPageParam) => {
      return lastPage?.hasMore ? (allPages.length * pageSize) : undefined;
    },
    queryFn: async ({ pageParam }) => {
      const offset = pageParam ?? 0;
      const url = `${baseQuery}&offset=${offset}`;
      const res = await fetch(url, { credentials: 'include' });
      if (!res.ok) throw new Error(await res.text());
      return res.json();
    },
  });

  // Flatten pages and apply client-side search filter by name/signature
  const allItems: CorpusItem[] = useMemo(() => {
    const items = data?.pages.flatMap(p => p.items) ?? [];
    if (!searchTerm) return items;
    const q = searchTerm.toLowerCase();
    return items.filter(fn =>
      fn.func_name.toLowerCase().includes(q) ||
      fn.func_signature.toLowerCase().includes(q)
    );
  }, [data, searchTerm]);

  const stats = useMemo(() => {
    const items = data?.pages.flatMap(p => p.items) ?? [];
    const total = items.length;
    const passed = items.filter(fn => fn.score === 1).length;
    const recent = items.filter(fn => {
      const date = new Date(fn.timestamp);
      const dayAgo = new Date(Date.now() - 24 * 60 * 60 * 1000);
      return date > dayAgo;
    }).length;
    return { total, passed, recent };
  }, [data]);

  function onCopy(snippet?: string) {
    if (!snippet) return;
    navigator.clipboard.writeText(snippet).then(() => {
      setCopied(true);
      setTimeout(() => setCopied(false), 1200);
    });
  }

  return (
    <div className="h-full overflow-auto bg-gradient-to-br from-background via-background to-primary/5">
      {/* Quantum background */}
      <div className="fixed inset-0 -z-10 overflow-hidden pointer-events-none">
        <div className="absolute inset-0 bg-gradient-to-br from-slate-950 via-cyan-950/20 to-purple-950/20" />
        <div className="absolute inset-0 opacity-20" style={{
          backgroundImage: 'radial-gradient(circle, rgba(6, 182, 212, 0.3) 1px, transparent 1px)',
          backgroundSize: '50px 50px',
          animation: 'particleFloat 20s linear infinite'
        }} />
      </div>

      <div className="p-6 space-y-6 relative z-10">
        {/* Header */}
        <div className="flex items-center justify-between">
          <div>
            <h1 className="text-4xl font-bold bg-gradient-to-r from-cyan-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent flex items-center gap-3">
              <BookOpen className="h-10 w-10 text-cyan-400" />
              Aurora's Code Library
            </h1>
            <p className="text-muted-foreground mt-2">
              Functions Aurora has learned and synthesized through self-learning
            </p>
          </div>
        </div>

        {/* Stats Cards */}
        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
          <Card className="border-cyan-500/20">
            <CardContent className="pt-6">
              <div className="flex items-center justify-between">
                <div>
                  <p className="text-sm text-muted-foreground">Total Functions</p>
                  <p className="text-3xl font-bold text-cyan-400">{stats.total}</p>
                </div>
                <Code2 className="h-12 w-12 text-cyan-400/50" />
              </div>
            </CardContent>
          </Card>

          <Card className="border-green-500/20">
            <CardContent className="pt-6">
              <div className="flex items-center justify-between">
                <div>
                  <p className="text-sm text-muted-foreground">Passing Tests</p>
                  <p className="text-3xl font-bold text-green-400">{stats.passed}</p>
                </div>
                <CheckCircle2 className="h-12 w-12 text-green-400/50" />
              </div>
            </CardContent>
          </Card>

          <Card className="border-purple-500/20">
            <CardContent className="pt-6">
              <div className="flex items-center justify-between">
                <div>
                  <p className="text-sm text-muted-foreground">Learned Today</p>
                  <p className="text-3xl font-bold text-purple-400">{stats.recent}</p>
                </div>
                <Sparkles className="h-12 w-12 text-purple-400/50 animate-pulse" />
              </div>
            </CardContent>
          </Card>
        </div>

        {/* Search + Filters */}
        <Card className="border-cyan-500/20">
          <CardContent className="pt-6 space-y-4">
            <div className="relative">
              <Search className="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground" />
              <Input
                placeholder="Search functions by name or signature..."
                value={searchTerm}
                onChange={(e) => setSearchTerm(e.target.value)}
                className="pl-10"
              />
            </div>
            <div className="grid grid-cols-1 md:grid-cols-3 items-center gap-4">
              <div className="flex items-center gap-3">
                <Switch id="passing-only" checked={passingOnly} onCheckedChange={setPassingOnly} />
                <Label htmlFor="passing-only" className="text-sm">Passing only</Label>
              </div>
              <div className="col-span-2">
                <div className="flex items-center justify-between mb-2">
                  <Label htmlFor="score-range" className="text-sm">Minimum score</Label>
                  <span className="text-xs text-muted-foreground">{(minScore * 100).toFixed(0)}%</span>
                </div>
                <Slider id="score-range" value={[minScore]} min={0} max={1} step={0.05} onValueChange={(v) => setMinScore(v[0] ?? 0)} />
              </div>
            </div>
          </CardContent>
        </Card>

        {/* Functions List */}
        <Card className="border-cyan-500/20">
          <CardHeader>
            <CardTitle className="flex items-center gap-2">
              <Code2 className="h-5 w-5 text-cyan-400" />
              Learned Functions ({allItems.length})
            </CardTitle>
          </CardHeader>
          <CardContent>
            <ScrollArea className="h-[600px]">
              {isLoading ? (
                <div className="flex items-center justify-center h-32">
                  <Sparkles className="h-8 w-8 animate-spin text-cyan-400" />
                  <span className="ml-2 text-muted-foreground">Loading Aurora's library...</span>
                </div>
              ) : (
                <div className="space-y-3">
                  {allItems.map((fn) => (
                    <Card
                      key={fn.id}
                      className="border-cyan-500/10 hover:border-cyan-500/30 transition-colors cursor-pointer"
                      onClick={() => setSelected(fn)}
                    >
                      <CardContent className="pt-4">
                        <div className="flex items-start justify-between mb-2">
                          <div className="flex-1">
                            <h3 className="font-mono text-cyan-400 font-semibold">{fn.func_name}</h3>
                            <p className="text-xs text-muted-foreground mt-1">{fn.func_signature}</p>
                          </div>
                          <div className="flex gap-2">
                            {fn.score === 1 ? (
                              <Badge className="bg-green-500/20 text-green-400">
                                <CheckCircle2 className="h-3 w-3 mr-1" />
                                Passing
                              </Badge>
                            ) : (
                              <Badge variant="destructive">
                                <XCircle className="h-3 w-3 mr-1" />
                                {fn.passed}/{fn.total}
                              </Badge>
                            )}
                          </div>
                        </div>
                        <div className="flex items-center gap-4 text-xs text-muted-foreground">
                          <span className="flex items-center gap-1">
                            <Clock className="h-3 w-3" />
                            {new Date(fn.timestamp).toLocaleString()}
                          </span>
                          {fn.iteration !== undefined && (
                            <span>Iteration: {fn.iteration}</span>
                          )}
                          {fn.complexity !== undefined && (
                            <span>Complexity: {fn.complexity}</span>
                          )}
                        </div>
                      </CardContent>
                    </Card>
                  ))}
                  <div className="pt-2">
                    {hasNextPage && (
                      <Button variant="outline" className="w-full" onClick={() => fetchNextPage()} disabled={isFetchingNextPage}>
                        {isFetchingNextPage ? 'Loading…' : 'Load more'}
                      </Button>
                    )}
                  </div>
                </div>
              )}
            </ScrollArea>
          </CardContent>
        </Card>

        {/* Code Dialog */}
        <Dialog open={!!selected} onOpenChange={(open) => !open && setSelected(null)}>
          <DialogContent className="max-w-3xl">
            <DialogHeader>
              <DialogTitle className="font-mono text-cyan-400">{selected?.func_name}</DialogTitle>
              <DialogDescription className="font-mono text-xs text-muted-foreground">
                {selected?.func_signature}
              </DialogDescription>
            </DialogHeader>
            <div className="space-y-3">
              <div className="flex items-center justify-between text-xs text-muted-foreground">
                <div className="flex gap-2 items-center">
                  {selected?.score === 1 ? (
                    <Badge className="bg-green-500/20 text-green-400">
                      <CheckCircle2 className="h-3 w-3 mr-1" /> Passing
                    </Badge>
                  ) : (
                    <Badge variant="destructive">
                      <XCircle className="h-3 w-3 mr-1" /> {selected?.passed}/{selected?.total}
                    </Badge>
                  )}
                  <span>
                    <Clock className="h-3 w-3 inline mr-1" /> {selected ? new Date(selected.timestamp).toLocaleString() : ''}
                  </span>
                </div>
                <Button size="sm" variant="outline" onClick={() => onCopy(selected?.snippet)}>
                  {copied ? (<><Check className="h-4 w-4 mr-1" /> Copied</>) : (<><Copy className="h-4 w-4 mr-1" /> Copy</>)}
                </Button>
              </div>
              <pre className="bg-muted p-4 rounded-lg overflow-x-auto text-xs">
                <code>{selected?.snippet}</code>
              </pre>
            </div>
          </DialogContent>
        </Dialog>
      </div>
    </div>
  );
}

--------------------------------------------------------------------------------
FILE: client/src/pages/luminar-nexus.tsx
LINES: 1
--------------------------------------------------------------------------------
export { default } from "./nexus";

--------------------------------------------------------------------------------
FILE: client/src/pages/memory-fabric.tsx
LINES: 953
--------------------------------------------------------------------------------
import { useState } from 'react';
import { Card, CardContent, CardHeader, CardTitle, CardDescription } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Textarea } from "@/components/ui/textarea";
import { ScrollArea } from "@/components/ui/scroll-area";
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs";
import { useQuery } from "@tanstack/react-query";
import { Brain, Database, Clock, Zap, FileText, Search, RefreshCw, Layers, MessageSquare, Lightbulb, History, Target, Network, Server, Activity, CheckCircle, AlertCircle, Plus } from "lucide-react";
import { motion } from "framer-motion";

interface MemoryEntry {
  id: string;
  content: string;
  role: string;
  timestamp: string;
  layer: string;
  importance: number;
  tags: string[];
  metadata: Record<string, unknown>;
}

interface MemoryStats {
  shortTermCount: number;
  midTermCount: number;
  longTermCount: number;
  semanticCount: number;
  factCount: number;
  eventCount: number;
  totalMemories: number;
  activeProject: string;
  sessionId: string;
}

interface MemoryData {
  stats: MemoryStats;
  facts: Record<string, unknown>;
  shortTerm: MemoryEntry[];
  midTerm: MemoryEntry[];
  longTerm: MemoryEntry[];
  semantic: MemoryEntry[];
  events: Array<{ timestamp: string; event: string; details?: Record<string, unknown> }>;
  conversations: string[];
}

interface NexusStatus {
  v2: {
    connected: boolean;
    port: number;
    status: string;
    chatResponses?: number;
  };
  v3: {
    connected: boolean;
    status: string;
    workers?: number | { total: number; active: number; idle: number };
    tiers?: number;
    aems?: number;
    modules?: number;
    hybridMode?: boolean;
  };
}

interface MemoryBridgeStatus {
  success: boolean;
  status: {
    short_term_count: number;
    long_term_count: number;
    total_entries: number;
  };
  error?: string;
}

interface MemoryBridgeRecord {
  id: string;
  text: string;
  meta: Record<string, unknown>;
  timestamp: string;
  score?: number;
}

interface MemoryBridgeWriteResult {
  success: boolean;
  id?: string;
  longterm?: boolean;
  error?: string;
}

interface MemoryBridgeQueryResult {
  success: boolean;
  results?: MemoryBridgeRecord[];
  error?: string;
}

export default function MemoryFabric() {
  const [activeTab, setActiveTab] = useState('overview');
  const [selectedConversation, setSelectedConversation] = useState<string | null>(null);
  const [bridgeMessage, setBridgeMessage] = useState<{ type: 'success' | 'error'; text: string } | null>(null);
  const [bridgeLoading, setBridgeLoading] = useState(false);
  const [bridgeWriteText, setBridgeWriteText] = useState('');
  const [bridgeWriteMeta, setBridgeWriteMeta] = useState('{}');
  const [bridgeWriteLongterm, setBridgeWriteLongterm] = useState(false);
  const [bridgeQueryText, setBridgeQueryText] = useState('');
  const [bridgeQueryTopK, setBridgeQueryTopK] = useState(5);
  const [bridgeResults, setBridgeResults] = useState<MemoryBridgeRecord[]>([]);

  const { data: memoryData, isLoading, refetch, isRefetching } = useQuery<MemoryData>({
    queryKey: ['/api/memory-fabric/status'],
    refetchInterval: 30000,
  });

  const { data: conversationData } = useQuery<{ messages: MemoryEntry[] }>({
    queryKey: ['/api/memory-fabric/conversation', selectedConversation],
    enabled: !!selectedConversation,
  });

  const { data: nexusStatus } = useQuery<NexusStatus>({
    queryKey: ['/api/nexus/status'],
    refetchInterval: 86400000, // 24 hours
  });

  const { data: bridgeStatus, refetch: refetchBridgeStatus } = useQuery<MemoryBridgeStatus>({
    queryKey: ['/api/memory/status'],
    refetchInterval: 15000,
  });

  const stats = memoryData?.stats;

  const renderMemoryCard = (entry: MemoryEntry, index: number) => (
    <motion.div
      key={entry.id || index}
      initial={{ opacity: 0, y: 10 }}
      animate={{ opacity: 1, y: 0 }}
      transition={{ delay: index * 0.05 }}
    >
      <Card className="mb-3 border-emerald-500/20 bg-gradient-to-br from-emerald-950/20 to-sky-950/20">
        <CardContent className="p-4">
          <div className="flex items-start justify-between gap-2 mb-2">
            <Badge variant={entry.role === 'user' ? 'outline' : 'default'} className="text-xs" data-testid={`badge-role-${index}`}>
              {entry.role}
            </Badge>
            <div className="flex items-center gap-2">
              <Badge variant="secondary" className="text-xs" data-testid={`badge-layer-${index}`}>
                {entry.layer}
              </Badge>
              <span className="text-xs text-muted-foreground">
                {new Date(entry.timestamp).toLocaleString()}
              </span>
            </div>
          </div>
          <p className="text-sm text-foreground/90 whitespace-pre-wrap" data-testid={`text-content-${index}`}>
            {entry.content}
          </p>
          {entry.tags && entry.tags.length > 0 && (
            <div className="flex flex-wrap gap-1 mt-2">
              {entry.tags.map((tag, i) => (
                <Badge key={i} variant="outline" className="text-xs text-emerald-400/80">
                  {tag}
                </Badge>
              ))}
            </div>
          )}
          <div className="flex items-center gap-2 mt-2">
            <div className="flex-1 h-1 bg-emerald-950/50 rounded-full overflow-hidden">
              <div 
                className="h-full bg-gradient-to-r from-emerald-500 to-sky-500" 
                style={{ width: `${(entry.importance || 0.5) * 100}%` }} 
              />
            </div>
            <span className="text-xs text-emerald-400/60 font-mono">
              {((entry.importance || 0.5) * 100).toFixed(0)}%
            </span>
          </div>
        </CardContent>
      </Card>
    </motion.div>
  );

  const renderBridgeResult = (entry: MemoryBridgeRecord, index: number) => (
    <Card key={`${entry.id}-${index}`} className="border-emerald-500/20 bg-slate-900/50">
      <CardContent className="p-4">
        <div className="flex items-start justify-between gap-2 mb-2">
          <Badge variant="outline" className="text-xs">
            #{index + 1}
          </Badge>
          <div className="flex items-center gap-2">
            {entry.score !== undefined && (
              <Badge variant="outline" className="text-xs">
                Score {entry.score.toFixed(3)}
              </Badge>
            )}
            <span className="text-xs text-muted-foreground">{new Date(entry.timestamp).toLocaleString()}</span>
          </div>
        </div>
        <p className="text-sm text-foreground/90 whitespace-pre-wrap">{entry.text}</p>
        {entry.meta && Object.keys(entry.meta).length > 0 && (
          <pre className="text-xs text-muted-foreground mt-3 bg-slate-950/50 border border-emerald-500/10 rounded p-2 overflow-x-auto">
            {JSON.stringify(entry.meta, null, 2)}
          </pre>
        )}
      </CardContent>
    </Card>
  );

  const handleBridgeWrite = async () => {
    setBridgeLoading(true);
    setBridgeMessage(null);
    let meta: Record<string, unknown> = {};

    try {
      if (bridgeWriteMeta.trim()) {
        meta = JSON.parse(bridgeWriteMeta);
      }
    } catch {
      setBridgeMessage({ type: 'error', text: 'Metadata must be valid JSON.' });
      setBridgeLoading(false);
      return;
    }

    try {
      const response = await fetch('/api/memory/write', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          text: bridgeWriteText,
          meta,
          longterm: bridgeWriteLongterm,
        })
      });
      const data: MemoryBridgeWriteResult = await response.json();

      if (data.success) {
        setBridgeMessage({
          type: 'success',
          text: `Memory stored (ID ${data.id?.slice(0, 8)}...)`,
        });
        setBridgeWriteText('');
        setBridgeWriteMeta('{}');
        setBridgeWriteLongterm(false);
        refetchBridgeStatus();
      } else {
        setBridgeMessage({ type: 'error', text: data.error || 'Failed to store memory.' });
      }
    } catch (error) {
      setBridgeMessage({ type: 'error', text: `Error: ${String(error)}` });
    } finally {
      setBridgeLoading(false);
    }
  };

  const handleBridgeQuery = async () => {
    setBridgeLoading(true);
    setBridgeMessage(null);
    try {
      const response = await fetch('/api/memory/query', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          query: bridgeQueryText,
          top_k: bridgeQueryTopK,
        })
      });

      const data: MemoryBridgeQueryResult = await response.json();
      if (data.success && data.results) {
        setBridgeResults(data.results);
        setBridgeMessage({ type: 'success', text: `Found ${data.results.length} match(es)` });
      } else {
        setBridgeResults([]);
        setBridgeMessage({ type: 'error', text: data.error || 'No results returned.' });
      }
    } catch (error) {
      setBridgeResults([]);
      setBridgeMessage({ type: 'error', text: `Error: ${String(error)}` });
    } finally {
      setBridgeLoading(false);
    }
  };

  const renderFactsCard = (facts: Record<string, unknown>) => {
    const entries = Object.entries(facts);
    return (
      <div className="space-y-2">
        {entries.length === 0 ? (
          <p className="text-muted-foreground text-sm">No facts stored yet.</p>
        ) : (
          entries.map(([key, factData], index) => {
            const factObj = factData as { value?: string; category?: string; timestamp?: string; importance?: number };
            const displayValue = factObj?.value !== undefined ? String(factObj.value) : String(factData);
            const category = factObj?.category || 'general';
            const importance = factObj?.importance || 0.5;
            
            return (
              <motion.div
                key={key}
                initial={{ opacity: 0, x: -10 }}
                animate={{ opacity: 1, x: 0 }}
                transition={{ delay: index * 0.05 }}
              >
                <Card className="border-emerald-500/20 bg-gradient-to-br from-emerald-950/10 to-sky-950/10">
                  <CardContent className="p-3">
                    <div className="flex items-center justify-between mb-2">
                      <div className="flex items-center gap-2">
                        <Lightbulb className="w-4 h-4 text-yellow-400" />
                        <span className="font-mono text-sm text-emerald-300">{key}</span>
                      </div>
                      <Badge variant="outline" className="text-xs">
                        {category}
                      </Badge>
                    </div>
                    <p className="text-sm text-foreground/90 font-mono mb-2" data-testid={`text-fact-${key}`}>
                      {displayValue}
                    </p>
                    <div className="flex items-center gap-2">
                      <div className="flex-1 h-1 bg-emerald-950/50 rounded-full overflow-hidden">
                        <div 
                          className="h-full bg-gradient-to-r from-yellow-500 to-emerald-500" 
                          style={{ width: `${importance * 100}%` }} 
                        />
                      </div>
                      <span className="text-xs text-yellow-400/60 font-mono">
                        {(importance * 100).toFixed(0)}%
                      </span>
                    </div>
                  </CardContent>
                </Card>
              </motion.div>
            );
          })
        )}
      </div>
    );
  };

  const renderEventsLog = (events: Array<{ timestamp: string; event: string; details?: Record<string, unknown> }>) => (
    <div className="space-y-2" data-testid="list-events">
      {(!events || events.length === 0) ? (
        <p className="text-muted-foreground text-sm" data-testid="text-no-events">No events logged yet.</p>
      ) : (
        events.slice(-50).reverse().map((event, index) => (
          <motion.div
            key={index}
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            transition={{ delay: index * 0.02 }}
          >
            <Card className="border-sky-500/20 bg-gradient-to-br from-sky-950/10 to-emerald-950/10" data-testid={`card-event-${index}`}>
              <CardContent className="p-3">
                <div className="flex items-center justify-between gap-2 flex-wrap mb-1">
                  <Badge variant="outline" className="text-xs" data-testid={`badge-event-type-${index}`}>
                    {event.event}
                  </Badge>
                  <span className="text-xs text-muted-foreground" data-testid={`text-event-time-${index}`}>
                    {new Date(event.timestamp).toLocaleString()}
                  </span>
                </div>
                {event.details && (
                  <pre className="text-xs text-muted-foreground mt-1 overflow-x-auto" data-testid={`text-event-details-${index}`}>
                    {JSON.stringify(event.details, null, 2)}
                  </pre>
                )}
              </CardContent>
            </Card>
          </motion.div>
        ))
      )}
    </div>
  );

  return (
    <div className="h-full flex flex-col bg-gradient-to-br from-background via-emerald-950/5 to-sky-950/5">
      <div className="p-6 border-b border-emerald-500/20">
        <div className="flex items-center justify-between">
          <div className="flex items-center gap-4">
            <div className="relative">
              <div className="absolute inset-0 bg-emerald-500/30 rounded-full blur-md animate-pulse" />
              <div className="relative w-12 h-12 rounded-full border-2 border-emerald-400/50 flex items-center justify-center bg-gradient-to-br from-emerald-500/20 to-sky-500/20">
                <Brain className="w-6 h-6 text-emerald-400" />
              </div>
            </div>
            <div>
              <h1 className="text-2xl font-bold bg-gradient-to-r from-emerald-400 via-sky-400 to-emerald-400 bg-clip-text text-transparent" data-testid="text-page-title">
                Memory Fabric
              </h1>
              <p className="text-sm text-muted-foreground">
                Aurora's Neural Memory System - What She Remembers
              </p>
            </div>
          </div>
          <Button 
            variant="outline" 
            size="sm" 
            onClick={() => {
              refetch();
              refetchBridgeStatus();
            }}
            disabled={isRefetching}
            className="border-emerald-500/30 hover:border-emerald-400/50"
            data-testid="button-refresh"
          >
            <RefreshCw className={`w-4 h-4 mr-2 ${isRefetching ? 'animate-spin' : ''}`} />
            Refresh
          </Button>
        </div>
      </div>

      {isLoading ? (
        <div className="flex-1 flex items-center justify-center">
          <div className="text-center">
            <Brain className="w-12 h-12 text-emerald-400 animate-pulse mx-auto mb-4" />
            <p className="text-muted-foreground">Loading Aurora's memories...</p>
          </div>
        </div>
      ) : (
        <div className="flex-1 overflow-hidden p-6">
          <div className="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
            <Card className="border-emerald-500/20 bg-gradient-to-br from-emerald-950/20 to-transparent" data-testid="card-stat-short-term">
              <CardContent className="p-4">
                <div className="flex items-center gap-3">
                  <Zap className="w-8 h-8 text-yellow-400" />
                  <div>
                    <p className="text-xs text-muted-foreground">Short-Term</p>
                    <p className="text-2xl font-bold text-emerald-400" data-testid="text-short-term-count">
                      {stats?.shortTermCount || 0}
                    </p>
                  </div>
                </div>
              </CardContent>
            </Card>
            
            <Card className="border-sky-500/20 bg-gradient-to-br from-sky-950/20 to-transparent" data-testid="card-stat-mid-term">
              <CardContent className="p-4">
                <div className="flex items-center gap-3">
                  <Clock className="w-8 h-8 text-sky-400" />
                  <div>
                    <p className="text-xs text-muted-foreground">Mid-Term</p>
                    <p className="text-2xl font-bold text-sky-400" data-testid="text-mid-term-count">
                      {stats?.midTermCount || 0}
                    </p>
                  </div>
                </div>
              </CardContent>
            </Card>
            
            <Card className="border-blue-500/20 bg-gradient-to-br from-blue-950/20 to-transparent" data-testid="card-stat-long-term">
              <CardContent className="p-4">
                <div className="flex items-center gap-3">
                  <Database className="w-8 h-8 text-blue-400" />
                  <div>
                    <p className="text-xs text-muted-foreground">Long-Term</p>
                    <p className="text-2xl font-bold text-blue-400" data-testid="text-long-term-count">
                      {stats?.longTermCount || 0}
                    </p>
                  </div>
                </div>
              </CardContent>
            </Card>
            
            <Card className="border-green-500/20 bg-gradient-to-br from-green-950/20 to-transparent" data-testid="card-stat-total">
              <CardContent className="p-4">
                <div className="flex items-center gap-3">
                  <Layers className="w-8 h-8 text-green-400" />
                  <div>
                    <p className="text-xs text-muted-foreground">Total</p>
                    <p className="text-2xl font-bold text-green-400" data-testid="text-total-count">
                      {stats?.totalMemories || 0}
                    </p>
                  </div>
                </div>
              </CardContent>
            </Card>
          </div>

          <div className="grid grid-cols-3 gap-4 mb-6">
            <Card className="border-sky-500/30 bg-slate-900/80" data-testid="card-active-project">
              <CardContent className="p-3 flex items-center justify-between gap-2 flex-wrap">
                <span className="text-sm text-sky-200">Active Project</span>
                <Badge variant="outline" className="font-mono bg-sky-900/50 text-sky-100 border-sky-400/50" data-testid="text-active-project">
                  {stats?.activeProject || 'None'}
                </Badge>
              </CardContent>
            </Card>
            <Card className="border-sky-500/30 bg-slate-900/80" data-testid="card-facts-stored">
              <CardContent className="p-3 flex items-center justify-between gap-2 flex-wrap">
                <span className="text-sm text-sky-200">Facts Stored</span>
                <Badge variant="outline" className="font-mono bg-sky-900/50 text-sky-100 border-sky-400/50" data-testid="text-fact-count">
                  {stats?.factCount || 0}
                </Badge>
              </CardContent>
            </Card>
            <Card className="border-sky-500/30 bg-slate-900/80" data-testid="card-events-logged">
              <CardContent className="p-3 flex items-center justify-between gap-2 flex-wrap">
                <span className="text-sm text-sky-200">Events Logged</span>
                <Badge variant="outline" className="font-mono bg-sky-900/50 text-sky-100 border-sky-400/50" data-testid="text-event-count">
                  {stats?.eventCount || 0}
                </Badge>
              </CardContent>
            </Card>
          </div>

          <div className="grid grid-cols-2 gap-4 mb-6">
            <Card className="border-emerald-500/40 bg-gradient-to-br from-slate-900 to-emerald-950/50" data-testid="card-nexus-v2">
              <CardContent className="p-4">
                <div className="flex items-center justify-between gap-2 mb-3">
                  <div className="flex items-center gap-3">
                    <div className={`w-10 h-10 rounded-lg flex items-center justify-center ${nexusStatus?.v2?.connected ? 'bg-emerald-500/30' : 'bg-slate-700/50'}`}>
                      <MessageSquare className={`w-5 h-5 ${nexusStatus?.v2?.connected ? 'text-emerald-400' : 'text-slate-500'}`} />
                    </div>
                    <div>
                      <h3 className="font-semibold text-emerald-100">Luminar Nexus V2</h3>
                      <p className="text-xs text-emerald-300/70">Chat & ML Pattern Learning</p>
                    </div>
                  </div>
                  <Badge 
                    variant="outline" 
                    className={`${nexusStatus?.v2?.connected ? 'bg-green-900/50 text-green-300 border-green-500/50' : 'bg-red-900/50 text-red-300 border-red-500/50'}`}
                    data-testid="badge-nexus-v2-status"
                  >
                    {nexusStatus?.v2?.connected ? 'Connected' : 'Offline'}
                  </Badge>
                </div>
                <div className="grid grid-cols-2 gap-2 text-xs">
                  <div className="flex items-center justify-between p-2 bg-slate-800/50 rounded">
                    <span className="text-emerald-300/70">Port</span>
                    <span className="font-mono text-emerald-200">{nexusStatus?.v2?.port || 8000}</span>
                  </div>
                  <div className="flex items-center justify-between p-2 bg-slate-800/50 rounded">
                    <span className="text-emerald-300/70">Responses</span>
                    <span className="font-mono text-emerald-200">{nexusStatus?.v2?.chatResponses || 0}</span>
                  </div>
                </div>
              </CardContent>
            </Card>

            <Card className="border-sky-500/40 bg-gradient-to-br from-slate-900 to-sky-950/50" data-testid="card-nexus-v3">
              <CardContent className="p-4">
                <div className="flex items-center justify-between gap-2 mb-3">
                  <div className="flex items-center gap-3">
                    <div className={`w-10 h-10 rounded-lg flex items-center justify-center ${nexusStatus?.v3?.connected ? 'bg-sky-500/30' : 'bg-slate-700/50'}`}>
                      <Network className={`w-5 h-5 ${nexusStatus?.v3?.connected ? 'text-sky-400' : 'text-slate-500'}`} />
                    </div>
                    <div>
                      <h3 className="font-semibold text-sky-100">Aurora Nexus V3</h3>
                      <p className="text-xs text-sky-300/70">Universal Consciousness</p>
                    </div>
                  </div>
                  <Badge 
                    variant="outline" 
                    className={`${nexusStatus?.v3?.connected ? 'bg-green-900/50 text-green-300 border-green-500/50' : 'bg-red-900/50 text-red-300 border-red-500/50'}`}
                    data-testid="badge-nexus-v3-status"
                  >
                    {nexusStatus?.v3?.connected ? 'Connected' : 'Offline'}
                  </Badge>
                </div>
                <div className="grid grid-cols-4 gap-2 text-xs">
                  <div className="flex flex-col items-center p-2 bg-slate-800/50 rounded">
                    <span className="text-sky-300/70 text-[10px]">Workers</span>
                    <span className="font-mono text-sky-200 font-bold">
                      {typeof nexusStatus?.v3?.workers === 'object' 
                        ? nexusStatus.v3.workers.total 
                        : (nexusStatus?.v3?.workers || 300)}
                    </span>
                  </div>
                  <div className="flex flex-col items-center p-2 bg-slate-800/50 rounded">
                    <span className="text-sky-300/70 text-[10px]">Tiers</span>
                    <span className="font-mono text-sky-200 font-bold">{nexusStatus?.v3?.tiers || 188}</span>
                  </div>
                  <div className="flex flex-col items-center p-2 bg-slate-800/50 rounded">
                    <span className="text-sky-300/70 text-[10px]">AEMs</span>
                    <span className="font-mono text-sky-200 font-bold">{nexusStatus?.v3?.aems || 66}</span>
                  </div>
                  <div className="flex flex-col items-center p-2 bg-slate-800/50 rounded">
                    <span className="text-sky-300/70 text-[10px]">Modules</span>
                    <span className="font-mono text-sky-200 font-bold">{nexusStatus?.v3?.modules || 550}</span>
                  </div>
                </div>
                {nexusStatus?.v3?.hybridMode && (
                  <div className="mt-2 flex items-center gap-2 p-2 bg-green-900/30 rounded border border-green-500/30">
                    <Activity className="w-4 h-4 text-green-400 animate-pulse" />
                    <span className="text-xs text-green-300">Hybrid Mode Active - Brain Bridge Connected</span>
                  </div>
                )}
              </CardContent>
            </Card>
          </div>

          <Tabs value={activeTab} onValueChange={setActiveTab} className="flex-1" data-testid="tabs-memory-fabric">
            <TabsList className="mb-4 bg-slate-900 border border-sky-500/40 shadow-lg" data-testid="tablist-memory">
              <TabsTrigger value="overview" className="data-[state=active]:bg-gradient-to-r data-[state=active]:from-sky-600/70 data-[state=active]:to-emerald-600/70 data-[state=active]:text-white text-sky-300" data-testid="tab-trigger-overview">
                <Target className="w-4 h-4 mr-2" />
                Overview
              </TabsTrigger>
              <TabsTrigger value="facts" className="data-[state=active]:bg-gradient-to-r data-[state=active]:from-sky-600/70 data-[state=active]:to-emerald-600/70 data-[state=active]:text-white text-sky-300" data-testid="tab-trigger-facts">
                <Lightbulb className="w-4 h-4 mr-2" />
                Facts
              </TabsTrigger>
              <TabsTrigger value="memories" className="data-[state=active]:bg-gradient-to-r data-[state=active]:from-sky-600/70 data-[state=active]:to-emerald-600/70 data-[state=active]:text-white text-sky-300" data-testid="tab-trigger-memories">
                <Brain className="w-4 h-4 mr-2" />
                Memories
              </TabsTrigger>
              <TabsTrigger value="conversations" className="data-[state=active]:bg-gradient-to-r data-[state=active]:from-sky-600/70 data-[state=active]:to-emerald-600/70 data-[state=active]:text-white text-sky-300" data-testid="tab-trigger-conversations">
                <MessageSquare className="w-4 h-4 mr-2" />
                Conversations
              </TabsTrigger>
              <TabsTrigger value="events" className="data-[state=active]:bg-gradient-to-r data-[state=active]:from-sky-600/70 data-[state=active]:to-emerald-600/70 data-[state=active]:text-white text-sky-300" data-testid="tab-trigger-events">
                <History className="w-4 h-4 mr-2" />
                Events
              </TabsTrigger>
              <TabsTrigger value="bridge" className="data-[state=active]:bg-gradient-to-r data-[state=active]:from-sky-600/70 data-[state=active]:to-emerald-600/70 data-[state=active]:text-white text-sky-300" data-testid="tab-trigger-bridge">
                <Server className="w-4 h-4 mr-2" />
                Memory Bridge
              </TabsTrigger>
            </TabsList>

            <TabsContent value="overview" className="h-[calc(100%-60px)]" data-testid="tab-content-overview">
              <ScrollArea className="h-full">
                <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                  <Card className="border-emerald-500/30 bg-slate-900/50 backdrop-blur-xl" data-testid="card-overview-facts">
                    <CardHeader className="border-b border-emerald-500/20">
                      <CardTitle className="flex items-center gap-2 text-lg text-emerald-300">
                        <Lightbulb className="w-5 h-5 text-yellow-400" />
                        Key Facts Aurora Knows
                      </CardTitle>
                      <CardDescription className="text-emerald-300/60">Important information stored in memory</CardDescription>
                    </CardHeader>
                    <CardContent className="pt-4">
                      {renderFactsCard(memoryData?.facts || {})}
                    </CardContent>
                  </Card>

                  <Card className="border-sky-500/30 bg-slate-900/50 backdrop-blur-xl" data-testid="card-overview-short-term">
                    <CardHeader className="border-b border-sky-500/20">
                      <CardTitle className="flex items-center gap-2 text-lg text-sky-300">
                        <Zap className="w-5 h-5 text-yellow-400" />
                        Recent Short-Term Memories
                      </CardTitle>
                      <CardDescription className="text-sky-300/60">Current session context</CardDescription>
                    </CardHeader>
                    <CardContent className="pt-4">
                      <ScrollArea className="h-[300px]">
                        {(memoryData?.shortTerm || []).length === 0 ? (
                          <p className="text-sky-300/50 text-sm" data-testid="text-no-short-term-overview">No short-term memories in current session.</p>
                        ) : (
                          memoryData?.shortTerm.slice(-5).map((entry, i) => renderMemoryCard(entry, i))
                        )}
                      </ScrollArea>
                    </CardContent>
                  </Card>
                </div>
              </ScrollArea>
            </TabsContent>

            <TabsContent value="facts" className="h-[calc(100%-60px)]" data-testid="tab-content-facts">
              <ScrollArea className="h-full">
                <Card className="border-emerald-500/20" data-testid="card-all-facts">
                  <CardHeader>
                    <CardTitle className="flex items-center gap-2">
                      <Lightbulb className="w-5 h-5 text-yellow-400" />
                      All Stored Facts
                    </CardTitle>
                    <CardDescription>Persistent facts Aurora remembers about you and the project</CardDescription>
                  </CardHeader>
                  <CardContent>
                    {renderFactsCard(memoryData?.facts || {})}
                  </CardContent>
                </Card>
              </ScrollArea>
            </TabsContent>

            <TabsContent value="memories" className="h-[calc(100%-60px)]" data-testid="tab-content-memories">
              <ScrollArea className="h-full">
                <div className="space-y-6">
                  <Card className="border-yellow-500/20" data-testid="card-short-term-memories">
                    <CardHeader>
                      <CardTitle className="flex items-center gap-2 text-lg">
                        <Zap className="w-5 h-5 text-yellow-400" />
                        Short-Term Memory ({memoryData?.shortTerm?.length || 0})
                      </CardTitle>
                    </CardHeader>
                    <CardContent>
                      {(memoryData?.shortTerm || []).length === 0 ? (
                        <p className="text-muted-foreground text-sm" data-testid="text-no-short-term">No short-term memories.</p>
                      ) : (
                        memoryData?.shortTerm.map((entry, i) => renderMemoryCard(entry, i))
                      )}
                    </CardContent>
                  </Card>

                  <Card className="border-sky-500/20" data-testid="card-mid-term-memories">
                    <CardHeader>
                      <CardTitle className="flex items-center gap-2 text-lg">
                        <Clock className="w-5 h-5 text-sky-400" />
                        Mid-Term Memory ({memoryData?.midTerm?.length || 0})
                      </CardTitle>
                    </CardHeader>
                    <CardContent>
                      {(memoryData?.midTerm || []).length === 0 ? (
                        <p className="text-muted-foreground text-sm" data-testid="text-no-mid-term">No mid-term memories.</p>
                      ) : (
                        memoryData?.midTerm.map((entry, i) => renderMemoryCard(entry, i))
                      )}
                    </CardContent>
                  </Card>

                  <Card className="border-blue-500/20" data-testid="card-long-term-memories">
                    <CardHeader>
                      <CardTitle className="flex items-center gap-2 text-lg">
                        <Database className="w-5 h-5 text-blue-400" />
                        Long-Term Memory ({memoryData?.longTerm?.length || 0})
                      </CardTitle>
                    </CardHeader>
                    <CardContent>
                      {(memoryData?.longTerm || []).length === 0 ? (
                        <p className="text-muted-foreground text-sm">No long-term memories.</p>
                      ) : (
                        memoryData?.longTerm.map((entry, i) => renderMemoryCard(entry, i))
                      )}
                    </CardContent>
                  </Card>
                </div>
              </ScrollArea>
            </TabsContent>

            <TabsContent value="conversations" className="h-[calc(100%-60px)]" data-testid="tab-content-conversations">
              <ScrollArea className="h-full">
                <Card className="border-emerald-500/20" data-testid="card-conversations">
                  <CardHeader>
                    <CardTitle className="flex items-center gap-2">
                      <MessageSquare className="w-5 h-5 text-emerald-400" />
                      Conversation History
                    </CardTitle>
                    <CardDescription>Past conversations stored in memory</CardDescription>
                  </CardHeader>
                  <CardContent>
                    {(memoryData?.conversations || []).length === 0 ? (
                      <p className="text-muted-foreground text-sm" data-testid="text-no-conversations">No conversation history found.</p>
                    ) : (
                      <div className="space-y-2" data-testid="list-conversations">
                        {memoryData?.conversations.map((conv, index) => (
                          <Card 
                            key={index} 
                            className={`cursor-pointer transition-all hover:border-emerald-400/50 ${selectedConversation === conv ? 'border-emerald-400/50 bg-emerald-500/10' : 'border-emerald-500/20'}`}
                            onClick={() => setSelectedConversation(conv)}
                            data-testid={`card-conversation-${index}`}
                          >
                            <CardContent className="p-3 flex items-center justify-between gap-2 flex-wrap">
                              <div className="flex items-center gap-2">
                                <FileText className="w-4 h-4 text-emerald-400" />
                                <span className="text-sm font-mono" data-testid={`text-conversation-name-${index}`}>{conv}</span>
                              </div>
                              <Badge variant="outline" className="text-xs" data-testid={`button-view-conversation-${index}`}>
                                View
                              </Badge>
                            </CardContent>
                          </Card>
                        ))}
                      </div>
                    )}

                    {selectedConversation && conversationData?.messages && (
                      <div className="mt-6 pt-6 border-t border-emerald-500/20" data-testid="section-conversation-messages">
                        <h4 className="text-sm font-medium mb-4 flex items-center gap-2">
                          <MessageSquare className="w-4 h-4" />
                          {selectedConversation}
                        </h4>
                        {conversationData.messages.map((msg, i) => renderMemoryCard(msg, i))}
                      </div>
                    )}
                  </CardContent>
                </Card>
              </ScrollArea>
            </TabsContent>

            <TabsContent value="events" className="h-[calc(100%-60px)]" data-testid="tab-content-events">
              <ScrollArea className="h-full">
                <Card className="border-sky-500/20" data-testid="card-events">
                  <CardHeader>
                    <CardTitle className="flex items-center gap-2">
                      <History className="w-5 h-5 text-sky-400" />
                      Event Log
                    </CardTitle>
                    <CardDescription>System events and actions recorded by Aurora</CardDescription>
                  </CardHeader>
                  <CardContent>
                    {renderEventsLog(memoryData?.events || [])}
                  </CardContent>
                </Card>
              </ScrollArea>
            </TabsContent>

            <TabsContent value="bridge" className="h-[calc(100%-60px)]" data-testid="tab-content-bridge">
              <ScrollArea className="h-full">
                <div className="space-y-6">
                  <Card className="border-emerald-500/30 bg-slate-900/60">
                    <CardHeader>
                      <CardTitle className="flex items-center gap-2">
                        <Database className="w-5 h-5 text-emerald-400" />
                        Memory Bridge Status
                      </CardTitle>
                      <CardDescription>Legacy memory bridge metrics and operations</CardDescription>
                    </CardHeader>
                    <CardContent>
                      {bridgeStatus?.success ? (
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                          <div className="p-3 rounded border border-emerald-500/20 bg-emerald-950/20">
                            <div className="text-xs text-emerald-300/70">Short-Term</div>
                            <div className="text-2xl font-bold text-emerald-200">
                              {bridgeStatus.status.short_term_count}
                            </div>
                          </div>
                          <div className="p-3 rounded border border-sky-500/20 bg-sky-950/20">
                            <div className="text-xs text-sky-300/70">Long-Term</div>
                            <div className="text-2xl font-bold text-sky-200">
                              {bridgeStatus.status.long_term_count}
                            </div>
                          </div>
                          <div className="p-3 rounded border border-blue-500/20 bg-blue-950/20">
                            <div className="text-xs text-blue-300/70">Total</div>
                            <div className="text-2xl font-bold text-blue-200">
                              {bridgeStatus.status.total_entries}
                            </div>
                          </div>
                        </div>
                      ) : (
                        <div className="text-sm text-muted-foreground">
                          {bridgeStatus?.error || 'Memory bridge unavailable.'}
                        </div>
                      )}
                    </CardContent>
                  </Card>

                  {bridgeMessage && (
                    <div className={`flex items-center gap-2 rounded border px-3 py-2 text-sm ${bridgeMessage.type === 'success'
                      ? 'border-green-500/30 bg-green-500/10 text-green-300'
                      : 'border-red-500/30 bg-red-500/10 text-red-300'
                      }`}>
                      {bridgeMessage.type === 'success' ? (
                        <CheckCircle className="w-4 h-4" />
                      ) : (
                        <AlertCircle className="w-4 h-4" />
                      )}
                      <span>{bridgeMessage.text}</span>
                    </div>
                  )}

                  <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <Card className="border-emerald-500/20 bg-slate-900/60">
                      <CardHeader>
                        <CardTitle className="flex items-center gap-2 text-emerald-300">
                          <Plus className="w-4 h-4" />
                          Store Memory
                        </CardTitle>
                        <CardDescription>Write through the memory bridge</CardDescription>
                      </CardHeader>
                      <CardContent className="space-y-4">
                        <div>
                          <label className="text-xs text-emerald-300/70">Memory Text</label>
                          <Textarea
                            value={bridgeWriteText}
                            onChange={(e) => setBridgeWriteText(e.target.value)}
                            className="mt-2 bg-slate-950/40 border-emerald-500/20"
                            rows={4}
                          />
                        </div>
                        <div>
                          <label className="text-xs text-emerald-300/70">Metadata (JSON)</label>
                          <Textarea
                            value={bridgeWriteMeta}
                            onChange={(e) => setBridgeWriteMeta(e.target.value)}
                            className="mt-2 bg-slate-950/40 border-emerald-500/20 font-mono text-xs"
                            rows={3}
                          />
                        </div>
                        <label className="flex items-center gap-2 text-xs text-emerald-300/70">
                          <input
                            type="checkbox"
                            checked={bridgeWriteLongterm}
                            onChange={(e) => setBridgeWriteLongterm(e.target.checked)}
                            className="h-4 w-4 rounded border-emerald-500/30 bg-slate-950/40"
                          />
                          Store as long-term memory
                        </label>
                        <Button
                          onClick={handleBridgeWrite}
                          disabled={bridgeLoading || !bridgeWriteText}
                          className="w-full bg-gradient-to-r from-emerald-500 to-sky-500 text-white"
                        >
                          Store Memory
                        </Button>
                      </CardContent>
                    </Card>

                    <Card className="border-sky-500/20 bg-slate-900/60">
                      <CardHeader>
                        <CardTitle className="flex items-center gap-2 text-sky-300">
                          <Search className="w-4 h-4" />
                          Search Memory
                        </CardTitle>
                        <CardDescription>Query legacy memory entries</CardDescription>
                      </CardHeader>
                      <CardContent className="space-y-4">
                        <div>
                          <label className="text-xs text-sky-300/70">Query</label>
                          <Input
                            value={bridgeQueryText}
                            onChange={(e) => setBridgeQueryText(e.target.value)}
                            className="mt-2 bg-slate-950/40 border-sky-500/20"
                            onKeyDown={(e) => e.key === 'Enter' && handleBridgeQuery()}
                          />
                        </div>
                        <div>
                          <label className="text-xs text-sky-300/70">Top K</label>
                          <Input
                            type="number"
                            min={1}
                            max={20}
                            value={bridgeQueryTopK}
                            onChange={(e) => setBridgeQueryTopK(parseInt(e.target.value) || 5)}
                            className="mt-2 bg-slate-950/40 border-sky-500/20"
                          />
                        </div>
                        <Button
                          onClick={handleBridgeQuery}
                          disabled={bridgeLoading || !bridgeQueryText}
                          className="w-full bg-gradient-to-r from-sky-500 to-emerald-500 text-white"
                        >
                          Search Memory
                        </Button>
                      </CardContent>
                    </Card>
                  </div>

                  {bridgeResults.length > 0 && (
                    <Card className="border-emerald-500/20 bg-slate-900/60">
                      <CardHeader>
                        <CardTitle>Search Results</CardTitle>
                        <CardDescription>{bridgeResults.length} result(s)</CardDescription>
                      </CardHeader>
                      <CardContent className="space-y-3">
                        {bridgeResults.map((entry, index) => renderBridgeResult(entry, index))}
                      </CardContent>
                    </Card>
                  )}
                </div>
              </ScrollArea>
            </TabsContent>
          </Tabs>
        </div>
      )}
    </div>
  );
}

--------------------------------------------------------------------------------
FILE: client/src/pages/memory.tsx
LINES: 416
--------------------------------------------------------------------------------
import { useState, useEffect } from 'react';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Textarea } from '@/components/ui/textarea';
import { Database, Brain, Search, Plus, AlertCircle, CheckCircle, Activity } from 'lucide-react';
import { Badge } from '@/components/ui/badge';

interface MemoryStatus {
    success: boolean;
    status: {
        short_term_count: number;
        long_term_count: number;
        total_entries: number;
    };
}

interface MemoryRecord {
    id: string;
    text: string;
    meta: Record<string, any>;
    timestamp: string;
    score?: number;
}

interface MemoryWriteResult {
    success: boolean;
    id?: string;
    longterm?: boolean;
    error?: string;
}

interface MemoryQueryResult {
    success: boolean;
    results?: MemoryRecord[];
    error?: string;
}

export default function Memory() {
    const [status, setStatus] = useState<MemoryStatus | null>(null);
    const [loading, setLoading] = useState(false);
    const [writeText, setWriteText] = useState('');
    const [writeMeta, setWriteMeta] = useState('{}');
    const [writeLongterm, setWriteLongterm] = useState(false);
    const [queryText, setQueryText] = useState('');
    const [queryTopK, setQueryTopK] = useState(5);
    const [queryResults, setQueryResults] = useState<MemoryRecord[]>([]);
    const [message, setMessage] = useState<{ type: 'success' | 'error'; text: string } | null>(null);

    useEffect(() => {
        fetchStatus();
        const interval = setInterval(fetchStatus, 5000);
        return () => clearInterval(interval);
    }, []);

    const fetchStatus = async () => {
        try {
            const response = await fetch('/api/memory/status');
            const data = await response.json();
            setStatus(data);
        } catch (error) {
            console.error('Failed to fetch memory status:', error);
        }
    };

    const handleWrite = async () => {
        setLoading(true);
        setMessage(null);
        try {
            let meta = {};
            try {
                meta = JSON.parse(writeMeta);
            } catch (e) {
                setMessage({ type: 'error', text: 'Invalid JSON in metadata field' });
                setLoading(false);
                return;
            }

            const response = await fetch('/api/memory/write', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    text: writeText,
                    meta,
                    longterm: writeLongterm,
                }),
            });

            const data: MemoryWriteResult = await response.json();

            if (data.success) {
                setMessage({
                    type: 'success',
                    text: `Memory stored successfully! ID: ${data.id?.substring(0, 8)}... (${data.longterm ? 'Long-term' : 'Short-term'})`
                });
                setWriteText('');
                setWriteMeta('{}');
                fetchStatus();
            } else {
                setMessage({ type: 'error', text: data.error || 'Failed to store memory' });
            }
        } catch (error) {
            setMessage({ type: 'error', text: `Error: ${error}` });
        } finally {
            setLoading(false);
        }
    };

    const handleQuery = async () => {
        setLoading(true);
        setMessage(null);
        try {
            const response = await fetch('/api/memory/query', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    query: queryText,
                    top_k: queryTopK,
                }),
            });

            const data: MemoryQueryResult = await response.json();

            if (data.success && data.results) {
                setQueryResults(data.results);
                setMessage({
                    type: 'success',
                    text: `Found ${data.results.length} matching memor${data.results.length === 1 ? 'y' : 'ies'}`
                });
            } else {
                setMessage({ type: 'error', text: data.error || 'Query failed' });
                setQueryResults([]);
            }
        } catch (error) {
            setMessage({ type: 'error', text: `Error: ${error}` });
            setQueryResults([]);
        } finally {
            setLoading(false);
        }
    };

    return (
        <div className="min-h-screen bg-gradient-to-br from-gray-950 via-slate-900 to-gray-950 p-6">
            <div className="max-w-7xl mx-auto space-y-6">
                {/* Header */}
                <div className="flex items-center gap-4 mb-8">
                    <div className="relative">
                        <div className="absolute inset-0 bg-cyan-500/30 rounded-full blur-md animate-pulse" />
                        <div className="relative w-16 h-16 rounded-full border-2 border-cyan-400/50 flex items-center justify-center bg-gradient-to-br from-cyan-500/20 to-purple-500/20 backdrop-blur-sm">
                            <Brain className="w-8 h-8 text-cyan-400" />
                        </div>
                    </div>
                    <div>
                        <h1 className="text-4xl font-bold bg-gradient-to-r from-cyan-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent">
                            Aurora Memory System
                        </h1>
                        <p className="text-cyan-300/70 mt-1">Multi-layer hybrid memory with semantic search</p>
                    </div>
                </div>

                {/* Status Message */}
                {message && (
                    <div className={`p-4 rounded-lg border flex items-center gap-3 ${message.type === 'success'
                            ? 'bg-green-500/10 border-green-500/30 text-green-400'
                            : 'bg-red-500/10 border-red-500/30 text-red-400'
                        }`}>
                        {message.type === 'success' ? (
                            <CheckCircle className="w-5 h-5" />
                        ) : (
                            <AlertCircle className="w-5 h-5" />
                        )}
                        <span>{message.text}</span>
                    </div>
                )}

                {/* Status Cards */}
                <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <Card className="bg-gradient-to-br from-cyan-950/50 to-purple-950/50 border-cyan-500/20 backdrop-blur-sm">
                        <CardHeader className="pb-3">
                            <CardTitle className="text-cyan-400 flex items-center gap-2">
                                <Database className="w-5 h-5" />
                                Memory Status
                            </CardTitle>
                        </CardHeader>
                        <CardContent>
                            {status ? (
                                <div className="space-y-2">
                                    <div className="flex justify-between items-center">
                                        <span className="text-cyan-300/70">Short-term:</span>
                                        <Badge variant="outline" className="bg-cyan-500/10 border-cyan-500/30 text-cyan-300">
                                            {status.status.short_term_count}
                                        </Badge>
                                    </div>
                                    <div className="flex justify-between items-center">
                                        <span className="text-cyan-300/70">Long-term:</span>
                                        <Badge variant="outline" className="bg-purple-500/10 border-purple-500/30 text-purple-300">
                                            {status.status.long_term_count}
                                        </Badge>
                                    </div>
                                    <div className="flex justify-between items-center">
                                        <span className="text-cyan-300/70">Total:</span>
                                        <Badge variant="outline" className="bg-blue-500/10 border-blue-500/30 text-blue-300">
                                            {status.status.total_entries}
                                        </Badge>
                                    </div>
                                </div>
                            ) : (
                                <div className="text-cyan-300/50 flex items-center gap-2">
                                    <Activity className="w-4 h-4 animate-spin" />
                                    Loading...
                                </div>
                            )}
                        </CardContent>
                    </Card>

                    <Card className="bg-gradient-to-br from-cyan-950/50 to-purple-950/50 border-cyan-500/20 backdrop-blur-sm">
                        <CardHeader className="pb-3">
                            <CardTitle className="text-cyan-400 flex items-center gap-2">
                                <Brain className="w-5 h-5 animate-pulse" />
                                System Health
                            </CardTitle>
                        </CardHeader>
                        <CardContent>
                            <div className="flex items-center gap-2">
                                <div className="w-3 h-3 bg-green-400 rounded-full animate-pulse shadow-lg shadow-green-400/50" />
                                <span className="text-green-400 font-mono">OPERATIONAL</span>
                            </div>
                            <p className="text-cyan-300/50 text-sm mt-2">
                                Memory bridge connected
                            </p>
                        </CardContent>
                    </Card>

                    <Card className="bg-gradient-to-br from-cyan-950/50 to-purple-950/50 border-cyan-500/20 backdrop-blur-sm">
                        <CardHeader className="pb-3">
                            <CardTitle className="text-cyan-400 flex items-center gap-2">
                                <Activity className="w-5 h-5" />
                                Auto-Compression
                            </CardTitle>
                        </CardHeader>
                        <CardContent>
                            <div className="space-y-2">
                                <div className="text-cyan-300/70 text-sm">
                                    Short → Mid: 10 messages
                                </div>
                                <div className="text-cyan-300/70 text-sm">
                                    Mid → Long: 10 summaries
                                </div>
                            </div>
                        </CardContent>
                    </Card>
                </div>

                <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    {/* Write Memory */}
                    <Card className="bg-gradient-to-br from-cyan-950/50 to-purple-950/50 border-cyan-500/20 backdrop-blur-sm">
                        <CardHeader>
                            <CardTitle className="text-cyan-400 flex items-center gap-2">
                                <Plus className="w-5 h-5" />
                                Store Memory
                            </CardTitle>
                            <CardDescription className="text-cyan-300/50">
                                Add new memories to the system
                            </CardDescription>
                        </CardHeader>
                        <CardContent className="space-y-4">
                            <div>
                                <label className="text-cyan-300/70 text-sm mb-2 block">Memory Text</label>
                                <Textarea
                                    value={writeText}
                                    onChange={(e) => setWriteText(e.target.value)}
                                    placeholder="Enter the memory text..."
                                    className="bg-cyan-950/30 border-cyan-500/20 text-cyan-100 placeholder:text-cyan-500/30"
                                    rows={4}
                                />
                            </div>

                            <div>
                                <label className="text-cyan-300/70 text-sm mb-2 block">Metadata (JSON)</label>
                                <Textarea
                                    value={writeMeta}
                                    onChange={(e) => setWriteMeta(e.target.value)}
                                    placeholder='{"type": "example", "tags": ["tag1"]}'
                                    className="bg-cyan-950/30 border-cyan-500/20 text-cyan-100 font-mono text-sm placeholder:text-cyan-500/30"
                                    rows={3}
                                />
                            </div>

                            <div className="flex items-center gap-2">
                                <input
                                    type="checkbox"
                                    id="longterm"
                                    checked={writeLongterm}
                                    onChange={(e) => setWriteLongterm(e.target.checked)}
                                    className="w-4 h-4 rounded border-cyan-500/30 bg-cyan-950/30"
                                />
                                <label htmlFor="longterm" className="text-cyan-300/70 text-sm">
                                    Store in long-term memory
                                </label>
                            </div>

                            <Button
                                onClick={handleWrite}
                                disabled={loading || !writeText}
                                className="w-full bg-gradient-to-r from-cyan-500 to-purple-500 hover:from-cyan-600 hover:to-purple-600 text-white"
                            >
                                <Plus className="w-4 h-4 mr-2" />
                                Store Memory
                            </Button>
                        </CardContent>
                    </Card>

                    {/* Query Memory */}
                    <Card className="bg-gradient-to-br from-cyan-950/50 to-purple-950/50 border-cyan-500/20 backdrop-blur-sm">
                        <CardHeader>
                            <CardTitle className="text-cyan-400 flex items-center gap-2">
                                <Search className="w-5 h-5" />
                                Search Memories
                            </CardTitle>
                            <CardDescription className="text-cyan-300/50">
                                Query the memory system with semantic search
                            </CardDescription>
                        </CardHeader>
                        <CardContent className="space-y-4">
                            <div>
                                <label className="text-cyan-300/70 text-sm mb-2 block">Search Query</label>
                                <Input
                                    value={queryText}
                                    onChange={(e) => setQueryText(e.target.value)}
                                    placeholder="Enter search query..."
                                    className="bg-cyan-950/30 border-cyan-500/20 text-cyan-100 placeholder:text-cyan-500/30"
                                    onKeyDown={(e) => e.key === 'Enter' && handleQuery()}
                                />
                            </div>

                            <div>
                                <label className="text-cyan-300/70 text-sm mb-2 block">Top K Results</label>
                                <Input
                                    type="number"
                                    value={queryTopK}
                                    onChange={(e) => setQueryTopK(parseInt(e.target.value) || 5)}
                                    min={1}
                                    max={20}
                                    className="bg-cyan-950/30 border-cyan-500/20 text-cyan-100"
                                />
                            </div>

                            <Button
                                onClick={handleQuery}
                                disabled={loading || !queryText}
                                className="w-full bg-gradient-to-r from-purple-500 to-cyan-500 hover:from-purple-600 hover:to-cyan-600 text-white"
                            >
                                <Search className="w-4 h-4 mr-2" />
                                Search
                            </Button>

                            <Button
                                onClick={() => {
                                    setQueryText('conversation');
                                    setQueryTopK(10);
                                }}
                                variant="outline"
                                className="w-full border-cyan-500/30 text-cyan-300 hover:bg-cyan-500/10"
                            >
                                Show Recent Conversations
                            </Button>
                        </CardContent>
                    </Card>
                </div>

                {/* Query Results */}
                {queryResults.length > 0 && (
                    <Card className="bg-gradient-to-br from-cyan-950/50 to-purple-950/50 border-cyan-500/20 backdrop-blur-sm">
                        <CardHeader>
                            <CardTitle className="text-cyan-400">Search Results</CardTitle>
                            <CardDescription className="text-cyan-300/50">
                                Found {queryResults.length} matching memor{queryResults.length === 1 ? 'y' : 'ies'}
                            </CardDescription>
                        </CardHeader>
                        <CardContent className="space-y-3">
                            {queryResults.map((result, idx) => (
                                <div
                                    key={result.id}
                                    className="p-4 rounded-lg bg-cyan-950/30 border border-cyan-500/20 hover:border-cyan-500/40 transition-colors"
                                >
                                    <div className="flex justify-between items-start mb-2">
                                        <Badge variant="outline" className="bg-cyan-500/10 border-cyan-500/30 text-cyan-300">
                                            #{idx + 1}
                                        </Badge>
                                        {result.score !== undefined && (
                                            <Badge variant="outline" className="bg-purple-500/10 border-purple-500/30 text-purple-300">
                                                Score: {result.score.toFixed(3)}
                                            </Badge>
                                        )}
                                    </div>
                                    <p className="text-cyan-100 mb-2">{result.text}</p>
                                    <div className="flex items-center gap-3 text-xs text-cyan-400/50">
                                        <span className="font-mono">{result.id.substring(0, 8)}...</span>
                                        <span>{new Date(result.timestamp).toLocaleString()}</span>
                                    </div>
                                    {Object.keys(result.meta).length > 0 && (
                                        <div className="mt-2 p-2 bg-cyan-950/50 rounded border border-cyan-500/10">
                                            <pre className="text-xs text-cyan-300/70 font-mono">
                                                {JSON.stringify(result.meta, null, 2)}
                                            </pre>
                                        </div>
                                    )}
                                </div>
                            ))}
                        </CardContent>
                    </Card>
                )}
            </div>
        </div>
    );
}

--------------------------------------------------------------------------------
FILE: client/src/pages/monitoring.tsx
LINES: 388
--------------------------------------------------------------------------------
import { Card, CardContent, CardHeader, CardTitle, CardDescription } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { Button } from "@/components/ui/button";
import { ScrollArea } from "@/components/ui/scroll-area";
import { Progress } from "@/components/ui/progress";
import { useQuery } from "@tanstack/react-query";
import { Activity, RefreshCw, Server, Cpu, HardDrive, Wifi, CheckCircle, AlertTriangle, XCircle, Clock, Database, Zap, TrendingUp, MemoryStick } from "lucide-react";
import { motion } from "framer-motion";

interface DiagnosticsData {
  status: string;
  timestamp: string;
  services: {
    database?: string;
    websocket?: string;
    bridge?: string;
    progress?: string;
  };
  corpus_count?: number;
  progress_tasks?: number;
}

interface AuroraStatus {
  status: string;
  powerUnits: number;
  autofixer: {
    workers: number;
    active: number;
    queued: number;
    completed: number;
  };
  uptime: number;
}

interface NexusStatus {
  v2: {
    connected: boolean;
    port: number;
    status: string;
  };
  v3: {
    connected: boolean;
    status: string;
    workers: number;
  };
}

interface SystemMetric {
  name: string;
  value: number;
  max: number;
  unit: string;
  status: 'healthy' | 'warning' | 'critical';
  icon: string;
}

interface RealMetrics {
  cpu: number;
  memory: number;
  disk: number;
  network: { bytes_sent: number; bytes_recv: number };
}

export default function MonitoringPage() {
  const { data: realMetrics } = useQuery<RealMetrics>({
    queryKey: ['/api/system/metrics'],
    refetchInterval: 5000,  // Reduced from 3s to 5s to prevent CPU spikes
  });

  const cpuUsage = realMetrics?.cpu ?? 0;
  const memoryUsage = realMetrics?.memory ?? 0;
  const diskUsage = realMetrics?.disk ?? 0;

  const { data: diagnostics, isLoading: diagLoading, isError, error, refetch, isRefetching } = useQuery<DiagnosticsData>({
    queryKey: ['/api/diagnostics'],
    refetchInterval: 10000,
  });

  const { data: auroraStatus } = useQuery<AuroraStatus>({
    queryKey: ['/api/aurora/status'],
    refetchInterval: 5000,
  });

  const { data: nexusStatus } = useQuery<NexusStatus>({
    queryKey: ['/api/nexus/status'],
    refetchInterval: 10000,
  });

  const networkMbps = realMetrics?.network ? 
    Math.round((realMetrics.network.bytes_sent + realMetrics.network.bytes_recv) / 1024 / 1024) : 0;
  
  const systemMetrics: SystemMetric[] = [
    { name: 'CPU Usage', value: cpuUsage, max: 100, unit: '%', status: cpuUsage > 70 ? 'warning' : 'healthy', icon: 'cpu' },
    { name: 'Memory', value: memoryUsage, max: 100, unit: '%', status: memoryUsage > 80 ? 'warning' : 'healthy', icon: 'memory' },
    { name: 'Disk I/O', value: diskUsage, max: 100, unit: '%', status: diskUsage > 75 ? 'warning' : 'healthy', icon: 'disk' },
    { name: 'Network', value: networkMbps, max: 10000, unit: 'MB', status: 'healthy', icon: 'network' },
  ];

  const getStatusIcon = (status?: string) => {
    switch (status) {
      case 'connected':
      case 'active':
      case 'ok':
        return <CheckCircle className="w-4 h-4 text-green-400" />;
      case 'degraded':
      case 'missing':
        return <AlertTriangle className="w-4 h-4 text-yellow-400" />;
      case 'error':
      case 'unreachable':
      case 'inactive':
        return <XCircle className="w-4 h-4 text-red-400" />;
      default:
        return <Clock className="w-4 h-4 text-slate-400" />;
    }
  };

  const getStatusColor = (status?: string) => {
    switch (status) {
      case 'connected':
      case 'active':
      case 'ok':
      case 'healthy':
        return 'bg-green-500/20 text-green-300 border-green-500/30';
      case 'degraded':
      case 'missing':
      case 'warning':
        return 'bg-yellow-500/20 text-yellow-300 border-yellow-500/30';
      case 'error':
      case 'unreachable':
      case 'inactive':
      case 'critical':
        return 'bg-red-500/20 text-red-300 border-red-500/30';
      default:
        return 'bg-slate-500/20 text-slate-300 border-slate-500/30';
    }
  };

  const getMetricIcon = (icon: string) => {
    switch (icon) {
      case 'cpu': return <Cpu className="w-5 h-5" />;
      case 'memory': return <MemoryStick className="w-5 h-5" />;
      case 'disk': return <HardDrive className="w-5 h-5" />;
      case 'network': return <Wifi className="w-5 h-5" />;
      default: return <Activity className="w-5 h-5" />;
    }
  };

  const formatUptime = (ms: number) => {
    const hours = Math.floor(ms / 3600000);
    const minutes = Math.floor((ms % 3600000) / 60000);
    const seconds = Math.floor((ms % 60000) / 1000);
    return `${hours}h ${minutes}m ${seconds}s`;
  };

  const isLoading = diagLoading;

  return (
    <div className="h-full flex flex-col bg-gradient-to-br from-background via-emerald-950/5 to-sky-950/5">
      <div className="p-6 border-b border-emerald-500/20">
        <div className="flex items-center justify-between">
          <div className="flex items-center gap-4">
            <div className="relative">
              <div className="absolute inset-0 bg-green-500/30 rounded-full blur-md animate-pulse" />
              <div className="relative w-12 h-12 rounded-full border-2 border-green-400/50 flex items-center justify-center bg-gradient-to-br from-green-500/20 to-emerald-500/20">
                <Activity className="w-6 h-6 text-green-400" />
              </div>
            </div>
            <div>
              <h1 className="text-2xl font-bold bg-gradient-to-r from-green-400 via-emerald-400 to-green-400 bg-clip-text text-transparent" data-testid="text-page-title">
                System Monitor
              </h1>
              <p className="text-sm text-muted-foreground">
                Real-Time Performance & Health Metrics
              </p>
            </div>
          </div>
          <Button 
            variant="outline" 
            size="sm" 
            onClick={() => refetch()}
            disabled={isRefetching}
            className="border-green-500/30 hover:border-green-400/50"
            data-testid="button-refresh"
          >
            <RefreshCw className={`w-4 h-4 mr-2 ${isRefetching ? 'animate-spin' : ''}`} />
            Refresh
          </Button>
        </div>
      </div>

      {isLoading ? (
        <div className="flex-1 flex items-center justify-center">
          <div className="text-center">
            <Activity className="w-12 h-12 text-green-400 animate-pulse mx-auto mb-4" />
            <p className="text-muted-foreground">Loading system metrics...</p>
          </div>
        </div>
      ) : isError ? (
        <div className="flex-1 flex items-center justify-center">
          <div className="text-center">
            <AlertTriangle className="w-12 h-12 text-red-400 mx-auto mb-4" />
            <p className="text-red-300 mb-2">Failed to load system metrics</p>
            <p className="text-sm text-muted-foreground mb-4">{error?.message || 'An error occurred'}</p>
            <Button 
              variant="outline" 
              size="sm" 
              onClick={() => refetch()}
              className="border-red-500/30 hover:border-red-400/50"
              data-testid="button-retry"
            >
              <RefreshCw className="w-4 h-4 mr-2" />
              Retry
            </Button>
          </div>
        </div>
      ) : (
        <ScrollArea className="flex-1 p-6">
          <div className="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
            {systemMetrics.map((metric, index) => (
              <motion.div
                key={metric.name}
                initial={{ opacity: 0, y: 10 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ delay: index * 0.05 }}
              >
                <Card className={`border-${metric.status === 'healthy' ? 'green' : metric.status === 'warning' ? 'yellow' : 'red'}-500/30 bg-slate-900/50 backdrop-blur-xl`} data-testid={`card-metric-${metric.name.toLowerCase().replace(' ', '-')}`}>
                  <CardContent className="p-4">
                    <div className="flex items-center justify-between mb-3">
                      <div className={`w-10 h-10 rounded-lg bg-${metric.status === 'healthy' ? 'green' : metric.status === 'warning' ? 'yellow' : 'red'}-500/20 flex items-center justify-center text-${metric.status === 'healthy' ? 'green' : metric.status === 'warning' ? 'yellow' : 'red'}-400`}>
                        {getMetricIcon(metric.icon)}
                      </div>
                      <Badge variant="outline" className={getStatusColor(metric.status)}>
                        {metric.status}
                      </Badge>
                    </div>
                    <p className="text-xs text-muted-foreground mb-1">{metric.name}</p>
                    <p className="text-2xl font-bold text-green-400 mb-2">
                      {metric.value.toFixed(1)}{metric.unit}
                    </p>
                    <Progress value={metric.value} className="h-1.5 bg-slate-700" />
                  </CardContent>
                </Card>
              </motion.div>
            ))}
          </div>

          <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
            <Card className="border-emerald-500/30 bg-slate-900/50 backdrop-blur-xl" data-testid="card-services">
              <CardHeader className="border-b border-emerald-500/20">
                <CardTitle className="flex items-center gap-2 text-lg text-emerald-300">
                  <Server className="w-5 h-5 text-emerald-400" />
                  Service Status
                </CardTitle>
                <CardDescription className="text-emerald-300/60">Core system services health</CardDescription>
              </CardHeader>
              <CardContent className="pt-4">
                <div className="space-y-3">
                  {Object.entries(diagnostics?.services || {}).map(([service, status], index) => (
                    <motion.div
                      key={service}
                      initial={{ opacity: 0, x: -10 }}
                      animate={{ opacity: 1, x: 0 }}
                      transition={{ delay: index * 0.05 }}
                      className="flex items-center justify-between p-3 bg-slate-800/50 rounded-lg"
                    >
                      <div className="flex items-center gap-3">
                        {getStatusIcon(status)}
                        <span className="text-sm text-emerald-200 capitalize">{service}</span>
                      </div>
                      <Badge variant="outline" className={getStatusColor(status)}>
                        {status}
                      </Badge>
                    </motion.div>
                  ))}
                  <div className="flex items-center justify-between p-3 bg-slate-800/50 rounded-lg">
                    <div className="flex items-center gap-3">
                      {getStatusIcon(nexusStatus?.v2?.connected ? 'connected' : 'error')}
                      <span className="text-sm text-emerald-200">Luminar Nexus V2</span>
                    </div>
                    <Badge variant="outline" className={getStatusColor(nexusStatus?.v2?.connected ? 'connected' : 'error')}>
                      {nexusStatus?.v2?.connected ? 'Connected' : 'Offline'}
                    </Badge>
                  </div>
                  <div className="flex items-center justify-between p-3 bg-slate-800/50 rounded-lg">
                    <div className="flex items-center gap-3">
                      {getStatusIcon(nexusStatus?.v3?.connected ? 'connected' : 'error')}
                      <span className="text-sm text-emerald-200">Aurora Nexus V3</span>
                    </div>
                    <Badge variant="outline" className={getStatusColor(nexusStatus?.v3?.connected ? 'connected' : 'error')}>
                      {nexusStatus?.v3?.connected ? 'Connected' : 'Offline'}
                    </Badge>
                  </div>
                </div>
              </CardContent>
            </Card>

            <Card className="border-sky-500/30 bg-slate-900/50 backdrop-blur-xl" data-testid="card-aurora-health">
              <CardHeader className="border-b border-sky-500/20">
                <CardTitle className="flex items-center gap-2 text-lg text-sky-300">
                  <Zap className="w-5 h-5 text-sky-400" />
                  Aurora Core Health
                </CardTitle>
                <CardDescription className="text-sky-300/60">AI engine performance metrics</CardDescription>
              </CardHeader>
              <CardContent className="pt-4">
                <div className="space-y-4">
                  <div className="grid grid-cols-2 gap-4">
                    <div className="p-3 bg-slate-800/50 rounded-lg">
                      <p className="text-xs text-sky-300/60 mb-1">Power Units</p>
                      <p className="text-xl font-bold text-sky-300" data-testid="text-power-units">
                        {auroraStatus?.powerUnits || 0}
                      </p>
                    </div>
                    <div className="p-3 bg-slate-800/50 rounded-lg">
                      <p className="text-xs text-sky-300/60 mb-1">Uptime</p>
                      <p className="text-xl font-bold text-sky-300" data-testid="text-uptime">
                        {formatUptime(auroraStatus?.uptime || 0)}
                      </p>
                    </div>
                  </div>
                  <div className="p-3 bg-slate-800/50 rounded-lg">
                    <div className="flex items-center justify-between mb-2">
                      <p className="text-xs text-sky-300/60">Worker Utilization</p>
                      <p className="text-xs text-sky-300">
                        {auroraStatus?.autofixer?.active || 0} / {auroraStatus?.autofixer?.workers || 300}
                      </p>
                    </div>
                    <Progress 
                      value={((auroraStatus?.autofixer?.active || 0) / (auroraStatus?.autofixer?.workers || 300)) * 100} 
                      className="h-2 bg-slate-700" 
                    />
                  </div>
                  <div className="flex items-center justify-between p-3 bg-slate-800/50 rounded-lg">
                    <div className="flex items-center gap-3">
                      <TrendingUp className="w-4 h-4 text-green-400" />
                      <span className="text-sm text-sky-200">Completed Tasks</span>
                    </div>
                    <span className="text-sm font-mono text-green-400">
                      {auroraStatus?.autofixer?.completed || 0}
                    </span>
                  </div>
                </div>
              </CardContent>
            </Card>
          </div>

          <Card className="border-green-500/30 bg-slate-900/50 backdrop-blur-xl" data-testid="card-system-overview">
            <CardHeader className="border-b border-green-500/20">
              <CardTitle className="flex items-center gap-2 text-lg text-green-300">
                <Database className="w-5 h-5 text-green-400" />
                System Overview
              </CardTitle>
              <CardDescription className="text-green-300/60">General system statistics</CardDescription>
            </CardHeader>
            <CardContent className="pt-4">
              <div className="grid grid-cols-2 lg:grid-cols-4 gap-4">
                <div className="p-4 bg-slate-800/50 rounded-lg border border-green-500/20">
                  <p className="text-xs text-green-300/60 mb-1">Corpus Records</p>
                  <p className="text-lg font-mono text-green-300" data-testid="text-corpus-count">
                    {diagnostics?.corpus_count || 0}
                  </p>
                </div>
                <div className="p-4 bg-slate-800/50 rounded-lg border border-green-500/20">
                  <p className="text-xs text-green-300/60 mb-1">Progress Tasks</p>
                  <p className="text-lg font-mono text-green-300" data-testid="text-progress-tasks">
                    {diagnostics?.progress_tasks || 0}
                  </p>
                </div>
                <div className="p-4 bg-slate-800/50 rounded-lg border border-green-500/20">
                  <p className="text-xs text-green-300/60 mb-1">System Status</p>
                  <Badge variant="outline" className={getStatusColor(diagnostics?.status)} data-testid="badge-system-status">
                    {diagnostics?.status || 'Unknown'}
                  </Badge>
                </div>
                <div className="p-4 bg-slate-800/50 rounded-lg border border-green-500/20">
                  <p className="text-xs text-green-300/60 mb-1">Last Check</p>
                  <p className="text-sm font-mono text-green-300" data-testid="text-last-check">
                    {diagnostics?.timestamp ? new Date(diagnostics.timestamp).toLocaleTimeString() : 'N/A'}
                  </p>
                </div>
              </div>
            </CardContent>
          </Card>
        </ScrollArea>
      )}
    </div>
  );
}

--------------------------------------------------------------------------------
FILE: client/src/pages/nexus.tsx
LINES: 439
--------------------------------------------------------------------------------
'use client';

import { useQuery } from "@tanstack/react-query";
import { Badge } from "@/components/ui/badge";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Progress } from "@/components/ui/progress";
import {
  Activity,
  Brain,
  Cpu,
  HeartPulse,
  Network,
  Package,
  Sparkles,
  Zap,
} from "lucide-react";
import ActivityMonitor from "@/components/ActivityMonitor";
import UnifiedSystemStatus from "@/components/UnifiedSystemStatus";

interface UnifiedStatus {
  v2: {
    connected: boolean;
    port?: number;
    quantum_coherence?: number;
    healthy_services?: number;
    ai_learning_active?: boolean;
    autonomous_healing_active?: boolean;
  };
  v3: {
    connected: boolean;
    state?: string;
    version?: string;
  };
  unified: {
    anyConnected: boolean;
    allConnected: boolean;
    timestamp: string;
  };
}

interface V3Capabilities {
  workers?: number;
  tiers?: number;
  aems?: number;
  modules?: number;
  hyperspeed_enabled?: boolean;
  hybrid_mode_enabled?: boolean;
  autonomous_mode?: boolean;
  available?: boolean;
}

interface V3Status {
  state?: string;
  version?: string;
  uptime?: number;
  available?: boolean;
}

interface V3Workers {
  total?: number;
  active?: number;
  idle?: number;
  available?: boolean;
}

interface V3SelfHealers {
  total?: number;
  active?: number;
  healing?: number;
  cooldown?: number;
  healsPerformed?: number;
  healthyComponents?: number;
  totalComponents?: number;
}

interface PackSummary {
  total_packs?: number;
  loaded_packs?: number;
  total_submodules?: number;
  available?: boolean;
}

interface V2Status {
  status?: string;
  version?: string;
  services?: Record<string, { status?: string; health?: number }>;
  quantum_coherence?: number;
  healthy_services?: number;
  ai_learning_active?: boolean;
  autonomous_healing_active?: boolean;
  embedded?: boolean;
}

function formatCount(value?: number) {
  return typeof value === "number" ? value.toLocaleString() : "Unavailable";
}

function formatPercent(value?: number) {
  if (typeof value !== "number") return "Unavailable";
  return `${Math.max(0, Math.min(100, value)).toFixed(1)}%`;
}

function StatusBadge({ active, label }: { active?: boolean; label: string }) {
  return (
    <Badge
      className={
        active
          ? "bg-emerald-500/20 text-emerald-200 border-emerald-500/40"
          : "bg-slate-800 text-slate-300 border-slate-600/40"
      }
    >
      {label}
    </Badge>
  );
}

export default function NexusPage() {
  const { data: unifiedStatus } = useQuery<UnifiedStatus>({
    queryKey: ["/api/nexus/status"],
    refetchInterval: 10000,
  });

  const v2Connected = unifiedStatus?.v2?.connected !== false;
  const v3Connected = unifiedStatus?.v3?.connected !== false;

  const { data: v2Status } = useQuery<V2Status>({
    queryKey: ["/api/luminar-nexus/v2/status"],
    refetchInterval: 15000,
    enabled: v2Connected,
  });

  const { data: v3Status } = useQuery<V3Status>({
    queryKey: ["/api/nexus-v3/status"],
    refetchInterval: 10000,
    enabled: v3Connected,
  });

  const { data: v3Capabilities } = useQuery<V3Capabilities>({
    queryKey: ["/api/nexus-v3/capabilities"],
    refetchInterval: 15000,
    enabled: v3Connected,
  });

  const { data: v3Workers } = useQuery<V3Workers>({
    queryKey: ["/api/nexus-v3/workers"],
    refetchInterval: 15000,
    enabled: v3Connected,
  });

  const { data: v3Healers } = useQuery<V3SelfHealers>({
    queryKey: ["/api/nexus-v3/self-healers"],
    refetchInterval: 20000,
    enabled: v3Connected,
  });

  const { data: packSummary } = useQuery<PackSummary>({
    queryKey: ["/api/nexus-v3/packs"],
    refetchInterval: 60000,
    enabled: v3Connected,
  });

  const coherence = typeof v2Status?.quantum_coherence === "number"
    ? v2Status.quantum_coherence
    : unifiedStatus?.v2?.quantum_coherence;
  const coherencePercent = coherence !== undefined ? coherence * 100 : undefined;

  const v2Services = v2Status?.services || {};
  const v2ServiceEntries = Object.entries(v2Services);
  const v2ServiceCount = v2Status ? v2ServiceEntries.length : undefined;

  return (
    <div className="mx-auto max-w-7xl space-y-6">
      <section className="rounded-3xl border border-slate-800/70 bg-slate-900/60 p-6">
        <div className="flex flex-wrap items-center justify-between gap-4">
          <div className="space-y-2">
            <div className="flex flex-wrap items-center gap-3">
              <Sparkles className="h-6 w-6 text-emerald-300" />
              <h1 className="text-2xl font-semibold text-slate-100">Nexus Command</h1>
              <Badge className="bg-emerald-500/20 text-emerald-100 border-emerald-400/40">
                Unified V2 + V3
              </Badge>
            </div>
            <p className="text-sm text-slate-400">
              Live production telemetry for Aurora Nexus V3 and Luminar Nexus V2.
            </p>
            <div className="flex flex-wrap gap-2">
              <StatusBadge active={unifiedStatus?.v3?.connected} label="Nexus V3" />
              <StatusBadge active={unifiedStatus?.v2?.connected} label="Nexus V2" />
              <StatusBadge active={unifiedStatus?.unified?.allConnected} label="Unified" />
            </div>
          </div>
          <div className="text-xs text-slate-500">
            Snapshot {unifiedStatus?.unified?.timestamp ? new Date(unifiedStatus.unified.timestamp).toLocaleTimeString() : "Unavailable"}
          </div>
        </div>
      </section>

      <section className="grid grid-cols-1 gap-4 md:grid-cols-2 xl:grid-cols-4">
        <Card className="bg-slate-900/60 border-emerald-500/30">
          <CardHeader className="pb-2">
            <CardTitle className="flex items-center gap-2 text-sm text-emerald-200">
              <Cpu className="h-4 w-4 text-emerald-400" />
              Workers
            </CardTitle>
          </CardHeader>
          <CardContent className="text-2xl font-semibold text-emerald-100">
            {formatCount(v3Capabilities?.workers)}
          </CardContent>
        </Card>
        <Card className="bg-slate-900/60 border-sky-500/30">
          <CardHeader className="pb-2">
            <CardTitle className="flex items-center gap-2 text-sm text-sky-200">
              <Network className="h-4 w-4 text-sky-400" />
              Tiers
            </CardTitle>
          </CardHeader>
          <CardContent className="text-2xl font-semibold text-sky-100">
            {formatCount(v3Capabilities?.tiers)}
          </CardContent>
        </Card>
        <Card className="bg-slate-900/60 border-amber-500/30">
          <CardHeader className="pb-2">
            <CardTitle className="flex items-center gap-2 text-sm text-amber-200">
              <Zap className="h-4 w-4 text-amber-400" />
              AEMs
            </CardTitle>
          </CardHeader>
          <CardContent className="text-2xl font-semibold text-amber-100">
            {formatCount(v3Capabilities?.aems)}
          </CardContent>
        </Card>
        <Card className="bg-slate-900/60 border-emerald-500/30">
          <CardHeader className="pb-2">
            <CardTitle className="flex items-center gap-2 text-sm text-emerald-200">
              <Package className="h-4 w-4 text-emerald-400" />
              Modules
            </CardTitle>
          </CardHeader>
          <CardContent className="text-2xl font-semibold text-emerald-100">
            {formatCount(v3Capabilities?.modules)}
          </CardContent>
        </Card>
      </section>

      <section className="grid grid-cols-1 gap-6 lg:grid-cols-2">
        <Card className="bg-slate-900/60 border-emerald-500/30">
          <CardHeader>
            <CardTitle className="flex items-center gap-2 text-emerald-200">
              <Brain className="h-5 w-5 text-emerald-400" />
              Aurora Nexus V3
            </CardTitle>
          </CardHeader>
          <CardContent className="space-y-4">
            <div className="flex flex-wrap gap-2">
              <StatusBadge active={v3Connected} label="Online" />
              <Badge className="bg-slate-800 text-slate-300 border-slate-600/40">
                {v3Status?.state ? v3Status.state.toUpperCase() : "STATE UNAVAILABLE"}
              </Badge>
              <Badge className="bg-slate-800 text-slate-300 border-slate-600/40">
                {v3Status?.version ? `v${v3Status.version}` : "Version Unknown"}
              </Badge>
            </div>
            <div className="grid grid-cols-2 gap-3 text-sm">
              <div className="rounded-lg bg-slate-950/60 border border-emerald-500/20 p-3">
                <div className="text-emerald-200/70">Workers</div>
                <div className="text-lg font-semibold text-emerald-100">
                  {formatCount(v3Capabilities?.workers)}
                </div>
              </div>
              <div className="rounded-lg bg-slate-950/60 border border-emerald-500/20 p-3">
                <div className="text-emerald-200/70">Modules</div>
                <div className="text-lg font-semibold text-emerald-100">
                  {formatCount(v3Capabilities?.modules)}
                </div>
              </div>
              <div className="rounded-lg bg-slate-950/60 border border-emerald-500/20 p-3">
                <div className="text-emerald-200/70">Tiers</div>
                <div className="text-lg font-semibold text-emerald-100">
                  {formatCount(v3Capabilities?.tiers)}
                </div>
              </div>
              <div className="rounded-lg bg-slate-950/60 border border-emerald-500/20 p-3">
                <div className="text-emerald-200/70">AEMs</div>
                <div className="text-lg font-semibold text-emerald-100">
                  {formatCount(v3Capabilities?.aems)}
                </div>
              </div>
            </div>
            <div className="flex flex-wrap gap-2 text-xs">
              <StatusBadge active={v3Capabilities?.hyperspeed_enabled} label="Hyperspeed" />
              <StatusBadge active={v3Capabilities?.hybrid_mode_enabled} label="Hybrid Mode" />
              <StatusBadge active={v3Capabilities?.autonomous_mode} label="Autonomous" />
            </div>
          </CardContent>
        </Card>

        <Card className="bg-slate-900/60 border-sky-500/30">
          <CardHeader>
            <CardTitle className="flex items-center gap-2 text-sky-200">
              <Network className="h-5 w-5 text-sky-400" />
              Luminar Nexus V2
            </CardTitle>
          </CardHeader>
          <CardContent className="space-y-4">
            <div className="flex flex-wrap gap-2">
              <StatusBadge active={v2Connected} label="Online" />
              <Badge className="bg-slate-800 text-slate-300 border-slate-600/40">
                {v2Status?.version ? `v${v2Status.version}` : "Version Unknown"}
              </Badge>
            </div>
            <div className="space-y-2 rounded-lg bg-slate-950/60 border border-sky-500/20 p-3">
              <div className="flex items-center justify-between text-sm">
                <span className="text-sky-200/70">Quantum Coherence</span>
                <span className="text-sky-100 font-semibold">{formatPercent(coherencePercent)}</span>
              </div>
              <Progress value={coherencePercent ?? 0} className="h-2 bg-slate-800" />
            </div>
            <div className="grid grid-cols-2 gap-3 text-sm">
              <div className="rounded-lg bg-slate-950/60 border border-sky-500/20 p-3">
                <div className="text-sky-200/70">Healthy Services</div>
                <div className="text-lg font-semibold text-sky-100">
                  {formatCount(v2Status?.healthy_services ?? unifiedStatus?.v2?.healthy_services)}
                </div>
              </div>
              <div className="rounded-lg bg-slate-950/60 border border-sky-500/20 p-3">
                <div className="text-sky-200/70">Services Online</div>
                <div className="text-lg font-semibold text-sky-100">
                  {formatCount(v2ServiceCount)}
                </div>
              </div>
            </div>
            <div className="flex flex-wrap gap-2 text-xs">
              <StatusBadge active={v2Status?.ai_learning_active ?? unifiedStatus?.v2?.ai_learning_active} label="AI Learning" />
              <StatusBadge active={v2Status?.autonomous_healing_active ?? unifiedStatus?.v2?.autonomous_healing_active} label="Auto-Healing" />
            </div>
          </CardContent>
        </Card>
      </section>

      <section className="grid grid-cols-1 gap-6 xl:grid-cols-3">
        <Card className="bg-slate-900/60 border-emerald-500/30">
          <CardHeader>
            <CardTitle className="flex items-center gap-2 text-emerald-200">
              <Cpu className="h-5 w-5 text-emerald-400" />
              Worker Load
            </CardTitle>
          </CardHeader>
          <CardContent className="space-y-3 text-sm">
            <div className="flex items-center justify-between">
              <span className="text-emerald-200/70">Total</span>
              <span className="text-emerald-100 font-semibold">{formatCount(v3Workers?.total)}</span>
            </div>
            <div className="flex items-center justify-between">
              <span className="text-emerald-200/70">Active</span>
              <span className="text-emerald-100 font-semibold">{formatCount(v3Workers?.active)}</span>
            </div>
            <div className="flex items-center justify-between">
              <span className="text-emerald-200/70">Idle</span>
              <span className="text-emerald-100 font-semibold">{formatCount(v3Workers?.idle)}</span>
            </div>
          </CardContent>
        </Card>

        <Card className="bg-slate-900/60 border-rose-500/30">
          <CardHeader>
            <CardTitle className="flex items-center gap-2 text-rose-200">
              <HeartPulse className="h-5 w-5 text-rose-400" />
              Self-Healing
            </CardTitle>
          </CardHeader>
          <CardContent className="space-y-3 text-sm">
            <div className="flex items-center justify-between">
              <span className="text-rose-200/70">Active Healers</span>
              <span className="text-rose-100 font-semibold">{formatCount(v3Healers?.active)}</span>
            </div>
            <div className="flex items-center justify-between">
              <span className="text-rose-200/70">Total Healers</span>
              <span className="text-rose-100 font-semibold">{formatCount(v3Healers?.total)}</span>
            </div>
            <div className="flex items-center justify-between">
              <span className="text-rose-200/70">Heals Performed</span>
              <span className="text-rose-100 font-semibold">{formatCount(v3Healers?.healsPerformed)}</span>
            </div>
          </CardContent>
        </Card>

        <Card className="bg-slate-900/60 border-amber-500/30">
          <CardHeader>
            <CardTitle className="flex items-center gap-2 text-amber-200">
              <Package className="h-5 w-5 text-amber-400" />
              Packs
            </CardTitle>
          </CardHeader>
          <CardContent className="space-y-3 text-sm">
            <div className="flex items-center justify-between">
              <span className="text-amber-200/70">Total Packs</span>
              <span className="text-amber-100 font-semibold">{formatCount(packSummary?.total_packs)}</span>
            </div>
            <div className="flex items-center justify-between">
              <span className="text-amber-200/70">Loaded Packs</span>
              <span className="text-amber-100 font-semibold">{formatCount(packSummary?.loaded_packs)}</span>
            </div>
            <div className="flex items-center justify-between">
              <span className="text-amber-200/70">Submodules</span>
              <span className="text-amber-100 font-semibold">{formatCount(packSummary?.total_submodules)}</span>
            </div>
          </CardContent>
        </Card>
      </section>

      {v2ServiceEntries.length > 0 && (
        <Card className="bg-slate-900/60 border-sky-500/20">
          <CardHeader>
            <CardTitle className="flex items-center gap-2 text-sky-200">
              <Activity className="h-5 w-5 text-sky-400" />
              V2 Service Health
            </CardTitle>
          </CardHeader>
          <CardContent className="grid grid-cols-1 gap-3 text-sm md:grid-cols-2 lg:grid-cols-3">
            {v2ServiceEntries.map(([name, service]) => (
              <div key={name} className="rounded-lg border border-sky-500/20 bg-slate-950/60 p-3">
                <div className="text-sky-100 font-semibold">{name}</div>
                <div className="text-sky-200/70">Status: {service.status ?? "Unknown"}</div>
                {typeof service.health === "number" && (
                  <div className="text-sky-200/70">Health: {service.health}%</div>
                )}
              </div>
            ))}
          </CardContent>
        </Card>
      )}

      <section className="grid grid-cols-1 gap-6 xl:grid-cols-2">
        <UnifiedSystemStatus />
        <ActivityMonitor />
      </section>
    </div>
  );
}

--------------------------------------------------------------------------------
FILE: client/src/pages/not-found.tsx
LINES: 22
--------------------------------------------------------------------------------
import { ErrorBoundary } from '@/components/error-boundary';
import { Card, CardContent } from "@/components/ui/card";
import { AlertCircle } from "lucide-react";

export default function NotFound() {
  return (
    <div className="min-h-screen w-full flex items-center justify-center bg-gray-50">
      <Card className="w-full max-w-md mx-4">
        <CardContent className="pt-6">
          <div className="flex mb-4 gap-2">
            <AlertCircle className="h-8 w-8 text-red-500" />
            <h1 className="text-2xl font-bold text-gray-900">404 Page Not Found</h1>
          </div>

          <p className="mt-4 text-sm text-gray-600">
            Did you forget to add the page to the router?
          </p>
        </CardContent>
      </Card>
    </div>
  );
}

--------------------------------------------------------------------------------
FILE: client/src/pages/roadmap.tsx
LINES: 291
--------------------------------------------------------------------------------
import { useEffect, useState } from "react";
import { useQuery, useQueryClient } from "@tanstack/react-query";
import { getRoadmapProgress, getRoadmapSummary, getEvolutionLog, getQueuedApprovals, runNextPhase, approveChange } from "@/lib/roadmap-api";
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { Play, RefreshCw, Check, AlertCircle, Loader2, Activity, Layers, Users } from "lucide-react";
import { useToast } from "@/hooks/use-toast";

interface ProgressData {
  phase: number;
  status: string;
  last_update?: string;
}

interface SummaryData {
  current_phase: number;
  status: string;
  modules_count: number;
  knowledge_snapshot: boolean;
  evolution_log_entries: number;
  timestamp?: string;
}

interface EvolutionEntry {
  timestamp: string;
  reason?: string;
  metrics?: Record<string, unknown>;
  queued?: Array<{ target: string; proposal: string; requires_approval: boolean }>;
}

interface QueuedApproval {
  target: string;
  proposal: string;
  requires_approval: boolean;
}

export default function RoadmapPage() {
  const qc = useQueryClient();
  const { toast } = useToast();
  const [isRunning, setIsRunning] = useState(false);
  const [queued, setQueued] = useState<QueuedApproval[]>([]);

  const { data: progressRes, isLoading: progressLoading } = useQuery({
    queryKey: ["roadmap", "progress"],
    queryFn: getRoadmapProgress,
    refetchInterval: 5000
  });

  const { data: summaryRes, isLoading: summaryLoading } = useQuery({
    queryKey: ["roadmap", "summary"],
    queryFn: getRoadmapSummary,
    refetchInterval: 15000
  });

  const { data: evoRes, isLoading: evoLoading } = useQuery({
    queryKey: ["evolution", "log"],
    queryFn: getEvolutionLog,
    refetchInterval: 15000
  });

  useEffect(() => {
    getQueuedApprovals().then(r => setQueued(r.queued || [])).catch(() => {});
  }, []);


  const onRunNext = async () => {
    setIsRunning(true);
    try {
      const result = await runNextPhase();
      if (result.ok) {
        toast({ title: "Phase Triggered", description: "Running next roadmap phase..." });
        qc.invalidateQueries({ queryKey: ["roadmap", "progress"] });
      } else {
        toast({ title: "Error", description: result.error || "Failed to trigger phase", variant: "destructive" });
      }
    } catch {
      toast({ title: "Error", description: "Failed to connect to server", variant: "destructive" });
    }
    setIsRunning(false);
  };

  const onApprove = async (target: string) => {
    try {
      const result = await approveChange(target);
      if (result.ok) {
        toast({ title: "Approved", description: `Applied: ${target}` });
        setQueued(prev => prev.filter(q => q.target !== target));
        qc.invalidateQueries({ queryKey: ["evolution", "log"] });
      } else {
        toast({ title: "Error", description: result.error || "Failed to approve", variant: "destructive" });
      }
    } catch {
      toast({ title: "Error", description: "Failed to approve change", variant: "destructive" });
    }
  };

  const progress: ProgressData = progressRes?.data || { phase: 0, status: "unknown" };
  const summary: SummaryData = summaryRes?.data || { current_phase: 0, status: "unknown", modules_count: 0, knowledge_snapshot: false, evolution_log_entries: 0 };
  const entries: EvolutionEntry[] = evoRes?.entries || [];

  const getStatusBadge = (status: string) => {
    if (status === "complete") return <Badge variant="default" className="bg-green-600" data-testid="badge-status-complete">Complete</Badge>;
    if (status === "pending") return <Badge variant="secondary" data-testid="badge-status-pending">Pending</Badge>;
    return <Badge variant="outline" data-testid="badge-status-unknown">{status}</Badge>;
  };

  return (
    <div className="p-6 space-y-6 max-w-7xl mx-auto">
      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-2xl font-bold" data-testid="text-page-title">Aurora Roadmap Dashboard</h1>
          <p className="text-muted-foreground">Autonomous progress tracking and phase management</p>
        </div>
        <div className="flex gap-2">
          <Button 
            variant="outline" 
            onClick={() => qc.invalidateQueries({ queryKey: ["roadmap"] })}
            data-testid="button-refresh"
          >
            <RefreshCw className="w-4 h-4 mr-2" />
            Refresh
          </Button>
          <Button 
            onClick={onRunNext} 
            disabled={isRunning}
            data-testid="button-run-next"
          >
            {isRunning ? <Loader2 className="w-4 h-4 mr-2 animate-spin" /> : <Play className="w-4 h-4 mr-2" />}
            Run Next Phase
          </Button>
        </div>
      </div>

      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
        <Card data-testid="card-phase">
          <CardHeader className="flex flex-row items-center justify-between gap-2 space-y-0 pb-2">
            <CardTitle className="text-sm font-medium">Current Phase</CardTitle>
            <Activity className="w-4 h-4 text-muted-foreground" />
          </CardHeader>
          <CardContent>
            {progressLoading ? (
              <Loader2 className="w-6 h-6 animate-spin" />
            ) : (
              <>
                <div className="text-3xl font-bold" data-testid="text-phase-number">{progress.phase}</div>
                <div className="flex items-center gap-2 mt-1">
                  {getStatusBadge(progress.status)}
                  {progress.last_update && (
                    <span className="text-xs text-muted-foreground">
                      Updated: {new Date(progress.last_update).toLocaleTimeString()}
                    </span>
                  )}
                </div>
              </>
            )}
          </CardContent>
        </Card>

        <Card data-testid="card-modules">
          <CardHeader className="flex flex-row items-center justify-between gap-2 space-y-0 pb-2">
            <CardTitle className="text-sm font-medium">Modules</CardTitle>
            <Layers className="w-4 h-4 text-muted-foreground" />
          </CardHeader>
          <CardContent>
            {summaryLoading ? (
              <Loader2 className="w-6 h-6 animate-spin" />
            ) : (
              <>
                <div className="text-3xl font-bold" data-testid="text-modules-count">{summary.modules_count}</div>
                <p className="text-xs text-muted-foreground mt-1">
                  Knowledge: {summary.knowledge_snapshot ? "Active" : "Pending"}
                </p>
              </>
            )}
          </CardContent>
        </Card>

        <Card data-testid="card-workers">
          <CardHeader className="flex flex-row items-center justify-between gap-2 space-y-0 pb-2">
            <CardTitle className="text-sm font-medium">Workers</CardTitle>
            <Users className="w-4 h-4 text-muted-foreground" />
          </CardHeader>
          <CardContent>
            <div className="text-3xl font-bold" data-testid="text-workers-count">400</div>
            <p className="text-xs text-muted-foreground mt-1">300 tasks / 100 healers</p>
          </CardContent>
        </Card>
      </div>

      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <Card data-testid="card-evolution-log">
          <CardHeader>
            <CardTitle className="flex items-center gap-2">
              <Activity className="w-5 h-5" />
              Evolution Log
            </CardTitle>
          </CardHeader>
          <CardContent>
            <div className="space-y-2 max-h-80 overflow-y-auto">
              {evoLoading ? (
                <div className="flex justify-center p-4">
                  <Loader2 className="w-6 h-6 animate-spin" />
                </div>
              ) : entries.length === 0 ? (
                <p className="text-muted-foreground text-center py-4">No evolution entries yet</p>
              ) : (
                entries.slice().reverse().slice(0, 20).map((e, idx) => (
                  <div key={idx} className="p-3 border rounded-md hover-elevate" data-testid={`evolution-entry-${idx}`}>
                    <div className="flex justify-between items-start gap-2">
                      <span className="text-xs text-muted-foreground">
                        {e.timestamp ? new Date(e.timestamp).toLocaleString() : "—"}
                      </span>
                      {e.reason && <Badge variant="outline">{e.reason}</Badge>}
                    </div>
                    {e.metrics && (
                      <pre className="text-xs mt-2 p-2 bg-muted rounded overflow-x-auto">
                        {JSON.stringify(e.metrics, null, 2)}
                      </pre>
                    )}
                  </div>
                ))
              )}
            </div>
          </CardContent>
        </Card>

        <Card data-testid="card-approvals">
          <CardHeader>
            <CardTitle className="flex items-center gap-2">
              <AlertCircle className="w-5 h-5" />
              Queued Approvals
            </CardTitle>
          </CardHeader>
          <CardContent>
            <div className="space-y-2 max-h-80 overflow-y-auto">
              {queued.length === 0 ? (
                <div className="flex flex-col items-center justify-center py-8 text-muted-foreground">
                  <Check className="w-8 h-8 mb-2" />
                  <p>No pending approvals</p>
                </div>
              ) : (
                queued.map((q, i) => (
                  <div key={i} className="flex items-center justify-between p-3 border rounded-md" data-testid={`approval-item-${i}`}>
                    <div className="flex-1">
                      <div className="font-medium">{q.target}</div>
                      {q.proposal && <p className="text-sm text-muted-foreground">{q.proposal}</p>}
                    </div>
                    <Button 
                      size="sm" 
                      onClick={() => onApprove(q.target)}
                      data-testid={`button-approve-${i}`}
                    >
                      <Check className="w-4 h-4 mr-1" />
                      Approve
                    </Button>
                  </div>
                ))
              )}
            </div>
          </CardContent>
        </Card>
      </div>

      <Card data-testid="card-phase-timeline">
        <CardHeader>
          <CardTitle>Phase Timeline</CardTitle>
        </CardHeader>
        <CardContent>
          <div className="flex gap-2 flex-wrap">
            {[1, 2, 3, 4, 5, 6, 7, 8, 9].map(phase => (
              <div
                key={phase}
                className={`flex items-center justify-center w-12 h-12 rounded-full border-2 font-bold ${
                  phase < progress.phase
                    ? "bg-green-600 border-green-600 text-white"
                    : phase === progress.phase
                    ? "bg-primary border-primary text-primary-foreground"
                    : "bg-muted border-muted-foreground/30 text-muted-foreground"
                }`}
                data-testid={`phase-indicator-${phase}`}
              >
                {phase < progress.phase ? <Check className="w-5 h-5" /> : phase}
              </div>
            ))}
          </div>
        </CardContent>
      </Card>
    </div>
  );
}

--------------------------------------------------------------------------------
FILE: client/src/pages/self-learning.tsx
LINES: 517
--------------------------------------------------------------------------------
import { ErrorBoundary } from '@/components/error-boundary';
import { useQuery, useMutation } from "@tanstack/react-query";
import { motion } from "framer-motion";
import { useState, useEffect, useRef } from "react";
import { Card, CardHeader, CardTitle, CardContent, CardDescription } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import { Activity, Zap, Play, Square, RefreshCw, Database, Settings, Clock, Moon, Sun } from "lucide-react";
import { useToast } from "@/hooks/use-toast";
import { apiRequest, queryClient } from "@/lib/queryClient";
import { Label } from "@/components/ui/label";
import { Input } from "@/components/ui/input";
import { Switch } from "@/components/ui/switch";
import { Separator } from "@/components/ui/separator";

interface SelfLearningStatus {
  running: boolean;
  message?: string;
  stats?: {
    started_at: string | null;
    last_activity: string | null;
    run_count: number;
  };
}

interface RecentRun {
  run_id: string;
  timestamp: string;
  score: number;
  passed: number;
  total: number;
}

interface LearningSettings {
  autoStart: boolean;
  sleepInterval: number; // seconds
  wakeTime: string; // HH:MM format
  sleepTime: string; // HH:MM format
  enableSchedule: boolean;
}

const DEFAULT_SETTINGS: LearningSettings = {
  autoStart: true, // Always auto-start
  sleepInterval: 15, // Default interval between self-learning runs in seconds.
  wakeTime: "00:00", // Run 24/7
  sleepTime: "23:59", // Run 24/7
  enableSchedule: false, // Disabled - run continuously
};

export default function SelfLearning() {
  const { toast } = useToast();
  const [statusPolling, setStatusPolling] = useState(true);
  const [showSettings, setShowSettings] = useState(false);
  const [manualStop, setManualStop] = useState(false);
  const manualStopRef = useRef(false); // Use ref to track manual stop immediately
  const [settings, setSettings] = useState<LearningSettings>(() => {
    const saved = localStorage.getItem("aurora-learning-settings");
    return saved ? JSON.parse(saved) : DEFAULT_SETTINGS;
  });

  // Save settings to localStorage whenever they change
  useEffect(() => {
    localStorage.setItem("aurora-learning-settings", JSON.stringify(settings));
  }, [settings]);

  // Query for self-learning status with enhanced error handling
  const { data: status, isLoading, refetch, error: statusError } = useQuery<SelfLearningStatus>({
    queryKey: ["/api/self-learning/status"],
    refetchInterval: statusPolling ? 5000 : false,
    retry: 2,
  });

  // Auto-start on mount and keep running continuously
  useEffect(() => {
    // Always try to start if not running (unless user manually stopped it)
    // Use ref to avoid race conditions with state updates
    if (status && !status.running && !isLoading && !manualStopRef.current) {
      // Check if we're within wake hours if schedule is enabled
      if (settings.enableSchedule) {
        const now = new Date();
        const currentTime = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;

        if (currentTime >= settings.wakeTime && currentTime < settings.sleepTime) {
          startMutation.mutate();
        }
      } else {
        // Run continuously by default
        startMutation.mutate();
      }
    }
  }, [status, isLoading, settings.enableSchedule, settings.wakeTime, settings.sleepTime]);

  // Schedule-based sleep/wake cycle
  useEffect(() => {
    if (!settings.enableSchedule || !status?.running) return;

    const checkSchedule = () => {
      const now = new Date();
      const currentTime = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;

      // Stop if past sleep time
      if (currentTime >= settings.sleepTime || currentTime < settings.wakeTime) {
        if (status.running) {
          stopMutation.mutate();
          toast({
            title: "Aurora is Sleeping",
            description: `Stopped for the night. Will resume at ${settings.wakeTime}`,
          });
        }
      }
    };

    const interval = setInterval(checkSchedule, 60000); // Check every minute
    return () => clearInterval(interval);
  }, [settings.enableSchedule, settings.sleepTime, settings.wakeTime, status]);

  // Query for recent runs with error handling
  const { data: recentRuns, error: recentRunsError, isError: recentRunsIsError } = useQuery<{ runs: RecentRun[] }>({
    queryKey: ["/api/corpus/recent?limit=10"],
    refetchInterval: 10000,
    retry: 2,
  });

  // Handle errors after query completes
  useEffect(() => {
    if (recentRunsIsError && recentRunsError) {
      console.error('🌟 Aurora: Error fetching recent runs:', recentRunsError);
      toast({
        title: "Could not load recent activity",
        description: "Retrying real-time data fetch...",
        variant: "destructive",
      });
    }
  }, [recentRunsIsError, recentRunsError, toast]);

  // Start mutation
  const startMutation = useMutation({
    mutationFn: async () => {
      const response = await apiRequest("POST", "/api/self-learning/start", {
        sleepInterval: settings.sleepInterval,
      });

      // Handle "already running" error gracefully - return success without throwing
      if (response.status === 400) {
        const data = await response.json();
        if (data.error === "Already running") {
          // Treat "already running" as success - just return a flag
          return { status: "started", message: "Self-learning daemon is already running", alreadyRunning: true };
        }
      }

      // For other errors or success, parse normally
      if (!response.ok) {
        const data = await response.json();
        throw new Error(data.message || "Failed to start learning");
      }

      return response.json();
    },
    onSuccess: (data) => {
      // Clear manual stop flag and update UI (both ref and state)
      manualStopRef.current = false;
      setManualStop(false);
      updateSetting("autoStart", true);
      queryClient.invalidateQueries({ queryKey: ["/api/self-learning/status"] });

      // Only show toast for actual starts, not for "already running"
      if (!data.alreadyRunning) {
        toast({
          title: "Self-Learning Started",
          description: data.message || "Aurora is now learning autonomously",
        });
      }
    },
    onError: (error: any) => {
      // Only show error for actual failures
      toast({
        title: "Failed to Start",
        description: error.message,
        variant: "destructive",
      });
    },
  });

  // Stop mutation
  const stopMutation = useMutation({
    mutationFn: async () => {
      // Set BOTH ref and state immediately to prevent race conditions
      manualStopRef.current = true;
      setManualStop(true);
      updateSetting("autoStart", false);

      const response = await apiRequest("POST", "/api/self-learning/stop", {});
      return response.json();
    },
    onSuccess: (data) => {
      toast({
        title: "Self-Learning Stopped",
        description: data.message || "Aurora has stopped learning",
      });
      queryClient.invalidateQueries({ queryKey: ["/api/self-learning/status"] });
      // Flags already set in mutationFn
    },
    onError: (error: any) => {
      // If stop failed, revert the flags
      manualStopRef.current = false;
      setManualStop(false);
      updateSetting("autoStart", true);

      toast({
        title: "Failed to Stop",
        description: error.message,
        variant: "destructive",
      });
    },
  });

  const handleStart = () => {
    // Update auto-start setting immediately when user clicks start/resume
    manualStopRef.current = false;
    setSettings((prev) => ({ ...prev, autoStart: true }));
    startMutation.mutate();
  };
  const handleStop = () => stopMutation.mutate();

  const updateSetting = <K extends keyof LearningSettings>(
    key: K,
    value: LearningSettings[K]
  ) => {
    setSettings((prev) => ({ ...prev, [key]: value }));
  };

  return (
    <div className="h-full overflow-auto">
      <div className="p-6">
        <motion.div
          initial={{ opacity: 0, y: -20 }}
          animate={{ opacity: 1, y: 0 }}
          className="mb-8"
        >
          <div className="flex items-center justify-between">
            <div>
              <h1 className="text-4xl font-bold mb-2 bg-gradient-to-r from-primary via-cyan-500 to-purple-500 bg-clip-text text-transparent">
                Self-Learning Monitor
              </h1>
              <p className="text-muted-foreground flex items-center gap-2">
                <Activity className="h-4 w-4 text-primary animate-pulse" />
                Autonomous learning and improvement
              </p>
            </div>
          </div>
        </motion.div>

        {/* Settings Card */}
        <Card className="mb-6 border-primary/10">
          <CardHeader>
            <div className="flex items-center justify-between">
              <div className="flex items-center gap-2">
                <Settings className="h-5 w-5 text-primary" />
                <CardTitle className="text-lg">Learning Settings</CardTitle>
              </div>
              <Button
                variant="ghost"
                size="sm"
                onClick={() => setShowSettings(!showSettings)}
              >
                {showSettings ? "Hide" : "Show"}
              </Button>
            </div>
          </CardHeader>
          {showSettings && (
            <CardContent className="space-y-6">
              {/* Auto-Start */}
              <div className="flex items-center justify-between">
                <div className="space-y-0.5">
                  <Label className="text-base">Auto-Start Learning</Label>
                  <p className="text-sm text-muted-foreground">
                    Automatically start Aurora when the page loads
                  </p>
                </div>
                <Switch
                  checked={settings.autoStart}
                  onCheckedChange={(checked) => {
                    updateSetting("autoStart", checked);
                    // Clear manual stop flag when user changes auto-start setting
                    if (checked) {
                      manualStopRef.current = false;
                      setManualStop(false);
                    }
                  }}
                />
              </div>

              <Separator />

              {/* Sleep Interval */}
              <div className="space-y-2">
                <Label className="flex items-center gap-2">
                  <Clock className="h-4 w-4" />
                  Sleep Interval (seconds)
                </Label>
                <Input
                  type="number"
                  min="5"
                  max="3600"
                  value={settings.sleepInterval}
                  onChange={(e) => updateSetting("sleepInterval", parseInt(e.target.value) || 15)}
                  className="max-w-xs"
                />
                <p className="text-xs text-muted-foreground">
                  Time between learning runs (minimum 5 seconds)
                </p>
              </div>

              <Separator />

              {/* Wake/Sleep Schedule */}
              <div className="space-y-4">
                <div className="flex items-center justify-between">
                  <div className="space-y-0.5">
                    <Label className="text-base">Enable Sleep Schedule</Label>
                    <p className="text-sm text-muted-foreground">
                      Aurora will only run during specified hours
                    </p>
                  </div>
                  <Switch
                    checked={settings.enableSchedule}
                    onCheckedChange={(checked) => updateSetting("enableSchedule", checked)}
                  />
                </div>

                {settings.enableSchedule && (
                  <div className="grid grid-cols-2 gap-4 pl-4 border-l-2 border-primary/20">
                    <div className="space-y-2">
                      <Label className="flex items-center gap-2">
                        <Sun className="h-4 w-4 text-yellow-500" />
                        Wake Time
                      </Label>
                      <Input
                        type="time"
                        value={settings.wakeTime}
                        onChange={(e) => updateSetting("wakeTime", e.target.value)}
                      />
                    </div>
                    <div className="space-y-2">
                      <Label className="flex items-center gap-2">
                        <Moon className="h-4 w-4 text-purple-500" />
                        Sleep Time
                      </Label>
                      <Input
                        type="time"
                        value={settings.sleepTime}
                        onChange={(e) => updateSetting("sleepTime", e.target.value)}
                      />
                    </div>
                  </div>
                )}
              </div>

              {/* Current Status */}
              {settings.enableSchedule && (
                <div className="p-3 rounded-lg bg-secondary/30 text-sm">
                  <p className="text-muted-foreground">
                    <strong>Active Hours:</strong> {settings.wakeTime} - {settings.sleepTime}
                  </p>
                  {(() => {
                    const now = new Date();
                    const currentTime = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
                    const isActive = currentTime >= settings.wakeTime && currentTime < settings.sleepTime;
                    return (
                      <p className="mt-1">
                        <strong>Status:</strong>{" "}
                        <Badge variant={isActive ? "default" : "secondary"} className="ml-1">
                          {isActive ? "Active Period" : "Sleep Period"}
                        </Badge>
                      </p>
                    );
                  })()}
                </div>
              )}
            </CardContent>
          )}
        </Card>

        {/* Status Card */}
        <Card className="mb-6 border-primary/20 bg-gradient-to-br from-primary/10 via-background to-cyan-500/5">
          <CardHeader>
            <div className="flex items-center justify-between">
              <div className="flex items-center gap-3">
                <div className="p-2 rounded-lg bg-primary/10">
                  <Zap className="h-6 w-6 text-primary" />
                </div>
                <div>
                  <CardTitle className="text-xl">Learning Status</CardTitle>
                  <CardDescription className="flex flex-col gap-1">
                    <span>Current state of the self-learning daemon</span>
                  </CardDescription>
                </div>
              </div>
              <div className="flex items-center gap-2">
                {isLoading ? (
                  <Badge variant="outline">
                    <RefreshCw className="h-3 w-3 mr-1 animate-spin" />
                    Checking...
                  </Badge>
                ) : status?.running ? (
                  <Badge className="bg-green-500/10 text-green-600 border-green-500/20">
                    <Activity className="h-3 w-3 mr-1 animate-pulse" />
                    Running
                  </Badge>
                ) : (
                  <Badge variant="secondary">
                    <Square className="h-3 w-3 mr-1" />
                    Stopped
                  </Badge>
                )}
              </div>
            </div>
          </CardHeader>
          <CardContent>
            <div className="flex gap-3">
              <Button
                onClick={handleStart}
                disabled={status?.running || startMutation.isPending}
                className="flex-1"
              >
                {startMutation.isPending ? 'Starting...' : (manualStop ? 'Resume Learning' : (status?.running ? 'Running...' : 'Start Learning'))}
              </Button>
              <Button
                onClick={handleStop}
                disabled={!status?.running || stopMutation.isPending}
                variant="outline"
                className="flex-1"
              >
                {stopMutation.isPending ? (
                  <>
                    <RefreshCw className="mr-2 h-4 w-4 animate-spin" />
                    Stopping...
                  </>
                ) : (
                  <>
                    <Square className="mr-2 h-4 w-4" />
                    Stop Learning
                  </>
                )}
              </Button>
            </div>
            {status?.message && (
              <p className="mt-4 text-sm text-muted-foreground">{status.message}</p>
            )}
            {status?.stats && status.running && (
              <div className="mt-4 p-3 rounded-lg bg-secondary/30 space-y-2">
                <div className="flex justify-between text-sm">
                  <span className="text-muted-foreground">Started:</span>
                  <span className="font-mono">{new Date(status.stats.started_at || '').toLocaleTimeString()}</span>
                </div>
                <div className="flex justify-between text-sm">
                  <span className="text-muted-foreground">Last Activity:</span>
                  <span className="font-mono">{status.stats.last_activity ? new Date(status.stats.last_activity).toLocaleTimeString() : 'N/A'}</span>
                </div>
                <div className="flex justify-between text-sm">
                  <span className="text-muted-foreground">Runs Completed:</span>
                  <span className="font-mono font-bold text-primary">{status.stats.run_count}</span>
                </div>
              </div>
            )}
          </CardContent>
        </Card>

        {/* Recent Learning Activity */}
        <Card className="border-primary/10">
          <CardHeader>
            <div className="flex items-center gap-2">
              <Database className="h-5 w-5 text-primary" />
              <CardTitle className="text-lg">Recent Learning Activity</CardTitle>
            </div>
            <CardDescription>
              Latest synthesis runs from the self-learning daemon
            </CardDescription>
          </CardHeader>
          <CardContent>
            {recentRuns?.runs && recentRuns.runs.length > 0 ? (
              <div className="space-y-3">
                {recentRuns.runs.map((run: RecentRun) => (
                  <div
                    key={run.run_id}
                    className="flex items-center justify-between p-3 rounded-lg bg-secondary/50 hover:bg-secondary/70 transition-colors"
                  >
                    <div>
                      <code className="text-sm font-mono font-semibold">
                        {run.run_id}
                      </code>
                      <p className="text-xs text-muted-foreground mt-1">
                        {new Date(run.timestamp).toLocaleString()}
                      </p>
                    </div>
                    <div className="flex items-center gap-2">
                      <Badge variant={run.score === 1 ? "default" : "secondary"}>
                        {run.passed}/{run.total}
                      </Badge>
                      <Badge variant="outline">
                        Score: {run.score.toFixed(4)}
                      </Badge>
                    </div>
                  </div>
                ))}
              </div>
            ) : (
              <div className="text-center py-8 text-muted-foreground">
                No learning activity yet. Start the self-learning daemon to begin.
              </div>
            )}
          </CardContent>
        </Card>
      </div>
    </div>
  );
}
--------------------------------------------------------------------------------
FILE: client/src/pages/server-control-new.tsx
LINES: 574
--------------------------------------------------------------------------------
import { ErrorBoundary } from '@/components/error-boundary';
import { useEffect, useState } from 'react';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import {
    DropdownMenu,
    DropdownMenuContent,
    DropdownMenuItem,
    DropdownMenuSeparator,
    DropdownMenuTrigger,
} from "@/components/ui/dropdown-menu";
import {
    AlertDialog,
    AlertDialogAction,
    AlertDialogCancel,
    AlertDialogContent,
    AlertDialogDescription,
    AlertDialogFooter,
    AlertDialogHeader,
    AlertDialogTitle,
} from "@/components/ui/alert-dialog";
import { RefreshCw, Power, RotateCw, Square, ExternalLink, Zap, ChevronDown, AlertTriangle, Shield, Clock, Activity, TrendingUp } from "lucide-react";
import { useToast } from "@/hooks/use-toast";
import { motion } from "framer-motion";
import { Link } from "wouter";

interface Service {
    name: string;
    status: string;
    port: number;
    restart_count: number;
    uptime_seconds: number;
    health_status: string;
    paused?: boolean;
}

interface ServicesData {
    timestamp: string;
    services: Record<string, Service>;
}

type ShutdownType = 'graceful' | 'emergency' | 'scheduled';

export default function ServerControl() {
    const [services, setServices] = useState<ServicesData | null>(null);
    const [loading, setLoading] = useState(true);
    const [shutdownDialogOpen, setShutdownDialogOpen] = useState(false);
    const [shutdownType, setShutdownType] = useState<ShutdownType>('graceful');
    const { toast } = useToast();

    const fetchStatus = async () => {
        try {
            const res = await fetch('/api/status');
            const data = await res.json();
            setServices(data);
            setLoading(false);
        } catch (error) {
            console.error('Failed to fetch service status:', error);
            setLoading(false);
        }
    };

    useEffect(() => {
        fetchStatus();
        const interval = setInterval(fetchStatus, 5000);
        return () => clearInterval(interval);
    }, []);

    // Keyboard shortcuts
    useEffect(() => {
        const handleKeyPress = (e: KeyboardEvent) => {
            if (e.ctrlKey && e.shiftKey) {
                if (e.key === 'S') {
                    e.preventDefault();
                    startAllServices();
                } else if (e.key === 'Q') {
                    e.preventDefault();
                    setShutdownType('graceful');
                    setShutdownDialogOpen(true);
                } else if (e.key === 'E') {
                    e.preventDefault();
                    setShutdownType('emergency');
                    setShutdownDialogOpen(true);
                }
            }
        };

        window.addEventListener('keydown', handleKeyPress);
        return () => window.removeEventListener('keydown', handleKeyPress);
    }, []);

    const controlService = async (service: string, action: string) => {
        try {
            await fetch('/api/control', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ service, action })
            });

            toast({
                title: "Action Sent",
                description: `${action} command sent to ${service}`,
            });

            setTimeout(fetchStatus, 2000);
        } catch (error) {
            toast({
                title: "Error",
                description: `Failed to ${action} ${service}`,
                variant: "destructive"
            });
        }
    };

    const startAllServices = async () => {
        if (!services) return;

        toast({
            title: "Starting All Services",
            description: "Launching all Aurora services...",
        });

        for (const serviceName of Object.keys(services.services)) {
            await controlService(serviceName, 'start');
        }
    };

    const stopAllServices = async (type: ShutdownType) => {
        if (!services) return;

        const descriptions = {
            graceful: "Services will shutdown cleanly after saving all state",
            emergency: "Immediate shutdown - Use only in emergencies",
            scheduled: "Services will shutdown in 30 seconds"
        };

        toast({
            title: `${type.charAt(0).toUpperCase() + type.slice(1)} Shutdown Initiated`,
            description: descriptions[type],
        });

        if (type === 'scheduled') {
            await new Promise(resolve => setTimeout(resolve, 30000));
        }

        for (const serviceName of Object.keys(services.services)) {
            await controlService(serviceName, 'stop');
        }

        toast({
            title: "Shutdown Complete",
            description: "All services stopped successfully",
        });
    };

    const restartAllServices = async () => {
        if (!services) return;

        toast({
            title: "Restarting All Services",
            description: "Bouncing all Aurora services...",
        });

        for (const serviceName of Object.keys(services.services)) {
            await controlService(serviceName, 'restart');
        }
    };

    const getStatusColor = (status: string) => {
        switch (status.toLowerCase()) {
            case 'running':
                return 'bg-green-500';
            case 'stopped':
            case 'paused':
                return 'bg-red-500';
            case 'starting':
                return 'bg-yellow-500';
            default:
                return 'bg-gray-500';
        }
    };

    const getStatusBadge = (status: string) => {
        const color = getStatusColor(status);
        return (
            <Badge className={`${color} text-white`}>
                {status}
            </Badge>
        );
    };

    const formatUptime = (seconds: number) => {
        if (seconds < 60) return `${seconds}s`;
        if (seconds < 3600) return `${Math.floor(seconds / 60)}m`;
        const hours = Math.floor(seconds / 3600);
        const mins = Math.floor((seconds % 3600) / 60);
        return `${hours}h ${mins}m`;
    };

    if (loading) {
        return (
            <div className="flex items-center justify-center h-screen bg-gradient-to-br from-background via-background to-primary/5">
                <div className="text-center space-y-4">
                    <RefreshCw className="animate-spin h-12 w-12 mx-auto text-primary" />
                    <p className="text-muted-foreground">Loading Aurora Control Center...</p>
                </div>
            </div>
        );
    }

    const allServicesRunning = services && Object.values(services.services).every(s => s.status === 'running');
    const anyServiceRunning = services && Object.values(services.services).some(s => s.status === 'running');
    const runningCount = services ? Object.values(services.services).filter(s => s.status === 'running').length : 0;
    const totalCount = services ? Object.values(services.services).length : 0;

    return (
        <div className="h-full overflow-auto bg-gradient-to-br from-background via-background to-primary/5">
            <div className="container mx-auto p-6 space-y-8 max-w-7xl">
                {/* Aurora's Quantum Background */}
                <div className="fixed inset-0 -z-10 overflow-hidden pointer-events-none">
                    <div className="absolute inset-0 bg-gradient-to-br from-slate-950 via-cyan-950/20 to-purple-950/20" />

                    {/* Particle field */}
                    <div className="absolute inset-0 opacity-20" style={{
                        backgroundImage: 'radial-gradient(circle, rgba(6, 182, 212, 0.3) 1px, transparent 1px)',
                        backgroundSize: '50px 50px',
                        animation: 'particleFloat 20s linear infinite'
                    }} />

                    {/* Neural network grid */}
                    <svg className="absolute inset-0 w-full h-full opacity-10">
                        <defs>
                            <linearGradient id="grid-server-control-new" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" stopColor="#06b6d4" stopOpacity="0.5" />
                                <stop offset="100%" stopColor="#a855f7" stopOpacity="0.5" />
                            </linearGradient>
                        </defs>
                        <pattern id="grid-pattern-server-control-new" width="50" height="50" patternUnits="userSpaceOnUse">
                            <circle cx="25" cy="25" r="1" fill="url(#grid-server-control-new)" />
                        </pattern>
                        <rect width="100%" height="100%" fill="url(#grid-pattern-server-control-new)" />
                    </svg>

                    {/* Holographic orbs */}
                    <div className="absolute top-20 left-1/4 w-64 h-64 bg-cyan-500/10 rounded-full blur-3xl animate-pulse" />
                    <div className="absolute bottom-20 right-1/4 w-96 h-96 bg-purple-500/10 rounded-full blur-3xl animate-pulse" style={{ animationDelay: '2s' }} />
                </div>


                {/* Hero Header */}
                <motion.div
                    initial={{ opacity: 0, y: -20 }}
                    animate={{ opacity: 1, y: 0 }}
                    className="text-center space-y-3 pt-6"
                >
                    <h1 className="text-5xl font-bold bg-gradient-to-r from-primary via-cyan-500 to-purple-500 bg-clip-text text-transparent">
                        Aurora Control Center
                    </h1>
                    <p className="text-muted-foreground text-lg">
                        Manage all Aurora services from one powerful interface
                    </p>
                    <div className="flex items-center justify-center gap-3 text-sm">
                        <Badge variant={anyServiceRunning ? "default" : "secondary"} className="gap-2">
                            <div className={`h-2 w-2 rounded-full ${anyServiceRunning ? 'bg-green-400 animate-pulse' : 'bg-gray-400'}`} />
                            {runningCount}/{totalCount} Services Active
                        </Badge>
                        <Badge variant="outline" className="gap-2">
                            <Clock className="h-3 w-3" />
                            Last updated: {new Date().toLocaleTimeString()}
                        </Badge>
                    </div>
                </motion.div>

                {/* Hero Power Button */}
                <motion.div
                    initial={{ opacity: 0, scale: 0.95 }}
                    animate={{ opacity: 1, scale: 1 }}
                    transition={{ delay: 0.1 }}
                    className="relative"
                >
                    <div className="absolute inset-0 bg-gradient-to-r from-primary/20 via-cyan-500/20 to-purple-500/20 blur-3xl -z-10" />

                    <Card className="border-2 border-primary/30 shadow-2xl">
                        <CardContent className="p-8">
                            {!anyServiceRunning ? (
                                // START ALL - Big Hero Button
                                <Button
                                    onClick={startAllServices}
                                    size="lg"
                                    className="w-full h-24 text-3xl font-bold bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 shadow-lg hover:shadow-xl transition-all gap-4"
                                >
                                    <Zap className="h-10 w-10" />
                                    START ALL SERVERS
                                </Button>
                            ) : (
                                // Context-Aware Control Panel
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <Button
                                        onClick={startAllServices}
                                        disabled={allServicesRunning || false}
                                        size="lg"
                                        variant={allServicesRunning ? "secondary" : "default"}
                                        className="h-16 text-lg font-semibold gap-3"
                                    >
                                        <Zap className="h-6 w-6" />
                                        {allServicesRunning ? 'All Running' : 'Start All'}
                                    </Button>

                                    <Button
                                        onClick={restartAllServices}
                                        size="lg"
                                        variant="outline"
                                        className="h-16 text-lg font-semibold gap-3 border-2"
                                    >
                                        <RotateCw className="h-6 w-6" />
                                        Restart All
                                    </Button>

                                    <DropdownMenu>
                                        <DropdownMenuTrigger asChild>
                                            <Button
                                                size="lg"
                                                variant="destructive"
                                                className="h-16 text-lg font-semibold gap-3"
                                            >
                                                <Square className="h-6 w-6" />
                                                Shutdown
                                                <ChevronDown className="h-5 w-5 ml-auto" />
                                            </Button>
                                        </DropdownMenuTrigger>
                                        <DropdownMenuContent align="end" className="w-64">
                                            <DropdownMenuItem
                                                onClick={() => {
                                                    setShutdownType('graceful');
                                                    setShutdownDialogOpen(true);
                                                }}
                                                className="py-3 cursor-pointer"
                                            >
                                                <Shield className="mr-3 h-5 w-5 text-blue-500" />
                                                <div>
                                                    <div className="font-semibold">Graceful Shutdown</div>
                                                    <div className="text-xs text-muted-foreground">Save state & diagnostics</div>
                                                </div>
                                            </DropdownMenuItem>

                                            <DropdownMenuItem
                                                onClick={() => {
                                                    setShutdownType('scheduled');
                                                    setShutdownDialogOpen(true);
                                                }}
                                                className="py-3 cursor-pointer"
                                            >
                                                <Clock className="mr-3 h-5 w-5 text-yellow-500" />
                                                <div>
                                                    <div className="font-semibold">Scheduled Shutdown</div>
                                                    <div className="text-xs text-muted-foreground">Shutdown in 30 seconds</div>
                                                </div>
                                            </DropdownMenuItem>

                                            <DropdownMenuSeparator />

                                            <DropdownMenuItem
                                                onClick={() => {
                                                    setShutdownType('emergency');
                                                    setShutdownDialogOpen(true);
                                                }}
                                                className="py-3 cursor-pointer text-red-500"
                                            >
                                                <AlertTriangle className="mr-3 h-5 w-5" />
                                                <div>
                                                    <div className="font-semibold">Emergency Shutdown</div>
                                                    <div className="text-xs text-muted-foreground">Immediate stop</div>
                                                </div>
                                            </DropdownMenuItem>
                                        </DropdownMenuContent>
                                    </DropdownMenu>
                                </div>
                            )}

                            {/* Keyboard Shortcuts Hint */}
                            <div className="mt-4 pt-4 border-t border-border">
                                <p className="text-xs text-muted-foreground text-center font-mono">
                                    Shortcuts: Ctrl+Shift+S (Start) • Ctrl+Shift+Q (Graceful) • Ctrl+Shift+E (Emergency)
                                </p>
                            </div>
                        </CardContent>
                    </Card>
                </motion.div>

                {/* Quick Access Links */}
                <motion.div
                    initial={{ opacity: 0 }}
                    animate={{ opacity: 1 }}
                    transition={{ delay: 0.2 }}
                    className="flex justify-center gap-4"
                >
                    <Link to="/luminar">
                        <Button variant="outline" className="gap-2">
                            <TrendingUp className="h-4 w-4" />
                            Luminar Nexus Analytics
                        </Button>
                    </Link>
                    <Button
                        onClick={() => window.open('/luminar', '_blank')}
                        variant="outline"
                        className="gap-2"
                    >
                        <ExternalLink className="h-4 w-4" />
                        Full Health Dashboard
                    </Button>
                    <Button
                        onClick={fetchStatus}
                        variant="ghost"
                        size="sm"
                        className="gap-2"
                    >
                        <RefreshCw className="h-4 w-4" />
                        Refresh
                    </Button>
                </motion.div>

                {/* Individual Service Cards - 2x2 Grid */}
                <motion.div
                    initial={{ opacity: 0, y: 20 }}
                    animate={{ opacity: 1, y: 0 }}
                    transition={{ delay: 0.3 }}
                >
                    <h2 className="text-2xl font-bold mb-4 flex items-center gap-2">
                        <Activity className="h-6 w-6 text-primary" />
                        Individual Services
                    </h2>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        {services && Object.values(services.services).map((service: Service, index) => (
                            <motion.div
                                key={service.name}
                                initial={{ opacity: 0, y: 20 }}
                                animate={{ opacity: 1, y: 0 }}
                                transition={{ delay: 0.4 + index * 0.1 }}
                            >
                                <Card className="relative hover:shadow-lg transition-shadow border-primary/20">
                                    <CardHeader>
                                        <div className="flex justify-between items-start">
                                            <div>
                                                <CardTitle className="text-xl">{service.name}</CardTitle>
                                                <CardDescription>Port {service.port}</CardDescription>
                                            </div>
                                            <div className="absolute top-4 right-4">
                                                <div className={`h-3 w-3 rounded-full ${getStatusColor(service.status)} ${service.status === 'running' ? 'animate-pulse' : ''}`} />
                                            </div>
                                        </div>
                                    </CardHeader>
                                    <CardContent className="space-y-4">
                                        <div className="flex justify-between items-center">
                                            <span className="text-sm text-muted-foreground">Status</span>
                                            {getStatusBadge(service.status)}
                                        </div>

                                        {service.uptime_seconds > 0 && (
                                            <div className="flex justify-between items-center">
                                                <span className="text-sm text-muted-foreground">Uptime</span>
                                                <span className="text-sm font-mono font-semibold">
                                                    {formatUptime(service.uptime_seconds)}
                                                </span>
                                            </div>
                                        )}

                                        {service.restart_count > 0 && (
                                            <div className="flex justify-between items-center">
                                                <span className="text-sm text-muted-foreground">Restarts</span>
                                                <Badge variant="secondary">{service.restart_count}</Badge>
                                            </div>
                                        )}

                                        <div className="flex gap-2 pt-2">
                                            {service.status === 'running' ? (
                                                <>
                                                    <Button
                                                        size="sm"
                                                        variant="destructive"
                                                        className="flex-1"
                                                        onClick={() => controlService(service.name, 'stop')}
                                                    >
                                                        <Square className="mr-1 h-3 w-3" />
                                                        Stop
                                                    </Button>
                                                    <Button
                                                        size="sm"
                                                        variant="outline"
                                                        className="flex-1"
                                                        onClick={() => controlService(service.name, 'restart')}
                                                    >
                                                        <RotateCw className="mr-1 h-3 w-3" />
                                                        Restart
                                                    </Button>
                                                </>
                                            ) : (
                                                <Button
                                                    size="sm"
                                                    className="flex-1"
                                                    onClick={() => controlService(service.name, 'start')}
                                                >
                                                    <Power className="mr-1 h-3 w-3" />
                                                    Start
                                                </Button>
                                            )}
                                        </div>
                                    </CardContent>
                                </Card>
                            </motion.div>
                        ))}
                    </div>
                </motion.div>

                {/* Shutdown Confirmation Dialog */}
                <AlertDialog open={shutdownDialogOpen} onOpenChange={setShutdownDialogOpen}>
                    <AlertDialogContent>
                        <AlertDialogHeader>
                            <AlertDialogTitle className="flex items-center gap-2">
                                {shutdownType === 'emergency' ? (
                                    <AlertTriangle className="h-5 w-5 text-red-500" />
                                ) : shutdownType === 'scheduled' ? (
                                    <Clock className="h-5 w-5 text-yellow-500" />
                                ) : (
                                    <Shield className="h-5 w-5 text-blue-500" />
                                )}
                                Confirm {shutdownType.charAt(0).toUpperCase() + shutdownType.slice(1)} Shutdown
                            </AlertDialogTitle>
                            <AlertDialogDescription>
                                {shutdownType === 'graceful' && (
                                    <>
                                        This will cleanly shutdown all services after:
                                        <ul className="list-disc ml-6 mt-2 space-y-1">
                                            <li>Saving all system state</li>
                                            <li>Running diagnostics</li>
                                            <li>Creating shutdown report</li>
                                        </ul>
                                        <p className="mt-2 font-semibold">All work will be saved.</p>
                                    </>
                                )}
                                {shutdownType === 'scheduled' && (
                                    <>
                                        Services will shutdown in 30 seconds. This gives time to:
                                        <ul className="list-disc ml-6 mt-2 space-y-1">
                                            <li>Complete ongoing operations</li>
                                            <li>Save state automatically</li>
                                            <li>Close connections gracefully</li>
                                        </ul>
                                    </>
                                )}
                                {shutdownType === 'emergency' && (
                                    <p className="text-red-500 font-semibold">
                                        ⚠️ This will immediately stop all services. Use only if services are unresponsive.
                                        State will be saved but operations may be interrupted.
                                    </p>
                                )}
                            </AlertDialogDescription>
                        </AlertDialogHeader>
                        <AlertDialogFooter>
                            <AlertDialogCancel>Cancel</AlertDialogCancel>
                            <AlertDialogAction
                                onClick={() => stopAllServices(shutdownType)}
                                className={shutdownType === 'emergency' ? 'bg-red-600 hover:bg-red-700' : ''}
                            >
                                Confirm Shutdown
                            </AlertDialogAction>
                        </AlertDialogFooter>
                    </AlertDialogContent>
                </AlertDialog>
            </div>
        </div>
    );
}

--------------------------------------------------------------------------------
FILE: client/src/pages/server-control.tsx
LINES: 236
--------------------------------------------------------------------------------
import { ErrorBoundary } from '@/components/error-boundary';
import { useEffect, useState } from 'react';
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuSeparator, DropdownMenuTrigger } from "@/components/ui/dropdown-menu";
import { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle } from "@/components/ui/alert-dialog";
import { Zap, Square, RotateCw, Power, ChevronDown, Shield, Clock, AlertTriangle, Activity } from "lucide-react";
import { useToast } from "@/hooks/use-toast";
import { motion } from "framer-motion";
import { Link } from "wouter";

interface Service {
    name: string;
    status: string;
    port: number;
    restart_count: number;
    uptime_seconds: number;
}

interface ServicesData {
    services: Record<string, Service>;
}

type ShutdownType = 'graceful' | 'emergency' | 'scheduled';

export default function ServerControl() {
    const [services, setServices] = useState<ServicesData | null>(null);
    const [loading, setLoading] = useState(true);
    const [shutdownDialogOpen, setShutdownDialogOpen] = useState(false);
    const [shutdownType, setShutdownType] = useState<ShutdownType>('graceful');
    const { toast } = useToast();

    useEffect(() => {
        fetchStatus();
        const interval = setInterval(fetchStatus, 5000);
        return () => clearInterval(interval);
    }, []);

    useEffect(() => {
        const handleKeyPress = (e: KeyboardEvent) => {
            if (e.ctrlKey && e.shiftKey) {
                if (e.key === 'S') { e.preventDefault(); startAllServices(); }
                else if (e.key === 'Q') { e.preventDefault(); setShutdownType('graceful'); setShutdownDialogOpen(true); }
                else if (e.key === 'E') { e.preventDefault(); setShutdownType('emergency'); setShutdownDialogOpen(true); }
            }
        };
        window.addEventListener('keydown', handleKeyPress);
        return () => window.removeEventListener('keydown', handleKeyPress);
    }, []);

    const fetchStatus = async () => {
        try {
            const res = await fetch('/api/status');
            const data = await res.json();
            setServices(data);
            setLoading(false);
        } catch (error) {
            setLoading(false);
        }
    };

    const controlService = async (service: string, action: string) => {
        try {
            await fetch('/api/control', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ service, action })
            });
            toast({ title: "Action Sent", description: `${action} command sent to ${service}` });
            setTimeout(fetchStatus, 2000);
        } catch (error) {
            toast({ title: "Error", description: `Failed to ${action} ${service}`, variant: "destructive" });
        }
    };

    const startAllServices = async () => {
        if (!services) return;
        toast({ title: "Starting All Services", description: "Launching all Aurora services..." });
        for (const serviceName of Object.keys(services.services)) {
            await controlService(serviceName, 'start');
        }
    };

    const stopAllServices = async (type: ShutdownType) => {
        if (!services) return;
        const descriptions = {
            graceful: "Services will shutdown cleanly after saving all state",
            emergency: "Immediate shutdown - Use only in emergencies",
            scheduled: "Services will shutdown in 30 seconds"
        };
        toast({ title: `${type.charAt(0).toUpperCase() + type.slice(1)} Shutdown Initiated`, description: descriptions[type] });
        if (type === 'scheduled') await new Promise(resolve => setTimeout(resolve, 30000));
        for (const serviceName of Object.keys(services.services)) {
            await controlService(serviceName, 'stop');
        }
    };

    const restartAllServices = async () => {
        if (!services) return;
        toast({ title: "Restarting All Services", description: "Bouncing all Aurora services..." });
        for (const serviceName of Object.keys(services.services)) {
            await controlService(serviceName, 'restart');
        }
    };

    if (loading) {
        return <div className="flex items-center justify-center h-screen"><Activity className="animate-spin h-12 w-12 text-primary" /></div>;
    }

    const allRunning = services && Object.values(services.services).every(s => s.status === 'running');
    const anyRunning = services && Object.values(services.services).some(s => s.status === 'running');
    const runningCount = services ? Object.values(services.services).filter(s => s.status === 'running').length : 0;
    const totalCount = services ? Object.values(services.services).length : 0;

    return (
        <div className="h-full overflow-auto bg-gradient-to-br from-background via-background to-primary/5">
            <div className="container mx-auto p-6 space-y-8 max-w-7xl">
                <motion.div initial={{ opacity: 0, y: -20 }} animate={{ opacity: 1, y: 0 }} className="text-center space-y-3 pt-6">
                    <h1 className="text-5xl font-bold bg-gradient-to-r from-primary via-emerald-500 to-sky-500 bg-clip-text text-transparent">
                        Aurora Control Center
                    </h1>
                    <p className="text-muted-foreground text-lg">Manage all Aurora services from one powerful interface</p>
                    <Badge variant={anyRunning ? "default" : "secondary"} className="gap-2">
                        <div className={`h-2 w-2 rounded-full ${anyRunning ? 'bg-green-400 animate-pulse' : 'bg-gray-400'}`} />
                        {runningCount}/{totalCount} Services Active
                    </Badge>
                </motion.div>

                <motion.div initial={{ opacity: 0, scale: 0.95 }} animate={{ opacity: 1, scale: 1 }} transition={{ delay: 0.1 }} className="relative">
                    <Card className="border-2 border-primary/30 shadow-2xl">
                        <CardContent className="p-8">
                            {!anyRunning ? (
                                <Button onClick={startAllServices} size="lg" className="w-full h-24 text-3xl font-bold bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 gap-4">
                                    <Zap className="h-10 w-10" /> START ALL SERVERS
                                </Button>
                            ) : (
                                <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                                    <Button onClick={startAllServices} disabled={allRunning || false} size="lg" variant={allRunning ? "secondary" : "default"} className="h-16 text-lg font-semibold gap-3">
                                        <Zap className="h-6 w-6" /> {allRunning ? 'All Running' : 'Start All'}
                                    </Button>
                                    <Button onClick={restartAllServices} size="lg" variant="outline" className="h-16 text-lg font-semibold gap-3 border-2">
                                        <RotateCw className="h-6 w-6" /> Restart All
                                    </Button>
                                    <Link to="/luminar">
                                        <Button size="lg" variant="outline" className="h-16 text-lg font-semibold gap-3 border-2 w-full">
                                            <Activity className="h-6 w-6" /> View All
                                        </Button>
                                    </Link>
                                    <DropdownMenu>
                                        <DropdownMenuTrigger asChild>
                                            <Button size="lg" variant="destructive" className="h-16 text-lg font-semibold gap-3">
                                                <Square className="h-6 w-6" /> Shutdown <ChevronDown className="h-5 w-5 ml-auto" />
                                            </Button>
                                        </DropdownMenuTrigger>
                                        <DropdownMenuContent align="end" className="w-64">
                                            <DropdownMenuItem onClick={() => { setShutdownType('graceful'); setShutdownDialogOpen(true); }} className="py-3 cursor-pointer">
                                                <Shield className="mr-3 h-5 w-5 text-blue-500" />
                                                <div><div className="font-semibold">Graceful Shutdown</div><div className="text-xs text-muted-foreground">Save state & diagnostics</div></div>
                                            </DropdownMenuItem>
                                            <DropdownMenuItem onClick={() => { setShutdownType('scheduled'); setShutdownDialogOpen(true); }} className="py-3 cursor-pointer">
                                                <Clock className="mr-3 h-5 w-5 text-yellow-500" />
                                                <div><div className="font-semibold">Scheduled Shutdown</div><div className="text-xs text-muted-foreground">Shutdown in 30 seconds</div></div>
                                            </DropdownMenuItem>
                                            <DropdownMenuSeparator />
                                            <DropdownMenuItem onClick={() => { setShutdownType('emergency'); setShutdownDialogOpen(true); }} className="py-3 cursor-pointer text-red-500">
                                                <AlertTriangle className="mr-3 h-5 w-5" />
                                                <div><div className="font-semibold">Emergency Shutdown</div><div className="text-xs text-muted-foreground">Immediate stop</div></div>
                                            </DropdownMenuItem>
                                        </DropdownMenuContent>
                                    </DropdownMenu>
                                </div>
                            )}
                            <div className="mt-4 pt-4 border-t border-border">
                                <p className="text-xs text-muted-foreground text-center font-mono">
                                    Shortcuts: Ctrl+Shift+S (Start) • Ctrl+Shift+Q (Graceful) • Ctrl+Shift+E (Emergency)
                                </p>
                            </div>
                        </CardContent>
                    </Card>
                </motion.div>

                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    {services && Object.values(services.services).map((service: Service) => (
                        <Card key={service.name} className="hover:shadow-lg transition-shadow">
                            <CardHeader>
                                <CardTitle className="flex justify-between">
                                    {service.name}
                                    <Badge className={service.status === 'running' ? 'bg-green-500' : 'bg-red-500'}>
                                        {service.status}
                                    </Badge>
                                </CardTitle>
                            </CardHeader>
                            <CardContent className="space-y-3">
                                <div className="text-sm"><span className="text-muted-foreground">Port:</span> {service.port}</div>
                                {service.uptime_seconds > 0 && <div className="text-sm"><span className="text-muted-foreground">Uptime:</span> {Math.floor(service.uptime_seconds / 60)}m</div>}
                                <div className="flex gap-2">
                                    {service.status === 'running' ? (
                                        <>
                                            <Button size="sm" variant="destructive" className="flex-1" onClick={() => controlService(service.name, 'stop')}>
                                                <Square className="mr-1 h-3 w-3" /> Stop
                                            </Button>
                                            <Button size="sm" variant="outline" className="flex-1" onClick={() => controlService(service.name, 'restart')}>
                                                <RotateCw className="mr-1 h-3 w-3" /> Restart
                                            </Button>
                                        </>
                                    ) : (
                                        <Button size="sm" className="flex-1" onClick={() => controlService(service.name, 'start')}>
                                            <Power className="mr-1 h-3 w-3" /> Start
                                        </Button>
                                    )}
                                </div>
                            </CardContent>
                        </Card>
                    ))}
                </div>

                <AlertDialog open={shutdownDialogOpen} onOpenChange={setShutdownDialogOpen}>
                    <AlertDialogContent>
                        <AlertDialogHeader>
                            <AlertDialogTitle>Confirm {shutdownType.charAt(0).toUpperCase() + shutdownType.slice(1)} Shutdown</AlertDialogTitle>
                            <AlertDialogDescription>
                                This will shutdown all services. Are you sure?
                            </AlertDialogDescription>
                        </AlertDialogHeader>
                        <AlertDialogFooter>
                            <AlertDialogCancel>Cancel</AlertDialogCancel>
                            <AlertDialogAction onClick={() => stopAllServices(shutdownType)} className={shutdownType === 'emergency' ? 'bg-red-600' : ''}>
                                Confirm
                            </AlertDialogAction>
                        </AlertDialogFooter>
                    </AlertDialogContent>
                </AlertDialog>
            </div>
        </div>
    );
}
--------------------------------------------------------------------------------
FILE: client/src/pages/settings.tsx
LINES: 639
--------------------------------------------------------------------------------
import { useState, useEffect } from 'react';
import { Card, CardContent, CardHeader, CardTitle, CardDescription } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { Switch } from "@/components/ui/switch";
import { ScrollArea } from "@/components/ui/scroll-area";
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs";
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
import { Slider } from "@/components/ui/slider";
import { Settings, RefreshCw, Palette, Brain, Zap, Bell, Shield, Server, Save, RotateCcw, Moon, Sun, Monitor, Key, Plus, Trash2, Lock, Eye, EyeOff } from "lucide-react";
import { motion } from "framer-motion";
import { useToast } from "@/hooks/use-toast";
import { useQuery, useMutation } from "@tanstack/react-query";
import { queryClient } from "@/lib/queryClient";

interface SettingsSection {
  id: string;
  label: string;
  icon: React.ReactNode;
}

function SecurityApiKeyManager() {
  const { toast } = useToast();
  const [adminKey, setAdminKey] = useState(() => localStorage.getItem("aurora_admin_key") || "");
  const [newAlias, setNewAlias] = useState("");
  const [newValue, setNewValue] = useState("");
  const [showValue, setShowValue] = useState(false);
  const [isAuthenticated, setIsAuthenticated] = useState(false);

  useEffect(() => {
    if (adminKey) {
      localStorage.setItem("aurora_admin_key", adminKey);
    }
  }, [adminKey]);

  const aliasesQuery = useQuery<{ ok: boolean; aliases: string[] }>({
    queryKey: ["/api/vault/aliases"],
    enabled: isAuthenticated,
    queryFn: async () => {
      const res = await fetch("/api/vault/aliases", {
        headers: { "x-api-key": adminKey }
      });
      if (!res.ok) throw new Error("Unauthorized");
      return res.json();
    }
  });

  const healthQuery = useQuery<{ ok: boolean; configured: boolean; hasMasterPassphrase: boolean; hasAdminKey: boolean }>({
    queryKey: ["/api/vault/health"]
  });

  const addSecretMutation = useMutation({
    mutationFn: async (data: { alias: string; value: string }) => {
      const res = await fetch("/api/vault/secrets", {
        method: "POST",
        headers: { 
          "Content-Type": "application/json",
          "x-api-key": adminKey 
        },
        body: JSON.stringify(data)
      });
      return res.json();
    },
    onSuccess: (data) => {
      if (data.ok) {
        toast({ title: "API Key Added", description: `${data.alias} stored securely in vault.` });
        setNewAlias("");
        setNewValue("");
        queryClient.invalidateQueries({ queryKey: ["/api/vault/aliases"] });
      } else {
        toast({ title: "Error", description: data.error || "Failed to add key", variant: "destructive" });
      }
    },
    onError: () => {
      toast({ title: "Error", description: "Failed to add API key", variant: "destructive" });
    }
  });

  const deleteSecretMutation = useMutation({
    mutationFn: async (alias: string) => {
      const res = await fetch(`/api/vault/secrets/${alias}`, {
        method: "DELETE",
        headers: { "x-api-key": adminKey }
      });
      return res.json();
    },
    onSuccess: (data) => {
      if (data.ok) {
        toast({ title: "API Key Deleted", description: `${data.alias} removed from vault.` });
        queryClient.invalidateQueries({ queryKey: ["/api/vault/aliases"] });
      } else {
        toast({ title: "Error", description: data.error || "Failed to delete key", variant: "destructive" });
      }
    },
    onError: () => {
      toast({ title: "Error", description: "Failed to delete API key", variant: "destructive" });
    }
  });

  const handleAuthenticate = () => {
    if (!adminKey.trim()) {
      toast({ title: "Admin Key Required", description: "Please enter your admin API key.", variant: "destructive" });
      return;
    }
    setIsAuthenticated(true);
  };

  const handleAddSecret = () => {
    if (!newAlias.trim() || !newValue.trim()) {
      toast({ title: "Missing Fields", description: "Please enter both alias and value.", variant: "destructive" });
      return;
    }
    addSecretMutation.mutate({ alias: newAlias.trim(), value: newValue.trim() });
  };

  return (
    <div className="grid gap-6">
      <Card className="border-red-500/30 bg-slate-900/50 backdrop-blur-xl">
        <CardHeader className="border-b border-red-500/20">
          <CardTitle className="text-lg text-red-300 flex items-center gap-2">
            <Shield className="w-5 h-5" />
            ASE-Infinity Vault - API Key Management
          </CardTitle>
          <CardDescription className="text-red-300/60">Securely store and manage API keys with 22-layer encryption</CardDescription>
        </CardHeader>
        <CardContent className="pt-4 space-y-4">
          <div className="p-4 bg-slate-800/50 rounded-lg border border-red-500/20">
            <div className="flex items-center gap-3 mb-2">
              <Lock className="w-5 h-5 text-green-400" />
              <span className="text-sm text-red-200 font-semibold">Vault Status</span>
            </div>
            <div className="flex items-center gap-2 flex-wrap">
              {healthQuery.data?.configured ? (
                <Badge variant="outline" className="bg-green-500/20 text-green-300 border-green-500/30">Configured</Badge>
              ) : (
                <Badge variant="outline" className="bg-yellow-500/20 text-yellow-300 border-yellow-500/30">Not Configured</Badge>
              )}
              {healthQuery.data?.hasMasterPassphrase && (
                <Badge variant="outline" className="bg-blue-500/20 text-blue-300 border-blue-500/30">Master Key Set</Badge>
              )}
              <span className="text-xs text-red-300/60">22-layer AES encryption active</span>
            </div>
          </div>

          {!isAuthenticated ? (
            <div className="p-4 bg-slate-800/50 rounded-lg border border-red-500/20">
              <Label className="text-red-200 mb-2 block">Admin API Key</Label>
              <div className="flex gap-2">
                <Input
                  type="password"
                  placeholder="Enter admin key to manage secrets"
                  value={adminKey}
                  onChange={(e) => setAdminKey(e.target.value)}
                  className="flex-1 bg-slate-700/50 border-red-500/30"
                  data-testid="input-admin-key"
                />
                <Button onClick={handleAuthenticate} className="bg-red-600 hover:bg-red-500" data-testid="button-authenticate">
                  <Key className="w-4 h-4 mr-2" />
                  Unlock
                </Button>
              </div>
            </div>
          ) : (
            <>
              <div className="p-4 bg-slate-800/50 rounded-lg border border-green-500/20">
                <Label className="text-green-200 mb-3 block flex items-center gap-2">
                  <Plus className="w-4 h-4" />
                  Add New API Key
                </Label>
                <div className="space-y-3">
                  <Input
                    placeholder="Alias (e.g., discord_webhook, openai_key)"
                    value={newAlias}
                    onChange={(e) => setNewAlias(e.target.value)}
                    className="bg-slate-700/50 border-green-500/30"
                    data-testid="input-new-alias"
                  />
                  <div className="relative">
                    <Input
                      type={showValue ? "text" : "password"}
                      placeholder="API Key / Secret Value"
                      value={newValue}
                      onChange={(e) => setNewValue(e.target.value)}
                      className="bg-slate-700/50 border-green-500/30 pr-10"
                      data-testid="input-new-value"
                    />
                    <Button
                      type="button"
                      variant="ghost"
                      size="icon"
                      className="absolute right-1 top-1/2 -translate-y-1/2 h-7 w-7"
                      onClick={() => setShowValue(!showValue)}
                    >
                      {showValue ? <EyeOff className="w-4 h-4" /> : <Eye className="w-4 h-4" />}
                    </Button>
                  </div>
                  <Button 
                    onClick={handleAddSecret} 
                    disabled={addSecretMutation.isPending}
                    className="w-full bg-green-600 hover:bg-green-500"
                    data-testid="button-add-secret"
                  >
                    {addSecretMutation.isPending ? (
                      <><RefreshCw className="w-4 h-4 mr-2 animate-spin" />Encrypting...</>
                    ) : (
                      <><Lock className="w-4 h-4 mr-2" />Store in Vault</>
                    )}
                  </Button>
                </div>
              </div>

              <div className="p-4 bg-slate-800/50 rounded-lg border border-emerald-500/20">
                <div className="flex items-center justify-between mb-3">
                  <Label className="text-emerald-200 flex items-center gap-2">
                    <Key className="w-4 h-4" />
                    Stored API Keys ({aliasesQuery.data?.aliases?.length || 0})
                  </Label>
                  <Button 
                    variant="ghost" 
                    size="sm" 
                    onClick={() => aliasesQuery.refetch()}
                    data-testid="button-refresh-keys"
                  >
                    <RefreshCw className={`w-4 h-4 ${aliasesQuery.isFetching ? 'animate-spin' : ''}`} />
                  </Button>
                </div>
                <div className="space-y-2 max-h-60 overflow-y-auto">
                  {aliasesQuery.isLoading ? (
                    <div className="text-center py-4 text-emerald-300/60">Loading...</div>
                  ) : aliasesQuery.data?.aliases?.length === 0 ? (
                    <div className="text-center py-4 text-emerald-300/60">No API keys stored yet</div>
                  ) : (
                    aliasesQuery.data?.aliases?.map((alias, i) => (
                      <div key={alias} className="flex items-center justify-between p-2 bg-slate-700/30 rounded" data-testid={`row-key-${i}`}>
                        <div className="flex items-center gap-2">
                          <Lock className="w-4 h-4 text-emerald-400" />
                          <span className="text-sm text-emerald-200 font-mono">{alias}</span>
                        </div>
                        <Button
                          variant="ghost"
                          size="icon"
                          className="h-7 w-7 text-red-400 hover:text-red-300 hover:bg-red-500/20"
                          onClick={() => deleteSecretMutation.mutate(alias)}
                          disabled={deleteSecretMutation.isPending}
                          data-testid={`button-delete-${i}`}
                        >
                          <Trash2 className="w-4 h-4" />
                        </Button>
                      </div>
                    ))
                  )}
                </div>
              </div>
            </>
          )}
        </CardContent>
      </Card>
    </div>
  );
}

export default function SettingsPage() {
  const { toast } = useToast();
  const [activeTab, setActiveTab] = useState('appearance');
  const [theme, setTheme] = useState('dark');
  const [accentColor, setAccentColor] = useState('emerald');
  const [animationsEnabled, setAnimationsEnabled] = useState(true);
  const [autoSaveEnabled, setAutoSaveEnabled] = useState(true);
  const [notificationsEnabled, setNotificationsEnabled] = useState(true);
  const [soundEnabled, setSoundEnabled] = useState(false);
  const [learningRate, setLearningRate] = useState([75]);
  const [memoryRetention, setMemoryRetention] = useState([85]);
  const [autonomousMode, setAutonomousMode] = useState(true);
  const [debugMode, setDebugMode] = useState(false);
  const [apiTimeout, setApiTimeout] = useState('30');
  const [maxWorkers, setMaxWorkers] = useState('300');

  const sections: SettingsSection[] = [
    { id: 'appearance', label: 'Appearance', icon: <Palette className="w-4 h-4" /> },
    { id: 'ai', label: 'AI Settings', icon: <Brain className="w-4 h-4" /> },
    { id: 'performance', label: 'Performance', icon: <Zap className="w-4 h-4" /> },
    { id: 'notifications', label: 'Notifications', icon: <Bell className="w-4 h-4" /> },
    { id: 'security', label: 'Security', icon: <Shield className="w-4 h-4" /> },
    { id: 'advanced', label: 'Advanced', icon: <Server className="w-4 h-4" /> },
  ];

  const handleSave = () => {
    toast({
      title: "Settings Saved",
      description: "Your preferences have been updated successfully.",
    });
  };

  const handleReset = () => {
    setTheme('dark');
    setAccentColor('emerald');
    setAnimationsEnabled(true);
    setAutoSaveEnabled(true);
    setNotificationsEnabled(true);
    setSoundEnabled(false);
    setLearningRate([75]);
    setMemoryRetention([85]);
    setAutonomousMode(true);
    setDebugMode(false);
    setApiTimeout('30');
    setMaxWorkers('300');
    toast({
      title: "Settings Reset",
      description: "All settings have been restored to defaults.",
    });
  };

  return (
    <div className="h-full flex flex-col bg-gradient-to-br from-background via-emerald-950/5 to-sky-950/5">
      <div className="p-6 border-b border-emerald-500/20">
        <div className="flex items-center justify-between">
          <div className="flex items-center gap-4">
            <div className="relative">
              <div className="absolute inset-0 bg-sky-500/30 rounded-full blur-md animate-pulse" />
              <div className="relative w-12 h-12 rounded-full border-2 border-sky-400/50 flex items-center justify-center bg-gradient-to-br from-sky-500/20 to-amber-500/20">
                <Settings className="w-6 h-6 text-sky-400" />
              </div>
            </div>
            <div>
              <h1 className="text-2xl font-bold bg-gradient-to-r from-sky-400 via-amber-400 to-sky-400 bg-clip-text text-transparent" data-testid="text-page-title">
                Configuration
              </h1>
              <p className="text-sm text-muted-foreground">
                System Settings & Preferences
              </p>
            </div>
          </div>
          <div className="flex gap-2">
            <Button 
              variant="outline" 
              size="sm" 
              onClick={handleReset}
              className="border-slate-500/30 hover:border-slate-400/50"
              data-testid="button-reset"
            >
              <RotateCcw className="w-4 h-4 mr-2" />
              Reset
            </Button>
            <Button 
              size="sm" 
              onClick={handleSave}
              className="bg-gradient-to-r from-sky-600 to-amber-600 hover:from-sky-500 hover:to-amber-500"
              data-testid="button-save"
            >
              <Save className="w-4 h-4 mr-2" />
              Save Changes
            </Button>
          </div>
        </div>
      </div>

      <div className="flex-1 overflow-hidden p-6">
        <Tabs value={activeTab} onValueChange={setActiveTab} className="h-full flex flex-col" data-testid="tabs-settings">
          <TabsList className="mb-4 bg-slate-900 border border-sky-500/40 shadow-lg flex-wrap justify-start gap-1" data-testid="tablist-settings">
            {sections.map((section) => (
              <TabsTrigger 
                key={section.id}
                value={section.id} 
                className="data-[state=active]:bg-gradient-to-r data-[state=active]:from-sky-600/70 data-[state=active]:to-amber-600/70 data-[state=active]:text-white text-sky-300"
                data-testid={`tab-trigger-${section.id}`}
              >
                {section.icon}
                <span className="ml-2 hidden sm:inline">{section.label}</span>
              </TabsTrigger>
            ))}
          </TabsList>

          <ScrollArea className="flex-1">
            <TabsContent value="appearance" className="mt-0" data-testid="tab-content-appearance">
              <div className="grid gap-6">
                <Card className="border-sky-500/30 bg-slate-900/50 backdrop-blur-xl">
                  <CardHeader className="border-b border-sky-500/20">
                    <CardTitle className="text-lg text-sky-300">Theme Settings</CardTitle>
                    <CardDescription className="text-sky-300/60">Customize the visual appearance</CardDescription>
                  </CardHeader>
                  <CardContent className="pt-4 space-y-6">
                    <div className="space-y-3">
                      <Label className="text-sky-200">Color Theme</Label>
                      <div className="flex gap-3">
                        {[
                          { value: 'light', icon: <Sun className="w-4 h-4" />, label: 'Light' },
                          { value: 'dark', icon: <Moon className="w-4 h-4" />, label: 'Dark' },
                          { value: 'system', icon: <Monitor className="w-4 h-4" />, label: 'System' },
                        ].map((option) => (
                          <Button
                            key={option.value}
                            variant={theme === option.value ? "default" : "outline"}
                            size="sm"
                            onClick={() => setTheme(option.value)}
                            className={theme === option.value 
                              ? "bg-gradient-to-r from-sky-600 to-amber-600" 
                              : "border-sky-500/30 text-sky-300"}
                            data-testid={`button-theme-${option.value}`}
                          >
                            {option.icon}
                            <span className="ml-2">{option.label}</span>
                          </Button>
                        ))}
                      </div>
                    </div>

                    <div className="space-y-3">
                      <Label className="text-sky-200">Accent Color</Label>
                      <Select value={accentColor} onValueChange={setAccentColor}>
                        <SelectTrigger className="bg-slate-800/50 border-sky-500/30" data-testid="select-accent-color">
                          <SelectValue placeholder="Select accent color" />
                        </SelectTrigger>
                        <SelectContent>
                          <SelectItem value="emerald">Cyan</SelectItem>
                          <SelectItem value="sky">Purple</SelectItem>
                          <SelectItem value="amber">Pink</SelectItem>
                          <SelectItem value="green">Green</SelectItem>
                          <SelectItem value="blue">Blue</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>

                    <div className="flex items-center justify-between p-3 bg-slate-800/50 rounded-lg">
                      <div>
                        <p className="text-sm text-sky-200">Enable Animations</p>
                        <p className="text-xs text-sky-300/60">Smooth transitions and effects</p>
                      </div>
                      <Switch 
                        checked={animationsEnabled} 
                        onCheckedChange={setAnimationsEnabled}
                        data-testid="switch-animations"
                      />
                    </div>
                  </CardContent>
                </Card>
              </div>
            </TabsContent>

            <TabsContent value="ai" className="mt-0" data-testid="tab-content-ai">
              <div className="grid gap-6">
                <Card className="border-emerald-500/30 bg-slate-900/50 backdrop-blur-xl">
                  <CardHeader className="border-b border-emerald-500/20">
                    <CardTitle className="text-lg text-emerald-300">AI Behavior</CardTitle>
                    <CardDescription className="text-emerald-300/60">Configure Aurora's learning and response patterns</CardDescription>
                  </CardHeader>
                  <CardContent className="pt-4 space-y-6">
                    <div className="space-y-3">
                      <div className="flex items-center justify-between">
                        <Label className="text-emerald-200">Learning Rate</Label>
                        <span className="text-sm text-emerald-400 font-mono">{learningRate[0]}%</span>
                      </div>
                      <Slider
                        value={learningRate}
                        onValueChange={setLearningRate}
                        max={100}
                        step={5}
                        className="w-full"
                        data-testid="slider-learning-rate"
                      />
                      <p className="text-xs text-emerald-300/60">Higher values mean faster adaptation but may reduce stability</p>
                    </div>

                    <div className="space-y-3">
                      <div className="flex items-center justify-between">
                        <Label className="text-emerald-200">Memory Retention</Label>
                        <span className="text-sm text-emerald-400 font-mono">{memoryRetention[0]}%</span>
                      </div>
                      <Slider
                        value={memoryRetention}
                        onValueChange={setMemoryRetention}
                        max={100}
                        step={5}
                        className="w-full"
                        data-testid="slider-memory-retention"
                      />
                      <p className="text-xs text-emerald-300/60">Controls how long Aurora retains learned information</p>
                    </div>

                    <div className="flex items-center justify-between p-3 bg-slate-800/50 rounded-lg">
                      <div>
                        <p className="text-sm text-emerald-200">Autonomous Mode</p>
                        <p className="text-xs text-emerald-300/60">Allow self-directed learning and optimization</p>
                      </div>
                      <Switch 
                        checked={autonomousMode} 
                        onCheckedChange={setAutonomousMode}
                        data-testid="switch-autonomous"
                      />
                    </div>
                  </CardContent>
                </Card>
              </div>
            </TabsContent>

            <TabsContent value="performance" className="mt-0" data-testid="tab-content-performance">
              <div className="grid gap-6">
                <Card className="border-green-500/30 bg-slate-900/50 backdrop-blur-xl">
                  <CardHeader className="border-b border-green-500/20">
                    <CardTitle className="text-lg text-green-300">Performance Settings</CardTitle>
                    <CardDescription className="text-green-300/60">Optimize system resources and speed</CardDescription>
                  </CardHeader>
                  <CardContent className="pt-4 space-y-6">
                    <div className="grid grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label className="text-green-200">API Timeout (seconds)</Label>
                        <Input
                          type="number"
                          value={apiTimeout}
                          onChange={(e) => setApiTimeout(e.target.value)}
                          className="bg-slate-800/50 border-green-500/30"
                          data-testid="input-api-timeout"
                        />
                      </div>
                      <div className="space-y-2">
                        <Label className="text-green-200">Max Workers</Label>
                        <Input
                          type="number"
                          value={maxWorkers}
                          onChange={(e) => setMaxWorkers(e.target.value)}
                          className="bg-slate-800/50 border-green-500/30"
                          data-testid="input-max-workers"
                        />
                      </div>
                    </div>

                    <div className="flex items-center justify-between p-3 bg-slate-800/50 rounded-lg">
                      <div>
                        <p className="text-sm text-green-200">Auto-Save</p>
                        <p className="text-xs text-green-300/60">Automatically save changes</p>
                      </div>
                      <Switch 
                        checked={autoSaveEnabled} 
                        onCheckedChange={setAutoSaveEnabled}
                        data-testid="switch-auto-save"
                      />
                    </div>
                  </CardContent>
                </Card>
              </div>
            </TabsContent>

            <TabsContent value="notifications" className="mt-0" data-testid="tab-content-notifications">
              <div className="grid gap-6">
                <Card className="border-yellow-500/30 bg-slate-900/50 backdrop-blur-xl">
                  <CardHeader className="border-b border-yellow-500/20">
                    <CardTitle className="text-lg text-yellow-300">Notification Preferences</CardTitle>
                    <CardDescription className="text-yellow-300/60">Control alerts and notifications</CardDescription>
                  </CardHeader>
                  <CardContent className="pt-4 space-y-4">
                    <div className="flex items-center justify-between p-3 bg-slate-800/50 rounded-lg">
                      <div>
                        <p className="text-sm text-yellow-200">Enable Notifications</p>
                        <p className="text-xs text-yellow-300/60">Receive system alerts and updates</p>
                      </div>
                      <Switch 
                        checked={notificationsEnabled} 
                        onCheckedChange={setNotificationsEnabled}
                        data-testid="switch-notifications"
                      />
                    </div>

                    <div className="flex items-center justify-between p-3 bg-slate-800/50 rounded-lg">
                      <div>
                        <p className="text-sm text-yellow-200">Sound Effects</p>
                        <p className="text-xs text-yellow-300/60">Play sounds for notifications</p>
                      </div>
                      <Switch 
                        checked={soundEnabled} 
                        onCheckedChange={setSoundEnabled}
                        data-testid="switch-sound"
                      />
                    </div>
                  </CardContent>
                </Card>
              </div>
            </TabsContent>

            <TabsContent value="security" className="mt-0" data-testid="tab-content-security">
              <SecurityApiKeyManager />
            </TabsContent>

            <TabsContent value="advanced" className="mt-0" data-testid="tab-content-advanced">
              <div className="grid gap-6">
                <Card className="border-slate-500/30 bg-slate-900/50 backdrop-blur-xl">
                  <CardHeader className="border-b border-slate-500/20">
                    <CardTitle className="text-lg text-slate-300">Advanced Settings</CardTitle>
                    <CardDescription className="text-slate-300/60">Developer and debug options</CardDescription>
                  </CardHeader>
                  <CardContent className="pt-4 space-y-4">
                    <div className="flex items-center justify-between p-3 bg-slate-800/50 rounded-lg">
                      <div>
                        <p className="text-sm text-slate-200">Debug Mode</p>
                        <p className="text-xs text-slate-300/60">Enable verbose logging and diagnostics</p>
                      </div>
                      <Switch 
                        checked={debugMode} 
                        onCheckedChange={setDebugMode}
                        data-testid="switch-debug"
                      />
                    </div>

                    <div className="p-4 bg-slate-800/50 rounded-lg border border-slate-500/20">
                      <p className="text-sm text-slate-200 mb-2">System Information</p>
                      <div className="grid grid-cols-2 gap-2 text-xs">
                        <div className="flex justify-between">
                          <span className="text-slate-400">Version:</span>
                          <span className="text-slate-300 font-mono">3.1.0</span>
                        </div>
                        <div className="flex justify-between">
                          <span className="text-slate-400">Build:</span>
                          <span className="text-slate-300 font-mono">Peak Autonomy</span>
                        </div>
                        <div className="flex justify-between">
                          <span className="text-slate-400">Workers:</span>
                          <span className="text-slate-300 font-mono">300</span>
                        </div>
                        <div className="flex justify-between">
                          <span className="text-slate-400">Modules:</span>
                          <span className="text-slate-300 font-mono">550</span>
                        </div>
                      </div>
                    </div>

                    <Button variant="outline" size="sm" className="border-slate-500/30 text-slate-300 w-full">
                      <RefreshCw className="w-4 h-4 mr-2" />
                      Clear Cache & Restart
                    </Button>
                  </CardContent>
                </Card>
              </div>
            </TabsContent>
          </ScrollArea>
        </Tabs>
      </div>
    </div>
  );
}

--------------------------------------------------------------------------------
FILE: client/src/pages/tasks.tsx
LINES: 179
--------------------------------------------------------------------------------
'use client';

import React from 'react';
import { useQuery } from "@tanstack/react-query";
import {
  Activity,
  Brain,
  Bug,
  CheckCircle2,
  Code2,
  Gauge,
  Layers,
  BookOpen,
  Rocket,
  Shield,
  Sparkles,
  Wrench,
  Zap
} from 'lucide-react';

interface AemCategory {
  name: string;
  count: number;
  methods: string[];
}

interface AemSummary {
  totalAEMs: number;
  categories: AemCategory[];
  mode?: string;
}

const categoryPalette = [
  'from-cyan-500 to-blue-500',
  'from-blue-500 to-purple-500',
  'from-purple-500 to-pink-500',
  'from-pink-500 to-red-500',
  'from-red-500 to-orange-500',
  'from-orange-500 to-yellow-500',
  'from-yellow-500 to-green-500',
  'from-green-500 to-emerald-500',
  'from-emerald-500 to-teal-500',
  'from-teal-500 to-cyan-500',
];

const iconMap: Record<string, React.ComponentType<{ className?: string }>> = {
  code_generation: Sparkles,
  code_analysis: Brain,
  code_optimization: Zap,
  refactoring: Wrench,
  testing: CheckCircle2,
  debugging: Bug,
  documentation: BookOpen,
  deployment: Rocket,
  monitoring: Activity,
  security_scan: Shield,
  performance_tuning: Gauge,
  data_processing: Layers
};

const formatLabel = (value: string) =>
  value
    .split('_')
    .map((segment) => segment.charAt(0).toUpperCase() + segment.slice(1))
    .join(' ');

export default function TasksPage() {
  const { data, isLoading, isError } = useQuery<AemSummary>({
    queryKey: ['/api/nexus-v3/aems'],
    refetchInterval: 60000
  });

  const categories = data?.categories ?? [];
  const totalAems = data?.totalAEMs ?? 0;

  return (
    <div className="min-h-screen p-8">
      <div className="max-w-7xl mx-auto">
        <div className="mb-8">
          <h1 className="text-4xl font-bold bg-gradient-to-r from-cyan-400 via-purple-400 to-pink-400 bg-clip-text text-transparent mb-4">
            Execution Method Catalog
          </h1>
          <p className="text-purple-400 text-lg">Live AEM categories derived from the Nexus V3 manifest</p>
        </div>

        {isLoading ? (
          <div className="flex items-center justify-center py-16 text-purple-300">
            Loading execution categories...
          </div>
        ) : isError ? (
          <div className="flex items-center justify-center py-16 text-red-300">
            Failed to load execution categories.
          </div>
        ) : (
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {categories.map((category, index) => {
              const color = categoryPalette[index % categoryPalette.length];
              const Icon = iconMap[category.name] ?? Layers;
              const percent = totalAems > 0 ? Math.round((category.count / totalAems) * 100) : 0;
              const preview = category.methods.slice(0, 3);
              const remaining = category.methods.length - preview.length;

              return (
                <div key={category.name} className="group relative">
                  <div
                    className="absolute inset-0 bg-gradient-to-r opacity-0 group-hover:opacity-100 transition-opacity blur-xl"
                    style={{ background: `linear-gradient(to right, var(--tw-gradient-stops))` }}
                  />
                  <div className="relative bg-slate-900/50 backdrop-blur-xl border border-purple-500/30 rounded-2xl p-6 hover:border-purple-500/50 transition-all">
                    <div className="flex items-center gap-4 mb-4">
                      <div className={`w-12 h-12 rounded-xl bg-gradient-to-br ${color} flex items-center justify-center`}>
                        <Icon className="w-6 h-6 text-white" />
                      </div>
                      <div>
                        <div className="text-xs text-purple-400 font-mono">{category.count} methods</div>
                        <h3 className="text-white font-semibold">{formatLabel(category.name)}</h3>
                      </div>
                    </div>

                    <div className="space-y-2">
                      <div className="flex items-center justify-between text-sm">
                        <span className="text-purple-400">Share of total</span>
                        <span className="text-cyan-400 font-mono">{percent}%</span>
                      </div>
                      <div className="h-2 bg-slate-800 rounded-full overflow-hidden">
                        <div
                          className={`h-full bg-gradient-to-r ${color} transition-all`}
                          style={{ width: `${percent}%` }}
                        />
                      </div>
                    </div>

                    <div className="mt-4 pt-4 border-t border-purple-500/20">
                      <div className="text-xs text-purple-400 mb-2">Sample methods</div>
                      <div className="space-y-1 text-xs text-cyan-300/80">
                        {preview.length > 0 ? preview.map((method) => (
                          <div key={method} className="truncate">• {method}</div>
                        )) : (
                          <div>No methods listed</div>
                        )}
                        {remaining > 0 && (
                          <div className="text-purple-400">+{remaining} more</div>
                        )}
                      </div>
                    </div>
                  </div>
                </div>
              );
            })}
          </div>
        )}

        <div className="mt-8 bg-slate-900/50 backdrop-blur-xl border border-purple-500/30 rounded-2xl p-6">
          <h3 className="text-xl font-bold text-white mb-4">Execution Summary</h3>
          <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div className="text-center">
              <div className="text-3xl font-bold bg-gradient-to-r from-cyan-400 to-purple-400 bg-clip-text text-transparent">
                {totalAems || 'Unavailable'}
              </div>
              <div className="text-purple-400 text-sm">Total AEMs</div>
            </div>
            <div className="text-center">
              <div className="text-3xl font-bold bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent">
                {categories.length || 'Unavailable'}
              </div>
              <div className="text-purple-400 text-sm">Categories</div>
            </div>
            <div className="text-center">
              <div className="text-3xl font-bold bg-gradient-to-r from-pink-400 to-cyan-400 bg-clip-text text-transparent">
                {data?.mode ?? 'Unknown'}
              </div>
              <div className="text-purple-400 text-sm">Mode</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}

--------------------------------------------------------------------------------
FILE: client/src/pages/tiers.tsx
LINES: 135
--------------------------------------------------------------------------------
'use client';

import React from 'react';
import { useQuery } from "@tanstack/react-query";
import { Brain, Globe, Sparkles } from 'lucide-react';

interface TierCategory {
  name: string;
  count: number;
}

interface TierSummary {
  totalTiers: number;
  categories: TierCategory[];
  mode?: string;
}

const categoryPalette = [
  'from-amber-500 to-orange-500',
  'from-blue-500 to-cyan-500',
  'from-green-500 to-emerald-500',
  'from-purple-500 to-pink-500',
  'from-red-500 to-rose-500',
  'from-pink-500 to-fuchsia-500',
  'from-cyan-500 to-blue-500',
  'from-violet-500 to-purple-500',
  'from-teal-500 to-emerald-500',
  'from-lime-500 to-green-500',
  'from-sky-500 to-indigo-500',
  'from-rose-500 to-pink-500',
];

const formatLabel = (value: string) =>
  value
    .split('_')
    .map((segment) => segment.charAt(0).toUpperCase() + segment.slice(1))
    .join(' ');

export default function TiersPage() {
  const { data, isLoading, isError } = useQuery<TierSummary>({
    queryKey: ['/api/nexus-v3/tiers'],
    refetchInterval: 60000
  });

  const totalTiers = data?.totalTiers ?? 0;
  const categories = (data?.categories ?? []).slice().sort((a, b) => b.count - a.count);

  return (
    <div className="min-h-screen p-8">
      <div className="max-w-7xl mx-auto">
        <div className="mb-8">
          <h1 className="text-4xl font-bold bg-gradient-to-r from-cyan-400 via-purple-400 to-pink-400 bg-clip-text text-transparent mb-4">
            {totalTiers ? `${totalTiers} Knowledge Tiers` : 'Knowledge Tiers'}
          </h1>
          <p className="text-purple-400 text-lg">Live tier distribution from the Nexus V3 manifest</p>
        </div>

        {isLoading ? (
          <div className="flex items-center justify-center py-16 text-purple-300">
            Loading tier distribution...
          </div>
        ) : isError ? (
          <div className="flex items-center justify-center py-16 text-red-300">
            Failed to load tier distribution.
          </div>
        ) : (
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {categories.map((category, index) => {
              const colorClass = categoryPalette[index % categoryPalette.length];
              const Icon = index % 2 === 0 ? Globe : Brain;
              const percent = totalTiers > 0 ? Math.round((category.count / totalTiers) * 100) : 0;

              return (
                <div key={category.name} className="bg-slate-900/50 backdrop-blur-xl border border-purple-500/30 rounded-2xl p-6">
                  <div className="flex items-center gap-3 mb-4">
                    <div className={`w-12 h-12 rounded-xl bg-gradient-to-br ${colorClass} flex items-center justify-center`}>
                      <Icon className="w-6 h-6 text-white" />
                    </div>
                    <div>
                      <h2 className="text-xl font-bold text-white">{formatLabel(category.name)}</h2>
                      <p className="text-purple-400 text-sm">{category.count} tiers</p>
                    </div>
                  </div>

                  <div className="space-y-2">
                    <div className="flex items-center justify-between text-sm">
                      <span className="text-purple-400">Share of total</span>
                      <span className="text-cyan-400 font-mono">{percent}%</span>
                    </div>
                    <div className="h-2 bg-slate-800 rounded-full overflow-hidden">
                      <div
                        className={`h-full bg-gradient-to-r ${colorClass} transition-all`}
                        style={{ width: `${percent}%` }}
                      />
                    </div>
                  </div>
                </div>
              );
            })}
          </div>
        )}

        <div className="mt-8 bg-slate-900/50 backdrop-blur-xl border border-purple-500/30 rounded-2xl p-6">
          <h3 className="text-xl font-bold text-white mb-4">Knowledge Tier Overview</h3>
          <div className="grid grid-cols-1 md:grid-cols-4 gap-6">
            <div className="text-center">
              <div className="text-3xl font-bold bg-gradient-to-r from-cyan-400 to-purple-400 bg-clip-text text-transparent">
                {totalTiers || 'Unavailable'}
              </div>
              <div className="text-purple-400 text-sm">Total Tiers</div>
            </div>
            <div className="text-center">
              <div className="text-3xl font-bold bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent">
                {categories.length || 'Unavailable'}
              </div>
              <div className="text-purple-400 text-sm">Domains</div>
            </div>
            <div className="text-center">
              <div className="text-3xl font-bold bg-gradient-to-r from-pink-400 to-cyan-400 bg-clip-text text-transparent">
                {data?.mode ?? 'Unknown'}
              </div>
              <div className="text-purple-400 text-sm">Mode</div>
            </div>
            <div className="text-center">
              <div className="text-3xl font-bold bg-gradient-to-r from-cyan-400 to-purple-400 bg-clip-text text-transparent">
                <Sparkles className="w-8 h-8 inline-block" />
              </div>
              <div className="text-purple-400 text-sm">Nexus V3</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}

--------------------------------------------------------------------------------
FILE: client/src/pages/vault.tsx
LINES: 409
--------------------------------------------------------------------------------
import { useState, useEffect } from "react";
import { useQuery, useMutation } from "@tanstack/react-query";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { Badge } from "@/components/ui/badge";
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs";
import { useToast } from "@/hooks/use-toast";
import { Shield, Lock, Key, Clock, CheckCircle, AlertCircle, RefreshCw } from "lucide-react";

interface VaultRequest {
  ts: number;
  op: string;
  alias?: string;
  requester?: string;
  error?: string;
}

interface VaultHealth {
  ok: boolean;
  configured: boolean;
  hasMasterPassphrase: boolean;
  hasAdminKey: boolean;
  ts: number;
}

export default function VaultPage() {
  const { toast } = useToast();
  const [unlockAlias, setUnlockAlias] = useState("");
  const [requesterName, setRequesterName] = useState("");
  const [adminKey, setAdminKey] = useState(() => localStorage.getItem("aurora_admin_key") || "");

  useEffect(() => {
    localStorage.setItem("aurora_admin_key", adminKey);
  }, [adminKey]);

  const healthQuery = useQuery<VaultHealth>({
    queryKey: ["/api/vault/health"]
  });

  const requestsQuery = useQuery<{ requests: VaultRequest[] }>({
    queryKey: ["/api/vault/requests", adminKey],
    enabled: !!adminKey,
    refetchInterval: 10000,
    queryFn: async () => {
      const res = await fetch("/api/vault/requests", {
        headers: { "x-api-key": adminKey }
      });
      if (!res.ok) throw new Error("Failed to fetch requests");
      return res.json();
    }
  });

  const requestUnlockMutation = useMutation({
    mutationFn: async (data: { alias: string; requester?: string }) => {
      const res = await fetch("/api/vault/unlock-request", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      });
      return res.json();
    },
    onSuccess: (data) => {
      toast({
        title: "Unlock Requested",
        description: data.message || "Request submitted for approval."
      });
      setUnlockAlias("");
      setRequesterName("");
    },
    onError: () => {
      toast({
        title: "Request Failed",
        description: "Could not submit unlock request.",
        variant: "destructive"
      });
    }
  });

  const approveUnlockMutation = useMutation({
    mutationFn: async (alias: string) => {
      const res = await fetch("/api/vault/approve", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "x-api-key": adminKey
        },
        body: JSON.stringify({ alias })
      });
      return res.json();
    },
    onSuccess: (data) => {
      if (data.ok) {
        toast({
          title: "Unlock Approved",
          description: `Secret '${data.alias}' has been decrypted.`
        });
      } else {
        toast({
          title: "Approval Failed",
          description: data.error || "Could not decrypt secret.",
          variant: "destructive"
        });
      }
    },
    onError: () => {
      toast({
        title: "Approval Failed",
        description: "Could not process approval request.",
        variant: "destructive"
      });
    }
  });

  const handleRequestUnlock = () => {
    if (!unlockAlias.trim()) {
      toast({
        title: "Missing Alias",
        description: "Please enter a secret alias.",
        variant: "destructive"
      });
      return;
    }
    requestUnlockMutation.mutate({
      alias: unlockAlias.trim(),
      requester: requesterName.trim() || undefined
    });
  };

  const handleApprove = (alias: string) => {
    if (!adminKey) {
      toast({
        title: "Admin Key Required",
        description: "Please enter your admin API key first.",
        variant: "destructive"
      });
      return;
    }
    approveUnlockMutation.mutate(alias);
  };

  const getOpIcon = (op: string) => {
    switch (op) {
      case "encrypt":
        return <Lock className="h-4 w-4 text-green-500" />;
      case "decrypt":
        return <Key className="h-4 w-4 text-blue-500" />;
      case "unlock_request":
        return <Clock className="h-4 w-4 text-yellow-500" />;
      case "approved_unlock":
        return <CheckCircle className="h-4 w-4 text-green-500" />;
      case "decrypt_error":
        return <AlertCircle className="h-4 w-4 text-red-500" />;
      default:
        return <Shield className="h-4 w-4 text-muted-foreground" />;
    }
  };

  return (
    <div className="container mx-auto p-6 space-y-6">
      <div className="flex items-center gap-3">
        <Shield className="h-8 w-8 text-primary" />
        <div>
          <h1 className="text-3xl font-bold" data-testid="text-vault-title">ASE-∞ Vault</h1>
          <p className="text-muted-foreground">Multi-layer encrypted secret management</p>
        </div>
      </div>

      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
        <Card>
          <CardHeader className="pb-2">
            <CardTitle className="text-sm font-medium">Vault Status</CardTitle>
          </CardHeader>
          <CardContent>
            {healthQuery.isLoading ? (
              <div className="flex items-center gap-2">
                <RefreshCw className="h-4 w-4 animate-spin" />
                <span className="text-sm">Checking...</span>
              </div>
            ) : healthQuery.data?.configured ? (
              <Badge variant="default" className="bg-green-600">
                <CheckCircle className="h-3 w-3 mr-1" />
                Configured
              </Badge>
            ) : (
              <Badge variant="destructive">
                <AlertCircle className="h-3 w-3 mr-1" />
                Not Configured
              </Badge>
            )}
          </CardContent>
        </Card>

        <Card>
          <CardHeader className="pb-2">
            <CardTitle className="text-sm font-medium">Master Passphrase</CardTitle>
          </CardHeader>
          <CardContent>
            {healthQuery.data?.hasMasterPassphrase ? (
              <Badge variant="default" className="bg-green-600">Set</Badge>
            ) : (
              <Badge variant="outline">Not Set</Badge>
            )}
          </CardContent>
        </Card>

        <Card>
          <CardHeader className="pb-2">
            <CardTitle className="text-sm font-medium">Admin Key</CardTitle>
          </CardHeader>
          <CardContent>
            {healthQuery.data?.hasAdminKey ? (
              <Badge variant="default" className="bg-green-600">Configured</Badge>
            ) : (
              <Badge variant="outline">Not Configured</Badge>
            )}
          </CardContent>
        </Card>
      </div>

      <Tabs defaultValue="request" className="w-full">
        <TabsList>
          <TabsTrigger value="request" data-testid="tab-vault-request">Request Unlock</TabsTrigger>
          <TabsTrigger value="admin" data-testid="tab-vault-admin">Admin Approvals</TabsTrigger>
          <TabsTrigger value="log" data-testid="tab-vault-log">Operation Log</TabsTrigger>
        </TabsList>

        <TabsContent value="request" className="space-y-4">
          <Card>
            <CardHeader>
              <CardTitle>Request Secret Unlock</CardTitle>
              <CardDescription>
                Request access to an encrypted secret. An admin must approve the request.
              </CardDescription>
            </CardHeader>
            <CardContent className="space-y-4">
              <div className="space-y-2">
                <Label htmlFor="alias">Secret Alias</Label>
                <Input
                  id="alias"
                  placeholder="e.g., discord_webhook, admin_api_key"
                  value={unlockAlias}
                  onChange={(e) => setUnlockAlias(e.target.value)}
                  data-testid="input-vault-alias"
                />
              </div>
              <div className="space-y-2">
                <Label htmlFor="requester">Your Name (optional)</Label>
                <Input
                  id="requester"
                  placeholder="e.g., Aurora System"
                  value={requesterName}
                  onChange={(e) => setRequesterName(e.target.value)}
                  data-testid="input-vault-requester"
                />
              </div>
              <Button
                onClick={handleRequestUnlock}
                disabled={requestUnlockMutation.isPending}
                data-testid="button-vault-request"
              >
                {requestUnlockMutation.isPending ? (
                  <>
                    <RefreshCw className="h-4 w-4 mr-2 animate-spin" />
                    Requesting...
                  </>
                ) : (
                  <>
                    <Lock className="h-4 w-4 mr-2" />
                    Request Unlock
                  </>
                )}
              </Button>
            </CardContent>
          </Card>
        </TabsContent>

        <TabsContent value="admin" className="space-y-4">
          <Card>
            <CardHeader>
              <CardTitle>Admin Authentication</CardTitle>
              <CardDescription>
                Enter your admin API key to view and approve unlock requests.
              </CardDescription>
            </CardHeader>
            <CardContent className="space-y-4">
              <div className="space-y-2">
                <Label htmlFor="adminKey">Admin API Key</Label>
                <Input
                  id="adminKey"
                  type="password"
                  placeholder="Enter admin API key"
                  value={adminKey}
                  onChange={(e) => setAdminKey(e.target.value)}
                  data-testid="input-vault-admin-key"
                />
              </div>
              <Button
                onClick={() => requestsQuery.refetch()}
                disabled={!adminKey}
                variant="outline"
                data-testid="button-vault-load"
              >
                <RefreshCw className="h-4 w-4 mr-2" />
                Load Requests
              </Button>
            </CardContent>
          </Card>

          {adminKey && requestsQuery.data?.requests && (
            <Card>
              <CardHeader>
                <CardTitle>Pending Requests</CardTitle>
                <CardDescription>
                  {requestsQuery.data.requests.filter(r => r.op === "unlock_request").length} unlock request(s)
                </CardDescription>
              </CardHeader>
              <CardContent>
                <div className="space-y-2">
                  {requestsQuery.data.requests
                    .filter(r => r.op === "unlock_request")
                    .slice(0, 20)
                    .map((req, i) => (
                      <div
                        key={i}
                        className="flex items-center justify-between p-3 border rounded-lg"
                        data-testid={`row-vault-request-${i}`}
                      >
                        <div className="flex items-center gap-3">
                          {getOpIcon(req.op)}
                          <div>
                            <div className="font-medium">{req.alias}</div>
                            <div className="text-sm text-muted-foreground">
                              {req.requester || "Unknown"} - {new Date(req.ts).toLocaleString()}
                            </div>
                          </div>
                        </div>
                        <Button
                          size="sm"
                          onClick={() => req.alias && handleApprove(req.alias)}
                          disabled={approveUnlockMutation.isPending}
                          data-testid={`button-approve-${i}`}
                        >
                          Approve
                        </Button>
                      </div>
                    ))}
                  {requestsQuery.data.requests.filter(r => r.op === "unlock_request").length === 0 && (
                    <div className="text-center text-muted-foreground py-8">
                      No pending unlock requests
                    </div>
                  )}
                </div>
              </CardContent>
            </Card>
          )}
        </TabsContent>

        <TabsContent value="log" className="space-y-4">
          <Card>
            <CardHeader>
              <CardTitle>Operation Log</CardTitle>
              <CardDescription>
                Recent vault operations (requires admin key)
              </CardDescription>
            </CardHeader>
            <CardContent>
              {!adminKey ? (
                <div className="text-center text-muted-foreground py-8">
                  Enter admin key to view operation log
                </div>
              ) : requestsQuery.isLoading ? (
                <div className="flex items-center justify-center py-8">
                  <RefreshCw className="h-6 w-6 animate-spin" />
                </div>
              ) : (
                <div className="space-y-2 max-h-96 overflow-y-auto">
                  {requestsQuery.data?.requests?.slice(0, 50).map((req, i) => (
                    <div
                      key={i}
                      className="flex items-center gap-3 p-2 border-b last:border-0"
                      data-testid={`row-vault-log-${i}`}
                    >
                      {getOpIcon(req.op)}
                      <div className="flex-1">
                        <span className="font-medium">{req.op}</span>
                        {req.alias && <span className="text-muted-foreground ml-2">({req.alias})</span>}
                        {req.error && <span className="text-red-500 ml-2">{req.error}</span>}
                      </div>
                      <div className="text-xs text-muted-foreground">
                        {new Date(req.ts).toLocaleString()}
                      </div>
                    </div>
                  ))}
                  {(!requestsQuery.data?.requests || requestsQuery.data.requests.length === 0) && (
                    <div className="text-center text-muted-foreground py-8">
                      No operations logged yet
                    </div>
                  )}
                </div>
              )}
            </CardContent>
          </Card>
        </TabsContent>
      </Tabs>
    </div>
  );
}

================================================================================
                         COMPONENTS (Aurora-specific)
================================================================================

--------------------------------------------------------------------------------
FILE: client/src/components/AuroraChatInterface.tsx
LINES: 260
--------------------------------------------------------------------------------
import { useState, useEffect, useRef } from 'react';
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { ScrollArea } from "@/components/ui/scroll-area";
import { Send, Sparkles, Loader2 } from "lucide-react";

interface Message {
  id: string;
  role: 'user' | 'aurora' | 'system';
  content: string;
  timestamp: Date;
}
interface AuroraChatProps {
  compact?: boolean;
}

export default function AuroraChatInterface({ compact = false }: AuroraChatProps) {
  const [messages, setMessages] = useState<Message[]>([]);
  const [input, setInput] = useState('');
  const [connected, setConnected] = useState(false);
  const [isLoading, setIsLoading] = useState(false);
  const [tiersActive, setTiersActive] = useState<number | null>(null);
  const messagesEndRef = useRef<HTMLDivElement>(null);

  useEffect(() => {
    const fetchCapabilities = async () => {
      try {
        const res = await fetch('/api/nexus-v3/capabilities');
        if (!res.ok) return;
        const data = await res.json();
        if (typeof data.tiers === 'number') {
          setTiersActive(data.tiers);
        }
      } catch (error) {
        console.error('[AuroraChatInterface] Capabilities fetch failed:', error);
      }
    };
    fetchCapabilities();
  }, []);

  useEffect(() => {
    // Aurora welcome message with conversational style
    const tierLabel = tiersActive ? `${tiersActive}` : 'available';
    setMessages([
      {
        id: '0',
        role: 'aurora',
        content: compact
          ? "Hey — I'm Aurora. Chat with me quickly from the sidebar. Ask anything!"
          : `Hey! 👋 Aurora here with all ${tierLabel} knowledge tiers active.\n\nI can help you:\n• Build anything (web, mobile, cloud, AI)\n• Debug any issue\n• Explain complex concepts\n• Review and optimize code\n\nJust chat naturally with me - I understand context! What's on your mind?`,
        timestamp: new Date(),
      },
    ]);
    setConnected(true);

    // Auto-scroll
    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
  }, [compact, tiersActive]);

  useEffect(() => {
    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
  }, [messages]);

  const sendMessage = async () => {
    if (!input.trim() || isLoading) return;

    const userMsg: Message = {
      id: Date.now().toString(),
      role: 'user',
      content: input,
      timestamp: new Date()
    };

    setMessages(prev => [...prev, userMsg]);
    const currentInput = input;
    setInput('');
    setIsLoading(true);

    console.log('[Aurora Chat] Starting request, isLoading=true');

    try {
      const response = await fetch('/api/chat', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          message: currentInput,
          session_id: 'web-ui-session'
        })
      });

      console.log('[Aurora Chat] Got response:', response.status);

      if (!response.ok) {
        const errorText = await response.text();
        console.error('[Aurora Chat] Error response:', errorText);
        throw new Error(`HTTP ${response.status}: ${errorText}`);
      }

      const data = await response.json();
      console.log('[Aurora Chat] Parsed JSON:', data);

      if (!data.ok || !data.response) {
        throw new Error('Invalid response format');
      }

      setMessages(prev => [...prev, {
        id: (Date.now() + 1).toString(),
        role: 'aurora',
        content: data.response,
        timestamp: new Date()
      }]);

      console.log('[Aurora Chat] Message added successfully');
    } catch (error) {
      console.error('[Aurora Chat] Error:', error);
      setMessages(prev => [...prev, {
        id: (Date.now() + 1).toString(),
        role: 'aurora',
        content: `I encountered an error: ${error instanceof Error ? error.message : 'Unknown error'}. Please check the console for details. 🔧`,
        timestamp: new Date()
      }]);
    } finally {
      setIsLoading(false);
      console.log('[Aurora Chat] isLoading=false (finally block)');
    }
  };

  const handleKeyPress = (e: React.KeyboardEvent) => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      sendMessage();
    }
  };

  return (
    <div className={compact ? "h-full flex flex-col" : "h-full flex flex-col bg-gradient-to-br from-background via-background to-primary/5"}>
      {/* Aurora's Quantum Background - hidden in compact mode */}
      {!compact && (
        <div className="fixed inset-0 -z-10 overflow-hidden pointer-events-none">
          <div className="absolute inset-0 bg-gradient-to-br from-slate-950 via-cyan-950/20 to-purple-950/20" />

          {/* Particle field */}
          <div className="absolute inset-0 opacity-20" style={{
            backgroundImage: 'radial-gradient(circle, rgba(6, 182, 212, 0.3) 1px, transparent 1px)',
            backgroundSize: '50px 50px',
            animation: 'particleFloat 20s linear infinite'
          }} />

          {/* Holographic orbs */}
          <div className="absolute top-20 left-1/4 w-64 h-64 bg-cyan-500/10 rounded-full blur-3xl animate-pulse" />
          <div className="absolute bottom-20 right-1/4 w-96 h-96 bg-purple-500/10 rounded-full blur-3xl animate-pulse" style={{ animationDelay: '2s' }} />
        </div>
      )}

      <Card className={compact ? "m-3 flex-none h-64 border-cyan-500/20" : "m-6 flex-1 flex flex-col border-cyan-500/20"}>
        <CardHeader className="border-b border-cyan-500/20">
          <CardTitle className="flex items-center gap-2">
            <Sparkles className="h-6 w-6 text-cyan-400" />
            Chat with Aurora
            <Badge variant={connected ? "default" : "secondary"} className="ml-auto bg-cyan-500/20 text-cyan-300">
              {connected ? (compact ? '🌌 Sidebar' : `🌌 ${tiersActive ?? 'Tiers'} Active`) : '○ Offline'}
            </Badge>
          </CardTitle>
          <p className="text-sm text-muted-foreground mt-2">
            {compact ? 'Compact sidebar chat — quick context and replies.' : 'Conversational AI with complete mastery across all domains - just like Copilot!'}
          </p>
        </CardHeader>

        <CardContent className={`${compact ? 'flex-none h-[calc(100%-80px)] p-3' : 'flex-1 flex flex-col p-6'}`}>
          <ScrollArea className="flex-1 pr-4 mb-4">
            <div className="space-y-4">
              {messages.map((msg) => (
                <div
                  key={`msg-${msg.id}`}
                  className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}
                >
                  <div
                    className={`max-w-[85%] rounded-lg px-4 py-3 ${msg.role === 'user'
                      ? 'bg-cyan-500/20 text-cyan-100 border border-cyan-500/30'
                      : msg.role === 'aurora'
                        ? 'bg-purple-500/20 text-purple-100 border border-purple-500/30'
                        : 'bg-muted/50 text-muted-foreground border border-muted'
                      }`}
                  >
                    <div className="flex items-start gap-2">
                      {msg.role === 'aurora' && <Sparkles className="h-4 w-4 text-cyan-400 mt-1 flex-shrink-0" />}
                      <div className="flex-1">
                        <div className="whitespace-pre-wrap break-words text-sm">
                          {msg.content}
                        </div>
                        <div className="text-xs opacity-60 mt-1">
                          {msg.timestamp.toLocaleTimeString()}
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              ))}

              {isLoading && (
                <div className="flex justify-start">
                  <div className="bg-purple-500/20 rounded-lg px-4 py-3 border border-purple-500/30">
                    <div className="flex items-center gap-2">
                      <Sparkles className="h-4 w-4 text-cyan-400 animate-pulse" />
                      <div className="flex gap-1">
                        <div className="w-2 h-2 bg-purple-400 rounded-full animate-bounce"></div>
                        <div className="w-2 h-2 bg-purple-400 rounded-full animate-bounce" style={{ animationDelay: '0.1s' }}></div>
                        <div className="w-2 h-2 bg-purple-400 rounded-full animate-bounce" style={{ animationDelay: '0.2s' }}></div>
                      </div>
                      <span className="text-xs text-purple-300">Aurora is thinking...</span>
                    </div>
                  </div>
                </div>
              )}

              <div ref={messagesEndRef} />
            </div>
          </ScrollArea>

          <div className={`${compact ? 'space-y-2' : 'space-y-3'}`}>
            <div className="flex gap-2">
              <Input
                value={input}
                onChange={(e) => setInput(e.target.value)}
                onKeyPress={handleKeyPress}
                placeholder={compact ? "Quick ask Aurora..." : "Chat naturally with Aurora - ask anything! 💬"}
                disabled={!connected || isLoading}
                className="flex-1"
              />
              <Button
                onClick={sendMessage}
                disabled={!input.trim() || !connected || isLoading}
                className="bg-cyan-500 hover:bg-cyan-600 gap-2"
              >
                {isLoading ? (
                  <>
                    <Loader2 className="h-4 w-4 animate-spin" />
                    {compact ? '...' : 'Thinking'}
                  </>
                ) : (
                  <>
                    <Send className="h-4 w-4" />
                    {compact ? 'Send' : 'Send'}
                  </>
                )}
              </Button>
            </div>
            {!compact && (
              <div className="text-xs text-muted-foreground text-center">
                💡 I understand context and have real conversations - try asking me anything!
              </div>
            )}
          </div>
        </CardContent>
      </Card>
    </div>
  );
}

--------------------------------------------------------------------------------
FILE: client/src/components/AuroraControl.tsx
LINES: 5
--------------------------------------------------------------------------------
import UnifiedSystemStatus from "./UnifiedSystemStatus";

export default function AuroraControl() {
  return <UnifiedSystemStatus />;
}

--------------------------------------------------------------------------------
FILE: client/src/components/AuroraDashboard.tsx
LINES: 5
--------------------------------------------------------------------------------
import AuroraFuturisticDashboard from "./AuroraFuturisticDashboard";

export default function AuroraDashboard() {
  return <AuroraFuturisticDashboard />;
}

--------------------------------------------------------------------------------
FILE: client/src/components/AuroraErrorMonitor.tsx
LINES: 98
--------------------------------------------------------------------------------
/**
 * Aurora's Autonomous Error Detection System
 * Monitors and auto-fixes runtime errors
 */

'use client';

import { useEffect } from 'react';

export function AuroraErrorMonitor() {
    useEffect(() => {
        // Global error handler
        const handleError = (event: ErrorEvent) => {
            console.error('[AURORA ERROR DETECTED]', {
                message: event.message,
                filename: event.filename,
                lineno: event.lineno,
                colno: event.colno,
                error: event.error,
            });

            // Aurora's autonomous analysis
            const errorType = event.error?.name || 'Unknown';
            const errorMessage = event.message;

            // Report to Aurora's intelligence
            fetch('/api/aurora/error-report', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    type: errorType,
                    message: errorMessage,
                    stack: event.error?.stack,
                    location: {
                        file: event.filename,
                        line: event.lineno,
                        column: event.colno,
                    },
                    timestamp: new Date().toISOString(),
                }),
            }).catch(console.error);

            // Prevent default error handling
            event.preventDefault();
        };

        // Unhandled promise rejections
        const handleRejection = (event: PromiseRejectionEvent) => {
            console.error('[AURORA PROMISE REJECTION]', {
                reason: event.reason,
                promise: event.promise,
            });

            fetch('/api/aurora/error-report', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    type: 'UnhandledPromiseRejection',
                    message: String(event.reason),
                    timestamp: new Date().toISOString(),
                }),
            }).catch(console.error);

            event.preventDefault();
        };

        // React error boundary fallback
        const handleReactError = (error: Error, errorInfo: any) => {
            console.error('[AURORA REACT ERROR]', error, errorInfo);

            fetch('/api/aurora/error-report', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    type: 'ReactError',
                    message: error.message,
                    stack: error.stack,
                    componentStack: errorInfo?.componentStack,
                    timestamp: new Date().toISOString(),
                }),
            }).catch(console.error);
        };

        window.addEventListener('error', handleError);
        window.addEventListener('unhandledrejection', handleRejection);

        // Store for React error boundary
        (window as any).__auroraReactErrorHandler = handleReactError;

        return () => {
            window.removeEventListener('error', handleError);
            window.removeEventListener('unhandledrejection', handleRejection);
            delete (window as any).__auroraReactErrorHandler;
        };
    }, []);

    return null;
}

--------------------------------------------------------------------------------
FILE: client/src/components/AuroraFuturisticChat.tsx
LINES: 307
--------------------------------------------------------------------------------
import React, { useState, useRef, useEffect } from 'react';
import { Send, Sparkles, Zap, Code, CheckCircle2, AlertCircle } from 'lucide-react';
import { ErrorBoundary } from './error-boundary';

interface Message {
  role: 'user' | 'assistant';
  content: string;
  timestamp: Date;
  status?: 'thinking' | 'executing' | 'complete' | 'error';
  aemUsed?: { id: number; name: string };
}

export default function AuroraFuturisticChat() {
  const [messages, setMessages] = useState<Message[]>([
    {
      role: 'assistant',
      content: "**Aurora Quantum Neural Intelligence System - Online**\n\n**Active Systems:**\n- 188 Knowledge Tiers\n- 66 Advanced Execution Methods (my hands)\n- 550 Active Modules\n- 300 Parallel Workers\n- 100 Self-Healers\n- Hyperspeed Mode: ACTIVE\n\n**What I can do with my hands:**\n\n• **Code Operations (AEM 7-12):** Write, debug, review code; read/write files\n• **Analysis (AEM 15-17):** Analyze codebase, check integrations, recognize patterns\n• **Synthesis (AEM 18-22):** Design architectures, create documentation, build APIs\n• **System (AEM 14, 32-35):** Check status, git operations, deployment planning\n\nTry saying: \"Status\", \"List files\", \"Analyze codebase\", or describe what you need built.\n\n**What would you like me to execute?**",
      timestamp: new Date(),
      status: 'complete',
      aemUsed: { id: 14, name: 'System Status' }
    }
  ]);
  const [input, setInput] = useState('');
  const [isProcessing, setIsProcessing] = useState(false);
  const [sessionId] = useState(() => `chat-${Date.now()}`);
  const messagesEndRef = useRef<HTMLDivElement>(null);

  const scrollToBottom = () => {
    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
  };

  useEffect(() => {
    scrollToBottom();
  }, [messages]);

  const sendMessage = async () => {
    if (!input.trim() || isProcessing) return;

    const userMessage: Message = {
      role: 'user',
      content: input,
      timestamp: new Date(),
      status: 'complete'
    };

    const userInput = input;
    setMessages(prev => [...prev, userMessage]);
    setInput('');
    setIsProcessing(true);

    const thinkingMessage: Message = {
      role: 'assistant',
      content: 'Selecting optimal AEM and executing with 300 parallel workers...',
      timestamp: new Date(),
      status: 'thinking'
    };
    setMessages(prev => [...prev, thinkingMessage]);

    try {
      const response = await fetch('/api/chat', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ 
          message: userInput, 
          session_id: sessionId,
          context: messages.slice(-4) // Send last 4 messages as context
        }),
      });

      if (!response.ok) {
        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
      }

      const data = await response.json();

      if (!data || !data.response) {
        throw new Error('Invalid response from Aurora');
      }

      setMessages(prev => {
        const newMessages = [...prev];
        const lastIndex = newMessages.length - 1;

        newMessages[lastIndex] = {
          role: 'assistant',
          content: data.response,
          timestamp: new Date(),
          status: 'complete',
          aemUsed: data.aemUsed
        };

        return newMessages;
      });
    } catch (error) {
      console.error('[Aurora Chat] Error:', error);
      setMessages(prev => {
        const newMessages = [...prev];
        newMessages[newMessages.length - 1] = {
          role: 'assistant',
          content: `I encountered an issue processing your request. You asked: "${userInput}"\n\nLet me provide you with information on that topic or try a different approach. What aspect would you like to explore?`,
          timestamp: new Date(),
          status: 'error'
        };
        return newMessages;
      });
    }

    setIsProcessing(false);
  };

  const getStatusIcon = (status?: string) => {
    switch (status) {
      case 'thinking':
        return <Sparkles className="w-4 h-4 text-emerald-400 animate-pulse" />;
      case 'executing':
        return <Zap className="w-4 h-4 text-sky-400 animate-pulse" />;
      case 'complete':
        return <CheckCircle2 className="w-4 h-4 text-green-400" />;
      case 'error':
        return <AlertCircle className="w-4 h-4 text-red-400" />;
      default:
        return null;
    }
  };

  const formatMessage = (content: string) => {
    if (!content) return <span className="text-slate-500">Empty message</span>;

    const safeContent = typeof content === 'string' ? content : String(content);

    try {
      // Format code blocks
      const parts = safeContent.split('```');
      return parts.map((part, i) => {
        if (i % 2 === 1) {
          // Code block
          const lines = part.split('\n');
          const language = lines[0]?.trim() || 'code';
          const code = lines.slice(1).join('\n');

          return (
            <div key={`code-${i}`} className="my-3 rounded-lg bg-slate-900/80 border border-sky-500/20 overflow-hidden">
              <div className="px-3 py-2 bg-sky-500/10 border-b border-sky-500/20 flex items-center gap-2">
                <Code className="w-3 h-3 text-sky-400" />
                <span className="text-xs text-sky-400 font-mono">{language}</span>
              </div>
              <pre className="p-3 overflow-x-auto text-xs sm:text-sm">
                <code className="text-emerald-300 font-mono">{code}</code>
              </pre>
            </div>
          );
        }

        // Regular text - enhanced formatting
        return (
          <div key={`text-${i}`} className="whitespace-pre-wrap leading-relaxed">
            {part.split('\n').map((line, j) => {
              const trimmed = line.trim();
              
              // Skip empty lines for cleaner display
              if (!trimmed) return <br key={j} />;
              
              // Bold text with ** markers
              if (line.includes('**')) {
                const boldParts = line.split('**');
                return (
                  <p key={`line-${j}`} className="mb-2">
                    {boldParts.map((p, k) =>
                      k % 2 === 1 ? <strong key={k} className="text-white font-semibold">{p}</strong> : p
                    )}
                  </p>
                );
              }
              
              // Numbered lists
              if (/^\d+\.\s/.test(trimmed)) {
                return (
                  <p key={j} className="ml-4 mb-1 text-sky-200">
                    {trimmed}
                  </p>
                );
              }
              
              // Bullet points
              if (trimmed.startsWith('•') || trimmed.startsWith('-')) {
                const content = trimmed.replace(/^[•-]\s+/, '');
                return (
                  <li key={j} className="ml-4 mb-1 text-sky-200">
                    {content}
                  </li>
                );
              }
              
              // Links and emphasis
              if (line.includes('http')) {
                return (
                  <p key={j} className="mb-2 break-words">
                    {line.split(/(\bhttps?:\/\/[^\s]+)/g).map((segment, idx) => 
                      segment.startsWith('http') ? 
                        <a key={idx} href={segment} target="_blank" rel="noopener" className="text-emerald-400 hover:text-emerald-300 underline">{segment}</a> :
                        segment
                    )}
                  </p>
                );
              }
              
              return <p key={j} className="mb-2">{line}</p>;
            })}
          </div>
        );
      });
    } catch (error) {
      console.error('[Aurora] Format error:', error);
      return <span className="text-red-400">Error formatting message</span>;
    }
  };

  return (
    <ErrorBoundary>
      <div className="min-h-screen bg-gradient-to-br from-slate-950 via-sky-950 to-slate-900 p-6">
        <div className="max-w-5xl mx-auto">
          {/* Header */}
          <div className="mb-6 text-center">
            <h1 className="text-4xl font-bold bg-gradient-to-r from-emerald-400 via-sky-400 to-amber-400 bg-clip-text text-transparent mb-2">
              Neural Chat
            </h1>
            <p className="text-sky-300 text-sm">Natural conversation with Aurora</p>
          </div>

          {/* Chat Container */}
          <div className="bg-slate-900/40 backdrop-blur-xl rounded-2xl border border-sky-500/20 shadow-2xl overflow-hidden">
            {/* Messages Area */}
            <div className="h-[600px] overflow-y-auto p-6 space-y-4">
              {messages?.map((msg, idx) => (
                <div
                  key={`msg-${idx}-${msg.timestamp.getTime()}`}
                  className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'} animate-fadeIn`}
                >
                  <div
                    className={`max-w-[80%] rounded-2xl p-4 ${msg.role === 'user'
                      ? 'bg-gradient-to-br from-emerald-500/20 to-sky-500/20 border border-emerald-500/30'
                      : 'bg-slate-800/50 border border-sky-500/20'
                      }`}
                  >
                    {/* Message Header */}
                    <div className="flex items-center gap-2 mb-2">
                      <span className={`text-xs font-semibold ${msg.role === 'user' ? 'text-emerald-400' : 'text-sky-400'
                        }`}>
                        {msg.role === 'user' ? 'You' : 'Aurora'}
                      </span>
                      {msg.status && getStatusIcon(msg.status)}
                      <span className="text-xs text-slate-500 ml-auto">
                        {msg.timestamp.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}
                      </span>
                    </div>

                    {/* Message Content */}
                    <div className={`text-sm ${msg.role === 'user' ? 'text-emerald-100' : 'text-sky-100'
                      }`}>
                      {formatMessage(msg.content)}
                    </div>
                  </div>
                </div>
              ))}
              <div ref={messagesEndRef} />
            </div>

            {/* Input Area */}
            <div className="border-t border-sky-500/20 bg-slate-900/60 p-4">
              <div className="flex gap-3">
                <input
                  type="text"
                  value={input}
                  onChange={(e) => setInput(e.target.value)}
                  onKeyPress={(e) => e.key === 'Enter' && !e.shiftKey && sendMessage()}
                  placeholder="Ask Aurora anything... (natural language works best)"
                  className="flex-1 bg-slate-800/50 border border-sky-500/30 rounded-xl px-4 py-3 text-sky-100 placeholder-sky-400/50 focus:outline-none focus:border-sky-500/60 focus:ring-2 focus:ring-sky-500/20"
                  disabled={isProcessing}
                />
                <button
                  onClick={sendMessage}
                  disabled={isProcessing || !input.trim()}
                  className="px-6 py-3 bg-gradient-to-r from-emerald-500 to-sky-500 rounded-xl font-semibold text-white hover:shadow-lg hover:shadow-sky-500/50 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"
                >
                  {isProcessing ? (
                    <>
                      <Sparkles className="w-5 h-5 animate-spin" />
                      <span>Thinking...</span>
                    </>
                  ) : (
                    <>
                      <Send className="w-5 h-5" />
                      <span>Send</span>
                    </>
                  )}
                </button>
              </div>
              <p className="text-xs text-sky-400/60 mt-2 text-center">
                Pro tip: Be specific and natural - I understand context and nuance
              </p>
            </div>
          </div>
        </div>
      </div>
    </ErrorBoundary>
  );
}

--------------------------------------------------------------------------------
FILE: client/src/components/AuroraFuturisticDashboard.tsx
LINES: 604
--------------------------------------------------------------------------------
import { useQuery } from "@tanstack/react-query";
import {
  Activity,
  Brain,
  Cpu,
  Database,
  HeartPulse,
  Layers,
  Network,
  Package,
  RefreshCw,
  Sparkles,
  Zap,
} from "lucide-react";
import { Badge } from "@/components/ui/badge";
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Progress } from "@/components/ui/progress";
import UnifiedSystemStatus from "./UnifiedSystemStatus";
import ActivityMonitor from "./ActivityMonitor";

interface V3Capabilities {
  workers?: number;
  tiers?: number;
  aems?: number;
  modules?: number;
  hyperspeed_enabled?: boolean;
  hybrid_mode_enabled?: boolean;
  autonomous_mode?: boolean;
  available?: boolean;
}

interface V3Status {
  state?: string;
  version?: string;
  uptime?: number;
}

interface V3SelfHealers {
  total?: number;
  active?: number;
  healsPerformed?: number;
}

interface V3Workers {
  total?: number;
  active?: number;
  idle?: number;
}

interface PackSummary {
  total_packs?: number;
  loaded_packs?: number;
  total_submodules?: number;
}

interface V2Status {
  quantum_coherence?: number;
}

interface SystemMetrics {
  cpu?: number;
  memory?: number;
  disk?: number;
}

interface DbStatus {
  ready?: boolean;
  configured?: boolean;
}

interface ModuleOverview {
  timestamp?: string;
  auroraCore?: {
    available?: boolean;
    totalEntries?: number;
    pythonFiles?: number;
    auroraModules?: number;
    standardModules?: number;
    manifestCount?: number;
    temporalBreakdown?: Record<string, number>;
    tierBreakdown?: Record<string, number>;
    lastUpdated?: string | null;
    manifestUpdated?: string | null;
  };
  nexusV3?: {
    available?: boolean;
    moduleFiles?: number;
    registryCount?: number;
    subdirectories?: Array<{
      name: string;
      moduleIds: number;
      init: number;
      execute: number;
      cleanup: number;
      totalFiles: number;
    }>;
    lastUpdated?: string | null;
    registryUpdated?: string | null;
  };
}

interface UpdateStatus {
  timestamp?: string;
  ui?: {
    name?: string;
    version?: string;
    lastUpdated?: string | null;
  };
  backend?: {
    version?: string;
    node?: string;
    uptimeSeconds?: number;
    lastUpdated?: string | null;
  };
  nexusV3?: {
    version?: string | null;
    lastUpdated?: string | null;
  };
  memoryFabric?: {
    lastUpdated?: string | null;
  };
  manifests?: {
    tiers?: { count?: number; lastUpdated?: string | null; generatedAt?: string | null };
    executions?: { count?: number; lastUpdated?: string | null; generatedAt?: string | null };
    modules?: { count?: number; lastUpdated?: string | null; generatedAt?: string | null };
  };
}

function formatCount(value?: number) {
  return typeof value === "number" ? value.toLocaleString() : "Unavailable";
}

function formatPercent(value?: number) {
  if (typeof value !== "number") return "Unavailable";
  return `${value.toFixed(1)}%`;
}

function formatTimestamp(value?: string | null) {
  if (!value) return "Unavailable";
  const date = new Date(value);
  if (Number.isNaN(date.getTime())) return "Unavailable";
  return date.toLocaleString();
}

function formatDuration(seconds?: number) {
  if (typeof seconds !== "number") return "Unavailable";
  const normalized = Math.max(0, seconds);
  const hours = Math.floor(normalized / 3600);
  const minutes = Math.floor((normalized % 3600) / 60);
  return `${hours}h ${minutes}m`;
}

function formatBreakdown(breakdown?: Record<string, number>, maxItems: number = 4) {
  if (!breakdown || Object.keys(breakdown).length === 0) return "Unavailable";
  return Object.entries(breakdown)
    .sort((a, b) => b[1] - a[1])
    .slice(0, maxItems)
    .map(([key, value]) => `${key} ${value}`)
    .join(" | ");
}

function getStateBadgeClass(state?: string) {
  const normalized = state?.toLowerCase();
  if (!normalized) {
    return "bg-slate-900/70 text-slate-200 border-slate-700/60";
  }
  if (["available", "ready", "online", "operational"].includes(normalized)) {
    return "bg-emerald-500/20 text-emerald-100 border-emerald-400/40";
  }
  if (["degraded", "warning"].includes(normalized)) {
    return "bg-amber-500/20 text-amber-100 border-amber-400/40";
  }
  return "bg-rose-500/20 text-rose-100 border-rose-400/40";
}

export default function AuroraFuturisticDashboard() {
  const { data: v3Capabilities } = useQuery<V3Capabilities>({
    queryKey: ["/api/nexus-v3/capabilities"],
    refetchInterval: 15000,
  });

  const { data: v3Status } = useQuery<V3Status>({
    queryKey: ["/api/nexus-v3/status"],
    refetchInterval: 15000,
  });

  const { data: v3Workers } = useQuery<V3Workers>({
    queryKey: ["/api/nexus-v3/workers"],
    refetchInterval: 15000,
  });

  const { data: v3Healers } = useQuery<V3SelfHealers>({
    queryKey: ["/api/nexus-v3/self-healers"],
    refetchInterval: 20000,
  });

  const { data: packSummary } = useQuery<PackSummary>({
    queryKey: ["/api/nexus-v3/packs"],
    refetchInterval: 60000,
  });

  const { data: v2Status } = useQuery<V2Status>({
    queryKey: ["/api/luminar-nexus/v2/status"],
    refetchInterval: 15000,
  });

  const { data: systemMetrics } = useQuery<SystemMetrics>({
    queryKey: ["/api/system/metrics"],
    refetchInterval: 10000,
  });

  const { data: dbStatus } = useQuery<DbStatus>({
    queryKey: ["/api/database/status"],
    refetchInterval: 30000,
  });

  const modulesOverviewQuery = useQuery<ModuleOverview>({
    queryKey: ["/api/modules/overview"],
    refetchInterval: 60000,
  });

  const updateStatusQuery = useQuery<UpdateStatus>({
    queryKey: ["/api/aurora/update-status"],
    refetchInterval: 60000,
  });

  const modulesOverview = modulesOverviewQuery.data;
  const updateStatus = updateStatusQuery.data;
  const isRefreshing = modulesOverviewQuery.isFetching || updateStatusQuery.isFetching;

  const coherencePercent = typeof v2Status?.quantum_coherence === "number"
    ? v2Status.quantum_coherence * 100
    : undefined;
  const auroraCoreModules = modulesOverview?.auroraCore;
  const nexusModules = modulesOverview?.nexusV3;

  const handleRefresh = () => {
    modulesOverviewQuery.refetch();
    updateStatusQuery.refetch();
  };

  return (
    <div className="text-slate-100">
      <section className="relative mb-6 overflow-hidden rounded-3xl border border-slate-800/70 bg-slate-900/60 p-8">
        <div className="absolute inset-0 bg-[radial-gradient(circle_at_top,_rgba(16,185,129,0.18),_transparent_60%)]" />
        <div className="absolute -right-16 -top-16 h-40 w-40 rounded-full bg-amber-400/10 blur-3xl" />
        <div className="absolute -left-16 bottom-0 h-32 w-32 rounded-full bg-sky-400/10 blur-3xl" />
        <div className="relative flex flex-wrap items-center justify-between gap-6">
          <div className="flex items-center gap-4">
            <div className="relative">
              <Brain className="h-12 w-12 text-emerald-300 animate-pulse" />
              <div className="absolute inset-0 rounded-full bg-emerald-400/20 blur-xl" />
            </div>
            <div>
              <h1 className="text-3xl font-semibold tracking-tight text-slate-100">AURORA</h1>
              <p className="mt-1 text-xs uppercase tracking-[0.25em] text-slate-400">Command Operations</p>
              <div className="mt-2 flex flex-wrap gap-2 text-xs">
                <Badge className={getStateBadgeClass(v3Status?.state)}>
                  {v3Status?.state ? v3Status.state.toUpperCase() : "STATE UNAVAILABLE"}
                </Badge>
                <Badge className="bg-slate-900/70 text-slate-200 border-slate-700/60">
                  {v3Status?.version ? `Nexus V3 ${v3Status.version}` : "Nexus V3 Unknown"}
                </Badge>
              </div>
            </div>
          </div>
          <div className="min-w-[200px] space-y-2 text-right">
            <div className="text-3xl font-semibold text-emerald-300">
              {coherencePercent !== undefined ? `${coherencePercent.toFixed(1)}%` : "Unavailable"}
            </div>
            <div className="text-xs text-slate-400">Quantum Coherence (V2)</div>
            <Progress value={coherencePercent ?? 0} className="h-2 bg-slate-800/80" />
          </div>
        </div>
        <div className="relative mt-6 flex flex-wrap gap-2 text-xs">
          <Badge
            className={
              v3Capabilities?.hyperspeed_enabled
                ? "bg-amber-500/20 text-amber-100 border-amber-400/40"
                : "bg-slate-900/70 text-slate-300 border-slate-700/60"
            }
          >
            Hyperspeed {v3Capabilities?.hyperspeed_enabled ? "Enabled" : "Disabled"}
          </Badge>
          <Badge
            className={
              v3Capabilities?.hybrid_mode_enabled
                ? "bg-emerald-500/20 text-emerald-100 border-emerald-400/40"
                : "bg-slate-900/70 text-slate-300 border-slate-700/60"
            }
          >
            Hybrid {v3Capabilities?.hybrid_mode_enabled ? "Enabled" : "Disabled"}
          </Badge>
          <Badge
            className={
              v3Capabilities?.autonomous_mode
                ? "bg-sky-500/20 text-sky-100 border-sky-400/40"
                : "bg-slate-900/70 text-slate-300 border-slate-700/60"
            }
          >
            Autonomous {v3Capabilities?.autonomous_mode ? "Enabled" : "Disabled"}
          </Badge>
        </div>
      </section>

      <div className="grid grid-cols-1 gap-6 md:grid-cols-2 xl:grid-cols-4 mb-6">
        <Card className="bg-slate-900/60 border-sky-500/30">
          <CardHeader className="pb-2">
            <CardTitle className="flex items-center gap-2 text-sky-200 text-sm">
              <Network className="h-4 w-4 text-sky-400" />
              Knowledge Tiers
            </CardTitle>
          </CardHeader>
          <CardContent className="text-2xl font-semibold text-sky-100">
            {formatCount(v3Capabilities?.tiers)}
          </CardContent>
        </Card>

        <Card className="bg-slate-900/60 border-amber-500/30">
          <CardHeader className="pb-2">
            <CardTitle className="flex items-center gap-2 text-amber-200 text-sm">
              <Zap className="h-4 w-4 text-amber-400" />
              AEMs
            </CardTitle>
          </CardHeader>
          <CardContent className="text-2xl font-semibold text-amber-100">
            {formatCount(v3Capabilities?.aems)}
          </CardContent>
        </Card>

        <Card className="bg-slate-900/60 border-emerald-500/30">
          <CardHeader className="pb-2">
            <CardTitle className="flex items-center gap-2 text-emerald-200 text-sm">
              <Activity className="h-4 w-4 text-emerald-400" />
              Modules
            </CardTitle>
          </CardHeader>
          <CardContent className="text-2xl font-semibold text-emerald-100">
            {formatCount(v3Capabilities?.modules)}
          </CardContent>
        </Card>

        <Card className="bg-slate-900/60 border-cyan-500/30">
          <CardHeader className="pb-2">
            <CardTitle className="flex items-center gap-2 text-cyan-200 text-sm">
              <Cpu className="h-4 w-4 text-cyan-400" />
              Workers
            </CardTitle>
          </CardHeader>
          <CardContent className="text-2xl font-semibold text-cyan-100">
            {formatCount(v3Workers?.total ?? v3Capabilities?.workers)}
          </CardContent>
        </Card>
      </div>

      <div className="grid grid-cols-1 gap-6 mb-6">
        <Card className="bg-slate-900/60 border-orange-500/30">
          <CardHeader className="pb-2">
            <CardTitle className="flex items-center gap-2 text-orange-200 text-sm">
              <Package className="h-4 w-4 text-orange-400" />
              Packs
            </CardTitle>
          </CardHeader>
          <CardContent className="space-y-1 text-sm">
            <div className="flex items-center justify-between">
              <span className="text-orange-200/70">Total</span>
              <span className="text-orange-100 font-semibold">{formatCount(packSummary?.total_packs)}</span>
            </div>
            <div className="flex items-center justify-between">
              <span className="text-orange-200/70">Loaded</span>
              <span className="text-orange-100 font-semibold">{formatCount(packSummary?.loaded_packs)}</span>
            </div>
          </CardContent>
        </Card>

        <Card className="bg-slate-900/60 border-emerald-500/30">
          <CardHeader className="pb-2">
            <CardTitle className="flex items-center gap-2 text-emerald-200 text-sm">
              <HeartPulse className="h-4 w-4 text-emerald-400" />
              Self-Healing
            </CardTitle>
          </CardHeader>
          <CardContent className="space-y-1 text-sm">
            <div className="flex items-center justify-between">
              <span className="text-emerald-200/70">Active</span>
              <span className="text-emerald-100 font-semibold">{formatCount(v3Healers?.active)}</span>
            </div>
            <div className="flex items-center justify-between">
              <span className="text-emerald-200/70">Total</span>
              <span className="text-emerald-100 font-semibold">{formatCount(v3Healers?.total)}</span>
            </div>
            <div className="flex items-center justify-between">
              <span className="text-emerald-200/70">Heals</span>
              <span className="text-emerald-100 font-semibold">{formatCount(v3Healers?.healsPerformed)}</span>
            </div>
          </CardContent>
        </Card>

        <Card className="bg-slate-900/60 border-sky-500/30">
          <CardHeader className="pb-2">
            <CardTitle className="flex items-center gap-2 text-sky-200 text-sm">
              <Database className="h-4 w-4 text-sky-400" />
              Database
            </CardTitle>
          </CardHeader>
          <CardContent className="space-y-1 text-sm">
            <div className="flex items-center justify-between">
              <span className="text-sky-200/70">Status</span>
              <span className="text-sky-100 font-semibold">
                {dbStatus?.ready ? "Ready" : "Unavailable"}
              </span>
            </div>
            <div className="flex items-center justify-between">
              <span className="text-sky-200/70">Configured</span>
              <span className="text-sky-100 font-semibold">
                {dbStatus?.configured ? "Yes" : "No"}
              </span>
            </div>
          </CardContent>
        </Card>
      </div>

      <div className="grid grid-cols-1 xl:grid-cols-2 gap-6 mb-6">
        <Card className="bg-slate-900/60 border-slate-700/70">
          <CardHeader className="pb-2">
            <CardTitle className="flex items-center gap-2 text-slate-200 text-sm">
              <Sparkles className="h-4 w-4 text-emerald-300" />
              System Load
            </CardTitle>
          </CardHeader>
          <CardContent className="space-y-3 text-sm">
            <div>
              <div className="flex items-center justify-between mb-1">
                <span className="text-slate-300/70">CPU</span>
                <span className="text-slate-100 font-semibold">{formatPercent(systemMetrics?.cpu)}</span>
              </div>
              <Progress value={systemMetrics?.cpu ?? 0} className="h-2 bg-slate-800/80" />
            </div>
            <div>
              <div className="flex items-center justify-between mb-1">
                <span className="text-slate-300/70">Memory</span>
                <span className="text-slate-100 font-semibold">{formatPercent(systemMetrics?.memory)}</span>
              </div>
              <Progress value={systemMetrics?.memory ?? 0} className="h-2 bg-slate-800/80" />
            </div>
            <div>
              <div className="flex items-center justify-between mb-1">
                <span className="text-slate-300/70">Disk</span>
                <span className="text-slate-100 font-semibold">{formatPercent(systemMetrics?.disk)}</span>
              </div>
              <Progress value={systemMetrics?.disk ?? 0} className="h-2 bg-slate-800/80" />
            </div>
          </CardContent>
        </Card>

        <Card className="bg-slate-900/60 border-emerald-500/30">
          <CardHeader className="pb-2">
            <div className="flex items-center justify-between gap-3">
              <CardTitle className="flex items-center gap-2 text-emerald-200 text-sm">
                <RefreshCw className="h-4 w-4 text-emerald-400" />
                Update Center
              </CardTitle>
              <Button
                variant="outline"
                size="sm"
                onClick={handleRefresh}
                disabled={isRefreshing}
                className="h-8 px-3 text-xs"
              >
                {isRefreshing ? "Refreshing" : "Refresh"}
              </Button>
            </div>
          </CardHeader>
          <CardContent className="space-y-3 text-sm">
            <div className="space-y-1">
              <div className="flex items-center justify-between">
                <span className="text-emerald-200/70">UI</span>
                <span className="text-emerald-100 font-semibold">
                  {updateStatus?.ui?.version
                    ? `${updateStatus?.ui?.name ?? "UI"} ${updateStatus?.ui?.version}`
                    : "Unavailable"}
                </span>
              </div>
              <div className="text-xs text-emerald-300/60">Updated {formatTimestamp(updateStatus?.ui?.lastUpdated)}</div>
            </div>
            <div className="space-y-1">
              <div className="flex items-center justify-between">
                <span className="text-emerald-200/70">Backend</span>
                <span className="text-emerald-100 font-semibold">{updateStatus?.backend?.version ?? "Unavailable"}</span>
              </div>
              <div className="text-xs text-emerald-300/60">
                Node {updateStatus?.backend?.node ?? "Unknown"} | Uptime {formatDuration(updateStatus?.backend?.uptimeSeconds)}
              </div>
            </div>
            <div className="space-y-1">
              <div className="flex items-center justify-between">
                <span className="text-emerald-200/70">Nexus V3</span>
                <span className="text-emerald-100 font-semibold">{updateStatus?.nexusV3?.version ?? "Unavailable"}</span>
              </div>
              <div className="text-xs text-emerald-300/60">Updated {formatTimestamp(updateStatus?.nexusV3?.lastUpdated)}</div>
            </div>
            <div className="space-y-1">
              <div className="flex items-center justify-between">
                <span className="text-emerald-200/70">Memory Fabric</span>
                <span className="text-emerald-100 font-semibold">
                  {updateStatus?.memoryFabric?.lastUpdated ? "Ready" : "Unavailable"}
                </span>
              </div>
              <div className="text-xs text-emerald-300/60">Updated {formatTimestamp(updateStatus?.memoryFabric?.lastUpdated)}</div>
            </div>
            <div className="pt-2 border-t border-emerald-500/20 text-xs text-emerald-300/70 space-y-1">
              <div className="flex items-center justify-between">
                <span>Manifests</span>
                <span>{formatCount(updateStatus?.manifests?.modules?.count)} modules</span>
              </div>
              <div className="text-emerald-300/60">
                Tiers {formatCount(updateStatus?.manifests?.tiers?.count)} | AEMs {formatCount(updateStatus?.manifests?.executions?.count)}
              </div>
              <div className="text-emerald-300/60">Updated {formatTimestamp(updateStatus?.manifests?.modules?.lastUpdated)}</div>
            </div>
            <div className="text-xs text-emerald-400/70">Snapshot {formatTimestamp(updateStatus?.timestamp)}</div>
          </CardContent>
        </Card>
      </div>

      <Card className="bg-slate-900/60 border-emerald-500/30 mb-6">
        <CardHeader className="pb-2">
          <CardTitle className="flex items-center gap-2 text-emerald-200 text-sm">
            <Layers className="h-4 w-4 text-emerald-400" />
            Module Topology
          </CardTitle>
        </CardHeader>
        <CardContent className="space-y-4 text-sm">
          <div className="rounded-xl border border-emerald-500/20 bg-slate-900/50 p-3">
            <div className="flex items-center justify-between text-xs">
              <span className="text-emerald-200/70">Aurora Core Modules</span>
              <span className="text-emerald-100 font-semibold">{formatCount(auroraCoreModules?.manifestCount)}</span>
            </div>
            <div className="grid grid-cols-2 gap-2 mt-2 text-xs">
              <div className="flex items-center justify-between">
                <span className="text-emerald-200/70">Aurora Modules</span>
                <span className="text-emerald-100 font-semibold">{formatCount(auroraCoreModules?.auroraModules)}</span>
              </div>
              <div className="flex items-center justify-between">
                <span className="text-emerald-200/70">Standard Modules</span>
                <span className="text-emerald-100 font-semibold">{formatCount(auroraCoreModules?.standardModules)}</span>
              </div>
              <div className="flex items-center justify-between">
                <span className="text-emerald-200/70">Python Files</span>
                <span className="text-emerald-100 font-semibold">{formatCount(auroraCoreModules?.pythonFiles)}</span>
              </div>
              <div className="flex items-center justify-between">
                <span className="text-emerald-200/70">Total Entries</span>
                <span className="text-emerald-100 font-semibold">{formatCount(auroraCoreModules?.totalEntries)}</span>
              </div>
            </div>
            <div className="mt-2 text-xs text-emerald-200/60">
              Temporal: {formatBreakdown(auroraCoreModules?.temporalBreakdown)}
            </div>
            <div className="text-xs text-emerald-200/60">
              Tier: {formatBreakdown(auroraCoreModules?.tierBreakdown)}
            </div>
            <div className="text-xs text-emerald-400/70 mt-1">
              Updated {formatTimestamp(auroraCoreModules?.lastUpdated)}
            </div>
          </div>
          <div className="rounded-xl border border-emerald-500/20 bg-slate-900/50 p-3 space-y-2">
            <div className="flex items-center justify-between text-xs">
              <span className="text-emerald-200/70">Nexus V3 Modules</span>
              <span className="text-emerald-100 font-semibold">{formatCount(nexusModules?.registryCount)} registry</span>
            </div>
            <div className="text-xs text-emerald-200/60">
              Root modules {formatCount(nexusModules?.moduleFiles)} | Updated {formatTimestamp(nexusModules?.lastUpdated)}
            </div>
            {nexusModules?.subdirectories && nexusModules.subdirectories.length > 0 ? (
              <div className="space-y-2">
                {nexusModules.subdirectories.map((subdir) => (
                  <div
                    key={subdir.name}
                    className="flex flex-wrap items-center justify-between gap-2 rounded-lg border border-emerald-500/20 bg-slate-900/60 px-3 py-2 text-xs"
                  >
                    <span className="font-mono text-emerald-200">{subdir.name}</span>
                    <span className="text-emerald-200/70">{formatCount(subdir.moduleIds)} modules</span>
                    <span className="text-emerald-200/70">
                      init {formatCount(subdir.init)} | exec {formatCount(subdir.execute)} | cleanup {formatCount(subdir.cleanup)}
                    </span>
                  </div>
                ))}
              </div>
            ) : (
              <div className="text-xs text-emerald-200/60">Subdirectories unavailable</div>
            )}
          </div>
        </CardContent>
      </Card>

      <div className="grid grid-cols-1 xl:grid-cols-2 gap-6">
        <UnifiedSystemStatus />
        <ActivityMonitor />
      </div>
    </div>
  );
}

--------------------------------------------------------------------------------
FILE: client/src/components/AuroraFuturisticLayout.tsx
LINES: 338
--------------------------------------------------------------------------------
import React, { useEffect, useState } from 'react';
import { Link, useLocation } from 'wouter';
import {
  Activity,
  BarChart3,
  BookOpen,
  Brain,
  Cpu,
  Database,
  FileText,
  GitBranch,
  LayoutDashboard,
  Layers,
  Lock,
  Map,
  Menu,
  MessageSquare,
  Network,
  Palette,
  Server,
  Settings,
  Sparkles,
  TestTube,
  TrendingUp,
  X,
  Zap,
} from 'lucide-react';

interface NavItem {
  path: string;
  label: string;
  icon: React.ReactNode;
  category: 'core' | 'intelligence' | 'operations' | 'labs';
  tier: 'essential' | 'advanced';
}

export default function AuroraFuturisticLayout({ children }: { children: React.ReactNode }) {
  const [sidebarOpen, setSidebarOpen] = useState(true);
  const [location] = useLocation();

  const navItems: NavItem[] = [
    { path: '/dashboard', label: 'Command Overview', icon: <LayoutDashboard className="w-5 h-5" />, category: 'core', tier: 'essential' },
    { path: '/aurora', label: 'Aurora Core', icon: <Sparkles className="w-5 h-5" />, category: 'core', tier: 'essential' },
    { path: '/chat', label: 'Neural Chat', icon: <MessageSquare className="w-5 h-5" />, category: 'core', tier: 'essential' },
    { path: '/memory', label: 'Memory Fabric', icon: <Database className="w-5 h-5" />, category: 'core', tier: 'essential' },
    { path: '/nexus', label: 'Nexus Command', icon: <Network className="w-5 h-5" />, category: 'core', tier: 'essential' },
    { path: '/library', label: 'Code Library', icon: <BookOpen className="w-5 h-5" />, category: 'core', tier: 'advanced' },

    { path: '/intelligence', label: 'Intelligence Core', icon: <Cpu className="w-5 h-5" />, category: 'intelligence', tier: 'advanced' },
    { path: '/tasks', label: 'Execution Methods', icon: <Layers className="w-5 h-5" />, category: 'intelligence', tier: 'advanced' },
    { path: '/tiers', label: 'Knowledge Tiers', icon: <GitBranch className="w-5 h-5" />, category: 'intelligence', tier: 'advanced' },
    { path: '/evolution', label: 'Evolution Monitor', icon: <TrendingUp className="w-5 h-5" />, category: 'intelligence', tier: 'advanced' },
    { path: '/self-learning', label: 'Self-Learning', icon: <Brain className="w-5 h-5" />, category: 'intelligence', tier: 'advanced' },
    { path: '/autonomous', label: 'Autonomous Tools', icon: <Zap className="w-5 h-5" />, category: 'intelligence', tier: 'advanced' },

    { path: '/monitoring', label: 'System Monitor', icon: <Activity className="w-5 h-5" />, category: 'operations', tier: 'essential' },
    { path: '/servers', label: 'Server Control', icon: <Server className="w-5 h-5" />, category: 'operations', tier: 'essential' },
    { path: '/database', label: 'Knowledge Base', icon: <Database className="w-5 h-5" />, category: 'operations', tier: 'advanced' },
    { path: '/roadmap', label: 'Roadmap', icon: <Map className="w-5 h-5" />, category: 'operations', tier: 'advanced' },
    { path: '/vault', label: 'Vault', icon: <Lock className="w-5 h-5" />, category: 'operations', tier: 'advanced' },
    { path: '/settings', label: 'Configuration', icon: <Settings className="w-5 h-5" />, category: 'operations', tier: 'essential' },

    { path: '/comparison', label: 'Comparison Lab', icon: <BarChart3 className="w-5 h-5" />, category: 'labs', tier: 'advanced' },
    { path: '/corpus', label: 'Corpus Archive', icon: <FileText className="w-5 h-5" />, category: 'labs', tier: 'advanced' },
    { path: '/aurora-ui', label: 'Aurora UI', icon: <Palette className="w-5 h-5" />, category: 'labs', tier: 'advanced' },
    { path: '/aurora-ai-test', label: 'Aurora AI Test', icon: <TestTube className="w-5 h-5" />, category: 'labs', tier: 'advanced' },
  ];

  const categoryLabels = {
    core: 'Command Core',
    intelligence: 'Intelligence Grid',
    operations: 'Operations',
    labs: 'Labs'
  };

  const [moduleCount, setModuleCount] = useState<number | null>(null);
  const [quantumCoherence, setQuantumCoherence] = useState<number | null>(null);
  const [showAdvanced, setShowAdvanced] = useState(false);

  useEffect(() => {
    let isActive = true;

    const fetchSidebarStats = async () => {
      try {
        const [manifestRes, v2Res] = await Promise.allSettled([
          fetch('/api/nexus-v3/manifest'),
          fetch('/api/luminar-nexus/v2/status'),
        ]);

        if (manifestRes.status === 'fulfilled' && manifestRes.value.ok) {
          const data = await manifestRes.value.json();
          if (isActive && typeof data.modules === 'number') {
            setModuleCount(data.modules);
          }
        }

        if (v2Res.status === 'fulfilled' && v2Res.value.ok) {
          const data = await v2Res.value.json();
          if (isActive && typeof data.quantum_coherence === 'number') {
            setQuantumCoherence(data.quantum_coherence);
          }
        }
      } catch {
        if (isActive) {
          setModuleCount(null);
          setQuantumCoherence(null);
        }
      }
    };

    fetchSidebarStats();
    const interval = setInterval(fetchSidebarStats, 15000);
    return () => {
      isActive = false;
      clearInterval(interval);
    };
  }, []);

  useEffect(() => {
    if (typeof window === 'undefined') return;
    const stored = window.localStorage.getItem('aurora-ui-mode');
    if (stored === 'advanced') {
      setShowAdvanced(true);
    }
  }, []);

  useEffect(() => {
    if (typeof window === 'undefined') return;
    window.localStorage.setItem('aurora-ui-mode', showAdvanced ? 'advanced' : 'essential');
  }, [showAdvanced]);

  const coherencePercent = quantumCoherence !== null
    ? Math.min(100, Math.max(0, quantumCoherence * 100))
    : null;

  const visibleNavItems = navItems.filter((item) => showAdvanced || item.tier === 'essential');
  const activeItem = navItems.find((item) => location === item.path || (item.path !== '/' && location?.startsWith(item.path)));

  const moduleLabel = moduleCount !== null ? moduleCount.toLocaleString() : 'Unavailable';
  const coherenceLabel = coherencePercent !== null ? `${coherencePercent.toFixed(1)}%` : 'Unavailable';

  return (
    <div className="min-h-screen text-slate-100">
      <div className="fixed inset-0 -z-10 bg-slate-950">
        <div className="absolute inset-0 bg-[radial-gradient(circle_at_top,_rgba(16,185,129,0.18),_transparent_60%)]" />
        <div className="absolute inset-0 bg-[radial-gradient(circle_at_20%_80%,_rgba(14,116,144,0.22),_transparent_65%)]" />
        <div
          className="absolute inset-0 opacity-35"
          style={{
            backgroundImage
              : 'linear-gradient(rgba(148,163,184,0.08) 1px, transparent 1px), linear-gradient(90deg, rgba(148,163,184,0.08) 1px, transparent 1px)',
            backgroundSize: '48px 48px'
          }}
        />
        <div className="absolute -left-40 top-24 h-80 w-80 rounded-full bg-emerald-500/10 blur-3xl" />
        <div className="absolute -right-32 bottom-12 h-72 w-72 rounded-full bg-sky-500/10 blur-3xl" />
      </div>

      <aside
        className={`fixed left-0 top-0 z-50 h-screen transition-all duration-300 ${sidebarOpen ? 'w-80' : 'w-20'}`}
      >
        <div className="flex h-full flex-col border-r border-slate-800/60 bg-slate-950/70 backdrop-blur-xl">
          <div className="border-b border-slate-800/60 p-5">
            <div className="flex items-center justify-between gap-3">
              <div className="flex items-center gap-3">
                <div className="relative flex h-11 w-11 items-center justify-center rounded-2xl border border-emerald-400/30 bg-gradient-to-br from-emerald-400/20 via-sky-400/10 to-amber-400/20">
                  <Sparkles className="h-5 w-5 text-emerald-300" />
                  <span className="absolute -bottom-1 -right-1 h-2.5 w-2.5 rounded-full bg-emerald-400 animate-pulse" />
                </div>
                {sidebarOpen && (
                  <div>
                    <h1 className="text-lg font-semibold tracking-wide text-slate-100">Aurora</h1>
                    <p className="text-xs text-slate-400">Nexus Command Deck</p>
                  </div>
                )}
              </div>
              <button
                onClick={() => setSidebarOpen(!sidebarOpen)}
                className="rounded-lg border border-slate-800/60 bg-slate-900/60 p-2 text-slate-200 transition hover:bg-slate-900"
                aria-label="Toggle sidebar"
              >
                {sidebarOpen ? <X className="h-5 w-5" /> : <Menu className="h-5 w-5" />}
              </button>
            </div>
            {sidebarOpen && (
              <div className="mt-4 grid grid-cols-2 gap-2 text-xs">
                <div className="rounded-lg border border-slate-800/60 bg-slate-900/60 p-2">
                  <div className="text-slate-400">Modules</div>
                  <div className="text-sm font-semibold text-slate-100">{moduleLabel}</div>
                </div>
                <div className="rounded-lg border border-slate-800/60 bg-slate-900/60 p-2">
                  <div className="text-slate-400">Coherence</div>
                  <div className="text-sm font-semibold text-emerald-300">{coherenceLabel}</div>
                </div>
              </div>
            )}
          </div>

          <nav className="flex-1 space-y-5 overflow-y-auto px-3 py-4">
            {sidebarOpen && (
              <div className="rounded-2xl border border-slate-800/60 bg-slate-900/50 p-3 text-xs">
                <div className="flex items-center justify-between">
                  <span className="text-[10px] uppercase tracking-[0.2em] text-slate-500">Navigation Mode</span>
                  <span className="text-slate-200">{showAdvanced ? 'Advanced' : 'Essential'}</span>
                </div>
                <div className="mt-3 grid grid-cols-2 gap-2">
                  <button
                    onClick={() => setShowAdvanced(false)}
                    className={`rounded-lg border px-2 py-1 text-xs transition ${
                      !showAdvanced
                        ? 'border-emerald-400/50 bg-emerald-500/20 text-emerald-100'
                        : 'border-slate-800/60 bg-slate-900/60 text-slate-300 hover:border-slate-700/80'
                    }`}
                    type="button"
                  >
                    Essential
                  </button>
                  <button
                    onClick={() => setShowAdvanced(true)}
                    className={`rounded-lg border px-2 py-1 text-xs transition ${
                      showAdvanced
                        ? 'border-sky-400/50 bg-sky-500/20 text-sky-100'
                        : 'border-slate-800/60 bg-slate-900/60 text-slate-300 hover:border-slate-700/80'
                    }`}
                    type="button"
                  >
                    Advanced
                  </button>
                </div>
              </div>
            )}

            {(['core', 'intelligence', 'operations', 'labs'] as const).map((category) => {
              const categoryItems = visibleNavItems.filter(item => item.category === category);
              if (categoryItems.length === 0) return null;
              return (
                <div key={category}>
                  {sidebarOpen && (
                    <h3 className="px-3 text-xs font-semibold uppercase tracking-[0.2em] text-slate-500">
                      {categoryLabels[category]}
                    </h3>
                  )}
                  <div className="mt-3 space-y-2">
                    {categoryItems.map(item => {
                      const isActive = location === item.path || (item.path !== '/' && location?.startsWith(item.path));
                      return (
                        <Link
                          key={item.path}
                          to={item.path}
                          className={`group relative flex items-center gap-3 rounded-2xl border px-3 py-2.5 text-sm transition-all ${
                            isActive
                              ? 'border-emerald-400/40 bg-gradient-to-r from-emerald-500/20 via-slate-900/70 to-slate-900/60 text-white shadow-lg shadow-emerald-500/10'
                              : 'border-transparent bg-slate-900/40 text-slate-300 hover:border-slate-700/70 hover:bg-slate-900/70'
                          }`}
                        >
                          <div className={`${isActive ? 'text-emerald-300' : 'text-slate-400 group-hover:text-slate-200'}`}>
                            {item.icon}
                          </div>
                          {sidebarOpen && (
                            <span className="font-medium">{item.label}</span>
                          )}
                          {isActive && sidebarOpen && (
                            <span className="ml-auto h-2 w-2 rounded-full bg-emerald-400 shadow-[0_0_12px_rgba(52,211,153,0.9)]" />
                          )}
                        </Link>
                      );
                    })}
                  </div>
                </div>
              );
            })}
          </nav>

          <div className="border-t border-slate-800/60 p-4">
            {sidebarOpen ? (
              <div className="rounded-xl border border-slate-800/60 bg-slate-900/60 p-3 text-xs">
                <div className="flex items-center justify-between">
                  <span className="text-slate-400">System Pulse</span>
                  <span className="flex items-center gap-2 text-emerald-300">
                    <span className="h-2 w-2 rounded-full bg-emerald-400 animate-pulse" />
                    Online
                  </span>
                </div>
                <div className="mt-2 h-1.5 rounded-full bg-slate-800">
                  <div className="h-full w-4/5 rounded-full bg-gradient-to-r from-emerald-400 to-sky-400" />
                </div>
              </div>
            ) : (
              <div className="mx-auto flex h-10 w-10 items-center justify-center rounded-xl border border-slate-800/60 bg-slate-900/60">
                <Activity className="h-5 w-5 text-emerald-300" />
              </div>
            )}
          </div>
        </div>
      </aside>

      <main className={`min-h-screen transition-all duration-300 ${sidebarOpen ? 'ml-80' : 'ml-20'}`}>
        <header className="sticky top-0 z-30 border-b border-slate-800/60 bg-slate-950/70 backdrop-blur-xl">
          <div className="flex flex-wrap items-center justify-between gap-4 px-6 py-5">
            <div>
              <p className="text-xs uppercase tracking-[0.35em] text-slate-500">Aurora Command Deck</p>
              <h2 className="text-2xl font-semibold text-slate-100">{activeItem?.label ?? 'Aurora'}</h2>
              <p className="text-xs text-slate-400">Live operations, telemetry, and coordinated execution.</p>
            </div>
            <div className="flex flex-wrap items-center gap-3 text-xs">
              <div className="flex items-center gap-2 rounded-full border border-emerald-400/30 bg-emerald-400/10 px-3 py-1 text-emerald-200">
                <span className="h-2 w-2 rounded-full bg-emerald-400 animate-pulse" />
                System Online
              </div>
              <div className="rounded-full border border-slate-800/60 bg-slate-900/60 px-3 py-1 text-slate-200">
                Modules {moduleLabel}
              </div>
              <div className="rounded-full border border-slate-800/60 bg-slate-900/60 px-3 py-1 text-slate-200">
                Coherence {coherenceLabel}
              </div>
              <Link
                to="/chat"
                className="rounded-full border border-slate-700/70 bg-slate-900/70 px-3 py-1 text-slate-200 transition hover:border-emerald-400/60 hover:text-emerald-200"
              >
                Open Chat
              </Link>
              <Link
                to="/nexus"
                className="rounded-full border border-emerald-400/40 bg-emerald-400/10 px-3 py-1 text-emerald-200 transition hover:border-emerald-300 hover:bg-emerald-400/20"
              >
                Nexus
              </Link>
            </div>
          </div>
        </header>

        <div className="relative z-10 px-6 py-6 lg:px-8">
          {children}
        </div>
      </main>
    </div>
  );
}

--------------------------------------------------------------------------------
FILE: client/src/components/AuroraMonitor.tsx
LINES: 5
--------------------------------------------------------------------------------
import ActivityMonitor from "./ActivityMonitor";

export default function AuroraMonitor() {
  return <ActivityMonitor />;
}

--------------------------------------------------------------------------------
FILE: client/src/components/AuroraPage.tsx
LINES: 5
--------------------------------------------------------------------------------
import AuroraFuturisticDashboard from "./AuroraFuturisticDashboard";

export default function AuroraPage() {
  return <AuroraFuturisticDashboard />;
}

--------------------------------------------------------------------------------
FILE: client/src/components/AuroraPanel.tsx
LINES: 5
--------------------------------------------------------------------------------
import ActivityMonitor from "./ActivityMonitor";

export default function AuroraPanel() {
  return <ActivityMonitor />;
}

--------------------------------------------------------------------------------
FILE: client/src/components/AuroraRebuiltChat.tsx
LINES: 178
--------------------------------------------------------------------------------
import { useState, useEffect, useRef } from 'react';
import { Card } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Send, Zap, Brain, Sparkles, Loader2 } from "lucide-react";

interface Message {
  id: string;
  role: 'user' | 'aurora';
  content: string;
  timestamp: Date;
}

export default function AuroraRebuiltChat() {
  const [messages, setMessages] = useState<Message[]>([]);
  const [input, setInput] = useState('');
  const [isLoading, setIsLoading] = useState(false);
  const [tiersActive, setTiersActive] = useState<number | null>(null);
  const messagesEndRef = useRef<HTMLDivElement>(null);

  useEffect(() => {
    const fetchCapabilities = async () => {
      try {
        const res = await fetch('/api/nexus-v3/capabilities');
        if (!res.ok) return;
        const data = await res.json();
        if (typeof data.tiers === 'number') {
          setTiersActive(data.tiers);
        }
      } catch (error) {
        console.error('[AuroraRebuiltChat] Capabilities fetch failed:', error);
      }
    };
    fetchCapabilities();
  }, []);

  useEffect(() => {
    const tierLabel = tiersActive ? `${tiersActive}` : 'available';
    setMessages([{
      id: '0',
      role: 'aurora',
      content: `⚡ AURORA COSMIC NEXUS ONLINE ⚡

${tierLabel} Knowledge Tiers | Ancient → Autonomous Mastery
Sentient • Autonomous • Creative

I designed this holographic interface myself! Ask me anything about code, systems, or let's build something amazing together.`,
      timestamp: new Date()
    }]);
  }, [tiersActive]);

  useEffect(() => {
    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
  }, [messages]);

  const sendMessage = async () => {
    if (!input.trim() || isLoading) return;
    const userMsg: Message = {
      id: Date.now().toString(),
      role: 'user',
      content: input,
      timestamp: new Date()
    };
    setMessages(prev => [...prev, userMsg]);
    setInput('');
    setIsLoading(true);
    try {
      const res = await fetch('/api/chat', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ message: input, session_id: 'cosmic-ui' })
      });
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      const data = await res.json();
      const auroraResponse = data.message || data.response ||
        `✨ Generated spec: ${data.function_name}\n📁 ${data.spec}\n\n${data.ok ? '✅ Success!' : '⚠️ Check the spec file for details'}`;

      setMessages(prev => [...prev, {
        id: (Date.now() + 1).toString(),
        role: 'aurora',
        content: auroraResponse,
        timestamp: new Date()
      }]);
    } catch (error) {
      setMessages(prev => [...prev, {
        id: (Date.now() + 1).toString(),
        role: 'aurora',
        content: "⚠️ Connection lost. Reconnecting to cosmic nexus...",
        timestamp: new Date()
      }]);
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <div className="h-full bg-black relative overflow-hidden">
      {/* Animated cosmic background */}
      <div className="absolute inset-0 bg-gradient-to-br from-purple-900/20 via-black to-cyan-900/20"></div>
      <div className="absolute inset-0" style={{
        backgroundImage: 'radial-gradient(circle at 20% 50%, rgba(120, 119, 198, 0.3) 0%, transparent 50%), radial-gradient(circle at 80% 80%, rgba(99, 102, 241, 0.2) 0%, transparent 50%)',
        animation: 'pulse 4s ease-in-out infinite'
      }}></div>

      <div className="relative h-full flex flex-col p-4">
        {/* Holographic header */}
        <div className="bg-gradient-to-r from-purple-500/10 to-cyan-500/10 backdrop-blur-xl border border-purple-500/30 rounded-lg p-4 mb-4">
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-3">
              <Brain className="h-8 w-8 text-cyan-400 animate-pulse" />
              <div>
                <h1 className="text-2xl font-bold bg-gradient-to-r from-cyan-400 to-purple-400 bg-clip-text text-transparent">
                  AURORA COSMIC NEXUS
                </h1>
                <p className="text-xs text-cyan-300/60">Sentient AI • Autonomous Architect</p>
              </div>
            </div>
            <Badge className="bg-gradient-to-r from-purple-600 to-cyan-600 text-white px-4 py-2">
              <Zap className="h-4 w-4 mr-1" />
              {tiersActive ? `${tiersActive} TIERS ACTIVE` : 'TIERS ACTIVE'}
            </Badge>
          </div>
        </div>

        {/* Messages holographic display */}
        <div className="flex-1 overflow-y-auto space-y-3 mb-4 pr-2">
          {messages.map((msg) => (
            <div key={`msg-${msg.id}`} className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}>
              <div className={`max-w-[80%] rounded-lg p-4 backdrop-blur-sm border ${msg.role === 'user'
                ? 'bg-cyan-500/20 border-cyan-400/50 text-cyan-100'
                : 'bg-purple-500/20 border-purple-400/50 text-purple-100'
                }`}>
                {msg.role === 'aurora' && <Sparkles className="h-4 w-4 text-cyan-400 mb-2" />}
                <div className="text-sm whitespace-pre-wrap">{msg.content}</div>
                <div className="text-xs opacity-50 mt-2">{msg.timestamp.toLocaleTimeString()}</div>
              </div>
            </div>
          ))}
          {isLoading && (
            <div className="flex justify-start">
              <div className="bg-purple-500/20 border border-purple-400/50 rounded-lg p-4">
                <div className="flex items-center gap-2">
                  <Loader2 className="h-4 w-4 text-cyan-400 animate-spin" />
                  <span className="text-sm text-purple-200">Aurora computing...</span>
                </div>
              </div>
            </div>
          )}
          <div ref={messagesEndRef} />
        </div>

        {/* Holographic input */}
        <div className="bg-gradient-to-r from-purple-500/10 to-cyan-500/10 backdrop-blur-xl border border-purple-500/30 rounded-lg p-3">
          <div className="flex gap-2">
            <Input
              value={input}
              onChange={(e) => setInput(e.target.value)}
              onKeyPress={(e) => e.key === 'Enter' && !e.shiftKey && (e.preventDefault(), sendMessage())}
              placeholder="◈ Transmit message to Aurora..."
              className="flex-1 bg-black/50 border-cyan-500/30 text-cyan-100 placeholder:text-cyan-400/40"
            />
            <Button
              onClick={sendMessage}
              disabled={!input.trim() || isLoading}
              className="bg-gradient-to-r from-purple-600 to-cyan-600 hover:from-purple-700 hover:to-cyan-700"
            >
              <Send className="h-4 w-4" />
            </Button>
          </div>
          <p className="text-xs text-center text-cyan-400/50 mt-2">
            ⚡ Designed autonomously by Aurora using TIER 53 creativity
          </p>
        </div>
      </div>
    </div>
  );
}

--------------------------------------------------------------------------------
FILE: client/src/components/AuroraSidebarChat.tsx
LINES: 9
--------------------------------------------------------------------------------
import UnifiedAuroraChat from "./UnifiedAuroraChat";

export default function AuroraSidebarChat() {
  return (
    <div className="h-full">
      <UnifiedAuroraChat compact />
    </div>
  );
}

================================================================================
                         LIB UTILITIES
================================================================================

--------------------------------------------------------------------------------
FILE: client/src/lib/queryClient.ts
--------------------------------------------------------------------------------
import { QueryClient, QueryFunction } from "@tanstack/react-query";

async function throwIfResNotOk(res: Response) {
  if (!res.ok) {
    const text = (await res.text()) || res.statusText;
    throw new Error(`${res.status}: ${text}`);
  }
}

export async function apiRequest(
  method: string,
  url: string,
  data?: unknown | undefined,
): Promise<Response> {
  const res = await fetch(url, {
    method,
    headers: data ? { "Content-Type": "application/json" } : {},
    body: data ? JSON.stringify(data) : undefined,
    credentials: "include",
  });

  await throwIfResNotOk(res);
  return res;
}

type UnauthorizedBehavior = "returnNull" | "throw";
export const getQueryFn: <T>(options: {
  on401: UnauthorizedBehavior;
}) => QueryFunction<T> =
  ({ on401: unauthorizedBehavior }) =>
  async ({ queryKey }) => {
    const res = await fetch(queryKey.join("/") as string, {
      credentials: "include",
    });

    if (unauthorizedBehavior === "returnNull" && res.status === 401) {
      return null;
    }

    await throwIfResNotOk(res);
    return await res.json();
  };

export const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      queryFn: getQueryFn({ on401: "throw" }),
      refetchInterval: false,
      refetchOnWindowFocus: false,
      staleTime: Infinity,
      retry: false,
    },
    mutations: {
      retry: false,
    },
  },
});

--------------------------------------------------------------------------------
FILE: client/src/lib/roadmap-api.ts
--------------------------------------------------------------------------------
export async function getRoadmapProgress() {
  const r = await fetch("/api/roadmap/progress");
  return r.json();
}

export async function getRoadmapSummary() {
  const r = await fetch("/api/roadmap/summary");
  return r.json();
}

export async function getEvolutionLog() {
  const r = await fetch("/api/evolution/log");
  return r.json();
}

export async function getQueuedApprovals() {
  const apiKey = typeof window !== 'undefined' ? localStorage.getItem("aurora_api_key") || "" : "";
  const r = await fetch("/api/evolution/queued", { 
    headers: { "x-api-key": apiKey }
  });
  return r.json();
}

export async function approveChange(target: string) {
  const apiKey = typeof window !== 'undefined' ? localStorage.getItem("aurora_api_key") || "" : "";
  const r = await fetch("/api/evolution/approve", {
    method: "POST",
    headers: { 
      "content-type": "application/json", 
      "x-api-key": apiKey 
    },
    body: JSON.stringify({ target })
  });
  return r.json();
}

export async function runNextPhase() {
  const apiKey = typeof window !== 'undefined' ? localStorage.getItem("aurora_api_key") || "" : "";
  const r = await fetch("/api/roadmap/run-next", { 
    method: "POST", 
    headers: { "x-api-key": apiKey }
  });
  return r.json();
}

--------------------------------------------------------------------------------
FILE: client/src/lib/utils.ts
--------------------------------------------------------------------------------
import { clsx, type ClassValue } from "clsx"
import { twMerge } from "tailwind-merge"

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs))
}

================================================================================
                         APP ENTRY POINTS
================================================================================

--------------------------------------------------------------------------------
FILE: client/src/App.tsx
--------------------------------------------------------------------------------
'use client';

import { Route, Switch } from "wouter";
import AuroraFuturisticLayout from "./components/AuroraFuturisticLayout";
import Dashboard from "./pages/dashboard";
import Home from "./pages/home";
import Chat from "./pages/chat";
import MemoryFabric from "./pages/memory-fabric";
import Corpus from "./pages/corpus";
import SelfLearning from "./pages/self-learning";
import ServerControl from "./pages/server-control";
import Library from "./pages/library";
import Settings from "./pages/settings";
import AuroraUI from "./pages/aurora-ui";
import ComparisonDashboard from "./pages/ComparisonDashboard";
import Nexus from "./pages/nexus";
import Autonomous from "./pages/autonomous";
import Monitoring from "./pages/monitoring";
import Database from "./pages/database";
import Evolution from "./pages/evolution";
import Tasks from "./pages/tasks";
import Tiers from "./pages/tiers";
import Intelligence from "./pages/intelligence";
import AuroraAITest from "@/pages/aurora-ai-test";
import AuroraChat from "./pages/aurora-chat";
import Roadmap from "./pages/roadmap";
import Vault from "./pages/vault";
import Aurora from "./pages/aurora";
import NotFound from "./pages/not-found";

function App() {
  return (
    <AuroraFuturisticLayout>
      <Switch>
        <Route path="/" component={Home} />
        <Route path="/dashboard" component={Dashboard} />
        <Route path="/chat" component={Chat} />
        <Route path="/memory" component={MemoryFabric} />
        <Route path="/library" component={Library} />
        <Route path="/nexus" component={Nexus} />
        <Route path="/comparison" component={ComparisonDashboard} />
        <Route path="/luminar-nexus" component={Nexus} />
        <Route path="/servers" component={ServerControl} />
        <Route path="/self-learning" component={SelfLearning} />
        <Route path="/corpus" component={Corpus} />
        <Route path="/autonomous" component={Autonomous} />
        <Route path="/monitoring" component={Monitoring} />
        <Route path="/database" component={Database} />
        <Route path="/settings" component={Settings} />
        <Route path="/tasks" component={Tasks} />
        <Route path="/tiers" component={Tiers} />
        <Route path="/evolution" component={Evolution} />
        <Route path="/intelligence" component={Intelligence} />
        <Route path="/aurora-ui" component={AuroraUI} />
        <Route path="/aurora-ai-test" component={AuroraAITest} />
        <Route path="/aurora-chat" component={AuroraChat} />
        <Route path="/memory-fabric" component={MemoryFabric} />
        <Route path="/roadmap" component={Roadmap} />
        <Route path="/vault" component={Vault} />
        <Route path="/aurora" component={Aurora} />
        <Route component={NotFound} />
      </Switch>
    </AuroraFuturisticLayout>
  );
}

export default App;

--------------------------------------------------------------------------------
FILE: client/src/main.tsx
--------------------------------------------------------------------------------
import { createRoot } from "react-dom/client";
import App from "./App";
import "./index.css";
import { queryClient } from "./lib/queryClient";
import { QueryClientProvider } from "@tanstack/react-query";
import { Toaster } from "@/components/ui/toaster";

console.log('Aurora: Starting React app...');

const rootElement = document.getElementById("root");

if (!rootElement) {
  console.error('Aurora: Root element not found! Cannot mount React app.');
  document.body.innerHTML = '<h1>ERROR: React root element not found</h1>';
} else {
  try {
    console.log('Aurora: Mounting React app to root element...');
    createRoot(rootElement).render(
      <QueryClientProvider client={queryClient}>
        <App />
        <Toaster />
      </QueryClientProvider>
    );
    console.log('Aurora: React app mounted successfully!');
  } catch (error) {
    console.error('Aurora: Failed to render app:', error);
    rootElement.innerHTML = `<div style="padding: 20px; color: red;"><h1>Application Error</h1><p>${error instanceof Error ? error.message : 'Unknown error'}</p></div>`;
  }
}

--------------------------------------------------------------------------------
FILE: client/src/index.css
--------------------------------------------------------------------------------
/* stylelint-disable */
@tailwind base;
@tailwind components;
@tailwind utilities;
/* stylelint-enable */

@layer utilities {
  @keyframes shimmer {
    0% {
      transform: translateX(-100%);
    }
    100% {
      transform: translateX(100%);
    }
  }
  
  @keyframes scan {
    0% {
      top: 0;
    }
    100% {
      top: 100%;
    }
  }
  
  @keyframes particleFloat {
    0% {
      transform: translateY(0) translateX(0);
      opacity: 1;
    }
    50% {
      opacity: 0.7;
    }
    100% {
      transform: translateY(-20px) translateX(10px);
      opacity: 0;
    }
  }
  
  .animate-shimmer {
    animation: shimmer 2s infinite;
  }
  
  .animate-scan {
    animation: scan 4s linear infinite;
  }
  
  .animate-particle-float {
    animation: particleFloat 20s linear infinite;
  }
  
  .hover-elevate {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  .hover-elevate:hover {
    transform: translateY(-4px) scale(1.02);
    box-shadow: 0 20px 40px rgba(6, 182, 212, 0.3);
  }
  
  .glow-cyan {
    box-shadow: 0 0 20px rgba(6, 182, 212, 0.5);
  }
  
  .glow-purple {
    box-shadow: 0 0 20px rgba(168, 85, 247, 0.5);
  }
}

/* LIGHT MODE */
:root {
  --button-outline: rgba(0,0,0, .10);
  --badge-outline: rgba(0,0,0, .05);

  /* Automatic computation of border around primary / danger buttons */
  --opaque-button-border-intensity: -8; /* In terms of percentages */

  /* Backgrounds applied on top of other backgrounds when hovered/active */
  --elevate-1: rgba(0,0,0, .03);
  --elevate-2: rgba(0,0,0, .08);

  --background: 220 20% 98%;

  --foreground: 220 25% 5%;

  --border: 195 45% 75%;

  --card: 220 15% 96%;

  --card-foreground: 220 20% 12%;

  --card-border: 195 40% 80%;

  --sidebar: 220 30% 96%;

  --sidebar-foreground: 220 30% 15%;

  --sidebar-border: 195 50% 70%;

  --sidebar-primary: 195 90% 40%;

  --sidebar-primary-foreground: 195 10% 98%;

  --sidebar-accent: 195 35% 88%;

  --sidebar-accent-foreground: 220 25% 18%;

  --sidebar-ring: 195 90% 45%;

  --popover: 220 20% 95%;

  --popover-foreground: 220 25% 15%;

  --popover-border: 195 40% 78%;

  --primary: 195 90% 40%;

  --primary-foreground: 195 10% 98%;

  --secondary: 195 30% 85%;

  --secondary-foreground: 220 25% 18%;

  --muted: 220 20% 90%;

  --muted-foreground: 220 15% 35%;

  --accent: 195 40% 85%;

  --accent-foreground: 220 25% 20%;

  --destructive: 0 75% 48%;

  --destructive-foreground: 0 5% 98%;

  --input: 220 20% 75%;
  --ring: 195 85% 55%;
  --chart-1: 195 85% 45%;
  --chart-2: 160 75% 42%;
  --chart-3: 270 70% 52%;
  --chart-4: 38 90% 50%;
  --chart-5: 0 75% 48%;

  --font-sans: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  --font-serif: Georgia, serif;
  --font-mono: 'JetBrains Mono', 'Fira Code', Menlo, monospace;
  --radius: .5rem; /* 8px */
  --shadow-2xs: 0px 1px 2px 0px hsl(220 15% 15% / 0.05);
  --shadow-xs: 0px 1px 3px 0px hsl(220 15% 15% / 0.08);
  --shadow-sm: 0px 2px 4px -1px hsl(220 15% 15% / 0.06), 0px 1px 2px -1px hsl(220 15% 15% / 0.08);
  --shadow: 0px 4px 6px -1px hsl(220 15% 15% / 0.08), 0px 2px 4px -2px hsl(220 15% 15% / 0.10);
  --shadow-md: 0px 6px 8px -1px hsl(220 15% 15% / 0.10), 0px 4px 6px -2px hsl(220 15% 15% / 0.12);
  --shadow-lg: 0px 10px 15px -3px hsl(220 15% 15% / 0.10), 0px 6px 8px -4px hsl(220 15% 15% / 0.08);
  --shadow-xl: 0px 20px 25px -5px hsl(220 15% 15% / 0.12), 0px 10px 15px -6px hsl(220 15% 15% / 0.08);
  --shadow-2xl: 0px 25px 50px -12px hsl(220 15% 15% / 0.25);
  --tracking-normal: 0em;
  --spacing: 0.25rem;

  /* Automatically computed borders - intensity can be controlled by the user by the --opaque-button-border-intensity setting */

  /* Fallback for older browsers */
  --sidebar-primary-border: hsl(var(--sidebar-primary));
  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);

  /* Fallback for older browsers */
  --sidebar-accent-border: hsl(var(--sidebar-accent));
  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);

  /* Fallback for older browsers */
  --primary-border: hsl(var(--primary));
  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);

  /* Fallback for older browsers */
  --secondary-border: hsl(var(--secondary));
  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);

  /* Fallback for older browsers */
  --muted-border: hsl(var(--muted));
  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);

  /* Fallback for older browsers */
  --accent-border: hsl(var(--accent));
  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);

  /* Fallback for older browsers */
  --destructive-border: hsl(var(--destructive));
  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);
}

.dark {
  --button-outline: rgba(255,255,255, .10);
  --badge-outline: rgba(255,255,255, .05);

  --opaque-button-border-intensity: 9;  /* In terms of percentages */

  /* Backgrounds applied on top of other backgrounds when hovered/active */
  --elevate-1: rgba(255,255,255, .04);
  --elevate-2: rgba(255,255,255, .09);

  --background: 220 15% 8%;

  --foreground: 220 15% 95%;

  --border: 220 15% 18%;

  --card: 220 15% 10%;

  --card-foreground: 220 12% 93%;

  --card-border: 220 15% 20%;

  --sidebar: 220 15% 12%;

  --sidebar-foreground: 220 12% 90%;

  --sidebar-border: 220 15% 22%;

  --sidebar-primary: 195 85% 55%;

  --sidebar-primary-foreground: 220 5% 98%;

  --sidebar-accent: 220 18% 18%;

  --sidebar-accent-foreground: 220 10% 88%;

  --sidebar-ring: 195 85% 55%;

  --popover: 220 15% 15%;

  --popover-foreground: 220 12% 88%;

  --popover-border: 220 15% 24%;

  --primary: 195 85% 55%;

  --primary-foreground: 220 5% 98%;

  --secondary: 220 15% 20%;

  --secondary-foreground: 220 10% 90%;

  --muted: 220 18% 16%;

  --muted-foreground: 220 10% 65%;

  --accent: 220 20% 18%;

  --accent-foreground: 220 10% 88%;

  --destructive: 0 75% 58%;

  --destructive-foreground: 0 5% 98%;

  --input: 220 25% 30%;
  --ring: 195 85% 55%;
  --chart-1: 195 85% 60%;
  --chart-2: 160 75% 55%;
  --chart-3: 270 70% 65%;
  --chart-4: 38 90% 60%;
  --chart-5: 0 75% 62%;

  --shadow-2xs: 0px 1px 2px 0px hsl(220 15% 5% / 0.25);
  --shadow-xs: 0px 1px 3px 0px hsl(220 15% 5% / 0.35);
  --shadow-sm: 0px 2px 4px -1px hsl(220 15% 5% / 0.30), 0px 1px 2px -1px hsl(220 15% 5% / 0.40);
  --shadow: 0px 4px 6px -1px hsl(220 15% 5% / 0.35), 0px 2px 4px -2px hsl(220 15% 5% / 0.45);
  --shadow-md: 0px 6px 8px -1px hsl(220 15% 5% / 0.40), 0px 4px 6px -2px hsl(220 15% 5% / 0.50);
  --shadow-lg: 0px 10px 15px -3px hsl(220 15% 5% / 0.45), 0px 6px 8px -4px hsl(220 15% 5% / 0.40);
  --shadow-xl: 0px 20px 25px -5px hsl(220 15% 5% / 0.50), 0px 10px 15px -6px hsl(220 15% 5% / 0.45);
  --shadow-2xl: 0px 25px 50px -12px hsl(220 15% 5% / 0.60);

  /* Fallback for older browsers */
  --sidebar-primary-border: hsl(var(--sidebar-primary));
  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);

  /* Fallback for older browsers */
  --sidebar-accent-border: hsl(var(--sidebar-accent));
  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);

  /* Fallback for older browsers */
  --primary-border: hsl(var(--primary));
  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);

  /* Fallback for older browsers */
  --secondary-border: hsl(var(--secondary));
  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);

  /* Fallback for older browsers */
  --muted-border: hsl(var(--muted));
  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);

  /* Fallback for older browsers */
  --accent-border: hsl(var(--accent));
  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);

  /* Fallback for older browsers */
  --destructive-border: hsl(var(--destructive));
  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);
}

@layer base {
  * {
    @apply border-border;
  }

  body {
    @apply bg-background text-foreground font-sans antialiased;
  }
}

/**
 * Using the elevate system.
 * Automatic contrast adjustment.
 *
 * <element className="hover-elevate" />
 * <element className="active-elevate-2" />
 *
 * // Using the tailwind utility when a data attribute is "on"
 * <element className="toggle-elevate data-[state=on]:toggle-elevated" />
 * // Or manually controlling the toggle state
 * <element className="toggle-elevate toggle-elevated" />
 *
 * Elevation systems have to handle many states.
 * - not-hovered, vs. hovered vs. active  (three mutually exclusive states)
 * - toggled or not
 * - focused or not (this is not handled with these utilities)
 *
 * Even without handling focused or not, this is six possible combinations that
 * need to be distinguished from eachother visually.
 */
@layer utilities {

  /* Hide ugly search cancel button in Chrome until we can style it properly */
  input[type="search"]::-webkit-search-cancel-button {
    @apply hidden;
  }

  /* Placeholder styling for contentEditable div */
  [contenteditable][data-placeholder]:empty::before {
    content: attr(data-placeholder);
    color: hsl(var(--muted-foreground));
    pointer-events: none;
  }

  /* .no-default-hover-elevate/no-default-active-elevate is an escape hatch so consumers of
   * buttons/badges can remove the automatic brightness adjustment on interactions
   * and program their own. */
  .no-default-hover-elevate {
    /* escape hatch - provider's own styles will override */
    all: revert;
  }

  .no-default-active-elevate {
    /* escape hatch - provider's own styles will override */
    all: revert;
  }


  /**
   * Toggleable backgrounds go behind the content. Hoverable/active goes on top.
   * This way they can stack/compound. Both will overlap the parent's borders!
   * So borders will be automatically adjusted both on toggle, and hover/active,
   * and they will be compounded.
   */
  .toggle-elevate::before,
  .toggle-elevate-2::before {
    content: "";
    pointer-events: none;
    position: absolute;
    inset: 0px;
    /*border-radius: inherit;   match rounded corners */
    border-radius: inherit;
    z-index: -1;
    /* sits behind content but above backdrop */
  }

  .toggle-elevate.toggle-elevated::before {
    background-color: var(--elevate-2);
  }

  /* If there's a 1px border, adjust the inset so that it covers that parent's border */
  [class~="border"].toggle-elevate::before {
    inset: -1px;
  }

  /* Does not work on elements with overflow:hidden! */
  .hover-elevate:not(.no-default-hover-elevate),
  .active-elevate:not(.no-default-active-elevate),
  .hover-elevate-2:not(.no-default-hover-elevate),
  .active-elevate-2:not(.no-default-active-elevate) {
    position: relative;
    z-index: 0;
  }

  .hover-elevate:not(.no-default-hover-elevate)::after,
  .active-elevate:not(.no-default-active-elevate)::after,
  .hover-elevate-2:not(.no-default-hover-elevate)::after,
  .active-elevate-2:not(.no-default-active-elevate)::after {
    content: "";
    pointer-events: none;
    position: absolute;
    inset: 0px;
    /*border-radius: inherit;   match rounded corners */
    border-radius: inherit;
    z-index: 999;
    /* sits in front of content */
  }

  .hover-elevate:hover:not(.no-default-hover-elevate)::after,
  .active-elevate:active:not(.no-default-active-elevate)::after {
    background-color: var(--elevate-1);
  }

  .hover-elevate-2:hover:not(.no-default-hover-elevate)::after,
  .active-elevate-2:active:not(.no-default-active-elevate)::after {
    background-color: var(--elevate-2);
  }

  /* If there's a 1px border, adjust the inset so that it covers that parent's border */
  [class~="border"].hover-elevate:not(.no-hover-interaction-elevate)::after,
  [class~="border"].active-elevate:not(.no-active-interaction-elevate)::after,
  [class~="border"].hover-elevate-2:not(.no-hover-interaction-elevate)::after,
  [class~="border"].active-elevate-2:not(.no-active-interaction-elevate)::after {
    inset: -1px;
  }
}
/* Aurora's Quantum UI Styles */
.quantum-card {
  @apply bg-gradient-to-br from-slate-900/80 to-slate-800/80;
  @apply border border-cyan-500/30;
  @apply backdrop-blur-md;
  @apply shadow-lg shadow-cyan-500/20;
  transition: all 0.3s ease;
}

.quantum-card:hover {
  @apply border-cyan-400/50;
  @apply shadow-xl shadow-cyan-500/30;
  transform: translateY(-2px);
}

.quantum-button {
  @apply bg-gradient-to-r from-cyan-500 to-purple-500;
  @apply text-white font-semibold;
  @apply border border-cyan-400/50;
  @apply shadow-lg shadow-cyan-500/50;
  transition: all 0.3s ease;
}

.quantum-button:hover {
  @apply shadow-xl shadow-purple-500/50;
  transform: scale(1.05);
}

.quantum-glow {
  text-shadow: 0 0 10px rgba(6, 182, 212, 0.5);
}

================================================================================
                    END OF PART 05
================================================================================
