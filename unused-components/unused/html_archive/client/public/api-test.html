<!DOCTYPE html>
<html>

<head>
  <title>Aurora API Test</title>
</head>

<body>
  <h1>Aurora API Direct Test</h1>
  <button onclick="testAPI()">Test Aurora API</button>
  <div id="result"></div>

  <script>
    function testAuroraAPI() {
      const message = document.getElementById('message').value || 'Hello Aurora';
      const results = document.getElementById('results');

      results.innerHTML = '<div class="loading">Testing API...</div>';

      // Test multiple endpoints to find the issue
      console.log('Testing Aurora API endpoints...');

      // Test 1: Direct API call
      results.innerHTML += '<h3>Test 1: /api/chat endpoint</h3>';

      fetch('/api/chat', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          message: message,
          session_id: 'api-test'
        })
      })
        .then(response => {
          console.log('Response status:', response.status);
          console.log('Response headers:', [...response.headers.entries()]);
          console.log('Response URL:', response.url);
          console.log('Response type:', response.type);

          results.innerHTML += `<div><strong>Status:</strong> ${response.status} ${response.statusText}</div>`;
          results.innerHTML += `<div><strong>URL:</strong> ${response.url}</div>`;
          results.innerHTML += `<div><strong>Type:</strong> ${response.type}</div>`;
          results.innerHTML += `<div><strong>Headers:</strong> <pre>${JSON.stringify([...response.headers.entries()], null, 2)}</pre></div>`;

          return response.text();
        })
        .then(text => {
          console.log('Response text:', text);
          results.innerHTML += `<div><strong>Raw Response:</strong> <pre>${text}</pre></div>`;

          try {
            const json = JSON.parse(text);
            results.innerHTML += `<div><strong>Parsed JSON:</strong> <pre>${JSON.stringify(json, null, 2)}</pre></div>`;
          } catch (e) {
            results.innerHTML += `<div><strong>JSON Parse Error:</strong> ${e.message}</div>`;
          }

          // Test 2: Test the proxy routing
          results.innerHTML += '<h3>Test 2: Proxy routing check</h3>';
          return testProxyRouting();
        })
        .catch(error => {
          console.error('Error:', error);
          results.innerHTML += `<div><strong>Fetch Error:</strong> ${error.message}</div>`;
          results.innerHTML += `<div><strong>Error Stack:</strong> <pre>${error.stack}</pre></div>`;
        });
    }

    function testProxyRouting() {
      const results = document.getElementById('results');

      // Test if we can reach other API endpoints
      const endpoints = ['/api/health', '/api/status', '/api/chat/status'];

      endpoints.forEach(endpoint => {
        fetch(endpoint, { method: 'GET' })
          .then(response => {
            results.innerHTML += `<div><strong>${endpoint}:</strong> ${response.status} ${response.statusText}</div>`;
            return response.text();
          })
          .then(text => {
            results.innerHTML += `<div><strong>${endpoint} Response:</strong> <pre>${text.substring(0, 200)}...</pre></div>`;
          })
          .catch(error => {
            results.innerHTML += `<div><strong>${endpoint} Error:</strong> ${error.message}</div>`;
          });
      });
    }
  </script>
</body>

</html>