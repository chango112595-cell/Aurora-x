<!DOCTYPE html>
<html>

<head>
    <title>Aurora Luminar Nexus v2 - Advanced Interface</title>
    <style>
        body {
            font-family: 'Monaco', 'Menlo', monospace;
            max-width: 1200px;
            margin: 20px auto;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
            color: #00ff88;
            padding: 20px;
            min-height: 100vh;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            border: 2px solid #00ff88;
            padding: 20px;
            border-radius: 10px;
            background: rgba(0, 255, 136, 0.05);
        }

        .quantum-indicator {
            display: inline-block;
            padding: 5px 15px;
            margin: 5px;
            border: 1px solid;
            border-radius: 5px;
            font-size: 12px;
        }

        .quantum-stable {
            border-color: #00ff88;
            color: #00ff88;
        }

        .quantum-superposition {
            border-color: #ff8800;
            color: #ff8800;
        }

        .quantum-entangled {
            border-color: #8800ff;
            color: #8800ff;
        }

        .system-status {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .status-panel {
            border: 1px solid #00ff88;
            padding: 15px;
            background: #0a0a0a;
            border-radius: 5px;
        }

        #messages {
            border: 1px solid #00ff88;
            padding: 20px;
            margin: 20px 0;
            min-height: 400px;
            background: #0a0a0a;
            border-radius: 5px;
        }

        .message {
            margin: 10px 0;
            padding: 10px;
            border-left: 3px solid #00ff88;
            border-radius: 3px;
        }

        .user {
            color: #88ccff;
            background: rgba(136, 204, 255, 0.1);
        }

        .assistant {
            color: #00ff88;
            background: rgba(0, 255, 136, 0.1);
        }

        .system {
            color: #ff8800;
            background: rgba(255, 136, 0, 0.1);
            border-left-color: #ff8800;
        }

        input,
        button {
            background: #0a0a0a;
            border: 1px solid #00ff88;
            color: #00ff88;
            padding: 12px;
            font-family: monospace;
            border-radius: 3px;
        }

        button {
            cursor: pointer;
            transition: all 0.3s;
        }

        button:hover {
            background: #00ff88;
            color: #0a0a0a;
        }

        .control-panel {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 10px;
            margin: 10px 0;
        }

        .metric {
            font-size: 11px;
            color: #888;
        }
    </style>
</head>

<body>
    <div class="header">
        <h1>ÔøΩ Aurora Luminar Nexus v2 - Advanced System Interface</h1>
        <p>AI-Driven Orchestration | Quantum Coherence Monitoring | Autonomous Healing</p>
        <div id="quantum-states"></div>
    </div>

    <div class="system-status">
        <div class="status-panel">
            <h3>üîã System Status</h3>
            <div id="system-metrics"></div>
        </div>
        <div class="status-panel">
            <h3>üè• Service Health</h3>
            <div id="service-health"></div>
        </div>
    </div>

    <div class="control-panel">
        <input type="text" id="input" placeholder="Send message to Aurora via Luminar Nexus v2...">
        <button onclick="sendMessage()">Send Message</button>
        <button onclick="refreshStatus()">Refresh Status</button>
    </div>

    <div id="messages"></div>

    <script>
        const messagesDiv = document.getElementById('messages');
        const inputField = document.getElementById('input');

        // Store system status for display
        let systemStatus = null;

        function addMessage(role, content, timestamp = true) {
            const div = document.createElement('div');
            div.className = 'message ' + role;
            const time = timestamp ? new Date().toLocaleTimeString() : '';
            div.innerHTML = `<strong>${role}${timestamp ? ' [' + time + ']' : ''}:</strong><br>${content}`;
            messagesDiv.appendChild(div);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function formatJSON(obj) {
            return '<pre>' + JSON.stringify(obj, null, 2) + '</pre>';
        }

        async function refreshStatus() {
            try {
                // Get Luminar Nexus v2 status
                const nexusResponse = await fetch('http://localhost:5005/api/nexus/status');
                const nexusStatus = await nexusResponse.json();
                systemStatus = nexusStatus;

                updateSystemDisplay(nexusStatus);
                addMessage('system', '‚úÖ System status updated via Luminar Nexus v2');

            } catch (error) {
                console.error('Status refresh error:', error);
                addMessage('system', '‚ùå Failed to refresh status: ' + error.message);
            }
        }

        function updateSystemDisplay(status) {
            // Update quantum states
            const quantumDiv = document.getElementById('quantum-states');
            const services = Object.values(status.services || {});
            const quantumStates = {};

            services.forEach(service => {
                const state = service.quantum_state || 'stable';
                if (!quantumStates[state]) quantumStates[state] = [];
                quantumStates[state].push(service.service_name);
            });

            quantumDiv.innerHTML = Object.keys(quantumStates).map(state =>
                `<span class="quantum-indicator quantum-${state}">${state.toUpperCase()}: ${quantumStates[state].join(', ')}</span>`
            ).join('');

            // Update system metrics
            const metricsDiv = document.getElementById('system-metrics');
            metricsDiv.innerHTML = `
                <div><strong>Version:</strong> ${status.version || 'Unknown'}</div>
                <div><strong>Uptime:</strong> ${status.uptime || 'Unknown'}</div>
                <div><strong>Quantum Coherence:</strong> <span style="color: ${status.quantum_coherence >= 0.8 ? '#00ff88' : '#ff8800'}">${status.quantum_coherence || 0}</span></div>
                <div><strong>AI Learning:</strong> ${status.ai_learning_active ? '‚úÖ Active' : '‚ùå Inactive'}</div>
                <div><strong>Auto Healing:</strong> ${status.autonomous_healing_active ? '‚úÖ Active' : '‚ùå Inactive'}</div>
            `;

            // Update service health
            const healthDiv = document.getElementById('service-health');
            const healthyCount = status.healthy_services || 0;
            const totalCount = status.total_services || 0;

            healthDiv.innerHTML = `
                <div><strong>Services:</strong> ${healthyCount}/${totalCount} Healthy</div>
                ${services.map(service => `
                    <div class="metric">
                        <strong>${service.service_name}:</strong> ${service.status}
                        (Port: ${service.port}, Mem: ${(service.memory_usage * 100).toFixed(2)}%)
                    </div>
                `).join('')}
            `;
        }

        async function sendMessage() {
            const prompt = inputField.value;
            if (!prompt) return;

            addMessage('user', prompt);
            inputField.value = '';

            try {
                console.log('ÔøΩ Sending to Aurora via Luminar Nexus v2:', prompt);

                // Try multiple Aurora endpoints for maximum compatibility
                let response, data;
                const endpoints = [
                    'http://localhost:5001/chat',    // Aurora Bridge
                    'http://localhost:5003/api/chat' // Direct chat service
                ];

                for (const endpoint of endpoints) {
                    try {
                        response = await fetch(endpoint, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ prompt, message: prompt })
                        });

                        if (response.ok) {
                            data = await response.json();
                            break;
                        }
                    } catch (err) {
                        console.log(`Endpoint ${endpoint} failed:`, err.message);
                    }
                }

                if (data) {
                    console.log('üì¶ Aurora response:', data);

                    // Format Aurora's response beautifully
                    let auroraReply = 'ÔøΩ Aurora via Luminar Nexus v2:\n\n';

                    if (data.response) {
                        auroraReply += data.response;
                    } else if (data.message) {
                        auroraReply += data.message;
                    } else {
                        auroraReply += formatJSON(data);
                    }

                    addMessage('assistant', auroraReply);

                    // Auto-refresh status after interaction
                    setTimeout(refreshStatus, 1000);

                } else {
                    throw new Error('No valid response from any Aurora endpoint');
                }

            } catch (error) {
                console.error('‚ùå Error:', error);
                addMessage('assistant', '‚ùå Communication Error: ' + error.message + '\n\nüîß Luminar Nexus v2 will attempt autonomous healing...');

                // Trigger healing via Nexus v2
                setTimeout(refreshStatus, 2000);
            }
        }

        inputField.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendMessage();
        });

        // Initialize the interface
        async function initialize() {
            addMessage('system', 'üåå Luminar Nexus v2 Advanced Interface Initialized', false);
            addMessage('system', '‚ú® Features: Quantum State Monitoring | AI Healing | Multi-Endpoint Routing', false);

            await refreshStatus();

            addMessage('assistant', 'üåü Aurora Luminar Nexus v2 ready! Advanced system orchestration is active.');
        }

        // Auto-refresh status every 30 seconds
        setInterval(refreshStatus, 30000);

        // Start the interface
        initialize();
    </script>
</body>

</html>
